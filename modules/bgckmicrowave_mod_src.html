<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>bgckmicrowave_mod source &mdash; MIDAS  documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="MIDAS  documentation" href="../index.html" /> 
  </head>
  <body>
  <div>
    <img src="../_static/MIDAS_header.png" alt="MIDAS" />
  </div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../f-modindex.html" title="Fortran Module Index"
             >fortran modules</a> |</li>
        <li><a href="../index.html">MIDAS  documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/modules/bgckmicrowave_mod_src.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <section id="bgckmicrowave-mod-source">
<h1>bgckmicrowave_mod source<a class="headerlink" href="#bgckmicrowave-mod-source" title="Permalink to this headline">Â¶</a></h1>
<blockquote>
<div><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="linenos">   1</span><span class="c">!--------------------------------------- LICENCE BEGIN -----------------------------------</span>
<span class="linenos">   2</span><span class="c">!Environment Canada - Atmospheric Science and Technology License/Disclaimer,</span>
<span class="linenos">   3</span><span class="c">!                     version 3; Last Modified: May 7, 2008.</span>
<span class="linenos">   4</span><span class="c">!This is free but copyrighted software; you can use/redistribute/modify it under the terms</span>
<span class="linenos">   5</span><span class="c">!of the Environment Canada - Atmospheric Science and Technology License/Disclaimer</span>
<span class="linenos">   6</span><span class="c">!version 3 or (at your option) any later version that should be found at:</span>
<span class="linenos">   7</span><span class="c">!http://collaboration.cmc.ec.gc.ca/science/rpn.comm/license.html</span>
<span class="linenos">   8</span><span class="c">!</span>
<span class="linenos">   9</span><span class="c">!This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;</span>
<span class="linenos">  10</span><span class="c">!without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="linenos">  11</span><span class="c">!See the above mentioned License/Disclaimer for more details.</span>
<span class="linenos">  12</span><span class="c">!You should have received a copy of the License/Disclaimer along with this software;</span>
<span class="linenos">  13</span><span class="c">!if not, you can write to: EC-RPN COMM Group, 2121 TransCanada, suite 500, Dorval (Quebec),</span>
<span class="linenos">  14</span><span class="c">!CANADA, H9P 1J3; or send e-mail to service.rpn@ec.gc.ca</span>
<span class="linenos">  15</span><span class="c">!-------------------------------------- LICENCE end --------------------------------------</span>
<span class="linenos">  16</span>
<span class="linenos">  17</span><span class="k">module </span><span class="n">bgckmicrowave_mod</span><span class="w"></span>
<span class="linenos">  18</span><span class="w">  </span><span class="c">! MODULE bgckmicrowave_mod (prefix=&#39;mwbg&#39; category=&#39;1. High-level functionality&#39;)</span>
<span class="linenos">  19</span><span class="w">  </span><span class="c">!</span>
<span class="linenos">  20</span><span class="w">  </span><span class="c">!:Purpose: Variables for microwave background check and quality control.</span>
<span class="linenos">  21</span><span class="w">  </span><span class="c">!</span>
<span class="linenos">  22</span><span class="w">  </span><span class="k">use </span><span class="n">midasMpi_mod</span><span class="w"></span>
<span class="linenos">  23</span><span class="w">  </span><span class="k">use </span><span class="n">MathPhysConstants_mod</span><span class="w"></span>
<span class="linenos">  24</span><span class="w">  </span><span class="k">use </span><span class="n">utilities_mod</span><span class="w"></span>
<span class="linenos">  25</span><span class="w">  </span><span class="k">use </span><span class="n">obsSpaceData_mod</span><span class="w"></span>
<span class="linenos">  26</span><span class="w">  </span><span class="k">use </span><span class="n">tovs_nl_mod</span><span class="w"></span>
<span class="linenos">  27</span><span class="w">  </span><span class="k">use </span><span class="n">obsErrors_mod</span><span class="w"></span>
<span class="linenos">  28</span><span class="w">  </span><span class="k">use </span><span class="n">codtyp_mod</span><span class="w"></span>
<span class="linenos">  29</span>
<span class="linenos">  30</span><span class="w">  </span><span class="k">implicit none</span>
<span class="linenos">  31</span><span class="k">  save</span>
<span class="linenos">  32</span><span class="k">  private</span><span class="w"></span>
<span class="linenos">  33</span>
<span class="linenos">  34</span><span class="w">  </span><span class="c">! Public functions/subroutines</span>
<span class="linenos">  35</span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_bgCheckMW</span><span class="w"></span>
<span class="linenos">  36</span><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_computeMwhs2SurfaceType</span><span class="w"></span>
<span class="linenos">  37</span>
<span class="linenos">  38</span><span class="w">  </span><span class="kt">real</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_clwQcThreshold</span><span class="w"></span>
<span class="linenos">  39</span><span class="w">  </span><span class="kt">real</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_cloudyClwThresholdBcorr</span><span class="w"></span>
<span class="linenos">  40</span><span class="w">  </span><span class="kt">real</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_minSiOverWaterThreshold</span><span class="w"> </span><span class="c">! for AMSUB/MHS</span>
<span class="linenos">  41</span><span class="w">  </span><span class="kt">real</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_maxSiOverWaterThreshold</span><span class="w"> </span><span class="c">! for AMSUB/MHS</span>
<span class="linenos">  42</span><span class="w">  </span><span class="kt">real</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_cloudySiThresholdBcorr</span><span class="w">  </span><span class="c">! for AMSUB/MHS</span>
<span class="linenos">  43</span><span class="w">  </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"></span>
<span class="linenos">  44</span><span class="w">  </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="w"> </span>
<span class="linenos">  45</span>
<span class="linenos">  46</span><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_maxScanAngle</span><span class="o">=</span><span class="mi">98</span><span class="w"></span>
<span class="linenos">  47</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="o">=-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span>
<span class="linenos">  48</span><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_intMissing</span><span class="o">=-</span><span class="mi">1</span><span class="w"></span>
<span class="linenos">  49</span>
<span class="linenos">  50</span><span class="w">  </span><span class="c">! Module variable</span>
<span class="linenos">  51</span>
<span class="linenos">  52</span><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_atmsNumSfcSensitiveChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="linenos">  53</span><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">128</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fileMgLg</span><span class="o">=</span><span class="s1">&#39;fstglmg&#39;</span><span class="w">  </span><span class="c">! glace de mer file</span>
<span class="linenos">  54</span><span class="w">  </span><span class="c">! Upper limit for CLW (kg/m**2) for Tb rejection over water</span>
<span class="linenos">  55</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clw_atms_nrl_LTrej</span><span class="o">=</span><span class="mf">0.175</span><span class="w">      </span><span class="c">! lower trop chans 1-6, 16-20</span>
<span class="linenos">  56</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clw_atms_nrl_UTrej</span><span class="o">=</span><span class="mf">0.2</span><span class="w">        </span><span class="c">! upper trop chans 7-9, 21-22</span>
<span class="linenos">  57</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_LTrej</span><span class="o">=</span><span class="mf">0.175</span><span class="w"></span>
<span class="linenos">  58</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_UTrej</span><span class="o">=</span><span class="mf">0.2</span><span class="w"></span>
<span class="linenos">  59</span><span class="w">  </span><span class="c">! Other NRL thresholds</span>
<span class="linenos">  60</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec_atms_nrl_LTrej</span><span class="o">=</span><span class="mf">9.0</span><span class="w">     </span><span class="c">! lower trop chans 1-6, 16-22</span>
<span class="linenos">  61</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec_atms_nrl_UTrej</span><span class="o">=</span><span class="mi">1</span><span class="mf">8.0</span><span class="w">    </span><span class="c">! upper trop chans 7-9</span>
<span class="linenos">  62</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg_atms_nrl_LTrej</span><span class="o">=</span><span class="mi">1</span><span class="mf">0.0</span><span class="w">    </span><span class="c">! lower trop chans 1-6</span>
<span class="linenos">  63</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg_atms_nrl_UTrej</span><span class="o">=</span><span class="mi">1</span><span class="mf">5.0</span><span class="w">    </span><span class="c">! upper trop chans 7-9</span>
<span class="linenos">  64</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec_mwhs2_nrl_LTrej</span><span class="o">=</span><span class="mf">9.0</span><span class="w">    </span><span class="c">! all MWHS-2 channels (over water)</span>
<span class="linenos">  65</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg_mwhs2_cmc_LANDrej</span><span class="o">=</span><span class="mf">0.0</span><span class="w">  </span><span class="c">! all MWHS-2 channels (all surfaces)</span>
<span class="linenos">  66</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg_mwhs2_cmc_ICErej</span><span class="o">=</span><span class="mi">4</span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">  67</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg_mwhs2_cmc_SEA</span><span class="o">=</span><span class="mi">1</span><span class="mf">5.0</span><span class="w"></span>
<span class="linenos">  68</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mean_Tb_183Ghz_min</span><span class="o">=</span><span class="mi">24</span><span class="mf">0.0</span><span class="w">      </span><span class="c">! min. value for Mean(Tb) chans. 18-22 </span>
<span class="linenos">  69</span><span class="w">  </span>
<span class="linenos">  70</span><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_maxNumSat</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="w"></span>
<span class="linenos">  71</span><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_maxNumChan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="linenos">  72</span><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mwbg_maxNumTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
<span class="linenos">  73</span>
<span class="linenos">  74</span><span class="w">  </span><span class="kt">integer</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">rejectionCodArray</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_maxNumTest</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">  75</span><span class="w">                                           </span><span class="n">mwbg_maxNumChan</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">  76</span><span class="w">                                           </span><span class="n">mwbg_maxNumSat</span><span class="p">)</span><span class="w"> </span><span class="c">! number of rejection </span>
<span class="linenos">  77</span><span class="w">  </span><span class="c">!                                                          per sat. per channl per test</span>
<span class="linenos">  78</span><span class="w">  </span><span class="kt">integer</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">rejectionCodArray2</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_maxNumTest</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">  79</span><span class="w">                                           </span><span class="n">mwbg_maxNumChan</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">  80</span><span class="w">                                           </span><span class="n">mwbg_maxNumSat</span><span class="p">)</span><span class="w"> </span><span class="c">! number of rejection per channl per test</span>
<span class="linenos">  81</span><span class="w">  </span><span class="c">!                                                          for ATMS 2nd category of tests</span>
<span class="linenos">  82</span>
<span class="linenos">  83</span><span class="w">  </span><span class="c">! namelist variables</span>
<span class="linenos">  84</span><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">instName</span><span class="w">                      </span><span class="c">! instrument name</span>
<span class="linenos">  85</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">clwQcThreshold</span><span class="w">                </span><span class="c">! </span>
<span class="linenos">  86</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudyClwThresholdBcorr</span><span class="w">       </span><span class="c">!</span>
<span class="linenos">  87</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">minSiOverWaterThreshold</span><span class="w">       </span><span class="c">! min scattering index over water for AMSUB/MHS</span>
<span class="linenos">  88</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">maxSiOverWaterThreshold</span><span class="w">       </span><span class="c">! max scattering index over water for AMSUB/MHS</span>
<span class="linenos">  89</span><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudySiThresholdBcorr</span><span class="w">        </span><span class="c">!</span>
<span class="linenos">  90</span><span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="w">          </span><span class="c">!</span>
<span class="linenos">  91</span><span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                       </span><span class="c">! reset Qc flags option</span>
<span class="linenos">  92</span><span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">modLSQ</span><span class="w">                        </span><span class="c">!</span>
<span class="linenos">  93</span><span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">debug</span><span class="w">                         </span><span class="c">! debug mode</span>
<span class="linenos">  94</span><span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">skipTestArr</span><span class="p">(</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w">  </span><span class="c">! array to set to skip the test</span>
<span class="linenos">  95</span>
<span class="linenos">  96</span>
<span class="linenos">  97</span><span class="w">  </span><span class="k">namelist</span><span class="w"> </span><span class="o">/</span><span class="n">nambgck</span><span class="o">/</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">clwQcThreshold</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">  98</span><span class="w">                    </span><span class="n">useUnbiasedObsForClw</span><span class="p">,</span><span class="w"> </span><span class="n">debug</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">  99</span><span class="w">                    </span><span class="n">cloudyClwThresholdBcorr</span><span class="p">,</span><span class="w"> </span><span class="n">modLSQ</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 100</span><span class="w">                    </span><span class="n">minSiOverWaterThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">maxSiOverWaterThreshold</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 101</span><span class="w">                    </span><span class="n">cloudySiThresholdBcorr</span><span class="p">,</span><span class="w"> </span><span class="n">skipTestArr</span><span class="w"></span>
<span class="linenos"> 102</span><span class="w">                    </span>
<span class="linenos"> 103</span>
<span class="linenos"> 104</span><span class="k">contains</span>
<span class="linenos"> 105</span>
<span class="linenos"> 106</span><span class="k">  subroutine </span><span class="n">mwbg_init</span><span class="p">()</span><span class="w"></span>
<span class="linenos"> 107</span><span class="w">    </span><span class="c">!</span>
<span class="linenos"> 108</span><span class="w">    </span><span class="c">!:Purpose: This subroutine reads the namelist section NAMBGCK</span>
<span class="linenos"> 109</span><span class="w">    </span><span class="c">!          for the module.</span>
<span class="linenos"> 110</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 111</span>
<span class="linenos"> 112</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos"> 113</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nulnam</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="linenos"> 114</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fnom</span><span class="p">,</span><span class="w"> </span><span class="n">fclos</span><span class="w"></span>
<span class="linenos"> 115</span>
<span class="linenos"> 116</span><span class="w">    </span><span class="c">! Default values for namelist variables</span>
<span class="linenos"> 117</span><span class="w">    </span><span class="n">debug</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 118</span><span class="w">    </span><span class="n">clwQcThreshold</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span>
<span class="linenos"> 119</span><span class="w">    </span><span class="n">useUnbiasedObsForClw</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 120</span><span class="w">    </span><span class="n">cloudyClwThresholdBcorr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="w"></span>
<span class="linenos"> 121</span><span class="w">    </span><span class="n">minSiOverWaterThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos"> 122</span><span class="w">    </span><span class="n">maxSiOverWaterThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos"> 123</span><span class="w">    </span><span class="n">cloudySiThresholdBcorr</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0</span><span class="w"></span>
<span class="linenos"> 124</span><span class="w">    </span><span class="n">RESETQC</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 125</span><span class="w">    </span><span class="n">modLSQ</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 126</span><span class="w">    </span><span class="n">skipTestArr</span><span class="p">(:)</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 127</span>
<span class="linenos"> 128</span><span class="w">    </span><span class="n">nulnam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos"> 129</span><span class="w">    </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fnom</span><span class="p">(</span><span class="n">nulnam</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;./flnml&#39;</span><span class="p">,</span><span class="s1">&#39;FTN+SEQ+R/O&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 130</span><span class="w">    </span><span class="k">read</span><span class="p">(</span><span class="n">nulnam</span><span class="p">,</span><span class="w"> </span><span class="n">nml</span><span class="o">=</span><span class="n">nambgck</span><span class="p">,</span><span class="w"> </span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 131</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">utl_abort</span><span class="p">(</span><span class="s1">&#39;mwbg_init: Error reading namelist&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 132</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mmpi_myid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">nml</span><span class="o">=</span><span class="n">nambgck</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 133</span><span class="w">    </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fclos</span><span class="p">(</span><span class="n">nulnam</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 134</span>
<span class="linenos"> 135</span><span class="w">    </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">debug</span><span class="w"></span>
<span class="linenos"> 136</span><span class="w">    </span><span class="n">mwbg_clwQcThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clwQcThreshold</span><span class="w"></span>
<span class="linenos"> 137</span><span class="w">    </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="w"></span>
<span class="linenos"> 138</span><span class="w">    </span><span class="n">mwbg_cloudyClwThresholdBcorr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudyClwThresholdBcorr</span><span class="w"></span>
<span class="linenos"> 139</span><span class="w">    </span><span class="n">mwbg_minSiOverWaterThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minSiOverWaterThreshold</span><span class="w"></span>
<span class="linenos"> 140</span><span class="w">    </span><span class="n">mwbg_maxSiOverWaterThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxSiOverWaterThreshold</span><span class="w"></span>
<span class="linenos"> 141</span><span class="w">    </span><span class="n">mwbg_cloudySiThresholdBcorr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudySiThresholdBcorr</span><span class="w"></span>
<span class="linenos"> 142</span>
<span class="linenos"> 143</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_init</span><span class="w"> </span>
<span class="linenos"> 144</span>
<span class="linenos"> 145</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 146</span><span class="w">  </span><span class="c">! ISRCHEQI function</span>
<span class="linenos"> 147</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 148</span><span class="w">  </span><span class="k">function </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">KLIST</span><span class="p">,</span><span class="w"> </span><span class="n">KENTRY</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">ISRCHEQI_out</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 149</span><span class="w">    </span><span class="c">!OBJET          Rechercher un element dans une liste (valeurs entieres).</span>
<span class="linenos"> 150</span><span class="w">    </span><span class="c">!ARGUMENTS      - indx    - output -  position de l&#39;element recherche:</span>
<span class="linenos"> 151</span><span class="w">    </span><span class="c">!                                   =0, element introuvable,</span>
<span class="linenos"> 152</span><span class="w">    </span><span class="c">!                                   &gt;0, position de l&#39;element trouve,</span>
<span class="linenos"> 153</span><span class="w">    </span><span class="c">!               - klist   - input  -  la liste</span>
<span class="linenos"> 154</span><span class="w">    </span><span class="c">!               - kentry  - input  -  l&#39;element recherche</span>
<span class="linenos"> 155</span>
<span class="linenos"> 156</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 157</span><span class="w">    </span>
<span class="linenos"> 158</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos"> 159</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">KLIST</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos"> 160</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">KENTRY</span><span class="w"></span>
<span class="linenos"> 161</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISRCHEQI_out</span><span class="w"></span>
<span class="linenos"> 162</span>
<span class="linenos"> 163</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos"> 164</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">KLEN</span><span class="p">,</span><span class="w"> </span><span class="n">JI</span><span class="w"></span>
<span class="linenos"> 165</span>
<span class="linenos"> 166</span><span class="w">    </span><span class="n">ISRCHEQI_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos"> 167</span><span class="w">    </span><span class="n">klen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">KLIST</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 168</span><span class="w">    </span><span class="k">do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">KLEN</span><span class="w"></span>
<span class="linenos"> 169</span><span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">KLIST</span><span class="p">(</span><span class="n">JI</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">KENTRY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 170</span><span class="k">          </span><span class="n">ISRCHEQI_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JI</span><span class="w"></span>
<span class="linenos"> 171</span><span class="w">          </span><span class="k">return</span>
<span class="linenos"> 172</span><span class="k">       end if</span>
<span class="linenos"> 173</span><span class="k">    end do</span>
<span class="linenos"> 174</span>
<span class="linenos"> 175</span><span class="k">  end function </span><span class="n">ISRCHEQI</span><span class="w"></span>
<span class="linenos"> 176</span>
<span class="linenos"> 177</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 178</span><span class="w">  </span><span class="c">! extractParamForGrodyRun</span>
<span class="linenos"> 179</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------  </span>
<span class="linenos"> 180</span><span class="w">  </span><span class="k">subroutine </span><span class="n">extractParamForGrodyRun</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 181</span><span class="w">                                     </span><span class="n">tb23</span><span class="p">,</span><span class="w">   </span><span class="n">tb31</span><span class="p">,</span><span class="w">   </span><span class="n">tb50</span><span class="p">,</span><span class="w">   </span><span class="n">tb53</span><span class="p">,</span><span class="w">   </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 182</span><span class="w">                                     </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb50FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb53FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FG</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 183</span>
<span class="linenos"> 184</span><span class="w">    </span><span class="c">!:Purpose: Compute  Grody parameters by extracting tb for required channels:</span>
<span class="linenos"> 185</span><span class="w">    </span><span class="c">!          - 23 Ghz = AMSU-A 1 = channel #28</span>
<span class="linenos"> 186</span><span class="w">    </span><span class="c">!          - 31 Ghz = AMSU-A 2 = channel #29</span>
<span class="linenos"> 187</span><span class="w">    </span><span class="c">!          - 50 Ghz = AMSU-A 3 = channel #30</span>
<span class="linenos"> 188</span><span class="w">    </span><span class="c">!          - 53 Ghz = AMSU-A 5 = channel #32</span>
<span class="linenos"> 189</span><span class="w">    </span><span class="c">!          - 89 Ghz = AMSU-A15 = channel #42</span>
<span class="linenos"> 190</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 191</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 192</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">                </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 193</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">   </span><span class="c">! observations channels</span>
<span class="linenos"> 194</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">         </span><span class="c">! radiances</span>
<span class="linenos"> 195</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">         </span><span class="c">! radiances o-p</span>
<span class="linenos"> 196</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! correction aux radiances</span>
<span class="linenos"> 197</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb23</span><span class="w">                            </span><span class="c">! radiance frequence 23 Ghz   </span>
<span class="linenos"> 198</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb31</span><span class="w">                            </span><span class="c">! radiance frequence 31 Ghz</span>
<span class="linenos"> 199</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb50</span><span class="w">                            </span><span class="c">! radiance frequence 50 Ghz  </span>
<span class="linenos"> 200</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb53</span><span class="w">                            </span><span class="c">! radiance frequence 53 Ghz  </span>
<span class="linenos"> 201</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89</span><span class="w">                            </span><span class="c">! radiance frequence 89 Ghz  </span>
<span class="linenos"> 202</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb23FG</span><span class="w">                          </span><span class="c">! radiance frequence 23 Ghz   </span>
<span class="linenos"> 203</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb31FG</span><span class="w">                          </span><span class="c">! radiance frequence 31 Ghz</span>
<span class="linenos"> 204</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb50FG</span><span class="w">                          </span><span class="c">! radiance frequence 50 Ghz  </span>
<span class="linenos"> 205</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb53FG</span><span class="w">                          </span><span class="c">! radiance frequence 53 Ghz  </span>
<span class="linenos"> 206</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89FG</span><span class="w">                          </span><span class="c">! radiance frequence 89 Ghz        </span>
<span class="linenos"> 207</span>
<span class="linenos"> 208</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 209</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="w"></span>
<span class="linenos"> 210</span>
<span class="linenos"> 211</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 212</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 213</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 214</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 215</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 216</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 217</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 218</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 219</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 220</span><span class="w">        </span><span class="k">else</span>
<span class="linenos"> 221</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 222</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 223</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 224</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 225</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 226</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 227</span>
<span class="linenos"> 228</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb23FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 229</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb31FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 230</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb50FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 231</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb53FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 232</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 233</span><span class="w">      </span><span class="k">else</span>
<span class="linenos"> 234</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 235</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 236</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 237</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 238</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 239</span>
<span class="linenos"> 240</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb23FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w">  </span>
<span class="linenos"> 241</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb31FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span>
<span class="linenos"> 242</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb50FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span>
<span class="linenos"> 243</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb53FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span>
<span class="linenos"> 244</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span>
<span class="linenos"> 245</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos"> 246</span><span class="k">    end do</span>
<span class="linenos"> 247</span>
<span class="linenos"> 248</span><span class="k">  end subroutine </span><span class="n">extractParamForGrodyRun</span><span class="w"></span>
<span class="linenos"> 249</span>
<span class="linenos"> 250</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 251</span><span class="w">  </span><span class="c">! extractParamForBennartzRun</span>
<span class="linenos"> 252</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------  </span>
<span class="linenos"> 253</span><span class="w">  </span><span class="k">subroutine </span><span class="n">extractParamForBennartzRun</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 254</span><span class="w">                                        </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb150</span><span class="p">,</span><span class="w"> </span><span class="n">tb1831</span><span class="p">,</span><span class="w"> </span><span class="n">tb1832</span><span class="p">,</span><span class="w"> </span><span class="n">tb1833</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 255</span><span class="w">                                        </span><span class="n">tb89FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 256</span>
<span class="linenos"> 257</span><span class="w">    </span><span class="c">!:Purpose: Extract Parameters required to run bennaertz for required channels:</span>
<span class="linenos"> 258</span><span class="w">    </span><span class="c">!          extract required channels:        </span>
<span class="linenos"> 259</span><span class="w">    </span><span class="c">!          89 Ghz = AMSU-B 1 = channel #43</span>
<span class="linenos"> 260</span><span class="w">    </span><span class="c">!         150 Ghz = AMSU-B 2 = channel #44</span>
<span class="linenos"> 261</span>
<span class="linenos"> 262</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 263</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 264</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">                </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 265</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">   </span><span class="c">! observations channels</span>
<span class="linenos"> 266</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">         </span><span class="c">! radiances</span>
<span class="linenos"> 267</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">btClear</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! clear-sky radiances from background</span>
<span class="linenos"> 268</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">         </span><span class="c">! radiances o-p</span>
<span class="linenos"> 269</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! correction aux radiances</span>
<span class="linenos"> 270</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89</span><span class="w">                            </span><span class="c">! 89GHz radiance from observation</span>
<span class="linenos"> 271</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb150</span><span class="w">                           </span><span class="c">! 150GHz radiance from observation</span>
<span class="linenos"> 272</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb1831</span><span class="w">                          </span><span class="c">! 183GHz radiance from observation</span>
<span class="linenos"> 273</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb1832</span><span class="w">                          </span><span class="c">! 183GHz radiance from observation</span>
<span class="linenos"> 274</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb1833</span><span class="w">                          </span><span class="c">! 183GHz radiance from observation</span>
<span class="linenos"> 275</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89FG</span><span class="w">                          </span><span class="c">! 89GHz radiance from background</span>
<span class="linenos"> 276</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb150FG</span><span class="w">                         </span><span class="c">! 150GHz radiance from background</span>
<span class="linenos"> 277</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="w">                     </span><span class="c">! 89GHz clear-sky radiance from background</span>
<span class="linenos"> 278</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="w">                    </span><span class="c">! 150GHz clear-sky radiance from background</span>
<span class="linenos"> 279</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 280</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">channelval</span><span class="w"></span>
<span class="linenos"> 281</span>
<span class="linenos"> 282</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 283</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 284</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 285</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 286</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 287</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb150</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 288</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1831</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 289</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1832</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 290</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1833</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 291</span><span class="w">        </span><span class="k">else</span>
<span class="linenos"> 292</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 293</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb150</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 294</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1831</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 295</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1832</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 296</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1833</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 297</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 298</span>
<span class="linenos"> 299</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89FG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 300</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb150FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 301</span><span class="w">        </span>
<span class="linenos"> 302</span><span class="w">      </span><span class="k">else</span>
<span class="linenos"> 303</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 304</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb150</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 305</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1831</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 306</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1832</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 307</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb1833</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 308</span>
<span class="linenos"> 309</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb89FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 310</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tb150FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<span class="linenos"> 311</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos"> 312</span>
<span class="linenos"> 313</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">btClear</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 314</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="p">)</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btClear</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 315</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">btClear</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 316</span><span class="w">      </span><span class="k">else</span>
<span class="linenos"> 317</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">43</span><span class="p">)</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos"> 318</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w">       </span>
<span class="linenos"> 319</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos"> 320</span>
<span class="linenos"> 321</span><span class="k">    end do</span>
<span class="linenos"> 322</span>
<span class="linenos"> 323</span><span class="k">  end subroutine </span><span class="n">extractParamForBennartzRun</span><span class="w"></span>
<span class="linenos"> 324</span>
<span class="linenos"> 325</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 326</span><span class="w">  </span><span class="c">! amsuABTest10RttovRejectCheck</span>
<span class="linenos"> 327</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 328</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest10RttovRejectCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 329</span><span class="w">                                          </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 330</span>
<span class="linenos"> 331</span><span class="w">    </span><span class="c">!:Purpose:               10) test 10: RTTOV reject check (single)</span>
<span class="linenos"> 332</span><span class="w">    </span><span class="c">!                        Rejected datum flag has bit #9 on.</span>
<span class="linenos"> 333</span>
<span class="linenos"> 334</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 335</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 336</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 337</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 338</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 339</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                       </span><span class="c">! yes or not reset QC flag</span>
<span class="linenos"> 340</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 341</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 342</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 343</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 344</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">IBIT</span><span class="w"></span>
<span class="linenos"> 345</span>
<span class="linenos"> 346</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 347</span><span class="k">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="linenos"> 348</span><span class="w">      </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 349</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 350</span><span class="k">          </span><span class="n">IBIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">AND</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 351</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IBIT</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 352</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 353</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 354</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 355</span><span class="w">                  </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 356</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_DEBUG</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 357</span><span class="k">              write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; RTTOV REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 358</span><span class="w">                        </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 359</span><span class="w">                        </span><span class="s1">&#39; obsFlags= &#39;</span><span class="p">,</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 360</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos"> 361</span><span class="k">          end if</span>
<span class="linenos"> 362</span><span class="k">        end if</span>
<span class="linenos"> 363</span><span class="k">      end do</span>
<span class="linenos"> 364</span><span class="k">    end if</span>
<span class="linenos"> 365</span>
<span class="linenos"> 366</span><span class="k">  end subroutine </span><span class="n">amsuABTest10RttovRejectCheck</span><span class="w"></span>
<span class="linenos"> 367</span>
<span class="linenos"> 368</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 369</span><span class="w">  </span><span class="c">! amsuABTest1TopographyCheck</span>
<span class="linenos"> 370</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 371</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest1TopographyCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 372</span><span class="w">                                        </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">,</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 373</span><span class="w">                                        </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 374</span>
<span class="linenos"> 375</span><span class="w">    </span><span class="c">!:Purpose:               1) test 1: Topography check (partial)</span>
<span class="linenos"> 376</span><span class="w">    </span><span class="c">!                        Channel 6 is rejected for topography &gt;  250m.</span>
<span class="linenos"> 377</span><span class="w">    </span><span class="c">!                        Channel 7 is rejected for topography &gt; 2000m.</span>
<span class="linenos"> 378</span>
<span class="linenos"> 379</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 380</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 381</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 382</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 383</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 384</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 385</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">(:)</span><span class="w">       </span><span class="c">! channel list for filter</span>
<span class="linenos"> 386</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">(:)</span><span class="w">      </span><span class="c">! altitude threshold</span>
<span class="linenos"> 387</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">            </span><span class="c">! topo aux point d&#39;obs</span>
<span class="linenos"> 388</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 389</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 390</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 391</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">numFilteringTest</span><span class="p">,</span><span class="w"> </span><span class="n">indexFilteringTest</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 392</span>
<span class="linenos"> 393</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 394</span>
<span class="linenos"> 395</span><span class="w">    </span><span class="c">!check consistency between channelForTopoFilter and altitudeForTopoFilter</span>
<span class="linenos"> 396</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">altitudeForTopoFilter</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">channelForTopoFilter</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos"> 397</span><span class="k">      call </span><span class="n">utl_abort</span><span class="p">(</span><span class="s1">&#39;ABORT: amsuABTest1TopographyCheck, no consistency between channel List and altitude list &#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 398</span><span class="w">    </span><span class="k">end if </span>
<span class="linenos"> 399</span><span class="k">   </span>
<span class="linenos"> 400</span><span class="k">    </span><span class="n">numFilteringTest</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">size</span><span class="p">(</span><span class="n">altitudeForTopoFilter</span><span class="p">)</span><span class="w"> </span>
<span class="linenos"> 401</span><span class="w">    </span><span class="n">indexFilteringTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 402</span>
<span class="linenos"> 403</span><span class="w">    </span><span class="k">do while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">indexFilteringTest</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">numFilteringTest</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 404</span><span class="w">      </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 405</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">(</span><span class="n">indexFilteringTest</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 406</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">modelInterpTerrain</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">(</span><span class="n">indexFilteringTest</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 407</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 408</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 409</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">18</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 410</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 411</span><span class="w">                  </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 412</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_DEBUG</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 413</span><span class="k">              write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; TOPOGRAPHY REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 414</span><span class="w">                        </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 415</span><span class="w">                        </span><span class="s1">&#39; TOPO= &#39;</span><span class="p">,</span><span class="n">modelInterpTerrain</span><span class="w"></span>
<span class="linenos"> 416</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos"> 417</span><span class="k">          end if</span>
<span class="linenos"> 418</span><span class="k">        end if</span>
<span class="linenos"> 419</span><span class="k">      end do</span>
<span class="linenos"> 420</span><span class="k">      </span><span class="n">indexFilteringTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexFilteringTest</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 421</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos"> 422</span>
<span class="linenos"> 423</span><span class="k">  end subroutine </span><span class="n">amsuABTest1TopographyCheck</span><span class="w"></span>
<span class="linenos"> 424</span>
<span class="linenos"> 425</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 426</span><span class="w">  </span><span class="c">! amsuABTest2LandSeaQualifierCheck </span>
<span class="linenos"> 427</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 428</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest2LandSeaQualifierCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 429</span><span class="w">                                              </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 430</span>
<span class="linenos"> 431</span><span class="w">    </span><span class="c">!:Purpose:                      2) test 2: &quot;Land/sea qualifier&quot; code check (full)</span>
<span class="linenos"> 432</span><span class="w">    </span><span class="c">!                                  allowed values are: 0 land, 1 sea, 2 coast.</span>
<span class="linenos"> 433</span>
<span class="linenos"> 434</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 435</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 436</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 437</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 438</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 439</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 440</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea qualifier</span>
<span class="linenos"> 441</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 442</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 443</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 444</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 445</span>
<span class="linenos"> 446</span><span class="w">  </span>
<span class="linenos"> 447</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="linenos"> 448</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 449</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 450</span><span class="w">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 451</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 452</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 453</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 454</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 455</span><span class="w">      </span><span class="k">end do</span>
<span class="linenos"> 456</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_DEBUG</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 457</span><span class="k">        write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;LAND/SEA QUALifIER CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 458</span><span class="w">                  </span><span class="s1">&#39; REJECT. landQualifierIndice=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos"> 459</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos"> 460</span><span class="k">    end if</span>
<span class="linenos"> 461</span>
<span class="linenos"> 462</span><span class="k">  end subroutine </span><span class="n">amsuABTest2LandSeaQualifierCheck</span><span class="w"></span>
<span class="linenos"> 463</span>
<span class="linenos"> 464</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 465</span><span class="w">  </span><span class="c">!  amsuABTest3TerrainTypeCheck</span>
<span class="linenos"> 466</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 467</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest3TerrainTypeCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 468</span><span class="w">                                         </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 469</span>
<span class="linenos"> 470</span><span class="w">    </span><span class="c">!:Purpose:                     3) test 3: &quot;Terrain type&quot; code check (full)</span>
<span class="linenos"> 471</span><span class="w">    </span><span class="c">!                                 allowed values are: -1 missing, 0 sea-ice, 1 snow on land.</span>
<span class="linenos"> 472</span>
<span class="linenos"> 473</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 474</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 475</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 476</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 477</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 478</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 479</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">             </span><span class="c">! terrain type</span>
<span class="linenos"> 480</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 481</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 482</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 483</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 484</span>
<span class="linenos"> 485</span><span class="w"> </span>
<span class="linenos"> 486</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="linenos"> 487</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_intMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 488</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 489</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 490</span><span class="w">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 491</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 492</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 493</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 494</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 495</span><span class="w">        </span><span class="k">end do</span>
<span class="linenos"> 496</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 497</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;TERRAIN type CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 498</span><span class="w">                    </span><span class="s1">&#39; REJECT. TERRAIN=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos"> 499</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 500</span><span class="k">      end if</span>
<span class="linenos"> 501</span><span class="k">    end if</span>
<span class="linenos"> 502</span>
<span class="linenos"> 503</span><span class="k">  end subroutine </span><span class="n">amsuABTest3TerrainTypeCheck</span><span class="w"></span>
<span class="linenos"> 504</span>
<span class="linenos"> 505</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 506</span><span class="w">  </span><span class="c">! amsuABTest4FieldOfViewCheck </span>
<span class="linenos"> 507</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 508</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest4FieldOfViewCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 509</span><span class="w">                                         </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 510</span>
<span class="linenos"> 511</span><span class="w">    </span><span class="c">!:Purpose:                          4) test 4: Field of view number check (full)</span>
<span class="linenos"> 512</span><span class="w">    </span><span class="c">!                                      Field of view acceptable range is [1,maxScanAngleAMSU]  for AMSU footprints.</span>
<span class="linenos"> 513</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 514</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 515</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 516</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 517</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 518</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 519</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">               </span><span class="c">! position sur le &quot;scan&quot; </span>
<span class="linenos"> 520</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w">              </span><span class="c">! max scan angle </span>
<span class="linenos"> 521</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 522</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 523</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 524</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 525</span>
<span class="linenos"> 526</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="linenos"> 527</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 528</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 529</span><span class="k">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 530</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 531</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 532</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 533</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 534</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 535</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;FIELD OF VIEW NUMBER&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 536</span><span class="w">                    </span><span class="s1">&#39; REJECT. FIELD OF VIEW= &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"></span>
<span class="linenos"> 537</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 538</span><span class="k">      end if</span>
<span class="linenos"> 539</span><span class="k">    end do</span>
<span class="linenos"> 540</span><span class="k">  </span>
<span class="linenos"> 541</span><span class="k">  end subroutine </span><span class="n">amsuABTest4FieldOfViewCheck</span><span class="w"> </span>
<span class="linenos"> 542</span><span class="w">  </span>
<span class="linenos"> 543</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 544</span><span class="w">  </span><span class="c">! amsuABTest5ZenithAngleCheck </span>
<span class="linenos"> 545</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 546</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest5ZenithAngleCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 547</span><span class="w">                                         </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 548</span>
<span class="linenos"> 549</span><span class="w">    </span><span class="c">!:Purpose:                   5) test 5: Satellite zenith angle check (full)</span>
<span class="linenos"> 550</span><span class="w">    </span><span class="c">!                               Satellite zenith angle acceptable range is [0.,60.].</span>
<span class="linenos"> 551</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 552</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 553</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 554</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 555</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 556</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 557</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">                </span><span class="c">! satellite zenith angle </span>
<span class="linenos"> 558</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 559</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 560</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 561</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 562</span>
<span class="linenos"> 563</span>
<span class="linenos"> 564</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="linenos"> 565</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 566</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">6</span><span class="mf">0.</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 567</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 568</span><span class="w">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 569</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 570</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 571</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 572</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 573</span><span class="w">        </span><span class="k">end do</span>
<span class="linenos"> 574</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 575</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; SATELLITE ZENITH ANGLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 576</span><span class="w">                    </span><span class="s1">&#39; REJECT. satZenithAngle= &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 577</span><span class="w">                    </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos"> 578</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 579</span><span class="k">      end if</span>
<span class="linenos"> 580</span><span class="k">    end if</span>
<span class="linenos"> 581</span>
<span class="linenos"> 582</span><span class="k">  end subroutine </span><span class="n">amsuABTest5ZenithAngleCheck</span><span class="w"> </span>
<span class="linenos"> 583</span>
<span class="linenos"> 584</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 585</span><span class="w">  </span><span class="c">! amsuABTest6ZenAngleAndFovConsistencyCheck </span>
<span class="linenos"> 586</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 587</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest6ZenAngleAndFovConsistencyCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 588</span><span class="w">                                                       </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">ZANGL</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 589</span><span class="w">                                                       </span><span class="n">maxScanAngleAMSU</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 590</span>
<span class="linenos"> 591</span><span class="w">    </span><span class="c">!:Purpose:                            6) test 6: &quot;Sat. zenith angle&quot;/&quot;field of view&quot; consistency check.  (full)</span>
<span class="linenos"> 592</span><span class="w">    </span><span class="c">!                                        Acceptable difference between &quot;Satellite zenith angle&quot;  and</span>
<span class="linenos"> 593</span><span class="w">    </span><span class="c">!                                       &quot;approximate angle computed from field of view number&quot; is 1.8 degrees.</span>
<span class="linenos"> 594</span>
<span class="linenos"> 595</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 596</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 597</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 598</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 599</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 600</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 601</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">                </span><span class="c">! satellite zenith angle </span>
<span class="linenos"> 602</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ZANGL</span><span class="w">                         </span><span class="c">! satellite constant param</span>
<span class="linenos"> 603</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">               </span><span class="c">! position sur le &quot;scan&quot; </span>
<span class="linenos"> 604</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w">              </span><span class="c">! max scan angle </span>
<span class="linenos"> 605</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 606</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 607</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 608</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 609</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">APPROXIM</span><span class="p">,</span><span class="w"> </span><span class="n">ANGDif</span><span class="w"> </span>
<span class="linenos"> 610</span>
<span class="linenos"> 611</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="linenos"> 612</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">/=</span><span class="w">  </span><span class="n">mwbg_intMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 613</span><span class="k">      </span><span class="n">APPROXIM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">((</span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ZANGL</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 614</span><span class="w">      </span><span class="n">ANGDif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">APPROXIM</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 615</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ANGDif</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.8</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos"> 616</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 617</span><span class="w">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 618</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 619</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 620</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 621</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 622</span><span class="w">        </span><span class="k">end do</span>
<span class="linenos"> 623</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 624</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; ANGLE/FIELD OF VIEW&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 625</span><span class="w">                    </span><span class="s1">&#39; INCONSISTENCY REJECT. satZenithAngle= &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 626</span><span class="w">                    </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; FIELD OF VIEW= &#39;</span><span class="p">,</span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 627</span><span class="w">                    </span><span class="s1">&#39; ANGDif= &#39;</span><span class="p">,</span><span class="n">ANGDif</span><span class="w">  </span>
<span class="linenos"> 628</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 629</span><span class="k">      end if</span>
<span class="linenos"> 630</span><span class="k">    end if</span>
<span class="linenos"> 631</span>
<span class="linenos"> 632</span><span class="k">  end subroutine </span><span class="n">amsuABTest6ZenAngleAndFovConsistencyCheck</span><span class="w"></span>
<span class="linenos"> 633</span>
<span class="linenos"> 634</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 635</span><span class="w">  </span><span class="c">!  amsuABTest7landSeaQualifyerAndModelLandSeaConsistencyCheck</span>
<span class="linenos"> 636</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 637</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest7landSeaQualifyerAndModelLandSeaConsistencyCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 638</span><span class="w">                                                                        </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 639</span><span class="w">                                                                        </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 640</span>
<span class="linenos"> 641</span><span class="w">    </span><span class="c">!:Purpose: test 7: &quot;Land/sea qual.&quot;/&quot;model land/sea&quot; consistency check (full)</span>
<span class="linenos"> 642</span><span class="w">    </span><span class="c">!          Acceptable conditions are:</span>
<span class="linenos"> 643</span><span class="w">    </span><span class="c">!            - both over ocean (landQualifierIndice=1; mg&lt;0.01), new threshold 0.20, jh dec 2000,</span>
<span class="linenos"> 644</span><span class="w">    </span><span class="c">!            - both over land  (landQualifierIndice=0; mg&gt;0.80), new threshold 0.50, jh dec 2000.</span>
<span class="linenos"> 645</span><span class="w">    </span><span class="c">!            - Other conditions are unacceptable.</span>
<span class="linenos"> 646</span>
<span class="linenos"> 647</span>
<span class="linenos"> 648</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 649</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 650</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 651</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 652</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 653</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 654</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w">           </span><span class="c">! model interpolated land fraction</span>
<span class="linenos"> 655</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea qualifyer </span>
<span class="linenos"> 656</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 657</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 658</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 659</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 660</span>
<span class="linenos"> 661</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="linenos"> 662</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_intMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 663</span><span class="w">        </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.20</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 664</span><span class="w">        </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.50</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 665</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 666</span><span class="w">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 667</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 668</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 669</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 670</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 671</span><span class="w">      </span><span class="k">end do</span>
<span class="linenos"> 672</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 673</span><span class="k">        write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; LAND/SEA QUALifIER&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 674</span><span class="w">                  </span><span class="s1">&#39; INCONSISTENCY REJECT. landQualifierIndice= &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 675</span><span class="w">                  </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; MODEL MASK= &#39;</span><span class="p">,</span><span class="n">modelInterpLandFrac</span><span class="w"></span>
<span class="linenos"> 676</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos"> 677</span><span class="k">    end if</span>
<span class="linenos"> 678</span>
<span class="linenos"> 679</span><span class="k">  end subroutine </span><span class="n">amsuABTest7landSeaQualifyerAndModelLandSeaConsistencyCheck</span><span class="w"> </span>
<span class="linenos"> 680</span>
<span class="linenos"> 681</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 682</span><span class="w">  </span><span class="c">!  amsuABTest9UncorrectedTbCheck</span>
<span class="linenos"> 683</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 684</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest9UncorrectedTbCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 685</span><span class="w">                                           </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 686</span>
<span class="linenos"> 687</span><span class="w">    </span><span class="c">!:Purpose:                  9) test 9: Uncorrected Tb check (single)</span>
<span class="linenos"> 688</span><span class="w">    </span><span class="c">!                              Uncorrected datum (flag bit #6 off). In this case switch bit 11 ON.</span>
<span class="linenos"> 689</span>
<span class="linenos"> 690</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 691</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 692</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 693</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 694</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 695</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 696</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                       </span><span class="c">! yes or not reset QC flag</span>
<span class="linenos"> 697</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 698</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 699</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 700</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">IBIT</span><span class="w"></span>
<span class="linenos"> 701</span>
<span class="linenos"> 702</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">RESETQC</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos"> 703</span><span class="k">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="linenos"> 704</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 705</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 706</span><span class="k">        </span><span class="n">IBIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">AND</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 707</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">IBIT</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 708</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 709</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 710</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 711</span><span class="w">                </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 712</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 713</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; UNCORRECTED TB REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 714</span><span class="w">                        </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39; obsFlags= &#39;</span><span class="p">,</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 715</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 716</span><span class="k">        end if</span>
<span class="linenos"> 717</span><span class="k">      end if</span>
<span class="linenos"> 718</span><span class="k">    end do</span>
<span class="linenos"> 719</span>
<span class="linenos"> 720</span><span class="k">  end subroutine </span><span class="n">amsuABTest9UncorrectedTbCheck</span><span class="w"></span>
<span class="linenos"> 721</span><span class="w"> </span>
<span class="linenos"> 722</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 723</span><span class="w">  </span><span class="c">! amsuABTest11RadianceGrossValueCheck</span>
<span class="linenos"> 724</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 725</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest11RadianceGrossValueCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 726</span><span class="w">                                                 </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 727</span>
<span class="linenos"> 728</span><span class="w">    </span><span class="c">!:Purpose:                     11) test 11: Radiance observation &quot;Gross&quot; check (single) </span>
<span class="linenos"> 729</span><span class="w">    </span><span class="c">!                                               Change this test from full to single. jh nov 2000.</span>
<span class="linenos"> 730</span>
<span class="linenos"> 731</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 732</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 733</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 734</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 735</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 736</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 737</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiances </span>
<span class="linenos"> 738</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">(:)</span><span class="w">                   </span><span class="c">! Gross val min </span>
<span class="linenos"> 739</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">(:)</span><span class="w">                   </span><span class="c">! Gross val max </span>
<span class="linenos"> 740</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 741</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 742</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 743</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSERROR</span><span class="w"></span>
<span class="linenos"> 744</span>
<span class="linenos"> 745</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="linenos"> 746</span><span class="w">    </span><span class="n">GROSSERROR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 747</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 748</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 749</span><span class="w">          </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="k">then  </span>
<span class="linenos"> 750</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 751</span><span class="w">            </span><span class="p">(</span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 752</span><span class="w">             </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 753</span><span class="k">          </span><span class="n">GROSSERROR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 754</span><span class="w">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 755</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 756</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 757</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 758</span><span class="w">                  </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 759</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 760</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; GROSS CHECK REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 761</span><span class="w">                      </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39; TB= &#39;</span><span class="p">,</span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 762</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 763</span><span class="k">        end if</span>
<span class="linenos"> 764</span><span class="k">      end if</span>
<span class="linenos"> 765</span><span class="k">    end do</span>
<span class="linenos"> 766</span>
<span class="linenos"> 767</span><span class="k">  end subroutine </span><span class="n">amsuABTest11RadianceGrossValueCheck</span><span class="w"> </span>
<span class="linenos"> 768</span><span class="w">  </span>
<span class="linenos"> 769</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 770</span><span class="w">  </span><span class="c">! amsuaTest12GrodyClwCheck</span>
<span class="linenos"> 771</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 772</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuaTest12GrodyClwCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 773</span><span class="w">                                      </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 774</span><span class="w">                                      </span><span class="n">ICLWREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 775</span>
<span class="linenos"> 776</span><span class="w">    </span><span class="c">!:Purpose:                    12) test 12: Grody cloud liquid water check (partial)</span>
<span class="linenos"> 777</span><span class="w">    </span><span class="c">!                                 For Cloud Liquid Water &gt; clwQcThreshold, reject AMSUA-A channels 1-5 and 15.</span>
<span class="linenos"> 778</span>
<span class="linenos"> 779</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 780</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 781</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 782</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 783</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 784</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 785</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w">       </span><span class="c">! retrieved cloud liquid water from observation</span>
<span class="linenos"> 786</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">        </span><span class="c">! retrieved cloud liquid water from background</span>
<span class="linenos"> 787</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea qualifyer </span>
<span class="linenos"> 788</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICLWREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos"> 789</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 790</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 791</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 792</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span>
<span class="linenos"> 793</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clwUsedForQC</span><span class="p">,</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"></span>
<span class="linenos"> 794</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="p">,</span><span class="w"> </span><span class="n">cldPredMissing</span><span class="w"></span>
<span class="linenos"> 795</span>
<span class="linenos"> 796</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="w"></span>
<span class="linenos"> 797</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 798</span><span class="k">      </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 799</span><span class="w">      </span><span class="n">clwUsedForQC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"></span>
<span class="linenos"> 800</span><span class="w">      </span><span class="n">cldPredMissing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 801</span><span class="w">    </span><span class="k">else</span>
<span class="linenos"> 802</span><span class="k">      </span><span class="n">clwUsedForQC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos"> 803</span><span class="w">      </span><span class="n">cldPredMissing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 804</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos"> 805</span>
<span class="linenos"> 806</span><span class="k">    </span><span class="n">surfTypeIsWater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 807</span>
<span class="linenos"> 808</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">cldPredMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 809</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">clwUsedForQC</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_clwQcThreshold</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 810</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 811</span><span class="w">          </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICLWREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 812</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos"> 813</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 814</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 815</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 816</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 817</span><span class="w">                      </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 818</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 819</span><span class="k">        end do</span>
<span class="linenos"> 820</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 821</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;Grody cloud liquid water check&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 822</span><span class="w">                    </span><span class="s1">&#39; REJECT. CLW= &#39;</span><span class="p">,</span><span class="n">clwUsedForQC</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; SEUIL= &#39;</span><span class="p">,</span><span class="n">mwbg_clwQcThreshold</span><span class="w"></span>
<span class="linenos"> 823</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 824</span><span class="k">      end if</span><span class="w"></span>
<span class="linenos"> 825</span>
<span class="linenos"> 826</span><span class="w">      </span><span class="c">! In all-sky mode, turn on bit=23 for channels in ICLWREJ(:) as </span>
<span class="linenos"> 827</span><span class="w">      </span><span class="c">! cloud-affected radiances over sea when there is mismatch between </span>
<span class="linenos"> 828</span><span class="w">      </span><span class="c">! cloudLiquidWaterPathObs and cloudLiquidWaterPathFG (to be used in gen_bias_corr)</span>
<span class="linenos"> 829</span><span class="w">      </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 830</span><span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_cloudyClwThresholdBcorr</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 831</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 832</span><span class="w">          </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICLWREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 833</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">23</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 834</span><span class="w">        </span><span class="k">end do</span>
<span class="linenos"> 835</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 836</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; Grody cloud liquid water check&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 837</span><span class="w">                    </span><span class="s1">&#39; cloud-affected obs. CLW= &#39;</span><span class="p">,</span><span class="n">clwUsedForQC</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;, threshold= &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 838</span><span class="w">                    </span><span class="n">mwbg_cloudyClwThresholdBcorr</span><span class="w"></span>
<span class="linenos"> 839</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 840</span><span class="k">      end if</span><span class="w"></span>
<span class="linenos"> 841</span>
<span class="linenos"> 842</span><span class="w">    </span><span class="c">! Reject surface sensitive observations over water, in all-sky mode, </span>
<span class="linenos"> 843</span><span class="w">    </span><span class="c">! if CLW is not retrieved, and is needed to define obs error.</span>
<span class="linenos"> 844</span><span class="w">    </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">cldPredMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 845</span><span class="k">      </span><span class="n">loopChannel</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 846</span><span class="w">        </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 847</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICLWREJ</span><span class="p">,</span><span class="n">channelval</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 848</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">oer_useStateDepSigmaObs</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 849</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 850</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 851</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 852</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 853</span><span class="w">                    </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 854</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 855</span><span class="k">      end do </span><span class="n">loopChannel</span><span class="w"></span>
<span class="linenos"> 856</span>
<span class="linenos"> 857</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos"> 858</span>
<span class="linenos"> 859</span><span class="k">  end subroutine </span><span class="n">amsuaTest12GrodyClwCheck</span><span class="w"> </span>
<span class="linenos"> 860</span>
<span class="linenos"> 861</span><span class="w">  </span><span class="c">!-------------------------------------------------------------------------</span>
<span class="linenos"> 862</span><span class="w">  </span><span class="c">! amsubTest12DrynessIndexCheck</span>
<span class="linenos"> 863</span><span class="w">  </span><span class="c">!-------------------------------------------------------------------------</span>
<span class="linenos"> 864</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsubTest12DrynessIndexCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 865</span><span class="w">                                          </span><span class="n">tb1831</span><span class="p">,</span><span class="w"> </span><span class="n">tb1833</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 866</span><span class="w">                                          </span><span class="n">skipTestArr_opt</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 867</span>
<span class="linenos"> 868</span><span class="w">    </span><span class="c">!:Purpose:  12) test 12: Dryness index check</span>
<span class="linenos"> 869</span><span class="w">    </span><span class="c">!           The difference between channels AMSUB-3 and AMSUB-5 is used as an indicator</span>
<span class="linenos"> 870</span><span class="w">    </span><span class="c">!           of &quot;dryness&quot; of the atmosphere. In extreme dry conditions, channels AMSUB-3 4 and 5</span>
<span class="linenos"> 871</span><span class="w">    </span><span class="c">!           are sensitive to the surface.</span>
<span class="linenos"> 872</span><span class="w">    </span><span class="c">!           Therefore, various thresholds are used to reject channels AMSUB-3 4 and 5 over land and ice</span>
<span class="linenos"> 873</span>
<span class="linenos"> 874</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 875</span>
<span class="linenos"> 876</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos"> 877</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 878</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 879</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 880</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 881</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb1831</span><span class="w">                        </span><span class="c">! tb for channel  </span>
<span class="linenos"> 882</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb1833</span><span class="w">                        </span><span class="c">! tb for channel  </span>
<span class="linenos"> 883</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! mask terre-mer</span>
<span class="linenos"> 884</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">             </span><span class="c">! topo interpolated to obs point</span>
<span class="linenos"> 885</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 886</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 887</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="kd">::</span><span class="w"> </span><span class="n">skipTestArr_opt</span><span class="p">(:)</span><span class="w">            </span><span class="c">! array to set to skip the test</span>
<span class="linenos"> 888</span>
<span class="linenos"> 889</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos"> 890</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos"> 891</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">drynessIndex</span><span class="w"></span>
<span class="linenos"> 892</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 893</span>
<span class="linenos"> 894</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="w"></span>
<span class="linenos"> 895</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">skipTestArr_opt</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 896</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">skipTestArr_opt</span><span class="p">(</span><span class="n">testIndex</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 897</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">firstCall</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 898</span><span class="k">          </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos"> 899</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;amsubTest12DrynessIndexCheck: skipping this test&#39;</span><span class="w"></span>
<span class="linenos"> 900</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 901</span><span class="k">        return</span>
<span class="linenos"> 902</span><span class="k">      end if</span>
<span class="linenos"> 903</span><span class="k">    end if</span>
<span class="linenos"> 904</span>
<span class="linenos"> 905</span><span class="k">    </span><span class="n">drynessIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb1831</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb1833</span><span class="w"></span>
<span class="linenos"> 906</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 907</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">((</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 908</span><span class="w">                  </span><span class="p">(</span><span class="n">modelInterpSeaIce</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.01</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 909</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">drynessIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 910</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 911</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 912</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 913</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 914</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 915</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 916</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; DRYNESS INDEX REJECT.&#39;</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 917</span><span class="w">                      </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 918</span><span class="w">                      </span><span class="s1">&#39;INDEX= &#39;</span><span class="p">,</span><span class="n">drynessIndex</span><span class="w"></span>
<span class="linenos"> 919</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 920</span><span class="k">        else if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">drynessIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="mf">0.</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 921</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 922</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 923</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 924</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 925</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 926</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 927</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; DRYNESS INDEX REJECT.&#39;</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 928</span><span class="w">                    </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),&amp;</span><span class="w"></span>
<span class="linenos"> 929</span><span class="w">                    </span><span class="s1">&#39;INDEX= &#39;</span><span class="p">,</span><span class="n">drynessIndex</span><span class="w"></span>
<span class="linenos"> 930</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 931</span><span class="k">        else if</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">drynessIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="mf">0.</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 932</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 933</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 934</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 935</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 936</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 937</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 938</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; DRYNESS INDEX REJECT.&#39;</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 939</span><span class="w">                      </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),&amp;</span><span class="w"></span>
<span class="linenos"> 940</span><span class="w">                      </span><span class="s1">&#39;INDEX= &#39;</span><span class="p">,</span><span class="n">drynessIndex</span><span class="w"></span>
<span class="linenos"> 941</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 942</span><span class="k">        end if</span>
<span class="linenos"> 943</span><span class="k">      end if</span>
<span class="linenos"> 944</span><span class="k">    end do</span>
<span class="linenos"> 945</span>
<span class="linenos"> 946</span><span class="k">  end subroutine </span><span class="n">amsubTest12DrynessIndexCheck</span><span class="w"></span>
<span class="linenos"> 947</span>
<span class="linenos"> 948</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 949</span><span class="w">  </span><span class="c">! amsuaTest13GrodyScatteringIndexCheck</span>
<span class="linenos"> 950</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos"> 951</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuaTest13GrodyScatteringIndexCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 952</span><span class="w">                                                  </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 953</span><span class="w">                                                  </span><span class="n">ISCATREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 954</span>
<span class="linenos"> 955</span><span class="w">    </span><span class="c">!:Purpose:                  13) test 13: Grody scattering index check (partial)</span>
<span class="linenos"> 956</span><span class="w">    </span><span class="c">!                               For Scattering Index &gt; 9, reject AMSUA-A channels 1-6 and 15.</span>
<span class="linenos"> 957</span>
<span class="linenos"> 958</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos"> 959</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos"> 960</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos"> 961</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos"> 962</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos"> 963</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos"> 964</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">         </span><span class="c">! scattering index </span>
<span class="linenos"> 965</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea qualifyer </span>
<span class="linenos"> 966</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">             </span><span class="c">! terrain type </span>
<span class="linenos"> 967</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISCATREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos"> 968</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos"> 969</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos"> 970</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos"> 971</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span>
<span class="linenos"> 972</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ZSEUILSCAT</span><span class="w"></span>
<span class="linenos"> 973</span>
<span class="linenos"> 974</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="w"></span>
<span class="linenos"> 975</span><span class="w">    </span><span class="n">ZSEUILSCAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.0</span><span class="w"></span>
<span class="linenos"> 976</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 977</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w">  </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w">   </span>
<span class="linenos"> 978</span><span class="w">          </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ZSEUILSCAT</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 979</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos"> 980</span><span class="w">          </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ISCATREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 981</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos"> 982</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 983</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 984</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 985</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 986</span><span class="w">                      </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos"> 987</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos"> 988</span><span class="k">        end do</span>
<span class="linenos"> 989</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos"> 990</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;Grody scattering index check&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos"> 991</span><span class="w">                      </span><span class="s1">&#39; REJECT. scatIndexOverWaterObs= &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; SEUIL= &#39;</span><span class="p">,</span><span class="n">ZSEUILSCAT</span><span class="w"></span>
<span class="linenos"> 992</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos"> 993</span><span class="k">      end if</span>
<span class="linenos"> 994</span><span class="k">    end if</span>
<span class="linenos"> 995</span>
<span class="linenos"> 996</span><span class="k">  end subroutine </span><span class="n">amsuaTest13GrodyScatteringIndexCheck</span><span class="w"></span>
<span class="linenos"> 997</span><span class="w"> </span>
<span class="linenos"> 998</span>
<span class="linenos"> 999</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1000</span><span class="w">  </span><span class="c">! amsubTest13BennartzScatteringIndexCheck</span>
<span class="linenos">1001</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1002</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsubTest13BennartzScatteringIndexCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1003</span><span class="w">                                                     </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1004</span><span class="w">                                                     </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1005</span><span class="w">                                                     </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1006</span><span class="w">                                                     </span><span class="n">skipTestArr_opt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1007</span>
<span class="linenos">1008</span><span class="w">    </span><span class="c">!:Purpose:                  13) test 13: Bennartz scattering index check (full)</span>
<span class="linenos">1009</span><span class="w">    </span><span class="c">!                               For Scattering Index &gt; 40 sea ice</span>
<span class="linenos">1010</span><span class="w">    </span><span class="c">!                                                    &gt; 15 sea</span>
<span class="linenos">1011</span><span class="w">    </span><span class="c">!                                                    &gt; 0 land reject all AMSUB Channels</span>
<span class="linenos">1012</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">1013</span>
<span class="linenos">1014</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">1015</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">1016</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre canaux de tovs    </span>
<span class="linenos">1017</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">1018</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">1019</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1020</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">         </span><span class="c">! scattering index over water from observation</span>
<span class="linenos">1021</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">          </span><span class="c">! scattering index over water from background</span>
<span class="linenos">1022</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="w">          </span><span class="c">! scattering index over land</span>
<span class="linenos">1023</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea qualifyer </span>
<span class="linenos">1024</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">             </span><span class="c">! glace de mer</span>
<span class="linenos">1025</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">1026</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">1027</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:)</span><span class="w"> </span><span class="c">! channels to exclude from genCoeff</span>
<span class="linenos">1028</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="kd">::</span><span class="w"> </span><span class="n">skipTestArr_opt</span><span class="p">(:)</span><span class="w">            </span><span class="c">! array to set to skip the test</span>
<span class="linenos">1029</span>
<span class="linenos">1030</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">1031</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">chanIndex</span><span class="w"></span>
<span class="linenos">1032</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ZSEUILSCATICE</span><span class="p">,</span><span class="w"> </span><span class="n">ZSEUILSCATL</span><span class="p">,</span><span class="w"> </span><span class="n">ZSEUILSCATW</span><span class="w"></span>
<span class="linenos">1033</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatwUsedForQcThresh</span><span class="p">,</span><span class="w"> </span><span class="n">scatwObsFGaveraged</span><span class="p">,</span><span class="w"> </span><span class="n">scatwUsedForQC</span><span class="w"></span>
<span class="linenos">1034</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">surfTypeIsSea</span><span class="p">,</span><span class="w"> </span><span class="n">cldPredMissing</span><span class="w"></span>
<span class="linenos">1035</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1036</span>
<span class="linenos">1037</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="w"></span>
<span class="linenos">1038</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">skipTestArr_opt</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1039</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">skipTestArr_opt</span><span class="p">(</span><span class="n">testIndex</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1040</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">firstCall</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1041</span><span class="k">          </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1042</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;amsubTest13BennartzScatteringIndexCheck: skipping this test&#39;</span><span class="w"></span>
<span class="linenos">1043</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1044</span><span class="k">        return</span>
<span class="linenos">1045</span><span class="k">      end if</span>
<span class="linenos">1046</span><span class="k">    end if</span>
<span class="linenos">1047</span>
<span class="linenos">1048</span><span class="k">    </span><span class="n">ZSEUILSCATICE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">1049</span><span class="w">    </span><span class="n">ZSEUILSCATW</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">5.0</span><span class="w"></span>
<span class="linenos">1050</span><span class="w">    </span><span class="n">ZSEUILSCATL</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">1051</span><span class="w">    </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1052</span><span class="w">    </span><span class="n">surfTypeIsSea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1053</span>
<span class="linenos">1054</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1055</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.01</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! sea ice </span>
<span class="linenos">1056</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ZSEUILSCATICE</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1057</span><span class="k">          </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1058</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1059</span>
<span class="linenos">1060</span><span class="k">      else</span><span class="w">                                    </span><span class="c">! sea </span>
<span class="linenos">1061</span><span class="w">        </span><span class="n">surfTypeIsSea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1062</span>
<span class="linenos">1063</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1064</span><span class="k">          </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1065</span><span class="w">          </span><span class="n">scatwUsedForQC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatwObsFGaveraged</span><span class="w"></span>
<span class="linenos">1066</span><span class="w">          </span><span class="n">scatwUsedForQcThresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_maxSiOverWaterThreshold</span><span class="w"></span>
<span class="linenos">1067</span><span class="w">          </span><span class="n">cldPredMissing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1068</span><span class="w">                            </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1069</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">1070</span><span class="k">          </span><span class="n">scatwUsedForQC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"></span>
<span class="linenos">1071</span><span class="w">          </span><span class="n">scatwUsedForQcThresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZSEUILSCATW</span><span class="w"></span>
<span class="linenos">1072</span><span class="w">          </span><span class="n">cldPredMissing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1073</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1074</span>
<span class="linenos">1075</span><span class="k">        if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">cldPredMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">scatwUsedForQC</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatwUsedForQcThresh</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1076</span><span class="k">          </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1077</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1078</span><span class="k">      end if</span>
<span class="linenos">1079</span>
<span class="linenos">1080</span><span class="k">    else</span><span class="w">                                      </span><span class="c">! land</span>
<span class="linenos">1081</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ZSEUILSCATL</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1082</span><span class="k">        </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1083</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">1084</span><span class="k">    end if</span>
<span class="linenos">1085</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1086</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1087</span><span class="w">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1088</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1089</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1090</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1091</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">1092</span><span class="w">      </span><span class="k">end do</span>
<span class="linenos">1093</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1094</span><span class="k">        write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w">  </span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39; BENNARTZ scattering index check REJECT, scatIndexOverWaterObs=&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1095</span><span class="w">                    </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;, scatIndexOverWaterFG=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1096</span><span class="w">                    </span><span class="s1">&#39;, scatIndexOverLandObs= &#39;</span><span class="p">,</span><span class="n">scatIndexOverLandObs</span><span class="w"></span>
<span class="linenos">1097</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">1098</span><span class="k">    end if</span>
<span class="linenos">1099</span>
<span class="linenos">1100</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">surfTypeIsSea</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1101</span><span class="k">      </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1102</span>
<span class="linenos">1103</span><span class="w">      </span><span class="c">! In all-sky mode, turn on bit=23 for channels in chanIgnoreInAllskyGenCoeff(:)</span>
<span class="linenos">1104</span><span class="w">      </span><span class="c">! as cloud-affected radiances over sea when there is mismatch between </span>
<span class="linenos">1105</span><span class="w">      </span><span class="c">! scatIndexOverWaterObs and scatIndexOverWaterFG (to be used in gen_bias_corr)</span>
<span class="linenos">1106</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_cloudySiThresholdBcorr</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">cldPredMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1107</span><span class="k">        do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1108</span><span class="w">          </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1109</span><span class="w">          </span><span class="n">chanIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:),</span><span class="n">channelval</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1110</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">chanIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<span class="linenos">1111</span><span class="k">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">23</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1112</span><span class="w">        </span><span class="k">end do</span>
<span class="linenos">1113</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1114</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; BENNARTZ scattering index check&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1115</span><span class="w">                    </span><span class="s1">&#39; cloud-affected obs. scatwObsFGaveraged= &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">scatwObsFGaveraged</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;, threshold= &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1116</span><span class="w">                    </span><span class="n">mwbg_cloudySiThresholdBcorr</span><span class="w"></span>
<span class="linenos">1117</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1118</span><span class="k">      end if</span>
<span class="linenos">1119</span><span class="k">    end if</span>
<span class="linenos">1120</span><span class="k">    </span>
<span class="linenos">1121</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1122</span><span class="k">      </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1123</span><span class="w">      </span><span class="n">cldPredMissing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1124</span><span class="w">                        </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1125</span>
<span class="linenos">1126</span><span class="w">      </span><span class="c">! In all-sky mode, reject observations over sea if: </span>
<span class="linenos">1127</span><span class="w">      </span><span class="c">!   - scatwObsFGaveraged can not be computed.</span>
<span class="linenos">1128</span><span class="w">      </span><span class="c">!   - scatwObsFGaveraged smaller than the minimum value</span>
<span class="linenos">1129</span><span class="w">      </span><span class="c">!   - scatwObsFGaveraged greater than the maximum value</span>
<span class="linenos">1130</span><span class="w">      </span><span class="c">! scatwObsFGaveraged is needed to define obs error.</span>
<span class="linenos">1131</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cldPredMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mwbg_minSiOverWaterThreshold</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1132</span><span class="w">          </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_maxSiOverWaterThreshold</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1133</span>
<span class="linenos">1134</span><span class="k">        </span><span class="n">loopChannel3</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1135</span><span class="w">          </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1136</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oer_useStateDepSigmaObs</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1137</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1138</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1139</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1140</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1141</span><span class="w">                    </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">1142</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1143</span><span class="k">        end do </span><span class="n">loopChannel3</span><span class="w"></span>
<span class="linenos">1144</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">1145</span>
<span class="linenos">1146</span><span class="k">    end if</span><span class="w"> </span><span class="c">! if (tvs_mwAllskyAssim .and. surfTypeIsSea)</span>
<span class="linenos">1147</span>
<span class="linenos">1148</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">amsubTest13BennartzScatteringIndexCheck</span><span class="w"></span>
<span class="linenos">1149</span>
<span class="linenos">1150</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1151</span><span class="w">  </span><span class="c">! amsuaTest14RogueCheck</span>
<span class="linenos">1152</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1153</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuaTest14RogueCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1154</span><span class="w">                                   </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1155</span><span class="w">                                   </span><span class="n">ISFCREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1156</span>
<span class="linenos">1157</span><span class="w">    </span><span class="c">!:Purpose:                     14) test 14: &quot;Rogue check&quot; for (O-P) Tb residuals out of range.</span>
<span class="linenos">1158</span><span class="w">    </span><span class="c">!                                  (single/full). Les observations, dont le residu (O-P) </span>
<span class="linenos">1159</span><span class="w">    </span><span class="c">!                                  depasse par un facteur (roguefac) l&#39;erreur totale des TOVS.</span>
<span class="linenos">1160</span><span class="w">    </span><span class="c">!                                  N.B.: a reject by any of the 3 surface channels produces the </span>
<span class="linenos">1161</span><span class="w">    </span><span class="c">!                                  rejection of AMSUA-A channels 1-5 and 15.</span>
<span class="linenos">1162</span>
<span class="linenos">1163</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">1164</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">1165</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">1166</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">1167</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">1168</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1169</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w">                   </span><span class="c">! rogue factor </span>
<span class="linenos">1170</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land/sea identifier</span>
<span class="linenos">1171</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w">       </span><span class="c">! retrieved cloud liquid water from observation</span>
<span class="linenos">1172</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">        </span><span class="c">! retrieved cloud liquid water from background</span>
<span class="linenos">1173</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiance o-p </span>
<span class="linenos">1174</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">1175</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">1176</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">1177</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">1178</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span>
<span class="linenos">1179</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="n">clwThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">clwThresh2</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh2</span><span class="w"></span>
<span class="linenos">1180</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="p">,</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"></span>
<span class="linenos">1181</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="w"></span>
<span class="linenos">1182</span>
<span class="linenos">1183</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="w"></span>
<span class="linenos">1184</span><span class="w">    </span><span class="n">surfTypeIsWater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1185</span><span class="w">    </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1186</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1187</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1188</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">1189</span><span class="w">        </span><span class="c">! using state-dependent obs error only over water.</span>
<span class="linenos">1190</span><span class="w">        </span><span class="c">! obs over sea-ice will be rejected in test 15.</span>
<span class="linenos">1191</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">oer_useStateDepSigmaObs</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1192</span><span class="w">              </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1193</span><span class="k">          </span><span class="n">clwThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1194</span><span class="w">          </span><span class="n">clwThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1195</span><span class="w">          </span><span class="n">errThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1196</span><span class="w">          </span><span class="n">errThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1197</span><span class="w">          </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1198</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1199</span><span class="k">            </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="w"></span>
<span class="linenos">1200</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">1201</span><span class="k">            </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcStateDepObsErr_r4</span><span class="p">(</span><span class="n">clwThresh1</span><span class="p">,</span><span class="n">clwThresh2</span><span class="p">,</span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1202</span><span class="w">                                                      </span><span class="n">errThresh2</span><span class="p">,</span><span class="n">clwObsFGaveraged</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1203</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1204</span><span class="k">        else</span>
<span class="linenos">1205</span><span class="k">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_toverrst</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1206</span><span class="w">        </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">1207</span><span class="w">        </span><span class="c">! For sigmaObsErrUsed=MPC_missingValue_R4 (cloudLiquidWaterPathObs[FG]=mwbg_realMissing</span>
<span class="linenos">1208</span><span class="w">        </span><span class="c">! in all-sky mode), the observation is already rejected in test 12.</span>
<span class="linenos">1209</span><span class="w">        </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(</span><span class="n">channelval</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="w"></span>
<span class="linenos">1210</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1211</span><span class="w">            </span><span class="nb">ABS</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1212</span><span class="w">            </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1213</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1214</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1215</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1216</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1217</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="linenos">1218</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1219</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;ROGUE CHECK REJECT.NO.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1220</span><span class="w">                    </span><span class="s1">&#39; CHANNEL= &#39;</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1221</span><span class="w">                    </span><span class="s1">&#39; CHECK VALUE= &#39;</span><span class="p">,</span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1222</span><span class="w">                    </span><span class="s1">&#39; TBOMP= &#39;</span><span class="p">,</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1223</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1224</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1225</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1226</span><span class="k">      end if</span>
<span class="linenos">1227</span><span class="k">    end do</span>
<span class="linenos">1228</span>
<span class="linenos">1229</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1230</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1231</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ISFCREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1232</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1233</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">testIndex</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1234</span><span class="k">              </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1235</span><span class="w">              </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1236</span><span class="w">              </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1237</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1238</span><span class="w">                        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">1239</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1240</span><span class="k">        end if</span>
<span class="linenos">1241</span><span class="k">      end do</span>
<span class="linenos">1242</span><span class="k">    end if</span>
<span class="linenos">1243</span>
<span class="linenos">1244</span><span class="k">  end subroutine </span><span class="n">amsuaTest14RogueCheck</span><span class="w"></span>
<span class="linenos">1245</span>
<span class="linenos">1246</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1247</span><span class="w">  </span><span class="c">! amsubTest14RogueCheck</span>
<span class="linenos">1248</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1249</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsubTest14RogueCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1250</span><span class="w">                                   </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1251</span><span class="w">                                   </span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">skipTestArr_opt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1252</span>
<span class="linenos">1253</span><span class="w">    </span><span class="c">!:Purpose:                     14) test 14: &quot;Rogue check&quot; for (O-P) Tb residuals out of range.</span>
<span class="linenos">1254</span><span class="w">    </span><span class="c">!                                  (single)</span>
<span class="linenos">1255</span><span class="w">    </span><span class="c">!                                 Also, remove CH2,3,4,5 if CH2 |O-P|&gt;5K           (partial) </span>
<span class="linenos">1256</span><span class="w">    </span><span class="c">!                                  </span>
<span class="linenos">1257</span>
<span class="linenos">1258</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">1259</span>
<span class="linenos">1260</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">1261</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">1262</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">1263</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">1264</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1265</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w">                   </span><span class="c">! rogue factor </span>
<span class="linenos">1266</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land/sea identifier</span>
<span class="linenos">1267</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">             </span><span class="c">! terrain type</span>
<span class="linenos">1268</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiance o-p </span>
<span class="linenos">1269</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">         </span><span class="c">! retrieved scattering-index over water from observation</span>
<span class="linenos">1270</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">          </span><span class="c">! retrieved scattering-index over water from background</span>
<span class="linenos">1271</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">1272</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">1273</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">1274</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">skipTestArr_opt</span><span class="p">(:)</span><span class="w">            </span><span class="c">! array to set to skip the test</span>
<span class="linenos">1275</span>
<span class="linenos">1276</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos">1277</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span>
<span class="linenos">1278</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="n">siThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">siThresh2</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh2</span><span class="w"></span>
<span class="linenos">1279</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="p">,</span><span class="w"> </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span>
<span class="linenos">1280</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">ch2OmpRejectInAllsky</span><span class="p">,</span><span class="w"> </span><span class="n">channelIsAllsky</span><span class="p">,</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="w"></span>
<span class="linenos">1281</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1282</span>
<span class="linenos">1283</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="w"></span>
<span class="linenos">1284</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">skipTestArr_opt</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1285</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">skipTestArr_opt</span><span class="p">(</span><span class="n">testIndex</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1286</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">firstCall</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1287</span><span class="k">          </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1288</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;amsubTest14RogueCheck: skipping this test&#39;</span><span class="w"></span>
<span class="linenos">1289</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1290</span><span class="k">        return</span>
<span class="linenos">1291</span><span class="k">      end if</span>
<span class="linenos">1292</span><span class="k">    end if</span>
<span class="linenos">1293</span>
<span class="linenos">1294</span><span class="k">    </span><span class="n">surfTypeIsWater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1295</span><span class="w">    </span><span class="n">ch2OmpRejectInAllsky</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1296</span><span class="w">    </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1297</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1298</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1299</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1300</span><span class="k">        </span><span class="n">channelIsAllsky</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1301</span><span class="w">                            </span><span class="n">oer_useStateDepSigmaObs</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1302</span><span class="w">                            </span><span class="n">surfTypeIsWater</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1303</span><span class="w">        </span><span class="c">! using state-dependent obs error only over water.</span>
<span class="linenos">1304</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">channelIsAllsky</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1305</span><span class="k">          </span><span class="n">siThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1306</span><span class="w">          </span><span class="n">siThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1307</span><span class="w">          </span><span class="n">errThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1308</span><span class="w">          </span><span class="n">errThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1309</span><span class="w">          </span><span class="n">scatwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1310</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1311</span><span class="w">              </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1312</span><span class="k">            </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="w"></span>
<span class="linenos">1313</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">1314</span><span class="k">            </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcStateDepObsErr_r4</span><span class="p">(</span><span class="n">siThresh1</span><span class="p">,</span><span class="n">siThresh2</span><span class="p">,</span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1315</span><span class="w">                                                    </span><span class="n">errThresh2</span><span class="p">,</span><span class="n">scatwObsFGaveraged</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1316</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1317</span><span class="k">        else</span>
<span class="linenos">1318</span><span class="k">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_toverrst</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1319</span><span class="w">        </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">1320</span><span class="w">        </span><span class="c">! For sigmaObsErrUsed=MPC_missingValue_R4 (scatIndexOverWaterObs[FG]=mwbg_realMissing</span>
<span class="linenos">1321</span><span class="w">        </span><span class="c">! in all-sky mode), the observation is already rejected in test 13.</span>
<span class="linenos">1322</span><span class="w">        </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(</span><span class="n">channelval</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="w"></span>
<span class="linenos">1323</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1324</span><span class="w">            </span><span class="nb">abs</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1325</span><span class="w">            </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1326</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1327</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1328</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1329</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1330</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">1331</span>
<span class="linenos">1332</span><span class="w">          </span><span class="n">ch2OmpRejectInAllSky</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">channelIsAllsky</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1333</span>
<span class="linenos">1334</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1335</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;ROGUE CHECK REJECT.NO.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1336</span><span class="w">                    </span><span class="s1">&#39; CHANNEL= &#39;</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1337</span><span class="w">                    </span><span class="s1">&#39; CHECK VALUE= &#39;</span><span class="p">,</span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1338</span><span class="w">                    </span><span class="s1">&#39; TBOMP= &#39;</span><span class="p">,</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1339</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1340</span><span class="k">        end if</span>
<span class="linenos">1341</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1342</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">channelIsAllsky</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1343</span><span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">ch2OmpRejectInAllSky</span><span class="p">)</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1344</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">1345</span><span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">5.0</span><span class="p">)</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1346</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1347</span><span class="k">        end if</span>
<span class="linenos">1348</span><span class="k">      end if</span>
<span class="linenos">1349</span><span class="k">    end do</span>
<span class="linenos">1350</span>
<span class="linenos">1351</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1352</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1353</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1354</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1355</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">testIndex</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1356</span><span class="k">              </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1357</span><span class="w">              </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1358</span><span class="w">              </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1359</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1360</span><span class="w">                        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">1361</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1362</span><span class="k">        end if</span>
<span class="linenos">1363</span><span class="k">      end do</span>
<span class="linenos">1364</span><span class="k">    end if</span>
<span class="linenos">1365</span>
<span class="linenos">1366</span><span class="k">  end subroutine </span><span class="n">amsubTest14RogueCheck</span><span class="w"></span>
<span class="linenos">1367</span>
<span class="linenos">1368</span>
<span class="linenos">1369</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1370</span><span class="w">  </span><span class="c">! amsuABTest15ChannelSelectionWithTovutil</span>
<span class="linenos">1371</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1372</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuABTest15ChannelSelectionWithTovutil</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1373</span><span class="w">                                                     </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1374</span><span class="w">                                                     </span><span class="n">ISFCREJ2</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1375</span>
<span class="linenos">1376</span><span class="w">    </span><span class="c">!:Purpose: test 15: Channel Selection using array oer_tovutil(chan,sat)</span>
<span class="linenos">1377</span><span class="w">    </span><span class="c">!          oer_tovutil = 0 (blacklisted), 1 (assmilate), 2 (assimilate over open water only)</span>
<span class="linenos">1378</span><span class="w">    </span><span class="c">!          We also set QC flag bits 7 and 9 ON for channels with oer_tovutil=2</span>
<span class="linenos">1379</span><span class="w">    </span><span class="c">!          over land or sea-ice and we set QC flag bits 7 and 9 ON for channels</span>
<span class="linenos">1380</span><span class="w">    </span><span class="c">!          1-3,15 over land or sea-ice REGARDLESS of oer_tovutil value </span>
<span class="linenos">1381</span><span class="w">    </span><span class="c">!          (but oer_tovutil=0 always for these unassimilated channels).</span>
<span class="linenos">1382</span>
<span class="linenos">1383</span>
<span class="linenos">1384</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">1385</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">1386</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">1387</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">1388</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">1389</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1390</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea identifier </span>
<span class="linenos">1391</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">             </span><span class="c">! terrain type</span>
<span class="linenos">1392</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">             </span><span class="c">! gl</span>
<span class="linenos">1393</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISFCREJ2</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">1394</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">1395</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">1396</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">1397</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">ITRN</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"></span>
<span class="linenos">1398</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="w"></span>
<span class="linenos">1399</span>
<span class="linenos">1400</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="w"></span>
<span class="linenos">1401</span>
<span class="linenos">1402</span><span class="w">    </span><span class="n">ITRN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos">1403</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w">  </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1404</span><span class="w">        </span><span class="n">modelInterpSeaIce</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1405</span><span class="k">      </span><span class="n">ITRN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1406</span><span class="w">    </span><span class="k">end if        </span>
<span class="linenos">1407</span><span class="k">    do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1408</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1409</span><span class="w">      </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="w"> </span><span class="p">(</span><span class="n">ISFCREJ2</span><span class="p">,</span><span class="n">channelval</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1410</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1411</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w">  </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ITRN</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1412</span><span class="k">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1413</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1414</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1415</span><span class="k">      end if</span>
<span class="linenos">1416</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">oer_tovutil</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1417</span><span class="k">        </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1418</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">oer_tovutil</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1419</span><span class="k">          </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1420</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1421</span><span class="w">        </span><span class="k">else </span>
<span class="linenos">1422</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ITRN</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1423</span><span class="k">            </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1424</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1425</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1426</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1427</span><span class="k">        end if</span>
<span class="linenos">1428</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1429</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1430</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">1431</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="linenos">1432</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1433</span><span class="k">              write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;CHANNEL REJECT: &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1434</span><span class="w">                    </span><span class="s1">&#39; CHANNEL= &#39;</span><span class="p">,</span><span class="n">channelval</span><span class="w"></span>
<span class="linenos">1435</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">1436</span><span class="k">        end if</span>
<span class="linenos">1437</span><span class="k">      end if</span>
<span class="linenos">1438</span><span class="k">    end do</span>
<span class="linenos">1439</span>
<span class="linenos">1440</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1441</span><span class="k">       write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;qcIndicator = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1442</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">1443</span>
<span class="linenos">1444</span><span class="k">  end subroutine </span><span class="n">amsuABTest15ChannelSelectionWithTovutil</span><span class="w"></span>
<span class="linenos">1445</span>
<span class="linenos">1446</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1447</span><span class="w">  </span><span class="c">! amsuaTest16ExcludeExtremeScattering</span>
<span class="linenos">1448</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1449</span><span class="w">  </span><span class="k">subroutine </span><span class="n">amsuaTest16ExcludeExtremeScattering</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1450</span><span class="w">                                                 </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1451</span><span class="w">    </span><span class="c">!:Purpose: Exclude radiances affected extreme scattering in deep convective region.</span>
<span class="linenos">1452</span><span class="w">    </span><span class="c">!          For channel 5, if BT_cld-BT_clr &lt; -0.5 OR O-BT_clr &lt; -0.5, reject channels 4-5.</span>
<span class="linenos">1453</span>
<span class="linenos">1454</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">1455</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">1456</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">1457</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">1458</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1459</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">           </span><span class="c">! land sea identifier</span>
<span class="linenos">1460</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiance o</span>
<span class="linenos">1461</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">btClear</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">     </span><span class="c">! clear-radiance o</span>
<span class="linenos">1462</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiance o-p </span>
<span class="linenos">1463</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">1464</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">1465</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">1466</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span>
<span class="linenos">1467</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">BTcloudy</span><span class="p">,</span><span class="w"> </span><span class="n">simulatedCloudEffect</span><span class="p">,</span><span class="w"> </span><span class="n">observedCloudEffect</span><span class="w"></span>
<span class="linenos">1468</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="p">,</span><span class="w"> </span><span class="n">rejectLowPeakingChannels</span><span class="w"></span>
<span class="linenos">1469</span>
<span class="linenos">1470</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lowPeakingChannelsList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1471</span>
<span class="linenos">1472</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
<span class="linenos">1473</span><span class="w">    </span><span class="n">surfTypeIsWater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1474</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">surfTypeIsWater</span><span class="p">))</span><span class="w"> </span><span class="k">return </span>
<span class="linenos">1475</span>
<span class="linenos">1476</span><span class="k">    </span><span class="n">rejectLowPeakingChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1477</span><span class="w">    </span><span class="n">loopChannel2</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1478</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1479</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">cycle </span><span class="n">loopChannel2</span><span class="w"></span>
<span class="linenos">1480</span>
<span class="linenos">1481</span><span class="w">      </span><span class="n">BTcloudy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1482</span><span class="w">      </span><span class="n">simulatedCloudEffect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTcloudy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">btClear</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1483</span><span class="w">      </span><span class="n">observedCloudEffect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">btClear</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1484</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">simulatedCloudEffect</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">observedCloudEffect</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1485</span><span class="k">        </span><span class="n">rejectLowPeakingChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1486</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">1487</span>
<span class="linenos">1488</span><span class="k">      exit </span><span class="n">loopChannel2</span><span class="w"></span>
<span class="linenos">1489</span><span class="w">    </span><span class="k">end do </span><span class="n">loopChannel2</span><span class="w"></span>
<span class="linenos">1490</span>
<span class="linenos">1491</span><span class="w">    </span><span class="c">! reject channel 4-5</span>
<span class="linenos">1492</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rejectLowPeakingChannels</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1493</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1494</span><span class="w">        </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1495</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">lowPeakingChannelsList</span><span class="p">,</span><span class="n">channelval</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1496</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">1497</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1498</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1499</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1500</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1501</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="linenos">1502</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1503</span>
<span class="linenos">1504</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1505</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; extreme scattering check reject: &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1506</span><span class="w">                  </span><span class="s1">&#39; obs location index = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1507</span><span class="w">                  </span><span class="s1">&#39; channel = 1-5&#39;</span><span class="w"></span>
<span class="linenos">1508</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">1509</span><span class="k">      end do</span>
<span class="linenos">1510</span><span class="k">    end if</span>
<span class="linenos">1511</span>
<span class="linenos">1512</span><span class="k">  end subroutine </span><span class="n">amsuaTest16ExcludeExtremeScattering</span><span class="w"></span>
<span class="linenos">1513</span>
<span class="linenos">1514</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1515</span><span class="w">  </span><span class="c">! mwbg_tovCheckAmsua</span>
<span class="linenos">1516</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1517</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_tovCheckAmsua</span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1518</span><span class="w">                                </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1519</span><span class="w">                                </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1520</span><span class="w">                                </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1521</span><span class="w">                                </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1522</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1523</span><span class="w">                                </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1524</span><span class="w">                                </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1525</span><span class="w">  </span>
<span class="linenos">1526</span><span class="w">    </span><span class="c">!:Purpose:          Effectuer le controle de qualite des radiances tovs.</span>
<span class="linenos">1527</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">1528</span><span class="w">    </span><span class="c">!NOTES  </span>
<span class="linenos">1529</span><span class="w">    </span><span class="c">!               Quinze tests sont effectues menant aux erreurs suivantes:</span>
<span class="linenos">1530</span><span class="w">    </span><span class="c">!                  - 1) topography reject,</span>
<span class="linenos">1531</span><span class="w">    </span><span class="c">!                  - 2) invalid land/sea qualifier,</span>
<span class="linenos">1532</span><span class="w">    </span><span class="c">!                  - 3) invalid terrain type,</span>
<span class="linenos">1533</span><span class="w">    </span><span class="c">!                  - 4) invalid field of view number,</span>
<span class="linenos">1534</span><span class="w">    </span><span class="c">!                  - 5) satellite zenith angle out of range,</span>
<span class="linenos">1535</span><span class="w">    </span><span class="c">!                  - 6) inconsistent field of view and sat. zenith angle,</span>
<span class="linenos">1536</span><span class="w">    </span><span class="c">!                  - 7) inconsistent land/sea qualifier and model mask,</span>
<span class="linenos">1537</span><span class="w">    </span><span class="c">!                  - 8) inconsistent terrain type and model ice, (NOT USED)</span>
<span class="linenos">1538</span><span class="w">    </span><span class="c">!                  - 9) uncorrected radiance,</span>
<span class="linenos">1539</span><span class="w">    </span><span class="c">!                  - 10) rejected by RTTOV,</span>
<span class="linenos">1540</span><span class="w">    </span><span class="c">!                  - 11) radiance gross check failure,</span>
<span class="linenos">1541</span><span class="w">    </span><span class="c">!                  - 12) cloud liquid water reject,</span>
<span class="linenos">1542</span><span class="w">    </span><span class="c">!                  - 13) scattering index reject,</span>
<span class="linenos">1543</span><span class="w">    </span><span class="c">!                  - 14) radiance residual rogue check failure,</span>
<span class="linenos">1544</span><span class="w">    </span><span class="c">!                  - 15) channel reject (channel selection).</span>
<span class="linenos">1545</span><span class="w">    </span><span class="c">!                  - **) set terrain type to sea ice given certain conditions</span>
<span class="linenos">1546</span><span class="w">    </span><span class="k">implicit none</span><span class="w"> </span>
<span class="linenos">1547</span><span class="w">    </span><span class="c">!Arguments:</span>
<span class="linenos">1548</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w">         </span><span class="c">! Marqueurs globaux  </span>
<span class="linenos">1549</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">     </span><span class="c">! indicateur terre/mer</span>
<span class="linenos">1550</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">         </span><span class="c">! position sur le &quot;scan&quot;</span>
<span class="linenos">1551</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w">          </span><span class="c">! canaux des observations</span>
<span class="linenos">1552</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">       </span><span class="c">! indicateur du type de terrain</span>
<span class="linenos">1553</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">        </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">1554</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">             </span><span class="c">! numero de satellite (i.e. indice)</span>
<span class="linenos">1555</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">             </span><span class="c">! marqueurs des radiances</span>
<span class="linenos">1556</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! radiances</span>
<span class="linenos">1557</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">btClear</span><span class="p">(:)</span><span class="w">              </span><span class="c">! clear-sky radiances</span>
<span class="linenos">1558</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w">        </span><span class="c">! correction aux radiances</span>
<span class="linenos">1559</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! residus (o-p)</span>
<span class="linenos">1560</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w">     </span><span class="c">! masque terre/mer du modele</span>
<span class="linenos">1561</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">      </span><span class="c">! topographie du modele</span>
<span class="linenos">1562</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">       </span><span class="c">! etendue de glace du modele</span>
<span class="linenos">1563</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">          </span><span class="c">! angle zenith du satellite (deg.)</span>
<span class="linenos">1564</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w">                  </span><span class="c">! latitude</span>
<span class="linenos">1565</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w">     </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                   </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1566</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                 </span><span class="c">! reset du controle de qualite?</span>
<span class="linenos">1567</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w">          </span><span class="c">! indicateur controle de qualite tovs par canal </span>
<span class="linenos">1568</span><span class="w">                                                                </span><span class="c">!  =0 ok, &gt;0 rejet</span>
<span class="linenos">1569</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="c">! retrieved cloud liquid water from observation </span>
<span class="linenos">1570</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">  </span><span class="c">! retrieved cloud liquid water from background </span>
<span class="linenos">1571</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">   </span><span class="c">! scattering index over water from observation</span>
<span class="linenos">1572</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">      </span><span class="c">! ATMS Information flag (newInformationFlag) values </span>
<span class="linenos">1573</span><span class="w">                                                                </span><span class="c">!   (new BURP element 025174 in header)</span>
<span class="linenos">1574</span><span class="w">                                                                </span><span class="c">!   FOR AMSUA just fill with zeros</span>
<span class="linenos">1575</span><span class="w">    </span><span class="c">!locals</span>
<span class="linenos">1576</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span>
<span class="linenos">1577</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudyClwThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3</span><span class="w"></span>
<span class="linenos">1578</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ZANGL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="mf">7.6</span><span class="o">/</span><span class="n">maxScanAngleAMSU</span><span class="w"></span>
<span class="linenos">1579</span><span class="w">    </span>
<span class="linenos">1580</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">JI</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">rain</span><span class="p">,</span><span class="w"> </span><span class="n">snow</span><span class="w"></span>
<span class="linenos">1581</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICLWREJ</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">ISFCREJ2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">ISCATREJ</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1582</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">(:),</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">(:),</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">1583</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="nb">EPSILON</span><span class="p">,</span><span class="w"> </span><span class="n">tb23</span><span class="p">,</span><span class="w"> </span><span class="n">tb31</span><span class="p">,</span><span class="w"> </span><span class="n">tb50</span><span class="p">,</span><span class="w"> </span><span class="n">tb53</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="w"></span>
<span class="linenos">1584</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb50FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb53FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FG</span><span class="w"> </span>
<span class="linenos">1585</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ice</span><span class="p">,</span><span class="w"> </span><span class="n">tpw</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1586</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1587</span>
<span class="linenos">1588</span><span class="w">    </span><span class="nb">EPSILON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="w"></span>
<span class="linenos">1589</span>
<span class="linenos">1590</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1591</span><span class="w">    </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1592</span><span class="w">                     </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1593</span><span class="w">                     </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1594</span><span class="w">                     </span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1595</span><span class="w">                     </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1596</span><span class="w">    </span><span class="n">ICLWREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1597</span><span class="w">    </span><span class="n">ISFCREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1598</span><span class="w">    </span><span class="n">ISCATREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1599</span><span class="w">    </span><span class="n">ISFCREJ2</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1600</span>
<span class="linenos">1601</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">GROSSMIN</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1602</span><span class="w">    </span><span class="n">GROSSMIN</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1603</span><span class="w">                    </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1604</span><span class="w">                    </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1605</span><span class="w">                    </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1606</span><span class="w">                    </span><span class="mi">12</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1607</span><span class="w">                    </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1608</span>
<span class="linenos">1609</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">GROSSMAX</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1610</span><span class="w">    </span><span class="n">GROSSMAX</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">27</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1611</span><span class="w">                    </span><span class="mi">32</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1612</span><span class="w">                    </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1613</span><span class="w">                    </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1614</span><span class="w">                    </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1615</span><span class="w">                    </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w">  </span>
<span class="linenos">1616</span><span class="w">    </span><span class="n">channelForTopoFilter</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1617</span><span class="w">    </span><span class="n">altitudeForTopoFilter</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1618</span>
<span class="linenos">1619</span><span class="w">    </span><span class="c">! Allocation</span>
<span class="linenos">1620</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1621</span>
<span class="linenos">1622</span><span class="w">    </span><span class="c">! Initialisation, la premiere fois seulement!</span>
<span class="linenos">1623</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LLFIRST</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1624</span><span class="k">       </span><span class="n">rejectionCodArray</span><span class="p">(:,:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1625</span><span class="w">       </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1626</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">1627</span><span class="w">    </span><span class="c">! fill newInformationFlag with zeros ONLY for consistency with ATMS</span>
<span class="linenos">1628</span><span class="w">    </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1629</span><span class="w">    </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1630</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">RESETQC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1631</span>
<span class="linenos">1632</span><span class="w">    </span><span class="c">! Grody parameters are   extract required channels:</span>
<span class="linenos">1633</span><span class="w">    </span><span class="k">call </span><span class="n">extractParamForGrodyRun</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1634</span><span class="w">                                  </span><span class="n">tb23</span><span class="p">,</span><span class="w">   </span><span class="n">tb31</span><span class="p">,</span><span class="w">   </span><span class="n">tb50</span><span class="p">,</span><span class="w">   </span><span class="n">tb53</span><span class="p">,</span><span class="w">   </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1635</span><span class="w">                                  </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb50FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb53FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1636</span><span class="w">    </span>
<span class="linenos">1637</span><span class="w">    </span><span class="c">!  Run Grody AMSU-A algorithms.</span>
<span class="linenos">1638</span><span class="w">    </span><span class="k">call </span><span class="n">grody</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">tb23</span><span class="p">,</span><span class="w"> </span><span class="n">tb31</span><span class="p">,</span><span class="w"> </span><span class="n">tb50</span><span class="p">,</span><span class="w"> </span><span class="n">tb53</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1639</span><span class="w">                </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">ice</span><span class="p">,</span><span class="w"> </span><span class="n">tpw</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1640</span><span class="w">                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1641</span><span class="w">                </span><span class="n">rain</span><span class="p">,</span><span class="w"> </span><span class="n">snow</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">)</span><span class="w">   </span>
<span class="linenos">1642</span>
<span class="linenos">1643</span><span class="w">    </span><span class="c">! 10) test 10: RTTOV reject check (single)</span>
<span class="linenos">1644</span><span class="w">    </span><span class="c">! Rejected datum flag has bit #9 on.</span>
<span class="linenos">1645</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest10RttovRejectCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1646</span><span class="w">                                       </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1647</span>
<span class="linenos">1648</span><span class="w">    </span><span class="c">! 1) test 1: Topography check (partial)</span>
<span class="linenos">1649</span><span class="w">    </span><span class="c">! Channel 6 is rejected for topography &gt;  250m.</span>
<span class="linenos">1650</span><span class="w">    </span><span class="c">! Channel 7 is rejected for topography &gt; 2000m.</span>
<span class="linenos">1651</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest1TopographyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1652</span><span class="w">                                     </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">,</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1653</span><span class="w">                                     </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1654</span><span class="w"> </span>
<span class="linenos">1655</span><span class="w">    </span><span class="c">! 2) test 2: &quot;Land/sea qualifier&quot; code check (full)</span>
<span class="linenos">1656</span><span class="w">    </span><span class="c">! allowed values are: 0 land, 1 sea, 2 coast.</span>
<span class="linenos">1657</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest2LandSeaQualifierCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1658</span><span class="w">                                           </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1659</span>
<span class="linenos">1660</span><span class="w">    </span><span class="c">! 3) test 3: &quot;Terrain type&quot; code check (full)</span>
<span class="linenos">1661</span><span class="w">    </span><span class="c">! allowed values are: -1 missing, 0 sea-ice, 1 snow on land.</span>
<span class="linenos">1662</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest3TerrainTypeCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1663</span><span class="w">                                      </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1664</span><span class="w"> </span>
<span class="linenos">1665</span><span class="w">    </span><span class="c">! 4) test 4: Field of view number check (full)</span>
<span class="linenos">1666</span><span class="w">    </span><span class="c">! Field of view acceptable range is [1,maxScanAngleAMSU]  for AMSU footprints.</span>
<span class="linenos">1667</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest4FieldOfViewCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1668</span><span class="w">                                      </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1669</span>
<span class="linenos">1670</span><span class="w">    </span><span class="c">! 5) test 5: Satellite zenith angle check (full)</span>
<span class="linenos">1671</span><span class="w">    </span><span class="c">! Satellite zenith angle acceptable range is [0.,60.].</span>
<span class="linenos">1672</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest5ZenithAngleCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1673</span><span class="w">                                      </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1674</span>
<span class="linenos">1675</span><span class="w">    </span><span class="c">! 6) test 6: &quot;Sat. zenith angle&quot;/&quot;field of view&quot; consistency check.  (full)</span>
<span class="linenos">1676</span><span class="w">    </span><span class="c">! Acceptable difference between &quot;Satellite zenith angle&quot;  and</span>
<span class="linenos">1677</span><span class="w">    </span><span class="c">! &quot;approximate angle computed from field of view number&quot; is 1.8 degrees.</span>
<span class="linenos">1678</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest6ZenAngleAndFovConsistencyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1679</span><span class="w">                                                    </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">ZANGL</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1680</span><span class="w">                                                    </span><span class="n">maxScanAngleAMSU</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">1681</span>
<span class="linenos">1682</span><span class="w">    </span><span class="c">! 7) test 7: &quot;Land/sea qual.&quot;/&quot;model land/sea&quot; consistency check.    (full)</span>
<span class="linenos">1683</span><span class="w">    </span><span class="c">! Acceptable conditions are:</span>
<span class="linenos">1684</span><span class="w">    </span><span class="c">!       a) both over ocean (landQualifierIndice=1; mg&lt;0.01), new threshold 0.20, jh dec 2000,</span>
<span class="linenos">1685</span><span class="w">    </span><span class="c">!       b) both over land  (landQualifierIndice=0; mg&gt;0.80), new threshold 0.50, jh dec 2000.</span>
<span class="linenos">1686</span><span class="w">    </span><span class="c">! Other conditions are unacceptable.</span>
<span class="linenos">1687</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest7landSeaQualifyerAndModelLandSeaConsistencyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1688</span><span class="w">                                                                     </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1689</span><span class="w">                                                                     </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1690</span>
<span class="linenos">1691</span><span class="w">    </span><span class="c">! 8) test 8: &quot;Terrain type&quot;/&quot;Land/sea qual.&quot;/&quot;model ice&quot; consistency check. (full)</span>
<span class="linenos">1692</span><span class="w">    </span><span class="c">! Unacceptable conditions are:</span>
<span class="linenos">1693</span><span class="w">    </span><span class="c">!        a) terrain is sea-ice and model has no ice(terrainTypeIndice=0; gl&lt;0.01).</span>
<span class="linenos">1694</span><span class="w">    </span><span class="c">!        b) terrain is sea-ice and land/sea qualifier is land (terrainTypeIndice=0; landQualifierIndice=0).</span>
<span class="linenos">1695</span><span class="w">    </span><span class="c">!        c) terrain is snow on land and land/sea qualifier is sea (terrainTypeIndice=1; landQualifierIndice=1).</span>
<span class="linenos">1696</span><span class="w">    </span><span class="c">!        d) terrain is missing, land/sea qualifier is sea and model has ice(terrainTypeIndice=-1; landQualifierIndice=1; gl&gt;0.01). (enleve jh, jan 2001)</span>
<span class="linenos">1697</span><span class="w">    </span><span class="c">! NOT doNE ANYMORE </span>
<span class="linenos">1698</span><span class="w">    </span>
<span class="linenos">1699</span><span class="w">    </span><span class="c">! 9) test 9: Uncorrected Tb check (single)</span>
<span class="linenos">1700</span><span class="w">    </span><span class="c">! Uncorrected datum (flag bit #6 off). In this case switch bit 11 ON.</span>
<span class="linenos">1701</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest9UncorrectedTbCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1702</span><span class="w">                                        </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">1703</span>
<span class="linenos">1704</span><span class="w">    </span><span class="c">! 11) test 11: Radiance observation &quot;Gross&quot; check (single) </span>
<span class="linenos">1705</span><span class="w">    </span><span class="c">!  Change this test from full to single. jh nov 2000.</span>
<span class="linenos">1706</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest11RadianceGrossValueCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1707</span><span class="w">                                              </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1708</span>
<span class="linenos">1709</span><span class="w">    </span><span class="c">! 12) test 12: Grody cloud liquid water check (partial)</span>
<span class="linenos">1710</span><span class="w">    </span><span class="c">! For Cloud Liquid Water &gt; clwQcThreshold, reject AMSUA-A channels 1-5 and 15.</span>
<span class="linenos">1711</span><span class="w">    </span><span class="k">call </span><span class="n">amsuaTest12GrodyClwCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1712</span><span class="w">                                   </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1713</span><span class="w">                                   </span><span class="n">ICLWREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1714</span>
<span class="linenos">1715</span><span class="w">    </span><span class="c">! 13) test 13: Grody scattering index check (partial)</span>
<span class="linenos">1716</span><span class="w">    </span><span class="c">! For Scattering Index &gt; 9, reject AMSUA-A channels 1-6 and 15.</span>
<span class="linenos">1717</span><span class="w">    </span><span class="k">call </span><span class="n">amsuaTest13GrodyScatteringIndexCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1718</span><span class="w">                                               </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1719</span><span class="w">                                               </span><span class="n">ISCATREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1720</span>
<span class="linenos">1721</span><span class="w">    </span><span class="c">! 14) test 14: &quot;Rogue check&quot; for (O-P) Tb residuals out of range. (single/full)</span>
<span class="linenos">1722</span><span class="w">    </span><span class="c">! Les observations, dont le residu (O-P) depasse par un facteur (roguefac) l&#39;erreur totale des TOVS.</span>
<span class="linenos">1723</span><span class="w">    </span><span class="c">! N.B.: a reject by any of the 3 surface channels produces the rejection of AMSUA-A channels 1-5 and 15. </span>
<span class="linenos">1724</span><span class="w">    </span><span class="k">call </span><span class="n">amsuaTest14RogueCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1725</span><span class="w">                                </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1726</span><span class="w">                                </span><span class="n">ISFCREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1727</span>
<span class="linenos">1728</span><span class="w">    </span><span class="c">! 15) test 15: Channel Selection using array oer_tovutil(chan,sat)</span>
<span class="linenos">1729</span><span class="w">    </span><span class="c">!  oer_tovutil = 0 (blacklisted)</span>
<span class="linenos">1730</span><span class="w">    </span><span class="c">!                1 (assmilate)</span>
<span class="linenos">1731</span><span class="w">    </span><span class="c">!                2 (assimilate over open water only)</span>
<span class="linenos">1732</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">1733</span><span class="w">    </span><span class="c">!  We also set QC flag bits 7 and 9 ON for channels with oer_tovutil=2 </span>
<span class="linenos">1734</span><span class="w">    </span><span class="c">!  over land or sea-ice</span>
<span class="linenos">1735</span><span class="w">    </span><span class="c">!    and </span>
<span class="linenos">1736</span><span class="w">    </span><span class="c">!  we set QC flag bits 7 and 9 ON for channels 1-3,15 over land</span>
<span class="linenos">1737</span><span class="w">    </span><span class="c">!  or sea-ice REGARDLESS of oer_tovutil value (but oer_tovutil=0 always for</span>
<span class="linenos">1738</span><span class="w">    </span><span class="c">!  these unassimilated channels).</span>
<span class="linenos">1739</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest15ChannelSelectionWithTovutil</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1740</span><span class="w">                                                  </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1741</span><span class="w">                                                  </span><span class="n">ISFCREJ2</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1742</span>
<span class="linenos">1743</span><span class="w">    </span><span class="c">! 16) test 16: exclude radiances affected by extreme scattering in deep convective region in all-sky mode.</span>
<span class="linenos">1744</span><span class="w">    </span><span class="k">call </span><span class="n">amsuaTest16ExcludeExtremeScattering</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1745</span><span class="w">                                             </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w">  </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">1746</span>
<span class="linenos">1747</span><span class="w">    </span><span class="c">!  Synthese de la controle de qualite au niveau de chaque point</span>
<span class="linenos">1748</span><span class="w">    </span><span class="c">!  d&#39;observation. Code:</span>
<span class="linenos">1749</span><span class="w">    </span><span class="c">!            =0, aucun rejet,</span>
<span class="linenos">1750</span><span class="w">    </span><span class="c">!            &gt;0, au moins un canal rejete.</span>
<span class="linenos">1751</span>
<span class="linenos">1752</span><span class="w">    </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1753</span><span class="w">    </span><span class="k">do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">1754</span><span class="w">      </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">KCHKPRF</span><span class="p">,</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">JI</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1755</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">1756</span>
<span class="linenos">1757</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;KCHKPRF = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w"></span>
<span class="linenos">1758</span>
<span class="linenos">1759</span><span class="w">    </span><span class="c">! reset global marker flag (55200) and mark it if observtions are rejected</span>
<span class="linenos">1760</span><span class="w">    </span><span class="k">call </span><span class="n">resetQcCases</span><span class="p">(</span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1761</span>
<span class="linenos">1762</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">1763</span><span class="w">    </span><span class="c">! FINAL STEP: set terrain type to sea ice given certain conditions</span>
<span class="linenos">1764</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">1765</span><span class="w">    </span><span class="k">call </span><span class="n">setTerrainTypeToSeaIce</span><span class="p">(</span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1766</span>
<span class="linenos">1767</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_tovCheckAmsua</span><span class="w"></span>
<span class="linenos">1768</span>
<span class="linenos">1769</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1770</span><span class="w">  </span><span class="c">! mwbg_tovCheckAmsub</span>
<span class="linenos">1771</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">1772</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_tovCheckAmsub</span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1773</span><span class="w">                                </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1774</span><span class="w">                                </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1775</span><span class="w">                                </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1776</span><span class="w">                                </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1777</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1778</span><span class="w">                                </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1779</span><span class="w">  </span>
<span class="linenos">1780</span><span class="w">    </span><span class="c">!:Purpose:          Effectuer le controle de qualite des radiances tovs.</span>
<span class="linenos">1781</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">1782</span><span class="w">    </span><span class="c">!NOTES  </span>
<span class="linenos">1783</span><span class="w">    </span><span class="c">!               Quinze tests sont effectues menant aux erreurs suivantes:</span>
<span class="linenos">1784</span><span class="w">    </span><span class="c">!                  - 1) topography reject,</span>
<span class="linenos">1785</span><span class="w">    </span><span class="c">!                  - 2) invalid land/sea qualifier,</span>
<span class="linenos">1786</span><span class="w">    </span><span class="c">!                  - 3) invalid terrain type,</span>
<span class="linenos">1787</span><span class="w">    </span><span class="c">!                  - 4) invalid field of view number,</span>
<span class="linenos">1788</span><span class="w">    </span><span class="c">!                  - 5) satellite zenith angle out of range,</span>
<span class="linenos">1789</span><span class="w">    </span><span class="c">!                  - 6) inconsistent field of view and sat. zenith angle,</span>
<span class="linenos">1790</span><span class="w">    </span><span class="c">!                  - 7) inconsistent land/sea qualifier and model mask,</span>
<span class="linenos">1791</span><span class="w">    </span><span class="c">!                  - 8) inconsistent terrain type and model ice</span>
<span class="linenos">1792</span><span class="w">    </span><span class="c">!                  - 9) uncorrected radiance,</span>
<span class="linenos">1793</span><span class="w">    </span><span class="c">!                  - 10) rejected by RTTOV,</span>
<span class="linenos">1794</span><span class="w">    </span><span class="c">!                  - 11) radiance gross check failure,</span>
<span class="linenos">1795</span><span class="w">    </span><span class="c">!                  - 12) drynes index reject</span>
<span class="linenos">1796</span><span class="w">    </span><span class="c">!                  - 13) scattering index reject,</span>
<span class="linenos">1797</span><span class="w">    </span><span class="c">!                  - 14) radiance residual rogue check failure,</span>
<span class="linenos">1798</span><span class="w">    </span><span class="c">!                  - 15) channel reject (channel selection).</span>
<span class="linenos">1799</span><span class="w">    </span><span class="c">!                  - **) set terrain type to sea ice given certain conditions</span>
<span class="linenos">1800</span><span class="w">    </span><span class="k">implicit none</span><span class="w"> </span>
<span class="linenos">1801</span><span class="w">    </span><span class="c">!Arguments:</span>
<span class="linenos">1802</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">            </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w">        </span><span class="c">! Marqueurs globaux  </span>
<span class="linenos">1803</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">    </span><span class="c">! indicateur terre/mer</span>
<span class="linenos">1804</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">        </span><span class="c">! position sur le &quot;scan&quot;</span>
<span class="linenos">1805</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w">         </span><span class="c">! canaux des observations</span>
<span class="linenos">1806</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">            </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">      </span><span class="c">! indicateur du type de terrain</span>
<span class="linenos">1807</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">       </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">1808</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">            </span><span class="c">! numero de satellite (i.e. indice)</span>
<span class="linenos">1809</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">            </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">            </span><span class="c">! marqueurs des radiances</span>
<span class="linenos">1810</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">               </span><span class="c">! radiances from observation</span>
<span class="linenos">1811</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">btClear</span><span class="p">(:)</span><span class="w">             </span><span class="c">! clear-sky radiances from background</span>
<span class="linenos">1812</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w">       </span><span class="c">! correction aux radiances</span>
<span class="linenos">1813</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w">               </span><span class="c">! residus (o-p)</span>
<span class="linenos">1814</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w">    </span><span class="c">! masque terre/mer du modele</span>
<span class="linenos">1815</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">     </span><span class="c">! topographie du modele</span>
<span class="linenos">1816</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">      </span><span class="c">! etendue de glace du modele</span>
<span class="linenos">1817</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">         </span><span class="c">! angle zenith du satellite (deg.)</span>
<span class="linenos">1818</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                  </span><span class="c">! identificateur du satellite</span>
<span class="linenos">1819</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                </span><span class="c">! reset du controle de qualite?</span>
<span class="linenos">1820</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w">         </span><span class="c">! indicateur controle de qualite tovs par canal </span>
<span class="linenos">1821</span><span class="w">                                                                </span><span class="c">!           =0 ok, &gt;0 rejet,</span>
<span class="linenos">1822</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="c">! retrieved cloud liquid water from observation </span>
<span class="linenos">1823</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="c">! retrieved cloud liquid water from background </span>
<span class="linenos">1824</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">  </span><span class="c">! scattering index over water from observation</span>
<span class="linenos">1825</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">   </span><span class="c">! scattering index over water from background</span>
<span class="linenos">1826</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">     </span><span class="c">! ATMS Information flag (newInformationFlag) values </span>
<span class="linenos">1827</span><span class="w">                                                                </span><span class="c">!   (new BURP element 025174 in header)</span>
<span class="linenos">1828</span><span class="w">                                                                </span><span class="c">!   FOR AMSUA just fill with zeros</span>
<span class="linenos">1829</span>
<span class="linenos">1830</span><span class="w">    </span><span class="c">!locals</span>
<span class="linenos">1831</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span>
<span class="linenos">1832</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">ZANGL</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mi">11</span><span class="mf">7.6</span><span class="o">/</span><span class="n">maxScanAngleAMSU</span><span class="w"></span>
<span class="linenos">1833</span><span class="w">    </span>
<span class="linenos">1834</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">JI</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"></span>
<span class="linenos">1835</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">ISFCREJ2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1836</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">(:),</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">(:),</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">1837</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="nb">EPSILON</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb150</span><span class="p">,</span><span class="w"> </span><span class="n">tb1831</span><span class="p">,</span><span class="w"> </span><span class="n">tb1832</span><span class="p">,</span><span class="w"> </span><span class="n">tb1833</span><span class="w"></span>
<span class="linenos">1838</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="w"></span>
<span class="linenos">1839</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1840</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1841</span>
<span class="linenos">1842</span><span class="w">    </span><span class="nb">EPSILON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="w"></span>
<span class="linenos">1843</span>
<span class="linenos">1844</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1845</span><span class="w">    </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1846</span><span class="w">                    </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1847</span><span class="w">                    </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1848</span><span class="w">                    </span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1849</span><span class="w">                    </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1850</span>
<span class="linenos">1851</span><span class="w">    </span><span class="n">ISFCREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1852</span><span class="w">    </span><span class="n">ISFCREJ2</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1853</span><span class="w">    </span><span class="n">ICH2OMPREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">,</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1854</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">GROSSMIN</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1855</span><span class="w">    </span><span class="n">GROSSMIN</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1856</span><span class="w">                    </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1857</span><span class="w">                    </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1858</span><span class="w">                    </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1859</span><span class="w">                    </span><span class="mi">12</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1860</span><span class="w">                    </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1861</span><span class="w">                    </span><span class="mi">13</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1862</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">GROSSMAX</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">1863</span><span class="w">    </span><span class="n">GROSSMAX</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">27</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1864</span><span class="w">                    </span><span class="mi">32</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1865</span><span class="w">                    </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1866</span><span class="w">                    </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1867</span><span class="w">                    </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1868</span><span class="w">                    </span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1869</span><span class="w">                    </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w">  </span>
<span class="linenos">1870</span>
<span class="linenos">1871</span><span class="w">    </span><span class="n">channelForTopoFilter</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">,</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1872</span><span class="w">    </span><span class="n">altitudeForTopoFilter</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">250</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1873</span>
<span class="linenos">1874</span><span class="w">    </span><span class="c">! Channels excluded from genCoeff in all-sky mode</span>
<span class="linenos">1875</span><span class="w">    </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">,</span><span class="w"> </span><span class="mi">47</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1876</span>
<span class="linenos">1877</span><span class="w">    </span><span class="c">! Allocation</span>
<span class="linenos">1878</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1879</span>
<span class="linenos">1880</span><span class="w">    </span><span class="c">! Initialisation, la premiere fois seulement!</span>
<span class="linenos">1881</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LLFIRST</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">1882</span><span class="k">      </span><span class="n">rejectionCodArray</span><span class="p">(:,:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1883</span><span class="w">      </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">1884</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">1885</span><span class="w">    </span><span class="c">! fill newInformationFlag with zeros ONLY for consistency with ATMS</span>
<span class="linenos">1886</span><span class="w">    </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1887</span><span class="w">    </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1888</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">RESETQC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">1889</span>
<span class="linenos">1890</span><span class="w">    </span><span class="c">! Bennartz parameters are   extract required channels:</span>
<span class="linenos">1891</span><span class="w">    </span><span class="k">call </span><span class="n">extractParamForBennartzRun</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1892</span><span class="w">                                     </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb150</span><span class="p">,</span><span class="w"> </span><span class="n">tb1831</span><span class="p">,</span><span class="w"> </span><span class="n">tb1832</span><span class="p">,</span><span class="w"> </span><span class="n">tb1833</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1893</span><span class="w">                                     </span><span class="n">tb89FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1894</span><span class="w">    </span>
<span class="linenos">1895</span><span class="w">    </span><span class="c">!  Run Bennartz AMSU-B algorithms.</span>
<span class="linenos">1896</span><span class="w">    </span><span class="k">call </span><span class="n">bennartz</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb150</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1897</span><span class="w">                   </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1898</span><span class="w">                   </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1899</span><span class="w">                   </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1900</span>
<span class="linenos">1901</span><span class="w">    </span><span class="c">! 10) test 10: RTTOV reject check (single)</span>
<span class="linenos">1902</span><span class="w">    </span><span class="c">! Rejected datum flag has bit #9 on.</span>
<span class="linenos">1903</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest10RttovRejectCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1904</span><span class="w">                                       </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1905</span>
<span class="linenos">1906</span><span class="w">    </span><span class="c">! 1) test 1: Topography check (partial)</span>
<span class="linenos">1907</span><span class="w">    </span><span class="c">! Channel 3- 45 is rejected for topography &gt;  2500m.</span>
<span class="linenos">1908</span><span class="w">    </span><span class="c">! Channel 4 - 46 is rejected for topography &gt; 2000m.</span>
<span class="linenos">1909</span><span class="w">    </span><span class="c">! Channel 5 - 47 is rejected for topography &gt; 1000m.</span>
<span class="linenos">1910</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest1TopographyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1911</span><span class="w">                                     </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">channelForTopoFilter</span><span class="p">,</span><span class="w"> </span><span class="n">altitudeForTopoFilter</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1912</span><span class="w">                                     </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1913</span><span class="w"> </span>
<span class="linenos">1914</span><span class="w">    </span><span class="c">! 2) test 2: &quot;Land/sea qualifier&quot; code check (full)</span>
<span class="linenos">1915</span><span class="w">    </span><span class="c">! allowed values are: 0, land,</span>
<span class="linenos">1916</span><span class="w">    </span><span class="c">!                     1, sea,</span>
<span class="linenos">1917</span><span class="w">    </span><span class="c">!                     2, coast.</span>
<span class="linenos">1918</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest2LandSeaQualifierCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1919</span><span class="w">                                           </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1920</span>
<span class="linenos">1921</span><span class="w">    </span><span class="c">! 3) test 3: &quot;Terrain type&quot; code check (full)</span>
<span class="linenos">1922</span><span class="w">    </span><span class="c">! allowed values are: -1 missing, 0 sea-ice, 1 snow on land.</span>
<span class="linenos">1923</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest3TerrainTypeCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1924</span><span class="w">                                      </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1925</span><span class="w"> </span>
<span class="linenos">1926</span><span class="w">    </span><span class="c">! 4) test 4: Field of view number check (full)</span>
<span class="linenos">1927</span><span class="w">    </span><span class="c">! Field of view acceptable range is [1,maxScanAngleAMSU]  for AMSU footprints.</span>
<span class="linenos">1928</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest4FieldOfViewCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1929</span><span class="w">                                      </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1930</span>
<span class="linenos">1931</span><span class="w">    </span><span class="c">! 5) test 5: Satellite zenith angle check (full)</span>
<span class="linenos">1932</span><span class="w">    </span><span class="c">! Satellite zenith angle acceptable range is [0.,60.].</span>
<span class="linenos">1933</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest5ZenithAngleCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1934</span><span class="w">                                      </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1935</span>
<span class="linenos">1936</span><span class="w">    </span><span class="c">! 6) test 6: &quot;Sat. zenith angle&quot;/&quot;field of view&quot; consistency check.  (full)</span>
<span class="linenos">1937</span><span class="w">    </span><span class="c">! Acceptable difference between &quot;Satellite zenith angle&quot;  and</span>
<span class="linenos">1938</span><span class="w">    </span><span class="c">! &quot;approximate angle computed from field of view number&quot; is 1.8 degrees.</span>
<span class="linenos">1939</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest6ZenAngleAndFovConsistencyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1940</span><span class="w">                                                    </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">ZANGL</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1941</span><span class="w">                                                    </span><span class="n">maxScanAngleAMSU</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">1942</span>
<span class="linenos">1943</span><span class="w">    </span><span class="c">! 7) test 7: &quot;Land/sea qual.&quot;/&quot;model land/sea&quot; consistency check.    (full)</span>
<span class="linenos">1944</span><span class="w">    </span><span class="c">! Acceptable conditions are:</span>
<span class="linenos">1945</span><span class="w">    </span><span class="c">!       a) both over ocean (landQualifierIndice=1; mg&lt;0.01), new threshold 0.20, jh dec 2000,</span>
<span class="linenos">1946</span><span class="w">    </span><span class="c">!       b) both over land  (landQualifierIndice=0; mg&gt;0.80), new threshold 0.50, jh dec 2000.</span>
<span class="linenos">1947</span><span class="w">    </span><span class="c">! Other conditions are unacceptable.</span>
<span class="linenos">1948</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest7landSeaQualifyerAndModelLandSeaConsistencyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1949</span><span class="w">                                                                     </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1950</span><span class="w">                                                                     </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1951</span>
<span class="linenos">1952</span><span class="w">    </span><span class="c">! 8) test 8: &quot;Terrain type&quot;/&quot;Land/sea qual.&quot;/&quot;model ice&quot; consistency check. (full)</span>
<span class="linenos">1953</span><span class="w">    </span><span class="c">! Unacceptable conditions are:</span>
<span class="linenos">1954</span><span class="w">    </span><span class="c">!        a) terrain is sea-ice and model has no ice(terrainTypeIndice=0; gl&lt;0.01).</span>
<span class="linenos">1955</span><span class="w">    </span><span class="c">!        b) terrain is sea-ice and land/sea qualifier is land (terrainTypeIndice=0; landQualifierIndice=0).</span>
<span class="linenos">1956</span><span class="w">    </span><span class="c">!        c) terrain is snow on land and land/sea qualifier is sea (terrainTypeIndice=1; landQualifierIndice=1).</span>
<span class="linenos">1957</span><span class="w">    </span><span class="c">!        d) terrain is missing, land/sea qualifier is sea and model has ice(terrainTypeIndice=-1; landQualifierIndice=1; gl&gt;0.01). (enleve jh, jan 2001)</span>
<span class="linenos">1958</span><span class="w">    </span><span class="c">! NOT doNE ANYMORE </span>
<span class="linenos">1959</span><span class="w">    </span>
<span class="linenos">1960</span><span class="w">    </span><span class="c">! 9) test 9: Uncorrected Tb check (single) SKIP FOR NOW</span>
<span class="linenos">1961</span><span class="w">    </span><span class="c">! Uncorrected datum (flag bit #6 off). In this case switch bit 11 ON.</span>
<span class="linenos">1962</span><span class="w">    </span><span class="c">! call amsuABTest9UncorrectedTbCheck (obsChannels, sensorIndex, actualNumChannel, stnId, RESETQC, obsFlags, qcIndicator) </span>
<span class="linenos">1963</span>
<span class="linenos">1964</span><span class="w">    </span><span class="c">! 11) test 11: Radiance observation &quot;Gross&quot; check (single) </span>
<span class="linenos">1965</span><span class="w">    </span><span class="c">!  Change this test from full to single. jh nov 2000.</span>
<span class="linenos">1966</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest11RadianceGrossValueCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1967</span><span class="w">                                              </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSMIN</span><span class="p">,</span><span class="w"> </span><span class="n">GROSSMAX</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">1968</span>
<span class="linenos">1969</span><span class="w">    </span><span class="c">! 12) test 12:  Dryness index check </span>
<span class="linenos">1970</span><span class="w">    </span><span class="c">!The difference between channels AMSUB-3 and AMSUB-5 is used as an indicator</span>
<span class="linenos">1971</span><span class="w">    </span><span class="c">!of &quot;dryness&quot; of the atmosphere. In extreme dry conditions, channels AMSUB-3 4 and 5</span>
<span class="linenos">1972</span><span class="w">    </span><span class="c">! are sensitive to the surface.</span>
<span class="linenos">1973</span><span class="w">    </span><span class="c">! Therefore, various thresholds are used to reject channels AMSUB-3 4 and 5</span>
<span class="linenos">1974</span><span class="w">    </span><span class="c">!  over land and ice</span>
<span class="linenos">1975</span><span class="w">    </span><span class="k">call </span><span class="n">amsubTest12DrynessIndexCheck</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1976</span><span class="w">                                       </span><span class="n">tb1831</span><span class="p">,</span><span class="w"> </span><span class="n">tb1833</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1977</span><span class="w">                                       </span><span class="n">skipTestArr_opt</span><span class="o">=</span><span class="n">skipTestArr</span><span class="p">(:))</span><span class="w"></span>
<span class="linenos">1978</span>
<span class="linenos">1979</span><span class="w">    </span><span class="c">! 13) test 13: Bennartz scattering index check (full)</span>
<span class="linenos">1980</span><span class="w">    </span><span class="k">call </span><span class="n">amsubTest13BennartzScatteringIndexCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1981</span><span class="w">                                                 </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1982</span><span class="w">                                                 </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1983</span><span class="w">                                                 </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1984</span><span class="w">                                                 </span><span class="n">skipTestArr_opt</span><span class="o">=</span><span class="n">skipTestArr</span><span class="p">(:))</span><span class="w"></span>
<span class="linenos">1985</span>
<span class="linenos">1986</span><span class="w">    </span><span class="c">! 14) test 14: &quot;Rogue check&quot; for (O-P) Tb residuals out of range. (single/full)</span>
<span class="linenos">1987</span><span class="w">    </span><span class="c">! Les observations, dont le residu (O-P) depasse par un facteur (roguefac) l&#39;erreur totale des TOVS.</span>
<span class="linenos">1988</span><span class="w">    </span><span class="c">! N.B.: a reject by any of the 3 surface channels produces the rejection of AMSUA-A channels 1-5 and 15. </span>
<span class="linenos">1989</span><span class="w">    </span><span class="k">call </span><span class="n">amsubTest14RogueCheck</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1990</span><span class="w">                               </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">1991</span><span class="w">                               </span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">skipTestArr_opt</span><span class="o">=</span><span class="n">skipTestArr</span><span class="p">(:))</span><span class="w"></span>
<span class="linenos">1992</span>
<span class="linenos">1993</span><span class="w">    </span><span class="c">! 15) test 15: Channel Selection using array oer_tovutil(chan,sat)</span>
<span class="linenos">1994</span><span class="w">    </span><span class="c">!  oer_tovutil = 0 (blacklisted)</span>
<span class="linenos">1995</span><span class="w">    </span><span class="c">!                1 (assmilate)</span>
<span class="linenos">1996</span><span class="w">    </span><span class="c">!                2 (assimilate over open water only)</span>
<span class="linenos">1997</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">1998</span><span class="w">    </span><span class="c">!  We also set QC flag bits 7 and 9 ON for channels with oer_tovutil=2 </span>
<span class="linenos">1999</span><span class="w">    </span><span class="c">!  over land or sea-ice</span>
<span class="linenos">2000</span><span class="w">    </span><span class="c">!    and </span>
<span class="linenos">2001</span><span class="w">    </span><span class="c">!  we set QC flag bits 7 and 9 ON for channels 1-3,15 over land</span>
<span class="linenos">2002</span><span class="w">    </span><span class="c">!  or sea-ice REGARDLESS of oer_tovutil value (but oer_tovutil=0 always for</span>
<span class="linenos">2003</span><span class="w">    </span><span class="c">!  these unassimilated channels).</span>
<span class="linenos">2004</span>
<span class="linenos">2005</span><span class="w">    </span><span class="k">call </span><span class="n">amsuABTest15ChannelSelectionWithTovutil</span><span class="w"> </span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2006</span><span class="w">                                                  </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2007</span><span class="w">                                                  </span><span class="n">ISFCREJ2</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2008</span>
<span class="linenos">2009</span><span class="w">    </span><span class="c">!  Synthese de la controle de qualite au niveau de chaque point</span>
<span class="linenos">2010</span><span class="w">    </span><span class="c">!  d&#39;observation. Code:</span>
<span class="linenos">2011</span><span class="w">    </span><span class="c">!            =0, aucun rejet,</span>
<span class="linenos">2012</span><span class="w">    </span><span class="c">!            &gt;0, au moins un canal rejete.</span>
<span class="linenos">2013</span>
<span class="linenos">2014</span><span class="w">    </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2015</span><span class="w">    </span><span class="k">do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2016</span><span class="w">      </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">KCHKPRF</span><span class="p">,</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">JI</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2017</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">2018</span>
<span class="linenos">2019</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;KCHKPRF = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w"></span>
<span class="linenos">2020</span>
<span class="linenos">2021</span><span class="w">    </span><span class="c">! reset global marker flag (55200) and mark it if observtions are rejected</span>
<span class="linenos">2022</span><span class="w">    </span><span class="k">call </span><span class="n">resetQcCases</span><span class="p">(</span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2023</span>
<span class="linenos">2024</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">2025</span><span class="w">    </span><span class="c">! FINAL STEP: set terrain type to sea ice given certain conditions</span>
<span class="linenos">2026</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">2027</span><span class="w">    </span><span class="k">call </span><span class="n">setTerrainTypeToSeaIce</span><span class="p">(</span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2028</span>
<span class="linenos">2029</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_tovCheckAmsub</span><span class="w"></span>
<span class="linenos">2030</span>
<span class="linenos">2031</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2032</span><span class="w">  </span><span class="c">! mwbg_qcStats</span>
<span class="linenos">2033</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2034</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_qcStats</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2035</span><span class="w">                          </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">satelliteId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2036</span><span class="w">                          </span><span class="n">LDprint</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2037</span>
<span class="linenos">2038</span><span class="w">    </span><span class="c">!:Purpose:          Cumuler ou imprimer des statistiques decriptives</span>
<span class="linenos">2039</span><span class="w">    </span><span class="c">!                   des rejets tovs.</span>
<span class="linenos">2040</span><span class="w">    </span><span class="k">implicit none</span><span class="w"> </span>
<span class="linenos">2041</span><span class="w">    </span><span class="c">!Arguments:</span>
<span class="linenos">2042</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">instName</span><span class="w">                     </span><span class="c">! Instrument Name</span>
<span class="linenos">2043</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w">               </span><span class="c">! indicateur controle de qualite tovs par canal </span>
<span class="linenos">2044</span><span class="w">                                                                  </span><span class="c">!  =0 ok, &gt;0 rejet,</span>
<span class="linenos">2045</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">             </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">2046</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="c">! canaux des observations</span>
<span class="linenos">2047</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                  </span><span class="c">! numero d&#39;identificateur du satellite</span>
<span class="linenos">2048</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satelliteId</span><span class="p">(:)</span><span class="w">               </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2049</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">           </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LDprint</span><span class="w">                      </span><span class="c">! mode: imprimer ou cumuler?</span>
<span class="linenos">2050</span><span class="w">    </span><span class="c">!Locals</span>
<span class="linenos">2051</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">numSats</span><span class="p">,</span><span class="w"> </span><span class="n">JI</span><span class="p">,</span><span class="w"> </span><span class="n">JJ</span><span class="p">,</span><span class="w"> </span><span class="n">JK</span><span class="p">,</span><span class="w"> </span><span class="n">INTOTOBS</span><span class="p">,</span><span class="w"> </span><span class="n">INTOTACC</span><span class="w"></span>
<span class="linenos">2052</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">INTOT</span><span class="p">(:)</span><span class="w">    </span><span class="c">! INTOT(mwbg_maxNumSat)</span>
<span class="linenos">2053</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">INTOTRJF</span><span class="p">(:)</span><span class="w"> </span><span class="c">! INTOTRJF(mwbg_maxNumSat)</span>
<span class="linenos">2054</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">INTOTRJP</span><span class="p">(:)</span><span class="w"> </span><span class="c">! INTOTRJP(mwbg_maxNumSat)</span>
<span class="linenos">2055</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">FULLACCPT</span><span class="w"></span>
<span class="linenos">2056</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2057</span>
<span class="linenos">2058</span><span class="w">    </span><span class="c">! Initialize</span>
<span class="linenos">2059</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LLFIRST</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2060</span><span class="k">      call </span><span class="n">utl_reallocate</span><span class="p">(</span><span class="n">INTOT</span><span class="p">,</span><span class="w"> </span><span class="n">mwbg_maxNumSat</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2061</span><span class="w">      </span><span class="k">call </span><span class="n">utl_reallocate</span><span class="p">(</span><span class="n">INTOTRJF</span><span class="p">,</span><span class="w"> </span><span class="n">mwbg_maxNumSat</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2062</span><span class="w">      </span><span class="k">call </span><span class="n">utl_reallocate</span><span class="p">(</span><span class="n">INTOTRJP</span><span class="p">,</span><span class="w"> </span><span class="n">mwbg_maxNumSat</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2063</span><span class="w">      </span><span class="k">do </span><span class="n">JJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mwbg_maxNumSat</span><span class="w"></span>
<span class="linenos">2064</span><span class="w">        </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2065</span><span class="w">        </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2066</span><span class="w">        </span><span class="n">INTOT</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2067</span><span class="w">      </span><span class="k">end do</span>
<span class="linenos">2068</span><span class="k">      </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2069</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">2070</span>
<span class="linenos">2071</span><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">LDprint</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">2072</span><span class="w">      </span><span class="c">! Accumulate statistics on rejects</span>
<span class="linenos">2073</span><span class="w">      </span><span class="n">INTOT</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOT</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2074</span><span class="w">      </span><span class="c">! Fully accepted, fully rejected or partially rejected?</span>
<span class="linenos">2075</span><span class="w">      </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2076</span><span class="w">      </span><span class="n">FULLACCPT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2077</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;AMSUA&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos">2078</span><span class="k">        do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2079</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">JI</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2080</span><span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">JI</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2081</span><span class="k">              </span><span class="n">FULLACCPT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2082</span><span class="w">            </span><span class="k">else</span>
<span class="linenos">2083</span><span class="k">              </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2084</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos">2085</span><span class="k">          end if</span>
<span class="linenos">2086</span><span class="k">        end do</span>
<span class="linenos">2087</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2088</span><span class="k">          </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2089</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2090</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">FULLACCPT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2091</span><span class="k">          </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2092</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2093</span><span class="k">      else if</span><span class="w">  </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;ATMS&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos">2094</span><span class="k">        do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2095</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">JI</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2096</span><span class="k">            </span><span class="n">FULLACCPT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2097</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">2098</span><span class="k">            </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2099</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">2100</span><span class="k">        end do</span>
<span class="linenos">2101</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2102</span><span class="k">          </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2103</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2104</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">FULLREJCT</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">FULLACCPT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2105</span><span class="k">          </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2106</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2107</span><span class="k">      end if</span>
<span class="linenos">2108</span><span class="k">      </span>
<span class="linenos">2109</span><span class="k">    else</span>
<span class="linenos">2110</span>
<span class="linenos">2111</span><span class="k">      </span><span class="n">numSats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">satelliteId</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2112</span><span class="w">      </span><span class="c">! Print statistics</span>
<span class="linenos">2113</span><span class="w">      </span><span class="k">do </span><span class="n">JK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">numSats</span><span class="w"></span>
<span class="linenos">2114</span>
<span class="linenos">2115</span><span class="w">        </span><span class="n">INTOTOBS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOT</span><span class="p">(</span><span class="n">JK</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2116</span><span class="w">        </span><span class="n">INTOTACC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INTOTOBS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">JK</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">JK</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2117</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(/////50(&quot;*&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2118</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(     50(&quot;*&quot;)/)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2119</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(T5,&quot;SUMMARY OF QUALITY CONTROL FOR &quot;, &amp;</span>
<span class="linenos">2120</span><span class="s1">           A8)&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">satelliteId</span><span class="p">(</span><span class="n">JK</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">2121</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(T5,&quot;------------------------------------- &quot;,/)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2122</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;( &amp;</span>
<span class="linenos">2123</span><span class="s1">           &quot; - TOTAL NUMBER OF OBS.    = &quot;,I10,/ &amp;</span>
<span class="linenos">2124</span><span class="s1">           &quot; - TOTAL FULL REJECTS      = &quot;,I10,/ &amp;</span>
<span class="linenos">2125</span><span class="s1">           &quot; - TOTAL PARTIAL REJECTS   = &quot;,I10,/ &amp;</span>
<span class="linenos">2126</span><span class="s1">           &quot;   ------------------------------------&quot;,/ &amp;</span>
<span class="linenos">2127</span><span class="s1">           &quot;   TOTAL FULLY ACCEPTED    = &quot;,I10,/)&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2128</span><span class="w">            </span><span class="n">INTOTOBS</span><span class="p">,</span><span class="w"> </span><span class="n">INTOTRJF</span><span class="p">(</span><span class="n">JK</span><span class="p">),</span><span class="w"> </span><span class="n">INTOTRJP</span><span class="p">(</span><span class="n">JK</span><span class="p">),</span><span class="w"> </span><span class="n">INTOTACC</span><span class="w"></span>
<span class="linenos">2129</span>
<span class="linenos">2130</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;AMSUA&quot;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;AMSUB&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then         </span>
<span class="linenos">2131</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(//,1x,114(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2132</span><span class="w">           </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(t10,&quot;|&quot;,t47,&quot;REJECTION CATEGORIES&quot;)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2133</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(&quot; CHANNEL&quot;,t10,&quot;|&quot;,105(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2134</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(t10,&quot;|&quot;,16i7)&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">JI</span><span class="p">,</span><span class="n">JI</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2135</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(1x,&quot;--------|&quot;,105(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2136</span><span class="w">          </span><span class="k">do </span><span class="n">JJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"> </span>
<span class="linenos">2137</span><span class="w">             </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(3X,I2,t10,&quot;|&quot;,16I7)&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">JJ</span><span class="p">,(</span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">JI</span><span class="p">,</span><span class="n">JJ</span><span class="p">,</span><span class="n">JK</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2138</span><span class="w">                                      </span><span class="n">JI</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2139</span><span class="w">          </span><span class="k">end do</span>
<span class="linenos">2140</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(1x,114(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2141</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">2142</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">2143</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; -----------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">2144</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; Definition of rejection categories:&#39;</span><span class="w"></span>
<span class="linenos">2145</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; -----------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">2146</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  1 - topography reject&#39;</span><span class="w"></span>
<span class="linenos">2147</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  2 - invalid land/sea qualifier&#39;</span><span class="w"></span>
<span class="linenos">2148</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  3 - invalid terrain type&#39;</span><span class="w"></span>
<span class="linenos">2149</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  4 - invalid field of view number&#39;</span><span class="w"></span>
<span class="linenos">2150</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  5 - satellite zenith angle out of range &#39;</span><span class="w"></span>
<span class="linenos">2151</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  6 - inconsistent field of view and sat. zenith angle&#39;</span><span class="w"></span>
<span class="linenos">2152</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  7 - inconsistent land/sea qualifier and model mask&#39;</span><span class="w"></span>
<span class="linenos">2153</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  8 - inconsistent terrain type and land/sea&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2154</span><span class="w">                   </span><span class="s1">&#39; qualifier/model ice (NOT doNE)&#39;</span><span class="w"></span>
<span class="linenos">2155</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  9 - uncorrected radiance&#39;</span><span class="w"></span>
<span class="linenos">2156</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; 10 - rejected by RTTOV&#39;</span><span class="w"></span>
<span class="linenos">2157</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; 11 - radiance gross check failure&#39;</span><span class="w"></span>
<span class="linenos">2158</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; 12 - cloud liquid water reject&#39;</span><span class="w"></span>
<span class="linenos">2159</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; 13 - scattering index reject&#39;</span><span class="w"></span>
<span class="linenos">2160</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; 14 - radiance residual rogue check failure&#39;</span><span class="w"></span>
<span class="linenos">2161</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; 15 - rejection by channel selection&#39;</span><span class="w"></span>
<span class="linenos">2162</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; -----------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">2163</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>
<span class="linenos">2164</span>
<span class="linenos">2165</span><span class="w">        </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;ATMS&quot;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;MWHS2&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2166</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(//,1x,59(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2167</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(t10,&quot;|&quot;,t19,&quot;1. REJECTION CATEGORIES&quot;)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2168</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(&quot; CHANNEL&quot;,t10,&quot;|&quot;,50(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2169</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(t10,&quot;|&quot;,5i7)&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">JI</span><span class="p">,</span><span class="n">JI</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2170</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(1x,&quot;--------|&quot;,50(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2171</span><span class="w">          </span><span class="k">do </span><span class="n">JJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"> </span>
<span class="linenos">2172</span><span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(3X,I2,t10,&quot;|&quot;,5I7)&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">JJ</span><span class="p">,(</span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">JI</span><span class="p">,</span><span class="n">JJ</span><span class="p">,</span><span class="n">JK</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2173</span><span class="w">                                        </span><span class="n">JI</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2174</span><span class="w">          </span><span class="k">end do</span>
<span class="linenos">2175</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(1x,59(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2176</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(//,1x,59(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2177</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(t10,&quot;|&quot;,t19,&quot;2. QC2 REJECT CATEGORIES&quot;)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2178</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(&quot; CHANNEL&quot;,t10,&quot;|&quot;,50(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">2179</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(t10,&quot;|&quot;,5i7)&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">JI</span><span class="p">,</span><span class="n">JI</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2180</span><span class="w">          </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(1x,&quot;--------|&quot;,50(&quot;-&quot;))&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2181</span><span class="w">          </span><span class="k">do </span><span class="n">JJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2182</span><span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(3X,I2,t10,&quot;|&quot;,5I7)&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">JJ</span><span class="p">,(</span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">JI</span><span class="p">,</span><span class="n">JJ</span><span class="p">,</span><span class="n">JK</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2183</span><span class="w">                                        </span><span class="n">JI</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w">          </span>
<span class="linenos">2184</span><span class="w">          </span><span class="k">end do</span>
<span class="linenos">2185</span><span class="k">          print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">2186</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">2187</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; -----------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">2188</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; Definition of rejection categories: &#39;</span><span class="w"></span>
<span class="linenos">2189</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; -----------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">2190</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  1 - first bgckAtms/bgckMwhs2 program reject [bit 7]&#39;</span><span class="w"></span>
<span class="linenos">2191</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  2 - topography reject&#39;</span><span class="w"></span>
<span class="linenos">2192</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  3 - uncorrected radiance&#39;</span><span class="w"></span>
<span class="linenos">2193</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  4 - innovation (O-P) based reject&#39;</span><span class="w"></span>
<span class="linenos">2194</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  5 - rejection by channel selection&#39;</span><span class="w"></span>
<span class="linenos">2195</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; -----------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">2196</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">2197</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; QC2 REJECT numbers in Table 2 are for data that &#39;</span><span class="w"></span>
<span class="linenos">2198</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; passed test 1 (data with QC flag bit 7 OFF)&#39;</span><span class="w"></span>
<span class="linenos">2199</span><span class="w">          </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">2200</span><span class="w">        </span><span class="k">end if </span>
<span class="linenos">2201</span><span class="k">      end do</span>
<span class="linenos">2202</span><span class="k">    end if</span>
<span class="linenos">2203</span>
<span class="linenos">2204</span><span class="k">  end subroutine </span><span class="n">mwbg_qcStats</span><span class="w"></span>
<span class="linenos">2205</span>
<span class="linenos">2206</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2207</span><span class="w">  </span><span class="c">! resetQcC</span>
<span class="linenos">2208</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2209</span><span class="w">  </span><span class="k">subroutine </span><span class="n">resetQcCases</span><span class="p">(</span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2210</span><span class="w">    </span><span class="c">!:Purpose:        allumer la bit (6) indiquant que l&#39;observation a un element</span>
<span class="linenos">2211</span><span class="w">    </span><span class="c">!                 rejete par le controle de qualite de l&#39;AO.</span>
<span class="linenos">2212</span><span class="w">    </span><span class="c">!                 N.B.: si on est en mode resetqc, on remet le marqueur global a</span>
<span class="linenos">2213</span><span class="w">    </span><span class="c">!                 sa valeur de defaut, soit 1024,  avant de faire la mise a jour.</span>
<span class="linenos">2214</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">2215</span><span class="w">    </span><span class="c">!Arguments:</span>
<span class="linenos">2216</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">         </span><span class="c">! reset the quality control flags before adding the new ones ?</span>
<span class="linenos">2217</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w">         </span><span class="c">! indicateur global controle de qualite tovs. Code:</span>
<span class="linenos">2218</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"> </span><span class="c">! Marqueurs globaux  </span>
<span class="linenos">2219</span>
<span class="linenos">2220</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">RESETQC</span><span class="p">)</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="w">  </span>
<span class="linenos">2221</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="w"> </span><span class="p">(</span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2222</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; KCHKPRF   = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;, NEW FLAGS = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"></span>
<span class="linenos">2223</span>
<span class="linenos">2224</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">resetQcCases</span><span class="w"></span>
<span class="linenos">2225</span>
<span class="linenos">2226</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2227</span><span class="w">  </span><span class="c">! setTerrainTypeToSeaIce</span>
<span class="linenos">2228</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2229</span><span class="w">  </span><span class="k">subroutine </span><span class="n">setTerrainTypeToSeaIce</span><span class="p">(</span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2230</span>
<span class="linenos">2231</span><span class="w">    </span><span class="c">!:Purpose:       Dans les conditions suivantes:</span>
<span class="linenos">2232</span><span class="w">    </span><span class="c">!                1) l&#39;indicateur terre/mer indique l&#39;ocean (landQualifierIndice=1),</span>
<span class="linenos">2233</span><span class="w">    </span><span class="c">!                2) le &quot;terrain type&quot; est manquant (terrainTypeIndice=-1),</span>
<span class="linenos">2234</span><span class="w">    </span><span class="c">!                3) le modele indique de la glace (gl &gt;= 0.01),</span>
<span class="linenos">2235</span><span class="w">    </span><span class="c">!                on specifie &quot;sea ice&quot; pour le &quot;terrain type&quot; (terrainTypeIndice=0).</span>
<span class="linenos">2236</span><span class="w">    </span><span class="k">implicit none</span><span class="w"> </span>
<span class="linenos">2237</span><span class="w">    </span><span class="c">!Arguments:</span>
<span class="linenos">2238</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">   </span><span class="c">! sea ice</span>
<span class="linenos">2239</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="c">! land sea qualifier</span>
<span class="linenos">2240</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">   </span><span class="c">! terrain type</span>
<span class="linenos">2241</span>
<span class="linenos">2242</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2243</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; OLD TERRAIN type = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2244</span><span class="w">                  </span><span class="s1">&#39;, landQualifierIndice = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2245</span><span class="w">                  </span><span class="s1">&#39;, modelInterpSeaIce = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w"></span>
<span class="linenos">2246</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">2247</span>
<span class="linenos">2248</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">  </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2249</span><span class="k">      </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2250</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">2251</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;NEW TERRAIN type = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos">2252</span><span class="w">    </span>
<span class="linenos">2253</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">setTerrainTypeToSeaIce</span><span class="w"></span>
<span class="linenos">2254</span>
<span class="linenos">2255</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2256</span><span class="w">  </span><span class="c">! GRODY</span>
<span class="linenos">2257</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2258</span><span class="w">  </span><span class="k">subroutine </span><span class="n">GRODY</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">tb23</span><span class="p">,</span><span class="w"> </span><span class="n">tb31</span><span class="p">,</span><span class="w"> </span><span class="n">tb50</span><span class="p">,</span><span class="w"> </span><span class="n">tb53</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2259</span><span class="w">                    </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">ice</span><span class="p">,</span><span class="w"> </span><span class="n">tpw</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2260</span><span class="w">                    </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2261</span><span class="w">                    </span><span class="n">rain</span><span class="p">,</span><span class="w"> </span><span class="n">snow</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2262</span><span class="w">    </span><span class="c">!:Purpose: Compute the following parameters using 5 AMSU-A channels:</span>
<span class="linenos">2263</span><span class="w">    </span><span class="c">!          - sea ice, </span>
<span class="linenos">2264</span><span class="w">    </span><span class="c">!          - total precipitable water, </span>
<span class="linenos">2265</span><span class="w">    </span><span class="c">!          - cloud liquid water, </span>
<span class="linenos">2266</span><span class="w">    </span><span class="c">!          - ocean/land rain, </span>
<span class="linenos">2267</span><span class="w">    </span><span class="c">!          - snow cover/glacial ice,</span>
<span class="linenos">2268</span><span class="w">    </span><span class="c">!          - scattering index (sur la terre et sur l&#39;eau).</span>
<span class="linenos">2269</span><span class="w">    </span><span class="c">!          The four channels used are: 23Ghz, 31Ghz, 50Ghz and 89Ghz.</span>
<span class="linenos">2270</span><span class="w">    </span><span class="c">!          REGERENCES     N. Grody, NOAA/NESDIS, ....</span>
<span class="linenos">2271</span>
<span class="linenos">2272</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">2273</span>
<span class="linenos">2274</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">2275</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span><span class="w">                     </span><span class="c">! error return code: 0 ok, 1 input parameter out of range.</span>
<span class="linenos">2276</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb23</span><span class="w">                    </span><span class="c">! 23Ghz brightness temperature (K)</span>
<span class="linenos">2277</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb31</span><span class="w">                    </span><span class="c">! 31Ghz brightness temperature (K)</span>
<span class="linenos">2278</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb50</span><span class="w">                    </span><span class="c">! 50Ghz brightness temperature (K)</span>
<span class="linenos">2279</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb53</span><span class="w">                    </span><span class="c">! 53Ghz brightness temperature (K)</span>
<span class="linenos">2280</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89</span><span class="w">                    </span><span class="c">! 89Ghz brightness temperature (K)</span>
<span class="linenos">2281</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb23FG</span><span class="w">                  </span><span class="c">! 23Ghz brightness temperature from background (K)</span>
<span class="linenos">2282</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb31FG</span><span class="w">                  </span><span class="c">! 31Ghz brightness temperature from background (K)</span>
<span class="linenos">2283</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">          </span><span class="c">! satellite zenith angle (deg.)</span>
<span class="linenos">2284</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w">                  </span><span class="c">! latitude (deg.)</span>
<span class="linenos">2285</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">     </span><span class="c">! land/sea indicator (0=land;1=ocean)</span>
<span class="linenos">2286</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ice</span><span class="w">                     </span><span class="c">! sea ice concentration (0-100%)</span>
<span class="linenos">2287</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tpw</span><span class="w">                     </span><span class="c">! total precipitable water (0-70mm)</span>
<span class="linenos">2288</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="c">! retrieved cloud liquid water from observation (0-3mm)</span>
<span class="linenos">2289</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">  </span><span class="c">! retrieved cloud liquid water from background (0-3mm)</span>
<span class="linenos">2290</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rain</span><span class="w">                    </span><span class="c">! rain identification (0=no rain; 1=rain)</span>
<span class="linenos">2291</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">snow</span><span class="w">                    </span><span class="c">! snow cover and glacial ice identification:</span>
<span class="linenos">2292</span><span class="w">                                                    </span><span class="c">! (0=no snow; 1=snow; 2=glacial ice)</span>
<span class="linenos">2293</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="w">    </span><span class="c">! scattering index over land</span>
<span class="linenos">2294</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">   </span><span class="c">! scattering index over water</span>
<span class="linenos">2295</span>
<span class="linenos">2296</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos">2297</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">df3</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e23</span><span class="w"></span>
<span class="linenos">2298</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ei</span><span class="p">,</span><span class="w"> </span><span class="n">cosz</span><span class="p">,</span><span class="w"> </span><span class="n">tt</span><span class="p">,</span><span class="w"> </span><span class="n">scat</span><span class="p">,</span><span class="w"> </span><span class="n">sc31</span><span class="p">,</span><span class="w"> </span><span class="n">t23</span><span class="p">,</span><span class="w"> </span><span class="n">t31</span><span class="p">,</span><span class="w"> </span><span class="n">t50</span><span class="p">,</span><span class="w"> </span><span class="n">t89</span><span class="w"></span>
<span class="linenos">2299</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sc50</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">,</span><span class="w"> </span><span class="n">t53</span><span class="w"></span>
<span class="linenos">2300</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dif285t23</span><span class="p">,</span><span class="w"> </span><span class="n">dif285t31</span><span class="p">,</span><span class="w"> </span><span class="nb">epsilon</span>
<span class="linenos">2301</span><span class="nb">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dif285t23FG</span><span class="p">,</span><span class="w"> </span><span class="n">dif285t31FG</span><span class="w"></span>
<span class="linenos">2302</span>
<span class="linenos">2303</span><span class="w">    </span><span class="k">data </span><span class="nb">epsilon</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.E-30</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="linenos">2304</span>
<span class="linenos">2305</span><span class="w">    </span><span class="kt">logical </span><span class="n">chan15Missing</span><span class="w"> </span>
<span class="linenos">2306</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">2307</span><span class="w">    </span><span class="c">! Notes: In the case where an output parameter cannot be calculated, the</span>
<span class="linenos">2308</span><span class="w">    </span><span class="c">!        value of this parameter is to to the missing value, i.e. -99.</span>
<span class="linenos">2309</span>
<span class="linenos">2310</span><span class="w">    </span><span class="c">! 1) Initialise output parameters:</span>
<span class="linenos">2311</span><span class="w">    </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2312</span><span class="w">    </span><span class="n">tpw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2313</span><span class="w">    </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2314</span><span class="w">    </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2315</span><span class="w">    </span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2316</span><span class="w">    </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2317</span><span class="w">    </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2318</span><span class="w">    </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2319</span>
<span class="linenos">2320</span><span class="w">    </span><span class="c">! 2) Validate input parameters:</span>
<span class="linenos">2321</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2322</span><span class="w">          </span><span class="n">tb31</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb31</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2323</span><span class="w">          </span><span class="n">tb50</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb50</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2324</span><span class="w">          </span><span class="n">tb53</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb53</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2325</span><span class="w">          </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2326</span><span class="w">          </span><span class="n">obsLat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2327</span><span class="w">          </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2328</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2329</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">2330</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2331</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2332</span>
<span class="linenos">2333</span><span class="w">    </span><span class="c">!3) Compute parameters:</span>
<span class="linenos">2334</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2335</span><span class="k">      </span><span class="n">cosz</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">cosd</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2336</span><span class="w">      </span><span class="n">t23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23</span><span class="w"></span>
<span class="linenos">2337</span><span class="w">      </span><span class="n">t31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31</span><span class="w"></span>
<span class="linenos">2338</span><span class="w">      </span><span class="n">t50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb50</span><span class="w"></span>
<span class="linenos">2339</span><span class="w">      </span><span class="n">t53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb53</span><span class="w"></span>
<span class="linenos">2340</span><span class="w">      </span><span class="n">dif285t23</span><span class="w">  </span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.</span><span class="o">-</span><span class="n">t23</span><span class="p">,</span><span class="nb">epsilon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2341</span><span class="w">      </span><span class="n">dif285t23FG</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.</span><span class="o">-</span><span class="n">tb23FG</span><span class="p">,</span><span class="nb">epsilon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2342</span><span class="w">      </span><span class="n">dif285t31</span><span class="w">  </span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.</span><span class="o">-</span><span class="n">t31</span><span class="p">,</span><span class="nb">epsilon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2343</span><span class="w">      </span><span class="n">dif285t31FG</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.</span><span class="o">-</span><span class="n">tb31FG</span><span class="p">,</span><span class="nb">epsilon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2344</span>
<span class="linenos">2345</span><span class="w">      </span><span class="n">chan15Missing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2346</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tb89</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos">2347</span><span class="k">        </span><span class="n">chan15Missing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2348</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">2349</span>
<span class="linenos">2350</span><span class="k">      if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">chan15Missing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2351</span><span class="k">        </span><span class="n">t89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb89</span><span class="w"></span>
<span class="linenos">2352</span><span class="w">        </span><span class="c">! scattering indices:</span>
<span class="linenos">2353</span><span class="w">        </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">11</span><span class="mf">3.2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">2.41</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.0049</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.454</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t31</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t89</span><span class="w"> </span>
<span class="linenos">2354</span><span class="w">        </span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t89</span><span class="w"></span>
<span class="linenos">2355</span><span class="w">      </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2356</span>
<span class="linenos">2357</span><span class="w">      </span><span class="c">! discriminate functions:</span>
<span class="linenos">2358</span><span class="w">      </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">2.85</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.020</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.028</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t50</span><span class="w"> </span><span class="c">! used to identify (also remove) sea ice</span>
<span class="linenos">2359</span><span class="w">      </span><span class="n">df2</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">5.10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.078</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.096</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t50</span><span class="w"> </span><span class="c">! used to identify (also remove) warm deserts</span>
<span class="linenos">2360</span><span class="w">      </span><span class="n">df3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.036</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.074</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t50</span><span class="w"> </span><span class="c">! used to identify (also remove) cold deserts</span>
<span class="linenos">2361</span>
<span class="linenos">2362</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">2363</span>
<span class="linenos">2364</span><span class="w">        </span><span class="c">! Ocean Parameters</span>
<span class="linenos">2365</span>
<span class="linenos">2366</span><span class="w">        </span><span class="c">!3.1) Sea ice:</span>
<span class="linenos">2367</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2368</span><span class="k">          </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">2369</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">2370</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.45</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2371</span><span class="k">            </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">2372</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">2373</span><span class="k">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">1.7340</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">0.6236</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">2374</span><span class="w">            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.0070</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="mf">0.0025</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">2375</span><span class="w">            </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.00106</span><span class="w"> </span>
<span class="linenos">2376</span><span class="w">            </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.00909</span><span class="w"></span>
<span class="linenos">2377</span><span class="w">            </span><span class="n">e23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t31</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t50</span><span class="w"> </span><span class="c">! theoretical 23Ghz sfc emissivity (0.3-1.)</span>
<span class="linenos">2378</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">t23</span><span class="o">-</span><span class="n">t31</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">   </span><span class="c">! fov contains multiyear or new ice/water</span>
<span class="linenos">2379</span><span class="w">              </span><span class="n">ei</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.88</span><span class="w"></span>
<span class="linenos">2380</span><span class="w">            </span><span class="k">else</span>
<span class="linenos">2381</span><span class="k">              </span><span class="n">ei</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.95</span><span class="w"></span>
<span class="linenos">2382</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos">2383</span><span class="k">            </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">e23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.45</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">ei</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.45</span><span class="p">)</span><span class="w"> </span><span class="c">! sea-ice concentration within fov (0-100%) </span>
<span class="linenos">2384</span><span class="w">            </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="mf">0.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">ice</span><span class="p">))</span><span class="o">/</span><span class="mi">10</span><span class="mf">0.</span><span class="w">   </span><span class="c">!jh (0.-1.)</span>
<span class="linenos">2385</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">2386</span><span class="k">        end if</span><span class="w"></span>
<span class="linenos">2387</span>
<span class="linenos">2388</span><span class="w">        </span><span class="c">! 3.2) Total precipitable water:</span>
<span class="linenos">2389</span><span class="w">        </span><span class="c">! identify and remove sea ice</span>
<span class="linenos">2390</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="k">then  </span>
<span class="linenos">2391</span><span class="k">          </span><span class="n">tpw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2392</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">2393</span><span class="k">          </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mi">24</span><span class="mf">7.920</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="mf">9.235</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="mf">4.177</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">2394</span><span class="w">          </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">11</span><span class="mf">6.270</span><span class="w"></span>
<span class="linenos">2395</span><span class="w">          </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="mi">7</span><span class="mf">3.409</span><span class="w"></span>
<span class="linenos">2396</span><span class="w">          </span><span class="n">tpw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">dif285t23</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">dif285t31</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2397</span><span class="w">          </span><span class="n">tpw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tpw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w">           </span><span class="c">! theoretical total precipitable water (0-70mm)</span>
<span class="linenos">2398</span><span class="w">          </span><span class="n">tpw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.942</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tpw</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.17</span><span class="w">   </span><span class="c">! corrected   total precipitable water </span>
<span class="linenos">2399</span><span class="w">          </span><span class="n">tpw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="mi">7</span><span class="mf">0.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">tpw</span><span class="p">))</span><span class="w">   </span><span class="c">! jh     </span>
<span class="linenos">2400</span><span class="w">        </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2401</span>
<span class="linenos">2402</span><span class="w">        </span><span class="c">!3.3) Cloud liquid water from obs (cloudLiquidWaterPathObs) and background state (cloudLiquidWaterPathFG):</span>
<span class="linenos">2403</span><span class="w">        </span><span class="c">! identify and remove sea ice</span>
<span class="linenos">2404</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">then  </span>
<span class="linenos">2405</span><span class="k">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2406</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2407</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">2408</span><span class="k">          </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">8.240</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">2.622</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.846</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">2409</span><span class="w">          </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.754</span><span class="w"></span>
<span class="linenos">2410</span><span class="w">          </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">2.265</span><span class="w"></span>
<span class="linenos">2411</span><span class="w">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">dif285t23</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">dif285t31</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2412</span><span class="w">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w">         </span><span class="c">! theoretical cloud liquid water (0-3mm)</span>
<span class="linenos">2413</span><span class="w">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.03</span><span class="w">         </span><span class="c">! corrected cloud liquid water </span>
<span class="linenos">2414</span><span class="w">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">cloudLiquidWaterPathObs</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2415</span>
<span class="linenos">2416</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">dif285t23FG</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">dif285t31FG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2417</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w">           </span><span class="c">! theoretical cloud liquid water (0-3mm)</span>
<span class="linenos">2418</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.03</span><span class="w">           </span><span class="c">! corrected cloud liquid water </span>
<span class="linenos">2419</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">cloudLiquidWaterPathFG</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2420</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2421</span>
<span class="linenos">2422</span><span class="k">        if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">chan15Missing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">2423</span><span class="w">          </span><span class="c">!3.4) Ocean rain: 0=no rain; 1=rain.</span>
<span class="linenos">2424</span><span class="w">          </span><span class="c">! identify and remove sea ice</span>
<span class="linenos">2425</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">then  </span>
<span class="linenos">2426</span><span class="k">            </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2427</span><span class="w">          </span><span class="k">else</span><span class="w">                                   </span><span class="c">! remove non-precipitating clouds</span>
<span class="linenos">2428</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="o">&gt;</span><span class="w"> </span><span class="mf">9.0</span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos">2429</span><span class="k">              </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2430</span><span class="w">            </span><span class="k">else</span>
<span class="linenos">2431</span><span class="k">              </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2432</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos">2433</span><span class="k">          end if</span>
<span class="linenos">2434</span><span class="k">        end if</span>
<span class="linenos">2435</span>
<span class="linenos">2436</span><span class="k">      else</span>
<span class="linenos">2437</span>
<span class="linenos">2438</span><span class="k">        if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">chan15Missing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">2439</span><span class="w">          </span><span class="c">! Land Parameters</span>
<span class="linenos">2440</span>
<span class="linenos">2441</span><span class="w">          </span><span class="c">! 3.5) Rain  over land: 0=no rain; 1=rain.</span>
<span class="linenos">2442</span><span class="w">          </span><span class="n">tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="mf">8.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.49</span><span class="o">*</span><span class="n">t89</span><span class="w"></span>
<span class="linenos">2443</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">3.</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2444</span><span class="k">            </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2445</span><span class="w">          </span><span class="k">else </span>
<span class="linenos">2446</span><span class="k">            </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2447</span><span class="w">          </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2448</span><span class="w">          </span>
<span class="linenos">2449</span><span class="w">          </span><span class="c">! remove snow cover</span>
<span class="linenos">2450</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t23</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">26</span><span class="mf">1.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tt</span><span class="p">)</span><span class="w"> </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2451</span>
<span class="linenos">2452</span><span class="w">          </span><span class="c">! remove warm deserts</span>
<span class="linenos">2453</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t89</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6</span><span class="p">)</span><span class="w"> </span><span class="n">rain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2454</span>
<span class="linenos">2455</span><span class="w">          </span><span class="c">! 3.6) Snow cover and glacial ice: 0=no snow; 1=snow; 2=glacial ice.</span>
<span class="linenos">2456</span><span class="w">          </span><span class="n">tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="mf">8.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.49</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t89</span><span class="w"></span>
<span class="linenos">2457</span><span class="w">          </span><span class="n">scat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t89</span><span class="w"></span>
<span class="linenos">2458</span><span class="w">          </span><span class="n">sc31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t31</span><span class="w"></span>
<span class="linenos">2459</span><span class="w">          </span><span class="n">sc50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t31</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t50</span><span class="w"></span>
<span class="linenos">2460</span><span class="w">          </span><span class="n">par</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">t50</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t53</span><span class="w"></span>
<span class="linenos">2461</span>
<span class="linenos">2462</span><span class="w">          </span><span class="c">! re-frozen snow</span>
<span class="linenos">2463</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t89</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">25</span><span class="mf">5.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">scat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">sc31</span><span class="p">)</span><span class="w"> </span><span class="n">scat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc31</span><span class="w"></span>
<span class="linenos">2464</span>
<span class="linenos">2465</span><span class="w">          </span><span class="c">! identify glacial ice</span>
<span class="linenos">2466</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">21</span><span class="mf">5.</span><span class="p">)</span><span class="w"> </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="linenos">2467</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scat</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">3.</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2468</span><span class="k">            </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2469</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">2470</span><span class="k">            </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2471</span><span class="w">          </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2472</span>
<span class="linenos">2473</span><span class="w">          </span><span class="c">! remove precipitation</span>
<span class="linenos">2474</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t23</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">26</span><span class="mf">2.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">tt</span><span class="p">)</span><span class="w"> </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2475</span><span class="w">          </span><span class="c">! remove deserts</span>
<span class="linenos">2476</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">df3</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.35</span><span class="p">)</span><span class="w"> </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2477</span>
<span class="linenos">2478</span><span class="w">          </span><span class="c">! high elevation deserts</span>
<span class="linenos">2479</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="mf">5.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">sc31</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">par</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">2.</span><span class="p">)</span><span class="w"> </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2480</span>
<span class="linenos">2481</span><span class="w">          </span><span class="c">! remove frozen ground</span>
<span class="linenos">2482</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">9.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">sc31</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">sc50</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.</span><span class="p">)</span><span class="w"> </span><span class="n">snow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">2483</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2484</span>
<span class="linenos">2485</span><span class="k">      end if</span>
<span class="linenos">2486</span>
<span class="linenos">2487</span><span class="k">    end if</span>
<span class="linenos">2488</span>
<span class="linenos">2489</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_DEBUG</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2490</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;GRODY: tb23, tb31, tb50, tb89, satZenithAngle, obsLat, landQualifierIndice = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2491</span><span class="w">                </span><span class="n">tb23</span><span class="p">,</span><span class="w"> </span><span class="n">tb31</span><span class="p">,</span><span class="w"> </span><span class="n">tb50</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos">2492</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;GRODY: ier, ice, tpw, cloudLiquidWaterPathObs, cloudLiquidWaterPathFG, rain, snow=&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2493</span><span class="w">                  </span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">ice</span><span class="p">,</span><span class="w"> </span><span class="n">tpw</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">rain</span><span class="p">,</span><span class="w"> </span><span class="n">snow</span><span class="w"></span>
<span class="linenos">2494</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">2495</span>
<span class="linenos">2496</span><span class="k">  end subroutine </span><span class="n">GRODY</span><span class="w"></span>
<span class="linenos">2497</span>
<span class="linenos">2498</span><span class="w">  </span><span class="c">!------------------------------------------------------------------------------------</span>
<span class="linenos">2499</span><span class="w">  </span><span class="c">! bennartz</span>
<span class="linenos">2500</span><span class="w">  </span><span class="c">!------------------------------------------------------------------------------------</span>
<span class="linenos">2501</span><span class="w">  </span><span class="k">subroutine </span><span class="n">bennartz</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb150</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="p">,</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2502</span><span class="w">                       </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2503</span><span class="w">                       </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2504</span><span class="w">                       </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2505</span>
<span class="linenos">2506</span><span class="w">    </span><span class="c">!:Purpose: Compute the following parameters using 2 AMSU-B channels:</span>
<span class="linenos">2507</span><span class="w">    </span><span class="c">!          - scattering index (over land and ocean).*</span>
<span class="linenos">2508</span><span class="w">    </span><span class="c">!          The two channels used are: 89Ghz, 150Ghz.</span>
<span class="linenos">2509</span><span class="w">    </span><span class="c">!          REGERENCES     Bennartz, R., A. Thoss, A. Dybbroe and D. B. Michelson, </span>
<span class="linenos">2510</span><span class="w">    </span><span class="c">!                         1999: Precipitation Analysis from AMSU, Nowcasting SAF, </span>
<span class="linenos">2511</span><span class="w">    </span><span class="c">!                         Swedish Meteorologicali and Hydrological Institute, </span>
<span class="linenos">2512</span><span class="w">    </span><span class="c">!                         Visiting Scientist Report, November 1999.</span>
<span class="linenos">2513</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">2514</span><span class="w">    </span><span class="c">! arguments: </span>
<span class="linenos">2515</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span><span class="w">                     </span><span class="c">! error return code:</span>
<span class="linenos">2516</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89</span><span class="w">                    </span><span class="c">! 89Ghz AMSU-B brightness temperature (K)</span>
<span class="linenos">2517</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb150</span><span class="w">                   </span><span class="c">! 150Ghz AMSU-B brightness temperature (K)</span>
<span class="linenos">2518</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89FG</span><span class="w">                  </span><span class="c">! 89Ghz AMSU-B brightness temperature from background (K)</span>
<span class="linenos">2519</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb150FG</span><span class="w">                 </span><span class="c">! 150Ghz AMSU-B brightness temperature from background (K)</span>
<span class="linenos">2520</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb89FgClear</span><span class="w">             </span><span class="c">! 89Ghz clear-sky brightness temperature from background (K)</span>
<span class="linenos">2521</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="w">            </span><span class="c">! 150Ghz clear-sky brightness temperature from background (K)</span>
<span class="linenos">2522</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">          </span><span class="c">!  satellite zenith angle (deg.)</span>
<span class="linenos">2523</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">     </span><span class="c">! land/sea indicator (0=land;1=ocean)</span>
<span class="linenos">2524</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="w">    </span><span class="c">! scattering index over land</span>
<span class="linenos">2525</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">   </span><span class="c">! scattering index over water from observation</span>
<span class="linenos">2526</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">    </span><span class="c">! scattering index over water from background</span>
<span class="linenos">2527</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="c">! obs cloud liquid water content (not computed for NOW)</span>
<span class="linenos">2528</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">  </span><span class="c">! first guess cloud liquid water content (not computed for NOW)</span>
<span class="linenos">2529</span>
<span class="linenos">2530</span><span class="w">    </span><span class="c">! Notes: In the case where an output parameter cannot be calculated, the</span>
<span class="linenos">2531</span><span class="w">    </span><span class="c">!        value of this parameter is to to the missing value, i.e. -99.</span>
<span class="linenos">2532</span>
<span class="linenos">2533</span><span class="w">    </span><span class="c">! 1) Initialise output parameters</span>
<span class="linenos">2534</span><span class="w">    </span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2535</span><span class="w">    </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2536</span><span class="w">    </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2537</span><span class="w">    </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2538</span><span class="w">    </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">2539</span>
<span class="linenos">2540</span><span class="w">    </span><span class="c">! 2) Validate input parameters</span>
<span class="linenos">2541</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tb89</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb89</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2542</span><span class="w">        </span><span class="n">tb150</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">tb150</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">35</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">2543</span><span class="w">        </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">2544</span><span class="w">        </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2545</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2546</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">2547</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">      </span>
<span class="linenos">2548</span><span class="w">      </span><span class="k">end if</span><span class="w"> </span>
<span class="linenos">2549</span>
<span class="linenos">2550</span><span class="w">    </span><span class="c">! 3) Compute parameters</span>
<span class="linenos">2551</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2552</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2553</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2554</span><span class="k">          </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tb89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb150</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">tb89FgClear</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2555</span><span class="w">          </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tb89FG</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb150FG</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">tb89FgClear</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb150FgClear</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2556</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">2557</span><span class="k">          </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tb89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb150</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="mf">9.2010</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.1104</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2558</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">2559</span><span class="k">        else</span>
<span class="linenos">2560</span><span class="k">        </span><span class="n">scatIndexOverLandObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tb89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tb150</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">0.158</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.0163</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2561</span><span class="w">      </span><span class="k">end if</span><span class="w"> </span><span class="c">! if (landQualifierIndice == 1)</span>
<span class="linenos">2562</span><span class="w">    </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos">2563</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;bennartz: input Parameters are not all valid: &#39;</span><span class="w"></span>
<span class="linenos">2564</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;bennartz: tb89, tb150, satZenithAngle, landQualifierIndice = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2565</span><span class="w">                  </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb150</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos">2566</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;bennartz: ier, scatIndexOverLandObs, scatIndexOverWaterObs, scatIndexOverWaterFG=&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2567</span><span class="w">                  </span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverLandObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w"></span>
<span class="linenos">2568</span><span class="w">    </span><span class="k">end if</span><span class="w"> </span><span class="c">! if (ier == 0)</span>
<span class="linenos">2569</span>
<span class="linenos">2570</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">bennartz</span><span class="w"></span>
<span class="linenos">2571</span>
<span class="linenos">2572</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2573</span><span class="w">  </span><span class="c">! atmsMwhs2Test1Flagbit7Check</span>
<span class="linenos">2574</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2575</span><span class="w">  </span><span class="k">subroutine </span><span class="n">atmsMwhs2Test1Flagbit7Check</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2576</span><span class="w">                                          </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w">  </span><span class="n">B7CHCK</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2577</span>
<span class="linenos">2578</span><span class="w">    </span><span class="c">!:Purpose:               1) test 1: Check flag bit 7 on from the first bgckAtms/bgckMwhs2 program</span>
<span class="linenos">2579</span><span class="w">    </span><span class="c">!                        Includes observations flagged for cloud liquid water, scattering index,</span>
<span class="linenos">2580</span><span class="w">    </span><span class="c">!                        dryness index plus failure of several QC checks.</span>
<span class="linenos">2581</span>
<span class="linenos">2582</span>
<span class="linenos">2583</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">2584</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itest</span><span class="p">(:)</span><span class="w">                      </span><span class="c">! test number</span>
<span class="linenos">2585</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">2586</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">2587</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! observations channels</span>
<span class="linenos">2588</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">2589</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2590</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">2591</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">2592</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">2593</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">IBIT</span><span class="w"> </span>
<span class="linenos">2594</span>
<span class="linenos">2595</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2596</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itest</span><span class="p">(</span><span class="n">testIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2597</span>
<span class="linenos">2598</span><span class="k">    do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2599</span><span class="w">      </span><span class="n">IBIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">AND</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2600</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">IBIT</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2601</span><span class="k">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2602</span><span class="w">        </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2603</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2604</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2605</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2606</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2607</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; first bgckAtms/bgckMwhs2 program REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2608</span><span class="w">                    </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2609</span><span class="w">                    </span><span class="s1">&#39; obsFlags= &#39;</span><span class="p">,</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2610</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2611</span><span class="k">      end if</span>
<span class="linenos">2612</span><span class="k">    end do</span>
<span class="linenos">2613</span>
<span class="linenos">2614</span><span class="k">  end subroutine </span><span class="n">atmsMwhs2Test1Flagbit7Check</span><span class="w"></span>
<span class="linenos">2615</span>
<span class="linenos">2616</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2617</span><span class="w">  </span><span class="c">! atmsMwhs2Test2TopographyCheck</span>
<span class="linenos">2618</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2619</span><span class="w">  </span><span class="k">subroutine </span><span class="n">atmsMwhs2Test2TopographyCheck</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2620</span><span class="w">                                           </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">ICHTOPO</span><span class="p">,</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2621</span>
<span class="linenos">2622</span><span class="w">    </span><span class="c">!:Purpose:               1) test 2: Topography check (partial)</span>
<span class="linenos">2623</span>
<span class="linenos">2624</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">2625</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itest</span><span class="p">(:)</span><span class="w">                      </span><span class="c">! test number</span>
<span class="linenos">2626</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">2627</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">2628</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">2629</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2630</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">            </span><span class="c">! topo aux point d&#39;obs</span>
<span class="linenos">2631</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">2632</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICHTOPO</span><span class="p">(:)</span><span class="w"> </span>
<span class="linenos">2633</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">2634</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">2635</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2636</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">2637</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXTOPO</span><span class="w"> </span>
<span class="linenos">2638</span>
<span class="linenos">2639</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="linenos">2640</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itest</span><span class="p">(</span><span class="n">testIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2641</span><span class="k">    do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2642</span><span class="w">      </span><span class="n">INDXTOPO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICHTOPO</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2643</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXTOPO</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2644</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">modelInterpTerrain</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">(</span><span class="n">INDXTOPO</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2645</span><span class="k">          </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2646</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2647</span><span class="w">          </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">18</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2648</span><span class="w">          </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2649</span><span class="w">                </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2650</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2651</span><span class="k">            </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2652</span><span class="w">                </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span>
<span class="linenos">2653</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">2654</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2655</span><span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; TOPOGRAPHY REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2656</span><span class="w">                      </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2657</span><span class="w">                      </span><span class="s1">&#39; TOPO= &#39;</span><span class="p">,</span><span class="n">modelInterpTerrain</span><span class="w"></span>
<span class="linenos">2658</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">2659</span><span class="k">        end if</span>
<span class="linenos">2660</span><span class="k">      end if</span>
<span class="linenos">2661</span><span class="k">    end do</span>
<span class="linenos">2662</span>
<span class="linenos">2663</span><span class="k">  end subroutine </span><span class="n">atmsMwhs2Test2TopographyCheck</span><span class="w"></span>
<span class="linenos">2664</span>
<span class="linenos">2665</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2666</span><span class="w">  </span><span class="c">! atmsMwhs2Test3UncorrectedTbCheck</span>
<span class="linenos">2667</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2668</span><span class="w">  </span><span class="k">subroutine </span><span class="n">atmsMwhs2Test3UncorrectedTbCheck</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2669</span><span class="w">                                              </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2670</span>
<span class="linenos">2671</span><span class="w">    </span><span class="c">!:Purpose:                       Test 3: Uncorrected Tb check (single)</span>
<span class="linenos">2672</span><span class="w">    </span><span class="c">!                                Uncorrected datum (flag bit #6 off). </span>
<span class="linenos">2673</span><span class="w">    </span><span class="c">!                                In this case switch bit 11 ON.</span>
<span class="linenos">2674</span>
<span class="linenos">2675</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">2676</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itest</span><span class="p">(:)</span><span class="w">                      </span><span class="c">! test number</span>
<span class="linenos">2677</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">2678</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">2679</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">2680</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2681</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                       </span><span class="c">! resetqc logical</span>
<span class="linenos">2682</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">2683</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">2684</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2685</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">2686</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">IBIT</span><span class="w"> </span>
<span class="linenos">2687</span>
<span class="linenos">2688</span><span class="w"> </span>
<span class="linenos">2689</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">RESETQC</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2690</span><span class="k">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="linenos">2691</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itest</span><span class="p">(</span><span class="n">testIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2692</span><span class="k">    do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2693</span><span class="w">      </span><span class="n">IBIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">AND</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2694</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IBIT</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2695</span><span class="k">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2696</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2697</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2698</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2699</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2700</span><span class="k">          </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2701</span><span class="w">              </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span>
<span class="linenos">2702</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2703</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2704</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39; UNCORRECTED TB REJECT.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2705</span><span class="w">                    </span><span class="s1">&#39;CHANNEL=&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2706</span><span class="w">                    </span><span class="s1">&#39; obsFlags= &#39;</span><span class="p">,</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2707</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2708</span><span class="k">      end if</span>
<span class="linenos">2709</span><span class="k">    end do</span>
<span class="linenos">2710</span>
<span class="linenos">2711</span><span class="k">  end subroutine </span><span class="n">atmsMwhs2Test3UncorrectedTbCheck</span><span class="w"></span>
<span class="linenos">2712</span>
<span class="linenos">2713</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2714</span><span class="w">  </span><span class="c">! atmsTest4RogueCheck</span>
<span class="linenos">2715</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2716</span><span class="w">  </span><span class="k">subroutine </span><span class="n">atmsTest4RogueCheck</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2717</span><span class="w">                                 </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2718</span><span class="w">                                 </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">,</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2719</span><span class="w">                                 </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2720</span>
<span class="linenos">2721</span><span class="w">    </span><span class="c">!:Purpose:                         test 4: &quot;Rogue check&quot; for (O-P) Tb residuals out of range.</span>
<span class="linenos">2722</span><span class="w">    </span><span class="c">!                                  (single/full).</span>
<span class="linenos">2723</span><span class="w">    </span><span class="c">!                                  Also, over WATER remove CH.17-22 if CH.17 |O-P|&gt;5K (partial) </span>
<span class="linenos">2724</span><span class="w">    </span><span class="c">!                                  Les observations, dont le residu (O-P) </span>
<span class="linenos">2725</span><span class="w">    </span><span class="c">!                                  depasse par un facteur (roguefac) l&#39;erreur totale des TOVS.</span>
<span class="linenos">2726</span><span class="w">    </span><span class="c">!                                  N.B.: a reject by any of the 3 amsua surface channels 1-3 produces the </span>
<span class="linenos">2727</span><span class="w">    </span><span class="c">!                                  rejection of ATMS sfc/tropospheric channels 1-6 and 16-17.</span>
<span class="linenos">2728</span><span class="w">    </span><span class="c">!                                  OVER OPEN WATER</span>
<span class="linenos">2729</span><span class="w">    </span><span class="c">!                                  ch. 17 Abs(O-P) &gt; 5K produces rejection of all ATMS amsub channels 17-22.</span>
<span class="linenos">2730</span>
<span class="linenos">2731</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">2732</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itest</span><span class="p">(:)</span><span class="w">                      </span><span class="c">! test number</span>
<span class="linenos">2733</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">2734</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">2735</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">2736</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2737</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w">                   </span><span class="c">! rogue factor </span>
<span class="linenos">2738</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w">                      </span><span class="c">! open water obs</span>
<span class="linenos">2739</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiance o-p </span>
<span class="linenos">2740</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">2741</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">2742</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">            </span><span class="c">! data flag newInformationFlag  </span>
<span class="linenos">2743</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">2744</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">2745</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">2746</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">2747</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2748</span>
<span class="linenos">2749</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">2750</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span>
<span class="linenos">2751</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="n">clwThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">clwThresh2</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh2</span><span class="w"></span>
<span class="linenos">2752</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="p">,</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"> </span>
<span class="linenos">2753</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">IBIT</span><span class="w"> </span>
<span class="linenos">2754</span>
<span class="linenos">2755</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="linenos">2756</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itest</span><span class="p">(</span><span class="n">testIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2757</span>
<span class="linenos">2758</span><span class="k">    </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2759</span><span class="w">    </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2760</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2761</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2762</span><span class="w">      </span><span class="c">! using state-dependent obs error only over water.</span>
<span class="linenos">2763</span><span class="w">      </span><span class="c">! obs over sea-ice will be rejected in test 15.</span>
<span class="linenos">2764</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">oer_useStateDepSigmaObs</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2765</span><span class="k">        </span><span class="n">clwThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2766</span><span class="w">        </span><span class="n">clwThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2767</span><span class="w">        </span><span class="n">errThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2768</span><span class="w">        </span><span class="n">errThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2769</span><span class="w">        </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2770</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2771</span><span class="w">            </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2772</span><span class="k">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="w"></span>
<span class="linenos">2773</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">2774</span><span class="k">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcStateDepObsErr_r4</span><span class="p">(</span><span class="n">clwThresh1</span><span class="p">,</span><span class="n">clwThresh2</span><span class="p">,</span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2775</span><span class="w">                                                    </span><span class="n">errThresh2</span><span class="p">,</span><span class="n">clwObsFGaveraged</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2776</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2777</span><span class="k">      else</span>
<span class="linenos">2778</span><span class="k">        </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_toverrst</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2779</span><span class="w">      </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2780</span><span class="w">      </span><span class="c">! For sigmaObsErrUsed=MPC_missingValue_R4 (cloudLiquidWaterPathObs[FG]=mwbg_realMissing</span>
<span class="linenos">2781</span><span class="w">      </span><span class="c">! in all-sky mode), the observation is flagged for rejection in </span>
<span class="linenos">2782</span><span class="w">      </span><span class="c">! mwbg_reviewAllCritforFinalFlagsAtms.</span>
<span class="linenos">2783</span><span class="w">      </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(</span><span class="n">channelval</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="w"></span>
<span class="linenos">2784</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2785</span><span class="w">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2786</span><span class="k">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2787</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2788</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2789</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2790</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2791</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2792</span><span class="k">          </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2793</span><span class="w">              </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span>
<span class="linenos">2794</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2795</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2796</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;ROGUE CHECK REJECT.NO.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2797</span><span class="w">                  </span><span class="s1">&#39; CHANNEL= &#39;</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2798</span><span class="w">                  </span><span class="s1">&#39; CHECK VALUE= &#39;</span><span class="p">,</span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2799</span><span class="w">                  </span><span class="s1">&#39; TBOMP= &#39;</span><span class="p">,</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2800</span><span class="w">                  </span><span class="s1">&#39; TOVERRST= &#39;</span><span class="p">,</span><span class="n">oer_toverrst</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2801</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2802</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2803</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">2804</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2805</span><span class="w">          </span><span class="nb">ABS</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5.0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2806</span><span class="k">        </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2807</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">2808</span><span class="k">    end do</span>
<span class="linenos">2809</span>
<span class="linenos">2810</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">SFCREJCT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2811</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2812</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ISFCREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2813</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">2814</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">testIndex</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2815</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2816</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2817</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2818</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2819</span><span class="w">                    </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2820</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2821</span><span class="k">              </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2822</span><span class="w">                  </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span>
<span class="linenos">2823</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos">2824</span><span class="k">          end if</span>
<span class="linenos">2825</span><span class="k">        end if</span>
<span class="linenos">2826</span><span class="k">      end do</span>
<span class="linenos">2827</span><span class="k">    end if</span><span class="w"></span>
<span class="linenos">2828</span>
<span class="linenos">2829</span><span class="w">    </span><span class="c">!  amsub channels 17-22 obs are rejected if, for ch17 ABS(O-P) &gt; 5K</span>
<span class="linenos">2830</span><span class="w">    </span><span class="c">!    Apply over open water only (bit 0 ON in QC integer newInformationFlag).</span>
<span class="linenos">2831</span><span class="w">    </span><span class="c">!    Only apply if obs not rejected in this test already.</span>
<span class="linenos">2832</span><span class="w">    </span><span class="n">IBIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">AND</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2833</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">IBIT</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2834</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2835</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2836</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">2837</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">testIndex</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2838</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2839</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2840</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2841</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2842</span><span class="w">                    </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2843</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2844</span><span class="k">              </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2845</span><span class="w">                  </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                 </span>
<span class="linenos">2846</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos">2847</span><span class="k">          end if</span>
<span class="linenos">2848</span><span class="k">        end if</span>
<span class="linenos">2849</span><span class="k">      end do</span>
<span class="linenos">2850</span><span class="k">    end if</span>
<span class="linenos">2851</span>
<span class="linenos">2852</span><span class="k">  end subroutine </span><span class="n">atmsTest4RogueCheck</span><span class="w"></span>
<span class="linenos">2853</span>
<span class="linenos">2854</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2855</span><span class="w">  </span><span class="c">! Mwhs2Test4RogueCheck</span>
<span class="linenos">2856</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2857</span><span class="w">  </span><span class="k">subroutine </span><span class="n">Mwhs2Test4RogueCheck</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2858</span><span class="w">                                  </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2859</span><span class="w">                                  </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2860</span>
<span class="linenos">2861</span><span class="w">    </span><span class="c">!:Purpose:                         test 4: &quot;Rogue check&quot; for (O-P) Tb residuals out of range.</span>
<span class="linenos">2862</span><span class="w">    </span><span class="c">!                                  (single/full).</span>
<span class="linenos">2863</span><span class="w">    </span><span class="c">!                                  Also, over WATER remove CH.10-15 if CH.10 |O-P|&gt;5K (full)</span>
<span class="linenos">2864</span><span class="w">    </span><span class="c">!                                  Les observations, dont le residu (O-P)</span>
<span class="linenos">2865</span><span class="w">    </span><span class="c">!                                  depasse par un facteur (roguefac) l&#39;erreur totale des TOVS.</span>
<span class="linenos">2866</span><span class="w">    </span><span class="c">!                                  OVER OPEN WATER</span>
<span class="linenos">2867</span><span class="w">    </span><span class="c">!                                  ch. 10 Abs(O-P) &gt; 5K produces rejection of all ATMS amsub channels 10-15.</span>
<span class="linenos">2868</span>
<span class="linenos">2869</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">2870</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itest</span><span class="p">(:)</span><span class="w">                      </span><span class="c">! test number</span>
<span class="linenos">2871</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations</span>
<span class="linenos">2872</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">2873</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice)</span>
<span class="linenos">2874</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2875</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w">                   </span><span class="c">! rogue factor</span>
<span class="linenos">2876</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w">                      </span><span class="c">! open water obs</span>
<span class="linenos">2877</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">       </span><span class="c">! radiance o-p</span>
<span class="linenos">2878</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">2879</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">2880</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">            </span><span class="c">! data flag newInformationFlag</span>
<span class="linenos">2881</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">2882</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance</span>
<span class="linenos">2883</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">2884</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2885</span>
<span class="linenos">2886</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">2887</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"></span>
<span class="linenos">2888</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="n">clwThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">clwThresh2</span><span class="p">,</span><span class="w"> </span><span class="n">sigmaThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">sigmaThresh2</span><span class="w"></span>
<span class="linenos">2889</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="p">,</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"></span>
<span class="linenos">2890</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="p">,</span><span class="w"> </span><span class="n">IBIT</span><span class="w"></span>
<span class="linenos">2891</span>
<span class="linenos">2892</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="linenos">2893</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itest</span><span class="p">(</span><span class="n">testIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2894</span>
<span class="linenos">2895</span><span class="k">    </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2896</span><span class="w">    </span><span class="k">do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2897</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2898</span><span class="w">      </span><span class="c">! using state-dependent obs error only over water.</span>
<span class="linenos">2899</span><span class="w">      </span><span class="c">! obs over sea-ice will be rejected in test 15.</span>
<span class="linenos">2900</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">oer_useStateDepSigmaObs</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2901</span><span class="k">        </span><span class="n">clwThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2902</span><span class="w">        </span><span class="n">clwThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_cldPredThresh</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2903</span><span class="w">        </span><span class="n">sigmaThresh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2904</span><span class="w">        </span><span class="n">sigmaThresh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_errThreshAllsky</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2905</span><span class="w">        </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2906</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2907</span><span class="k">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="w"></span>
<span class="linenos">2908</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">2909</span><span class="k">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcStateDepObsErr_r4</span><span class="p">(</span><span class="n">clwThresh1</span><span class="p">,</span><span class="n">clwThresh2</span><span class="p">,</span><span class="n">sigmaThresh1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2910</span><span class="w">                                                    </span><span class="n">sigmaThresh2</span><span class="p">,</span><span class="n">clwObsFGaveraged</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2911</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2912</span><span class="k">      else</span>
<span class="linenos">2913</span><span class="k">        </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oer_toverrst</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2914</span><span class="w">      </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">2915</span><span class="w">      </span><span class="c">! For sigmaObsErrUsed=MPC_missingValue_R4 (cloudLiquidWaterPathObs=mwbg_realMissing</span>
<span class="linenos">2916</span><span class="w">      </span><span class="c">! in all-sky mode), the observation is flagged for rejection in</span>
<span class="linenos">2917</span><span class="w">      </span><span class="c">! mwbg_reviewAllCritforFinalFlagsMwhs2.</span>
<span class="linenos">2918</span><span class="w">      </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(</span><span class="n">channelval</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="w"></span>
<span class="linenos">2919</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">XCHECKVAL</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2920</span><span class="w">          </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2921</span><span class="k">        </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2922</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2923</span><span class="w">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2924</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2925</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2926</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2927</span><span class="k">          </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2928</span><span class="w">              </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2929</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2930</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2931</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;ROGUE CHECK REJECT.NO.&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2932</span><span class="w">                  </span><span class="s1">&#39; CHANNEL= &#39;</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2933</span><span class="w">                  </span><span class="s1">&#39; CHECK VALUE= &#39;</span><span class="p">,</span><span class="n">XCHECKVAL</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2934</span><span class="w">                  </span><span class="s1">&#39; TBOMP= &#39;</span><span class="p">,</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2935</span><span class="w">                  </span><span class="s1">&#39; TOVERRST= &#39;</span><span class="p">,</span><span class="n">oer_toverrst</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2936</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">2937</span><span class="k">      end if</span>
<span class="linenos">2938</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">channelval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2939</span><span class="w">          </span><span class="nb">ABS</span><span class="p">(</span><span class="n">ompTb</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2940</span><span class="k">        </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">2941</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">2942</span><span class="k">    end do</span><span class="w"></span>
<span class="linenos">2943</span>
<span class="linenos">2944</span><span class="w">    </span><span class="c">!    Channels 10-15 are rejected if, for ch10 ABS(O-P) &gt; 5K</span>
<span class="linenos">2945</span><span class="w">    </span><span class="c">!    Apply over open water only (bit 0 ON in QC integer newInformationFlag).</span>
<span class="linenos">2946</span><span class="w">    </span><span class="c">!    Only apply if obs not rejected in this test already.</span>
<span class="linenos">2947</span><span class="w">    </span><span class="n">IBIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">AND</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2948</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CH2OMPREJCT</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">IBIT</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2949</span><span class="k">      do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2950</span><span class="w">        </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2951</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">2952</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">testIndex</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2953</span><span class="k">            </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">testIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2954</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2955</span><span class="w">            </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2956</span><span class="w">            </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2957</span><span class="w">                    </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2958</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2959</span><span class="k">              </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2960</span><span class="w">                  </span><span class="n">rejectionCodArray2</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2961</span><span class="w">            </span><span class="k">end if</span>
<span class="linenos">2962</span><span class="k">          end if</span>
<span class="linenos">2963</span><span class="k">        end if</span>
<span class="linenos">2964</span><span class="k">      end do</span>
<span class="linenos">2965</span><span class="k">    end if</span>
<span class="linenos">2966</span>
<span class="linenos">2967</span><span class="k">  end subroutine </span><span class="n">Mwhs2Test4RogueCheck</span><span class="w"></span>
<span class="linenos">2968</span>
<span class="linenos">2969</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2970</span><span class="w">  </span><span class="c">! atmsMwhs2Test5ChannelSelectionUsingTovutil</span>
<span class="linenos">2971</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">2972</span><span class="w">  </span><span class="k">subroutine </span><span class="n">atmsMwhs2Test5ChannelSelectionUsingTovutil</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2973</span><span class="w">                                                        </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2974</span>
<span class="linenos">2975</span><span class="w">    </span><span class="c">!:Purpose: test 5: Channel selection using array oer_tovutil(chan,sat)</span>
<span class="linenos">2976</span><span class="w">    </span><span class="c">!          oer_tovutil = 0 (blacklisted), 1 (assmilate)</span>
<span class="linenos">2977</span>
<span class="linenos">2978</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">2979</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">itest</span><span class="p">(:)</span><span class="w">                      </span><span class="c">! test number</span>
<span class="linenos">2980</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">              </span><span class="c">! nombre de canaux des observations </span>
<span class="linenos">2981</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! observations channels</span>
<span class="linenos">2982</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">                   </span><span class="c">! numero de satellite (i.e. indice) </span>
<span class="linenos">2983</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                         </span><span class="c">! identificateur du satellite</span>
<span class="linenos">2984</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"> </span><span class="c">! indicateur du QC par canal</span>
<span class="linenos">2985</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w">    </span><span class="c">! marqueur de radiance </span>
<span class="linenos">2986</span>
<span class="linenos">2987</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">2988</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channelval</span><span class="p">,</span><span class="w"> </span><span class="n">nChannelIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testIndex</span><span class="w"></span>
<span class="linenos">2989</span>
<span class="linenos">2990</span><span class="w">    </span><span class="n">testIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="linenos">2991</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itest</span><span class="p">(</span><span class="n">testIndex</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">2992</span><span class="k">    do </span><span class="n">nChannelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">2993</span><span class="w">      </span><span class="n">channelval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2994</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">oer_tovutil</span><span class="p">(</span><span class="n">channelval</span><span class="p">,</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2995</span><span class="k">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">OR</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2996</span><span class="w">        </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">2997</span><span class="w">              </span><span class="n">rejectionCodArray</span><span class="p">(</span><span class="n">testIndex</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">2998</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">2999</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">stnId</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;CHANNEL REJECT: &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3000</span><span class="w">                </span><span class="s1">&#39; CHANNEL= &#39;</span><span class="p">,</span><span class="n">channelval</span><span class="w">                  </span>
<span class="linenos">3001</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">3002</span><span class="k">      end if</span>
<span class="linenos">3003</span><span class="k">    end do</span>
<span class="linenos">3004</span>
<span class="linenos">3005</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3006</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;qcIndicator = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">nChannelIndex</span><span class="p">),</span><span class="n">nChannelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3007</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">3008</span>
<span class="linenos">3009</span><span class="k">  end subroutine </span><span class="n">atmsMwhs2Test5ChannelSelectionUsingTovutil</span><span class="w"></span>
<span class="linenos">3010</span>
<span class="linenos">3011</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3012</span><span class="w">  </span><span class="c">! mwbg_tovCheckAtms </span>
<span class="linenos">3013</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3014</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_tovCheckAtms</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3015</span><span class="w">                               </span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3016</span><span class="w">                               </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3017</span><span class="w">                               </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3018</span><span class="w">                               </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3019</span><span class="w">                               </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3020</span><span class="w">                               </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3021</span>
<span class="linenos">3022</span><span class="w">    </span><span class="c">!:Purpose:                   Effectuer le controle de qualite des radiances tovs.</span>
<span class="linenos">3023</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3024</span>
<span class="linenos">3025</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">3026</span><span class="w">    </span><span class="c">!Arguments</span>
<span class="linenos">3027</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">        </span><span class="c">! nombre de canaux des observations</span>
<span class="linenos">3028</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">3029</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">3030</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos">3031</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos">3032</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos">3033</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3034</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3035</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"></span>
<span class="linenos">3036</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">         </span><span class="c">! position sur le &quot;scan&quot;</span>
<span class="linenos">3037</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w">          </span><span class="c">! canaux des observations</span>
<span class="linenos">3038</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">             </span><span class="c">! numero de satellite (i.e. indice)</span>
<span class="linenos">3039</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! radiances</span>
<span class="linenos">3040</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w">        </span><span class="c">! correction aux radiances</span>
<span class="linenos">3041</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! residus (o-p)</span>
<span class="linenos">3042</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">      </span><span class="c">! topographie du modele</span>
<span class="linenos">3043</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">      </span><span class="c">! flag to identify all obs pts in report</span>
<span class="linenos">3044</span><span class="w">                                                            </span><span class="c">!  as being over land/ice, cloudy, bad IWV</span>
<span class="linenos">3045</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                   </span><span class="c">! identificateur du satellite</span>
<span class="linenos">3046</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                 </span><span class="c">! reset du controle de qualite?</span>
<span class="linenos">3047</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w">     </span><span class="c">! indicateur controle de qualite tovs par canal </span>
<span class="linenos">3048</span><span class="w">                                                            </span><span class="c">!  =0 ok, &gt;0 rejet,</span>
<span class="linenos">3049</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">             </span><span class="c">! marqueurs des radiances</span>
<span class="linenos">3050</span><span class="w">                                                            </span><span class="c">!  satellite, critere et par canal</span>
<span class="linenos">3051</span><span class="w">                                                            </span><span class="c">!  (chech n2) par satellite, critere et par canal</span>
<span class="linenos">3052</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">3053</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">3054</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">   </span><span class="c">! scattering index over water from observation</span>
<span class="linenos">3055</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">    </span><span class="c">! scattering index over water from background</span>
<span class="linenos">3056</span>
<span class="linenos">3057</span><span class="w">    </span><span class="c">!locals</span>
<span class="linenos">3058</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">96</span><span class="w"></span>
<span class="linenos">3059</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="c">! OPTION for values of MG (land/sea mask) and LG (ice) </span>
<span class="linenos">3060</span><span class="w">                                         </span><span class="c">!  at each observation point using values on 5x5 mesh </span>
<span class="linenos">3061</span><span class="w">                                         </span><span class="c">!  centered at each point.</span>
<span class="linenos">3062</span><span class="w">                                         </span><span class="c">!  ilsmOpt = 1 --&gt; use MAX value from all 25 mesh points</span>
<span class="linenos">3063</span><span class="w">                                         </span><span class="c">!  ilsmOpt = 2 --&gt; use value at central mesh point (obs location)</span>
<span class="linenos">3064</span><span class="w">                                         </span><span class="c">!  ilsmOpt = 3 --&gt; use AVG value from all 25 mesh points</span>
<span class="linenos">3065</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w"></span>
<span class="linenos">3066</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iRej</span><span class="p">,</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">JI</span><span class="w"></span>
<span class="linenos">3067</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3068</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ITEST</span><span class="p">(</span><span class="n">mwbg_maxNumTest</span><span class="p">),</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">ICHTOPO</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3069</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="w"></span>
<span class="linenos">3070</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudobs</span><span class="p">,</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">precipobs</span><span class="w"></span>
<span class="linenos">3071</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdi</span><span class="p">,</span><span class="w"> </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3072</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3073</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3074</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3075</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"></span>
<span class="linenos">3076</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">drycnt</span><span class="w">                 </span><span class="c">! Number of pts flagged for AMSU-B Dryness Index</span>
<span class="linenos">3077</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landcnt</span><span class="w">                </span><span class="c">! Number of obs pts found over land/ice</span>
<span class="linenos">3078</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rejcnt</span><span class="w">                 </span><span class="c">! Number of problem obs pts (Tb err, QCfail)</span>
<span class="linenos">3079</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w">                 </span><span class="c">! Number of pts with Mean 183 Ghz Tb &lt; 240K</span>
<span class="linenos">3080</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w">                 </span><span class="c">! Number of scatter/precip obs</span>
<span class="linenos">3081</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldcnt</span><span class="w">                 </span><span class="c">! Number of water point covered by cloud</span>
<span class="linenos">3082</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">flgcnt</span><span class="w">                 </span><span class="c">! Total number of filtered obs pts</span>
<span class="linenos">3083</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">seaIcePointNum</span><span class="w">         </span><span class="c">! Number of waterobs points converted to sea ice points</span>
<span class="linenos">3084</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clwMissingPointNum</span><span class="w">     </span><span class="c">! Number of points where cloudLiquidWaterPath/SI missing</span>
<span class="linenos">3085</span><span class="w">                                            </span><span class="c">!   over water due bad data</span>
<span class="linenos">3086</span>
<span class="linenos">3087</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3088</span><span class="w">    </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3089</span><span class="w">                    </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3090</span><span class="w">                    </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3091</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="w"></span>
<span class="linenos">3092</span>
<span class="linenos">3093</span><span class="w">    </span><span class="c">! Channel sets for rejection in test 9 </span>
<span class="linenos">3094</span><span class="w">    </span><span class="c">! These LT channels are rejected if O-P fails rogue check for window ch. 1, 2, or 3</span>
<span class="linenos">3095</span><span class="w">    </span><span class="n">ISFCREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3096</span><span class="w">    </span><span class="c">!   These AMSU-B channels are rejected if ch. 17 O-P fails rogue check over OPEN WATER only    </span>
<span class="linenos">3097</span><span class="w">    </span><span class="n">ICH2OMPREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3098</span>
<span class="linenos">3099</span><span class="w">    </span><span class="c">!  Data for TOPOGRAPHY CHECK</span>
<span class="linenos">3100</span><span class="w">    </span><span class="c">!   Channel AMSUA-6 (atms ch 7) is rejected for topography  &gt;  250m.</span>
<span class="linenos">3101</span><span class="w">    </span><span class="c">!   Channel AMSUA-7 (atms ch 8) is rejected for topography  &gt; 2000m.</span>
<span class="linenos">3102</span><span class="w">    </span><span class="c">!   Channel AMSUB-3 (atms ch 22) is rejected for topography &gt; 2500m.</span>
<span class="linenos">3103</span><span class="w">    </span><span class="c">!                    atms ch 21  is rejected for topography &gt; 2250m.</span>
<span class="linenos">3104</span><span class="w">    </span><span class="c">!   Channel AMSUB-4 (atms ch 20) is rejected for topography &gt; 2000m.</span>
<span class="linenos">3105</span><span class="w">    </span><span class="n">ICHTOPO</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3106</span><span class="w">    </span><span class="n">ZCRIT</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">25</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">225</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">250</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3107</span>
<span class="linenos">3108</span><span class="w">    </span><span class="c">!  Test selection (0=skip test, 1=do test)</span>
<span class="linenos">3109</span><span class="w">    </span><span class="c">!              1  2  3  4  5</span>
<span class="linenos">3110</span><span class="w">    </span><span class="n">ITEST</span><span class="p">(:)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3111</span><span class="w">    </span><span class="n">ITEST</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3112</span>
<span class="linenos">3113</span><span class="w">    </span><span class="c">! Channels excluded from gen_bias_corr in all-sky mode</span>
<span class="linenos">3114</span><span class="w">    </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3115</span>
<span class="linenos">3116</span><span class="w">    </span><span class="c">! Initialisation, la premiere fois seulement!</span>
<span class="linenos">3117</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LLFIRST</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3118</span><span class="k">      </span><span class="n">numReportWithMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3119</span><span class="w">      </span><span class="n">flgcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3120</span><span class="w">      </span><span class="n">landcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3121</span><span class="w">      </span><span class="n">rejcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3122</span><span class="w">      </span><span class="n">cldcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3123</span><span class="w">      </span><span class="n">iwvcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3124</span><span class="w">      </span><span class="n">pcpcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3125</span><span class="w">      </span><span class="n">drycnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3126</span><span class="w">      </span><span class="n">seaIcePointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3127</span><span class="w">      </span><span class="n">clwMissingPointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3128</span><span class="w">      </span><span class="n">rejectionCodArray</span><span class="p">(:,:,:)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3129</span><span class="w">      </span><span class="n">rejectionCodArray2</span><span class="p">(:,:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3130</span><span class="w">      </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3131</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">3132</span>
<span class="linenos">3133</span><span class="w">    </span><span class="c">! PART 1 TESTS:</span>
<span class="linenos">3134</span>
<span class="linenos">3135</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3136</span><span class="w">    </span><span class="c">! STEP 1 ) Determine which obs pts are over open water (i.e NOT near coasts or</span>
<span class="linenos">3137</span><span class="w">    </span><span class="c">!          over/near land/ice) using model MG and LG fields from glbhyb2 ANAL</span>
<span class="linenos">3138</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3139</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2landIceMask</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3140</span><span class="w">                              </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3141</span>
<span class="linenos">3142</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3143</span><span class="w">    </span><span class="c">! STEP 2 ) Check for values of TB that are missing or outside physical limits.</span>
<span class="linenos">3144</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3145</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_grossValueCheck</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">38</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3146</span>
<span class="linenos">3147</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3148</span><span class="w">    </span><span class="c">! STEP 3 ) Preliminary QC checks --&gt; set qcRejectLogic(actualNumChannel)=.true.</span>
<span class="linenos">3149</span><span class="w">    </span><span class="c">!          for data that fail QC</span>
<span class="linenos">3150</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3151</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_firstQcCheckAtms</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3152</span><span class="w">                               </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3153</span><span class="w">                               </span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3154</span>
<span class="linenos">3155</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">3156</span><span class="w">    </span><span class="c">!  Exclude problem points from further calculations</span>
<span class="linenos">3157</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">COUNT</span><span class="p">(</span><span class="n">qcRejectLogic</span><span class="p">(:))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3158</span>
<span class="linenos">3159</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3160</span><span class="w">    </span><span class="c">! STEP 4 ) mwbg_nrlFilterAtms returns cloudLiquidWaterPathObs, cloudLiquidWaterPathFG, scatec, scatbg and also does sea-ice</span>
<span class="linenos">3161</span><span class="w">    </span><span class="c">!          detection missing value for  cloudLiquidWaterPathObs, scatec, scatbg  is -99.0 (e.g. over</span>
<span class="linenos">3162</span><span class="w">    </span><span class="c">!          land or sea-ice).Sets calcTerrainTypeIndice=0 (sea ice) for points where retrieved SeaIce</span>
<span class="linenos">3163</span><span class="w">    </span><span class="c">!          &gt;=0.55. Does nothing if calcTerrainTypeIndice=0 (sea ice) and retrieved SeaIce&lt;0.55.</span>
<span class="linenos">3164</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3165</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_nrlFilterAtms</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3166</span><span class="w">                            </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3167</span><span class="w">                            </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3168</span><span class="w">                            </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">iRej</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3169</span>
<span class="linenos">3170</span><span class="w">    </span><span class="n">seaIcePointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seaIcePointNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="w"></span>
<span class="linenos">3171</span><span class="w">    </span><span class="n">clwMissingPointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clwMissingPointNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">iRej</span><span class="w"></span>
<span class="linenos">3172</span>
<span class="linenos">3173</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3174</span><span class="w">    </span><span class="c">! STEP 5 ) Apply NRL cloud filter, scattering index and sea-ice detection algorithms</span>
<span class="linenos">3175</span><span class="w">    </span><span class="c">!          to OPEN WATER (waterobs=true) points.</span>
<span class="linenos">3176</span><span class="w">    </span><span class="c">! Points with SeaIce&gt;0.55 are set to sea-ice points (waterobs --&gt; false)</span>
<span class="linenos">3177</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3178</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_flagDataUsingNrlCritAtms</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3179</span><span class="w">                                       </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3180</span><span class="w">                                       </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">cloudobs</span><span class="p">,</span><span class="w"> </span><span class="n">precipobs</span><span class="p">,</span><span class="w"> </span><span class="n">cldcnt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3181</span>
<span class="linenos">3182</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3183</span><span class="w">    </span><span class="c">! STEP 6 ) ! Review all the checks previously made to determine which obs are to be</span>
<span class="linenos">3184</span><span class="w">    </span><span class="c">!            accepted for assimilation and which are to be flagged for exclusion</span>
<span class="linenos">3185</span><span class="w">    </span><span class="c">!            (obsFlags).</span>
<span class="linenos">3186</span><span class="w">    </span><span class="c">!            grossrej()  = .true. if any channel had a gross error at the point</span>
<span class="linenos">3187</span><span class="w">    </span><span class="c">!            cloudobs()  = .true. if CLW &gt; clw_atms_nrl_LTrej (0.175) or precipobs</span>
<span class="linenos">3188</span><span class="w">    </span><span class="c">!            precipobs() = .true. if precip. detected through NRL scattering indices</span>
<span class="linenos">3189</span><span class="w">    </span><span class="c">!            waterobs()  = .true. if open water point</span>
<span class="linenos">3190</span><span class="w">    </span><span class="c">!            iwvreject() = .true. if Mean 183 Ghz [ch. 18-22] Tb &lt; 240K (too dry</span>
<span class="linenos">3191</span><span class="w">    </span><span class="c">!            for ch.20-22 over land)</span>
<span class="linenos">3192</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3193</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_reviewAllCritforFinalFlagsAtms</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3194</span><span class="w">                                             </span><span class="n">precipobs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3195</span><span class="w">                                             </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3196</span><span class="w">                                             </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">drycnt</span><span class="p">,</span><span class="w"> </span><span class="n">landcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3197</span><span class="w">                                             </span><span class="n">rejcnt</span><span class="p">,</span><span class="w"> </span><span class="n">iwvcnt</span><span class="p">,</span><span class="w"> </span><span class="n">pcpcnt</span><span class="p">,</span><span class="w"> </span><span class="n">flgcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3198</span><span class="w">                                             </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3199</span>
<span class="linenos">3200</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3201</span><span class="w">    </span><span class="c">! PART 2 TESTS:</span>
<span class="linenos">3202</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3203</span>
<span class="linenos">3204</span><span class="w">    </span><span class="c">! allocations</span>
<span class="linenos">3205</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3206</span><span class="w">    </span><span class="c">!  Initialisations</span>
<span class="linenos">3207</span><span class="w">    </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3208</span><span class="w">    </span><span class="n">B7CHCK</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3209</span>
<span class="linenos">3210</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">RESETQC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3211</span>
<span class="linenos">3212</span><span class="w">    </span><span class="c">! 1) test 1: Check flag bit 7 on from the first bgckAtms program</span>
<span class="linenos">3213</span><span class="w">    </span><span class="c">!  Includes observations flagged for cloud liquid water, scattering index,</span>
<span class="linenos">3214</span><span class="w">    </span><span class="c">!  dryness index plus failure of several QC checks.</span>
<span class="linenos">3215</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test1Flagbit7Check</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3216</span><span class="w">                                      </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3217</span>
<span class="linenos">3218</span><span class="w">    </span><span class="c">! 2) test 2: Topography check (partial)</span>
<span class="linenos">3219</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test2TopographyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3220</span><span class="w">                                        </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">ICHTOPO</span><span class="p">,</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3221</span>
<span class="linenos">3222</span><span class="w">    </span><span class="c">! 3) test 3: Uncorrected Tb check (single)</span>
<span class="linenos">3223</span><span class="w">    </span><span class="c">!  Uncorrected datum (flag bit #6 off). In this case switch bit 11 ON.</span>
<span class="linenos">3224</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test3UncorrectedTbCheck</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3225</span><span class="w">                                           </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3226</span>
<span class="linenos">3227</span><span class="w">    </span><span class="c">! 4) test 4: &quot;Rogue check&quot; for (O-P) Tb residuals out of range. (single/full)</span>
<span class="linenos">3228</span><span class="w">    </span><span class="c">!             Also, over WATER remove CH.17-22 if CH.17 |O-P|&gt;5K (partial)</span>
<span class="linenos">3229</span><span class="w">    </span><span class="c">!  Les observations, dont le residu (O-P) depasse par un facteur (roguefac)</span>
<span class="linenos">3230</span><span class="w">    </span><span class="c">!   l&#39;erreur totale des TOVS.</span>
<span class="linenos">3231</span><span class="w">    </span><span class="c">!  N.B.: a reject by any of the 3 amsua surface channels 1-3 produces the</span>
<span class="linenos">3232</span><span class="w">    </span><span class="c">!           rejection of ATMS sfc/tropospheric channels 1-6 and 16-17.</span>
<span class="linenos">3233</span><span class="w">    </span><span class="c">!  OVER OPEN WATER</span>
<span class="linenos">3234</span><span class="w">    </span><span class="c">!    ch. 17 Abs(O-P) &gt; 5K produces rejection of all ATMS amsub channels 17-22.</span>
<span class="linenos">3235</span><span class="w">    </span><span class="k">call </span><span class="n">atmsTest4RogueCheck</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3236</span><span class="w">                              </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3237</span><span class="w">                              </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">ISFCREJ</span><span class="p">,</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3238</span><span class="w">                              </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3239</span>
<span class="linenos">3240</span><span class="w">    </span><span class="c">! 5) test 5: Channel selection using array oer_tovutil(chan,sat)</span>
<span class="linenos">3241</span><span class="w">    </span><span class="c">!  oer_tovutil = 0 (blacklisted)</span>
<span class="linenos">3242</span><span class="w">    </span><span class="c">!                1 (assmilate)</span>
<span class="linenos">3243</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test5ChannelSelectionUsingTovutil</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3244</span><span class="w">                                                    </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3245</span>
<span class="linenos">3246</span><span class="w">    </span><span class="c">!  Synthese de la controle de qualite au niveau de chaque point</span>
<span class="linenos">3247</span><span class="w">    </span><span class="c">!  d&#39;observation. Code:</span>
<span class="linenos">3248</span><span class="w">    </span><span class="c">!            =0 aucun rejet, &gt;0 au moins un canal rejete.</span>
<span class="linenos">3249</span><span class="w">    </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3250</span><span class="w">    </span><span class="k">do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">3251</span><span class="w">      </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">KCHKPRF</span><span class="p">,</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">JI</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3252</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">3253</span>
<span class="linenos">3254</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;KCHKPRF = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w"></span>
<span class="linenos">3255</span>
<span class="linenos">3256</span><span class="w">    </span><span class="c">! reset global marker flag (55200) and mark it if observtions are rejected</span>
<span class="linenos">3257</span><span class="w">    </span><span class="k">call </span><span class="n">resetQcCases</span><span class="p">(</span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3258</span>
<span class="linenos">3259</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3260</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3261</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of BURP file reports where Tb set to mwbg_realMissing  = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"></span>
<span class="linenos">3262</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3263</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 1. Number of obs pts found over land/ice           = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">landcnt</span><span class="w"></span>
<span class="linenos">3264</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 2. Number of problem obs pts (Tb err, QCfail)      = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">rejcnt</span><span class="w"></span>
<span class="linenos">3265</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 3. Number of cloudy obs  (CLW &gt; clw_min)           = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cldcnt</span><span class="w"></span>
<span class="linenos">3266</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 4. Number of scatter/precip obs                    = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w"></span>
<span class="linenos">3267</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 5. Number of pts with Mean 183 Ghz Tb &lt; 240K       = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w"></span>
<span class="linenos">3268</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 6. Number of pts flagged for AMSU-B Dryness Index  = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">drycnt</span><span class="w"></span>
<span class="linenos">3269</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3270</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Total number of filtered obs pts                   = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"></span>
<span class="linenos">3271</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ----------------------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">3272</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3273</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of waterobs points converted to sea ice points         = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">seaIcePointNum</span><span class="w"></span>
<span class="linenos">3274</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of points where CLW/SI missing over water due bad data = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">clwMissingPointNum</span><span class="w"></span>
<span class="linenos">3275</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3276</span>
<span class="linenos">3277</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   Meaning of newInformationFlag flag bits: &#39;</span><span class="w"></span>
<span class="linenos">3278</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3279</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;      BIT    Meaning&#39;</span><span class="w"></span>
<span class="linenos">3280</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       0     off=land or sea-ice, on=open water away from coast&#39;</span><span class="w"></span>
<span class="linenos">3281</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       1     Mean 183 Ghz [ch. 18-22] is missing&#39;</span><span class="w"></span>
<span class="linenos">3282</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       2     NRL CLW is missing (over water)&#39;</span><span class="w"></span>
<span class="linenos">3283</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       3     NRL &gt; clw_atms_nrl_LTrej (0.175 kg/m2) (cloudobs)&#39;</span><span class="w"></span>
<span class="linenos">3284</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       4     scatec/scatbg &gt; Lower Troposphere limit 9/10 (precipobs)&#39;</span><span class="w"></span>
<span class="linenos">3285</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       5     Mean 183 Ghz [ch. 18-22] Tb &lt; 240K&#39;</span><span class="w"></span>
<span class="linenos">3286</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       6     CLW &gt; clw_atms_nrl_UTrej (0.200 kg/m2)&#39;</span><span class="w"></span>
<span class="linenos">3287</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       7     Dryness Index rejection (for ch. 22)&#39;</span><span class="w"></span>
<span class="linenos">3288</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       8     scatec/scatbg &gt; Upper Troposphere limit 18/15&#39;</span><span class="w"></span>
<span class="linenos">3289</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       9     Dryness Index rejection (for ch. 21)&#39;</span><span class="w"></span>
<span class="linenos">3290</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;      10     Sea ice &gt; 0.55 detected&#39;</span><span class="w"></span>
<span class="linenos">3291</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;      11     Gross error in Tb (any chan.) or other QC problem (all channels rejected)&#39;</span><span class="w"></span>
<span class="linenos">3292</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3293</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   New Element 13209 in BURP file = CLW (kg/m2)&#39;</span><span class="w"></span>
<span class="linenos">3294</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   New Element 13208 in BURP file = ECMWF Scattering Index&#39;</span><span class="w"></span>
<span class="linenos">3295</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   New Element 25174 in BURP file = newInformationFlag flag&#39;</span><span class="w"></span>
<span class="linenos">3296</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3297</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">3298</span>
<span class="linenos">3299</span><span class="k">  end subroutine </span><span class="n">mwbg_tovCheckAtms</span><span class="w"></span>
<span class="linenos">3300</span>
<span class="linenos">3301</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3302</span><span class="w">  </span><span class="c">! mwbg_tovCheckMwhs2</span>
<span class="linenos">3303</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3304</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_tovCheckMwhs2</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3305</span><span class="w">                                </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3306</span><span class="w">                                </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3307</span><span class="w">                                </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3308</span><span class="w">                                </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3309</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3310</span><span class="w">                                </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3311</span><span class="w">                                </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">modLSQ</span><span class="p">,</span><span class="w"> </span><span class="n">lastHeader</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3312</span>
<span class="linenos">3313</span><span class="w">    </span><span class="c">!:Purpose:                   Effectuer le controle de qualite des radiances tovs.</span>
<span class="linenos">3314</span>
<span class="linenos">3315</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">3316</span><span class="w">    </span><span class="c">!Arguments</span>
<span class="linenos">3317</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">        </span><span class="c">! nombre de canaux des observations</span>
<span class="linenos">3318</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">3319</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">3320</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos">3321</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos">3322</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos">3323</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"></span>
<span class="linenos">3324</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">         </span><span class="c">! position sur le &quot;scan&quot;</span>
<span class="linenos">3325</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w">          </span><span class="c">! canaux des observations</span>
<span class="linenos">3326</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">             </span><span class="c">! numero de satellite (i.e. indice)</span>
<span class="linenos">3327</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! radiances</span>
<span class="linenos">3328</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w">        </span><span class="c">! correction aux radiances</span>
<span class="linenos">3329</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! residus (o-p)</span>
<span class="linenos">3330</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">      </span><span class="c">! topographie du modele</span>
<span class="linenos">3331</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">      </span><span class="c">! flag to identify all obs pts in report</span>
<span class="linenos">3332</span><span class="w">                                                            </span><span class="c">!  as being over land/ice, cloudy, bad IWV</span>
<span class="linenos">3333</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                   </span><span class="c">! identificateur du satellite</span>
<span class="linenos">3334</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">RESETQC</span><span class="w">                 </span><span class="c">! reset du controle de qualite?</span>
<span class="linenos">3335</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modLSQ</span><span class="w">                  </span><span class="c">! If active, recalculate values for land/sea</span>
<span class="linenos">3336</span><span class="w">                                                            </span><span class="c">!  qualifier and terrain type based on LG/MG</span>
<span class="linenos">3337</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">          </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lastHeader</span><span class="w">              </span><span class="c">! active if last header</span>
<span class="linenos">3338</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w">      </span><span class="c">! indicateur controle de qualite tovs par canal</span>
<span class="linenos">3339</span><span class="w">                                                            </span><span class="c">!  =0 ok, &gt;0 rejet,</span>
<span class="linenos">3340</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">       </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">             </span><span class="c">! marqueurs des radiances</span>
<span class="linenos">3341</span><span class="w">                                                            </span><span class="c">!  satellite, critere et par canal</span>
<span class="linenos">3342</span><span class="w">                                                            </span><span class="c">!  (chech n2) par satellite, critere et par canal</span>
<span class="linenos">3343</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">3344</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">3345</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">   </span><span class="c">! scattering index over water from observation</span>
<span class="linenos">3346</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">         </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">    </span><span class="c">! scattering index over water from background</span>
<span class="linenos">3347</span>
<span class="linenos">3348</span><span class="w">    </span><span class="c">!locals</span>
<span class="linenos">3349</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">maxScanAngleAMSU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">98</span><span class="w"></span>
<span class="linenos">3350</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">   </span><span class="c">! OPTION for values of MG (land/sea mask) and LG (ice) </span>
<span class="linenos">3351</span><span class="w">                                        </span><span class="c">!   at each observation point using values on 5x5 mesh </span>
<span class="linenos">3352</span><span class="w">                                        </span><span class="c">!   centered at each point.</span>
<span class="linenos">3353</span><span class="w">                                        </span><span class="c">!   ilsmOpt = 1 --&gt; use MAX value from all 25 mesh points</span>
<span class="linenos">3354</span><span class="w">                                        </span><span class="c">!   ilsmOpt = 2 --&gt; use value at central mesh point (obs location)</span>
<span class="linenos">3355</span><span class="w">                                        </span><span class="c">!   ilsmOpt = 3 --&gt; use AVG value from all 25 mesh points</span>
<span class="linenos">3356</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w"></span>
<span class="linenos">3357</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iRej</span><span class="p">,</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">JI</span><span class="w"></span>
<span class="linenos">3358</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">ICHTOPO</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3359</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">),</span><span class="w"> </span><span class="n">ITEST</span><span class="p">(</span><span class="n">mwbg_maxNumTest</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3360</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="w"> </span>
<span class="linenos">3361</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudobs</span><span class="p">,</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">precipobs</span><span class="w"></span>
<span class="linenos">3362</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3363</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdi</span><span class="p">,</span><span class="w"> </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3364</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3365</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3366</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"></span>
<span class="linenos">3367</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">allcnt</span><span class="w">                 </span><span class="c">! Number of Tovs obs</span>
<span class="linenos">3368</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">drycnt</span><span class="w">                 </span><span class="c">! Number of pts flagged for AMSU-B Dryness Index</span>
<span class="linenos">3369</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landcnt</span><span class="w">                </span><span class="c">! Number of obs pts found over land/ice</span>
<span class="linenos">3370</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rejcnt</span><span class="w">                 </span><span class="c">! Number of problem obs pts (Tb err, QCfail)</span>
<span class="linenos">3371</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w">                 </span><span class="c">! Number of pts with Mean 183 Ghz Tb &lt; 240K</span>
<span class="linenos">3372</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w">                 </span><span class="c">! Number of scatter/precip obs</span>
<span class="linenos">3373</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldcnt</span><span class="w">                 </span><span class="c">! Number of water point covered by cloud</span>
<span class="linenos">3374</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">flgcnt</span><span class="w">                 </span><span class="c">! Total number of filtered obs pts</span>
<span class="linenos">3375</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">seaIcePointNum</span><span class="w">         </span><span class="c">! Number of waterobs points converted to sea ice points</span>
<span class="linenos">3376</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clwMissingPointNum</span><span class="w">     </span><span class="c">! Number of points where cloudLiquidWaterPath/SI missing</span>
<span class="linenos">3377</span><span class="w">                                            </span><span class="c">!  over water due bad data</span>
<span class="linenos">3378</span>
<span class="linenos">3379</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="o">+</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3380</span><span class="w">    </span><span class="n">ROGUEFAC</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3381</span><span class="w">                    </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3382</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.9</span><span class="w"></span>
<span class="linenos">3383</span>
<span class="linenos">3384</span><span class="w">    </span><span class="c">! Channel sets for rejection in test 9</span>
<span class="linenos">3385</span><span class="w">    </span><span class="c">!   These AMSU-B channels are rejected if ch. 10 O-P fails rogue check over OPEN WATER only</span>
<span class="linenos">3386</span><span class="w">    </span><span class="n">ICH2OMPREJ</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3387</span>
<span class="linenos">3388</span><span class="w">    </span><span class="c">!  Data for TOPOGRAPHY CHECK</span>
<span class="linenos">3389</span><span class="w">    </span><span class="c">!   Channel AMSUB-3 (mwhs2 ch 11) is rejected for topography &gt; 2500m.</span>
<span class="linenos">3390</span><span class="w">    </span><span class="c">!                   (mwhs2 ch 12) is rejected for topography &gt; 2250m.</span>
<span class="linenos">3391</span><span class="w">    </span><span class="c">!   Channel AMSUB-4 (mwhs2 ch 13) is rejected for topography &gt; 2000m.</span>
<span class="linenos">3392</span><span class="w">    </span><span class="n">ICHTOPO</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3393</span><span class="w">    </span><span class="n">ZCRIT</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">250</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">225</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="mf">0.</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3394</span>
<span class="linenos">3395</span><span class="w">    </span><span class="c">!  Test selection (0=skip test, 1=do test)</span>
<span class="linenos">3396</span><span class="w">    </span><span class="c">!              1  2  3  4  5</span>
<span class="linenos">3397</span><span class="w">    </span><span class="n">ITEST</span><span class="p">(:)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3398</span><span class="w">    </span><span class="n">ITEST</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3399</span>
<span class="linenos">3400</span><span class="w">    </span><span class="c">! Channels excluded from gen_bias_corr in all-sky mode</span>
<span class="linenos">3401</span><span class="w">    </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3402</span>
<span class="linenos">3403</span><span class="w">    </span><span class="c">! Initialisation, la premiere fois seulement!</span>
<span class="linenos">3404</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LLFIRST</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3405</span><span class="k">      </span><span class="n">numReportWithMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3406</span><span class="w">      </span><span class="n">allcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3407</span><span class="w">      </span><span class="n">flgcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3408</span><span class="w">      </span><span class="n">landcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3409</span><span class="w">      </span><span class="n">rejcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3410</span><span class="w">      </span><span class="n">cldcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3411</span><span class="w">      </span><span class="n">iwvcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3412</span><span class="w">      </span><span class="n">pcpcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3413</span><span class="w">      </span><span class="n">drycnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3414</span><span class="w">      </span><span class="n">seaIcePointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3415</span><span class="w">      </span><span class="n">clwMissingPointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3416</span><span class="w">      </span><span class="n">rejectionCodArray</span><span class="p">(:,:,:)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3417</span><span class="w">      </span><span class="n">rejectionCodArray2</span><span class="p">(:,:,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3418</span><span class="w">      </span><span class="n">LLFIRST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3419</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">3420</span>
<span class="linenos">3421</span><span class="w">    </span><span class="c">! PART 1 TESTS:</span>
<span class="linenos">3422</span>
<span class="linenos">3423</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3424</span><span class="w">    </span><span class="c">! STEP 1 ) Determine which obs pts are over open water (i.e NOT near coasts or</span>
<span class="linenos">3425</span><span class="w">    </span><span class="c">!          over/near land/ice) using model MG and LG fields from glbhyb2 ANAL</span>
<span class="linenos">3426</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3427</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2landIceMask</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3428</span><span class="w">                              </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3429</span>
<span class="linenos">3430</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3431</span><span class="w">    </span><span class="c">! STEP 2 ) Check for values of TB that are missing or outside physical limits.</span>
<span class="linenos">3432</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3433</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_grossValueCheck</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mi">38</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3434</span>
<span class="linenos">3435</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3436</span><span class="w">    </span><span class="c">! STEP 3 ) Preliminary QC checks --&gt; set qcRejectLogic(actualNumChannel)=.true.</span>
<span class="linenos">3437</span><span class="w">    </span><span class="c">!          for data that fail QC</span>
<span class="linenos">3438</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3439</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_firstQcCheckMwhs2</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3440</span><span class="w">                                </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3441</span><span class="w">                                </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="p">,</span><span class="w"> </span><span class="n">modLSQ</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3442</span>
<span class="linenos">3443</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">3444</span><span class="w">    </span><span class="c">!  Exclude problem points from further calculations</span>
<span class="linenos">3445</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">COUNT</span><span class="p">(</span><span class="n">qcRejectLogic</span><span class="p">(:))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3446</span>
<span class="linenos">3447</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3448</span><span class="w">    </span><span class="c">! STEP 4 ) mwbg_nrlFilterMwhs2 returns cloudLiquidWaterPathObs, cloudLiquidWaterPathFG, scatec, scatbg and also does sea-ice</span>
<span class="linenos">3449</span><span class="w">    </span><span class="c">!          detection missing value for  cloudLiquidWaterPathObs, scatec, scatbg  is -99.0 (e.g. over</span>
<span class="linenos">3450</span><span class="w">    </span><span class="c">!          land or sea-ice).Sets calcTerrainTypeIndice=0 (sea ice) for points where retrieved SeaIce</span>
<span class="linenos">3451</span><span class="w">    </span><span class="c">!          &gt;=0.55. Does nothing if calcTerrainTypeIndice=0 (sea ice) and retrieved SeaIce&lt;0.55.</span>
<span class="linenos">3452</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3453</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_nrlFilterMwhs2</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3454</span><span class="w">                             </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3455</span><span class="w">                             </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3456</span><span class="w">                             </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">iRej</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3457</span>
<span class="linenos">3458</span><span class="w">    </span><span class="n">seaIcePointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seaIcePointNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="w"></span>
<span class="linenos">3459</span><span class="w">    </span><span class="n">clwMissingPointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clwMissingPointNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">iRej</span><span class="w"></span>
<span class="linenos">3460</span>
<span class="linenos">3461</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3462</span><span class="w">    </span><span class="c">! STEP 5 ) Apply NRL cloud filter, scattering index and sea-ice detection algorithms</span>
<span class="linenos">3463</span><span class="w">    </span><span class="c">!          to OPEN WATER (waterobs=true) points.</span>
<span class="linenos">3464</span><span class="w">    </span><span class="c">! Points with SeaIce&gt;0.55 are set to sea-ice points (waterobs --&gt; false)</span>
<span class="linenos">3465</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3466</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_flagDataUsingNrlCritMwhs2</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3467</span><span class="w">                                        </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3468</span><span class="w">                                        </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">cloudobs</span><span class="p">,</span><span class="w"> </span><span class="n">precipobs</span><span class="p">,</span><span class="w"> </span><span class="n">cldcnt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3469</span>
<span class="linenos">3470</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3471</span><span class="w">    </span><span class="c">! STEP 6 ) ! Review all the checks previously made to determine which obs are to be</span>
<span class="linenos">3472</span><span class="w">    </span><span class="c">!            accepted for assimilation and which are to be flagged for exclusion</span>
<span class="linenos">3473</span><span class="w">    </span><span class="c">!            (obsFlags).</span>
<span class="linenos">3474</span><span class="w">    </span><span class="c">!            grossrej()  = .true. if any channel had a gross error at the point</span>
<span class="linenos">3475</span><span class="w">    </span><span class="c">!            cloudobs()  = .true. if CLW &gt; clw_mwhs2_nrl_LTrej (0.175) or precipobs</span>
<span class="linenos">3476</span><span class="w">    </span><span class="c">!            precipobs() = .true. if precip. detected through NRL scattering indices</span>
<span class="linenos">3477</span><span class="w">    </span><span class="c">!            waterobs()  = .true. if open water point</span>
<span class="linenos">3478</span><span class="w">    </span><span class="c">!            iwvreject() = .true. if Mean 183 Ghz [ch. 11-15] Tb &lt; 240K (too dry</span>
<span class="linenos">3479</span><span class="w">    </span><span class="c">!            for ch.11-13 over land)</span>
<span class="linenos">3480</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3481</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_reviewAllCritforFinalFlagsMwhs2</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3482</span><span class="w">                                              </span><span class="n">precipobs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3483</span><span class="w">                                              </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3484</span><span class="w">                                              </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">allcnt</span><span class="p">,</span><span class="w"> </span><span class="n">drycnt</span><span class="p">,</span><span class="w"> </span><span class="n">landcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3485</span><span class="w">                                              </span><span class="n">rejcnt</span><span class="p">,</span><span class="w"> </span><span class="n">iwvcnt</span><span class="p">,</span><span class="w"> </span><span class="n">pcpcnt</span><span class="p">,</span><span class="w"> </span><span class="n">flgcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3486</span><span class="w">                                              </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3487</span>
<span class="linenos">3488</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3489</span><span class="w">    </span><span class="c">! PART 2 TESTS:</span>
<span class="linenos">3490</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">3491</span>
<span class="linenos">3492</span><span class="w">    </span><span class="c">! allocations</span>
<span class="linenos">3493</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3494</span><span class="w">    </span><span class="c">!  Initialisations</span>
<span class="linenos">3495</span><span class="w">    </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3496</span><span class="w">    </span><span class="n">B7CHCK</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3497</span>
<span class="linenos">3498</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">RESETQC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3499</span>
<span class="linenos">3500</span><span class="w">    </span><span class="c">! 1) test 1: Check flag bit 7 on from the first bgckMwhs2 program</span>
<span class="linenos">3501</span><span class="w">    </span><span class="c">!  Includes observations flagged for cloud liquid water, scattering index,</span>
<span class="linenos">3502</span><span class="w">    </span><span class="c">!  dryness index plus failure of several QC checks.</span>
<span class="linenos">3503</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test1Flagbit7Check</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3504</span><span class="w">                                      </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3505</span>
<span class="linenos">3506</span><span class="w">    </span><span class="c">! 2) test 2: Topography check (partial)</span>
<span class="linenos">3507</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test2TopographyCheck</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3508</span><span class="w">                                        </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">ICHTOPO</span><span class="p">,</span><span class="w"> </span><span class="n">ZCRIT</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3509</span>
<span class="linenos">3510</span><span class="w">    </span><span class="c">! 3) test 3: Uncorrected Tb check (single)</span>
<span class="linenos">3511</span><span class="w">    </span><span class="c">!  Uncorrected datum (flag bit #6 off). In this case switch bit 11 ON.</span>
<span class="linenos">3512</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test3UncorrectedTbCheck</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3513</span><span class="w">                                           </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3514</span>
<span class="linenos">3515</span><span class="w">    </span><span class="c">! 4) test 4: &quot;Rogue check&quot; for (O-P) Tb residuals out of range. (single/full)</span>
<span class="linenos">3516</span><span class="w">    </span><span class="c">!             Also, over WATER remove CH.10-15 if CH.10 |O-P|&gt;5K (full)</span>
<span class="linenos">3517</span><span class="w">    </span><span class="c">!  Les observations, dont le residu (O-P) depasse par un facteur (roguefac)</span>
<span class="linenos">3518</span><span class="w">    </span><span class="c">!   l&#39;erreur totale des TOVS.</span>
<span class="linenos">3519</span><span class="w">    </span><span class="c">!  OVER OPEN WATER</span>
<span class="linenos">3520</span><span class="w">    </span><span class="c">!    ch. 10 Abs(O-P) &gt; 5K produces rejection of all ATMS amsub channels 10-15.</span>
<span class="linenos">3521</span><span class="w">    </span><span class="k">call </span><span class="n">Mwhs2Test4RogueCheck</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">ROGUEFAC</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3522</span><span class="w">                              </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3523</span><span class="w">                              </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">ICH2OMPREJ</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">B7CHCK</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3524</span>
<span class="linenos">3525</span><span class="w">    </span><span class="c">! 5) test 5: Channel selection using array oer_tovutil(chan,sat)</span>
<span class="linenos">3526</span><span class="w">    </span><span class="c">!  oer_tovutil = 0 (blacklisted)</span>
<span class="linenos">3527</span><span class="w">    </span><span class="c">!                1 (assmilate)</span>
<span class="linenos">3528</span><span class="w">    </span><span class="k">call </span><span class="n">atmsMwhs2Test5ChannelSelectionUsingTovutil</span><span class="p">(</span><span class="n">itest</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3529</span><span class="w">                                                    </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3530</span>
<span class="linenos">3531</span><span class="w">    </span><span class="c">!  Synthese de la controle de qualite au niveau de chaque point</span>
<span class="linenos">3532</span><span class="w">    </span><span class="c">!  d&#39;observation. Code:</span>
<span class="linenos">3533</span><span class="w">    </span><span class="c">!            =0 aucun rejet, &gt;0 au moins un canal rejete.</span>
<span class="linenos">3534</span><span class="w">    </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3535</span><span class="w">    </span><span class="k">do </span><span class="n">JI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">3536</span><span class="w">      </span><span class="n">KCHKPRF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">KCHKPRF</span><span class="p">,</span><span class="n">qcIndicator</span><span class="p">(</span><span class="n">JI</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3537</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">3538</span>
<span class="linenos">3539</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;KCHKPRF = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="w"></span>
<span class="linenos">3540</span>
<span class="linenos">3541</span><span class="w">    </span><span class="c">! reset global marker flag (55200) and mark it if observtions are rejected</span>
<span class="linenos">3542</span><span class="w">    </span><span class="k">call </span><span class="n">resetQcCases</span><span class="p">(</span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">KCHKPRF</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3543</span>
<span class="linenos">3544</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastHeader</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3545</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3546</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of obs pts read from BURP file                         = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">allcnt</span><span class="w"></span>
<span class="linenos">3547</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of BURP file reports where Tb set to mwbg_realMissing  = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">numReportWithMissingTb</span><span class="w"></span>
<span class="linenos">3548</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3549</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 1. Number of obs pts found over land/ice           = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">landcnt</span><span class="w"></span>
<span class="linenos">3550</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 2. Number of problem obs pts (Tb err, QCfail)      = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">rejcnt</span><span class="w"></span>
<span class="linenos">3551</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 3. Number of cloudy obs  (CLW &gt; clw_min)           = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cldcnt</span><span class="w"></span>
<span class="linenos">3552</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 4. Number of scatter/precip obs                    = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w"></span>
<span class="linenos">3553</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 5. Number of pts with Mean 183 Ghz Tb &lt; 240K       = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w"></span>
<span class="linenos">3554</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; 6. Number of pts flagged for AMSU-B Dryness Index  = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">drycnt</span><span class="w"></span>
<span class="linenos">3555</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3556</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Total number of filtered obs pts                   = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"></span>
<span class="linenos">3557</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ----------------------------------------------------------------&#39;</span><span class="w"></span>
<span class="linenos">3558</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3559</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of waterobs points converted to sea ice points         = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">seaIcePointNum</span><span class="w"></span>
<span class="linenos">3560</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; Number of points where CLW/SI missing over water due bad data = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">clwMissingPointNum</span><span class="w"></span>
<span class="linenos">3561</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; --------------------------------------------------------------- &#39;</span><span class="w"></span>
<span class="linenos">3562</span>
<span class="linenos">3563</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   Meaning of newInformationFlag flag bits: &#39;</span><span class="w"></span>
<span class="linenos">3564</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3565</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;      BIT    Meaning&#39;</span><span class="w"></span>
<span class="linenos">3566</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       0     off=land or sea-ice, on=open water away from coast&#39;</span><span class="w"></span>
<span class="linenos">3567</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       1     Mean 183 Ghz [ch. 11-15] is missing&#39;</span><span class="w"></span>
<span class="linenos">3568</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       2     NRL CLW is missing (over water)&#39;</span><span class="w"></span>
<span class="linenos">3569</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       3     NRL &gt; clw_mwhs2_nrl_LTrej (0.175 kg/m2) (cloudobs)&#39;</span><span class="w"></span>
<span class="linenos">3570</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       4     scatec &gt; Lower Troposphere limit=9 (precipobs)&#39;</span><span class="w"></span>
<span class="linenos">3571</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       5     Mean 183 Ghz [ch. 11-15] Tb &lt; 240K&#39;</span><span class="w"></span>
<span class="linenos">3572</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       6     CLW &gt; clw_mwhs2_nrl_UTrej (0.200 kg/m2)&#39;</span><span class="w"></span>
<span class="linenos">3573</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       7     Dryness Index rejection (for ch. 11)&#39;</span><span class="w"></span>
<span class="linenos">3574</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       8     scatbg &gt; CMC amsu-b limit (land=0,sea=15,ice=40)&#39;</span><span class="w"></span>
<span class="linenos">3575</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;       9     Dryness Index rejection (for ch. 12)&#39;</span><span class="w"></span>
<span class="linenos">3576</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;      10     Sea ice &gt; 0.55 detected&#39;</span><span class="w"></span>
<span class="linenos">3577</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;      11     Gross error in Tb (any chan.) or other QC problem (all channels rejected)&#39;</span><span class="w"></span>
<span class="linenos">3578</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3579</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   New Element 13209 in BURP file = CLW (kg/m2)&#39;</span><span class="w"></span>
<span class="linenos">3580</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   New Element 13208 in BURP file = Bennartz-Grody Scattering Index&#39;</span><span class="w"></span>
<span class="linenos">3581</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;   New Element 25174 in BURP file = newInformationFlag flag&#39;</span><span class="w"></span>
<span class="linenos">3582</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">3583</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">3584</span>
<span class="linenos">3585</span><span class="k">  end subroutine </span><span class="n">mwbg_tovCheckMwhs2</span><span class="w"></span>
<span class="linenos">3586</span>
<span class="linenos">3587</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3588</span><span class="w">  </span><span class="c">! mwbg_readGeophysicFieldsAndInterpolate</span>
<span class="linenos">3589</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3590</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_readGeophysicFieldsAndInterpolate</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3591</span><span class="w">                                                    </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3592</span>
<span class="linenos">3593</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">3594</span>
<span class="linenos">3595</span><span class="w">    </span><span class="c">!:Purpose: Reads Modele Geophysical variables and save for the first time</span>
<span class="linenos">3596</span><span class="w">    </span><span class="c">!         TOPOGRAPHIE (MF ou MX):</span>
<span class="linenos">3597</span><span class="w">    </span><span class="c">!             MF est la topographie filtree avec unites en metres (filtered ME).</span>
<span class="linenos">3598</span><span class="w">    </span><span class="c">!             MX est la topographie filtree avec unites en m2/s2  (geopotential topography).</span>
<span class="linenos">3599</span><span class="w">    </span><span class="c">!         Glace de Mer (GL)</span>
<span class="linenos">3600</span><span class="w">    </span><span class="c">!         Masque Terre-Mer (MG)</span>
<span class="linenos">3601</span><span class="w">    </span><span class="c">!         Then Interpolate Those variables to observation location</span>
<span class="linenos">3602</span><span class="w">    </span><span class="c">!Arguments:</span>
<span class="linenos">3603</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">instName</span><span class="w">            </span><span class="c">! Instrument Name</span>
<span class="linenos">3604</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w">              </span><span class="c">! Obseravtion Lats</span>
<span class="linenos">3605</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w">              </span><span class="c">! Observation Lons</span>
<span class="linenos">3606</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w"> </span><span class="c">! model interpolated land fraction.</span>
<span class="linenos">3607</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">  </span><span class="c">! topographie filtree (en metres) et interpolees</span>
<span class="linenos">3608</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">   </span><span class="c">! Glace de mer interpolees au pt d&#39;obs.</span>
<span class="linenos">3609</span>
<span class="linenos">3610</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos">3611</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MXLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">MXLAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">MXELM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="linenos">3612</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">DLAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">DLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6</span><span class="w"></span>
<span class="linenos">3613</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">GL</span><span class="p">(:)</span><span class="w">   </span><span class="c">! Modele Glace de Mer (GL)</span>
<span class="linenos">3614</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">MG</span><span class="p">(:)</span><span class="w">   </span><span class="c">! Modele Masque Terre-Mer (MG)</span>
<span class="linenos">3615</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">MT</span><span class="p">(:)</span><span class="w">   </span><span class="c">! Modele Topographie (MT)</span>
<span class="linenos">3616</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w">  </span><span class="n">gdmt</span><span class="w">                </span><span class="c">! topo interpolation param</span>
<span class="linenos">3617</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w">  </span><span class="n">gdmg</span><span class="w">                </span><span class="c">! mask terre-mer interpolation param</span>
<span class="linenos">3618</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w">  </span><span class="n">gdgl</span><span class="w">                </span><span class="c">! glace interpolation param</span>
<span class="linenos">3619</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">TOPOFACT</span><span class="w">             </span><span class="c">! Facteur x topo pour avoir des unites en metre</span>
<span class="linenos">3620</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">ifFirstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">True</span><span class="p">.</span><span class="w"> </span><span class="c">! If .True. we read GL, MT and MG</span>
<span class="linenos">3621</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">,</span><span class="w"> </span><span class="n">IUNGEO</span><span class="w"> </span>
<span class="linenos">3622</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">irec</span><span class="p">,</span><span class="w"> </span><span class="n">ezqkdef</span><span class="p">,</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">,</span><span class="w"> </span><span class="n">FSTINF</span><span class="p">,</span><span class="n">FSTPRM</span><span class="p">,</span><span class="n">FCLOS</span><span class="p">,</span><span class="w"> </span><span class="n">FSTLIR</span><span class="p">,</span><span class="n">FSTFRM</span><span class="p">,</span><span class="w"> </span><span class="n">FNOM</span><span class="p">,</span><span class="w"> </span><span class="n">FSTOUV</span><span class="w"></span>
<span class="linenos">3623</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">NI</span><span class="p">,</span><span class="w"> </span><span class="n">NJ</span><span class="p">,</span><span class="w"> </span><span class="n">NK</span><span class="p">,</span><span class="w"> </span><span class="n">IG1</span><span class="p">,</span><span class="w"> </span><span class="n">IG2</span><span class="p">,</span><span class="w"> </span><span class="n">IG3</span><span class="p">,</span><span class="w"> </span><span class="n">IG4</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM1</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM2</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM3</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM4</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM5</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM6</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM7</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM8</span><span class="w"></span>
<span class="linenos">3624</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">IDUM9</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM10</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM11</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM12</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM13</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM14</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM15</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM16</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM17</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM18</span><span class="w"></span>
<span class="linenos">3625</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">NLAT</span><span class="p">,</span><span class="w"> </span><span class="n">NLON</span><span class="p">,</span><span class="w"> </span><span class="n">boxPointIndex</span><span class="p">,</span><span class="w"> </span><span class="n">latIndex</span><span class="p">,</span><span class="w"> </span><span class="n">lonIndex</span><span class="p">,</span><span class="w"> </span><span class="n">boxPointNum</span><span class="w"></span>
<span class="linenos">3626</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ETIKXX</span><span class="w"></span>
<span class="linenos">3627</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">CLNOMVAR</span><span class="w"></span>
<span class="linenos">3628</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">NOMVXX</span><span class="w"></span>
<span class="linenos">3629</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">TYPXX</span><span class="w"></span>
<span class="linenos">3630</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">GRTYP</span><span class="w"></span>
<span class="linenos">3631</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">XLAT</span><span class="p">,</span><span class="w"> </span><span class="n">XLON</span><span class="w"></span>
<span class="linenos">3632</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ZLATBOX</span><span class="p">(:),</span><span class="w"> </span><span class="n">ZLONBOX</span><span class="p">(:),</span><span class="w"> </span><span class="n">MGINTBOX</span><span class="p">(:),</span><span class="w"> </span><span class="n">MTINTBOX</span><span class="p">(:),</span><span class="w"> </span><span class="n">GLINTBOX</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3633</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">readGlaceMask</span><span class="w"></span>
<span class="linenos">3634</span>
<span class="linenos">3635</span><span class="w">    </span><span class="c">! STEP 1: READ MT, GL and MG from the FST FILE</span>
<span class="linenos">3636</span><span class="w">    </span><span class="n">readGlaceMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">True</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3637</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;ATMS&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">readGlaceMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">False</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3638</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ifFirstCall</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3639</span><span class="k">      </span><span class="n">IUNGEO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3640</span><span class="w">      </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FNOM</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">fileMgLg</span><span class="p">,</span><span class="s1">&#39;STD+RND+R/O&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3641</span>
<span class="linenos">3642</span><span class="w">      </span><span class="c">! 3) Lecture des champs geophysiques (MF/MX) du modele</span>
<span class="linenos">3643</span><span class="w">      </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTOUV</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">,</span><span class="s1">&#39;RND&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3644</span>
<span class="linenos">3645</span><span class="w">      </span><span class="c">! TOPOGRAPHIE (MF ou MX).</span>
<span class="linenos">3646</span><span class="w">      </span><span class="c">!     MX est la topographie filtree avec unites en m2/s2  (geopotential topography).</span>
<span class="linenos">3647</span>
<span class="linenos">3648</span><span class="w">      </span><span class="n">IREC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTINF</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">NI</span><span class="p">,</span><span class="n">NJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;MX&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3649</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IREC</span><span class="w"> </span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3650</span><span class="k">        </span><span class="n">TOPOFACT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.80616</span><span class="w"></span>
<span class="linenos">3651</span><span class="w">        </span><span class="n">CLNOMVAR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MX&#39;</span><span class="w"></span>
<span class="linenos">3652</span><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">MT</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">MT</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3653</span><span class="w">        </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">MT</span><span class="p">(</span><span class="n">NI</span><span class="o">*</span><span class="n">NJ</span><span class="p">),</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3654</span><span class="w">        </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTLIR</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">NI</span><span class="p">,</span><span class="n">NJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3655</span><span class="w">           </span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">CLNOMVAR</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3656</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">3657</span><span class="k">        call </span><span class="n">utl_abort</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bgckMicrowave_mod: ERREUR: LA TOPOGRAPHIE (MF or MX) EST INEXISTANTE&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3658</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3659</span>
<span class="linenos">3660</span><span class="k">      </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTPRM</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">IREC</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM1</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM2</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM3</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM4</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3661</span><span class="w">          </span><span class="n">IDUM5</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM6</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM7</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM8</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM9</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM10</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3662</span><span class="w">          </span><span class="n">IDUM11</span><span class="p">,</span><span class="w"> </span><span class="n">TYPXX</span><span class="p">,</span><span class="w"> </span><span class="n">NOMVXX</span><span class="p">,</span><span class="w"> </span><span class="n">ETIKXX</span><span class="p">,</span><span class="w"> </span><span class="n">GRTYP</span><span class="p">,</span><span class="w"> </span><span class="n">IG1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3663</span><span class="w">          </span><span class="n">IG2</span><span class="p">,</span><span class="w"> </span><span class="n">IG3</span><span class="p">,</span><span class="w"> </span><span class="n">IG4</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM12</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM13</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM14</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3664</span><span class="w">          </span><span class="n">IDUM15</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM16</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM17</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM18</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">3665</span><span class="w">       </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; GRILLE MT : &#39;</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3666</span><span class="w">                </span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="w"></span>
<span class="linenos">3667</span><span class="w">      </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;INTERP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3668</span><span class="w">      </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;EXTRAP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;ABORT&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3669</span><span class="w">      </span><span class="n">gdmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ezqkdef</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="p">,</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3670</span>
<span class="linenos">3671</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">readGlaceMask</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">3672</span><span class="w">        </span><span class="c">! MG</span>
<span class="linenos">3673</span><span class="w">        </span><span class="n">IREC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTINF</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">NI</span><span class="p">,</span><span class="n">NJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;MG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3674</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IREC</span><span class="w"> </span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3675</span><span class="k">          call </span><span class="n">utl_abort</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bgckMicrowave_mod: ERREUR: LE MASQUE TERRE-MER EST INEXISTANT&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3676</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">3677</span>
<span class="linenos">3678</span><span class="k">        if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">MG</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">MG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3679</span><span class="w">        </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">MG</span><span class="p">(</span><span class="n">NI</span><span class="o">*</span><span class="n">NJ</span><span class="p">),</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3680</span><span class="w">        </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTLIR</span><span class="p">(</span><span class="n">MG</span><span class="p">,</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">NI</span><span class="p">,</span><span class="n">NJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="linenos">3681</span><span class="w">                 </span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;MG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3682</span>
<span class="linenos">3683</span><span class="w">        </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTPRM</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">IREC</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM1</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM2</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM3</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM4</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3684</span><span class="w">             </span><span class="n">IDUM5</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM6</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM7</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM8</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM9</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM10</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3685</span><span class="w">             </span><span class="n">IDUM11</span><span class="p">,</span><span class="w"> </span><span class="n">TYPXX</span><span class="p">,</span><span class="w"> </span><span class="n">NOMVXX</span><span class="p">,</span><span class="w"> </span><span class="n">ETIKXX</span><span class="p">,</span><span class="w"> </span><span class="n">GRTYP</span><span class="p">,</span><span class="w"> </span><span class="n">IG1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="linenos">3686</span><span class="w">             </span><span class="n">IG2</span><span class="p">,</span><span class="w"> </span><span class="n">IG3</span><span class="p">,</span><span class="w"> </span><span class="n">IG4</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM12</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM13</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM14</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3687</span><span class="w">             </span><span class="n">IDUM15</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM16</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM17</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM18</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">3688</span><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; GRILLE MG : &#39;</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3689</span><span class="w">                </span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="w"></span>
<span class="linenos">3690</span><span class="w">        </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;INTERP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3691</span><span class="w">        </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;EXTRAP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;ABORT&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3692</span><span class="w">        </span><span class="n">gdmg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ezqkdef</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="p">,</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3693</span><span class="w">        </span><span class="c">! GL</span>
<span class="linenos">3694</span><span class="w">        </span><span class="n">IREC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTINF</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">NI</span><span class="p">,</span><span class="n">NJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;GL&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3695</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IREC</span><span class="w"> </span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3696</span><span class="k">          call </span><span class="n">utl_abort</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bgckMicrowave_mod: ERREUR: LE CHAMP GLACE DE MER EST INEXISTANT&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3697</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">3698</span>
<span class="linenos">3699</span><span class="k">        if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">GL</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">GL</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3700</span><span class="w">        </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">GL</span><span class="p">(</span><span class="n">NI</span><span class="o">*</span><span class="n">NJ</span><span class="p">),</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3701</span><span class="w">        </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTLIR</span><span class="p">(</span><span class="n">GL</span><span class="p">,</span><span class="n">IUNGEO</span><span class="p">,</span><span class="n">NI</span><span class="p">,</span><span class="n">NJ</span><span class="p">,</span><span class="n">NK</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3702</span><span class="w">                 </span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;GL&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3703</span>
<span class="linenos">3704</span><span class="w">        </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTPRM</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">IREC</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM1</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM2</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM3</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM4</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3705</span><span class="w">             </span><span class="n">IDUM5</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM6</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM7</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM8</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM9</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM10</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3706</span><span class="w">             </span><span class="n">IDUM11</span><span class="p">,</span><span class="w"> </span><span class="n">TYPXX</span><span class="p">,</span><span class="w"> </span><span class="n">NOMVXX</span><span class="p">,</span><span class="w"> </span><span class="n">ETIKXX</span><span class="p">,</span><span class="w"> </span><span class="n">GRTYP</span><span class="p">,</span><span class="w"> </span><span class="n">IG1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3707</span><span class="w">             </span><span class="n">IG2</span><span class="p">,</span><span class="w"> </span><span class="n">IG3</span><span class="p">,</span><span class="w"> </span><span class="n">IG4</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM12</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM13</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM14</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3708</span><span class="w">             </span><span class="n">IDUM15</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM16</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM17</span><span class="p">,</span><span class="w"> </span><span class="n">IDUM18</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">3709</span><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; GRILLE GL : &#39;</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3710</span><span class="w">                </span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="w"></span>
<span class="linenos">3711</span><span class="w">        </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;INTERP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3712</span><span class="w">        </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;EXTRAP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;ABORT&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3713</span><span class="w">        </span><span class="n">gdgl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ezqkdef</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="p">,</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3714</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">3715</span><span class="k">        </span><span class="n">gdgl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="linenos">3716</span><span class="w">        </span><span class="n">gdmg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="linenos">3717</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3718</span><span class="k">      </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSTFRM</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3719</span><span class="w">      </span><span class="n">IER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCLOS</span><span class="p">(</span><span class="n">IUNGEO</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3720</span><span class="w">      </span><span class="n">ifFirstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">False</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3721</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">3722</span>
<span class="linenos">3723</span><span class="w">    </span><span class="c">! STEP 3:  Interpolation de la glace et le champ terre/mer du modele aux pts TOVS.</span>
<span class="linenos">3724</span><span class="w">    </span><span class="c">! N.B.: on examine ces champs sur une boite centree sur chaque obs.</span>
<span class="linenos">3725</span><span class="w">    </span><span class="n">boxPointNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MXLAT</span><span class="o">*</span><span class="n">MXLON</span><span class="w"></span>
<span class="linenos">3726</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ZLATBOX</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">ZLATBOX</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3727</span><span class="w">    </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">ZLATBOX</span><span class="p">(</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3728</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ZLONBOX</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">ZLONBOX</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3729</span><span class="w">    </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">ZLONBOX</span><span class="p">(</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3730</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">MTINTBOX</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">MTINTBOX</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3731</span><span class="w">    </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">MTINTBOX</span><span class="p">(</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3732</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">GLINTBOX</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">GLINTBOX</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3733</span><span class="w">    </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">GLINTBOX</span><span class="p">(</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3734</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">MGINTBOX</span><span class="p">))</span><span class="w"> </span><span class="k">deallocate</span><span class="p">(</span><span class="n">MGINTBOX</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3735</span><span class="w">    </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">MGINTBOX</span><span class="p">(</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">STAT</span><span class="o">=</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3736</span><span class="w">    </span><span class="n">NLAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MXLAT</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="linenos">3737</span><span class="w">    </span><span class="n">NLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MXLON</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="linenos">3738</span><span class="w">    </span><span class="n">boxPointIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3739</span><span class="w">    </span><span class="k">do </span><span class="n">latIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">NLAT</span><span class="p">,</span><span class="w"> </span><span class="n">NLAT</span><span class="w"></span>
<span class="linenos">3740</span><span class="w">      </span><span class="n">XLAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">latIndex</span><span class="o">*</span><span class="n">DLAT</span><span class="w"></span>
<span class="linenos">3741</span><span class="w">      </span><span class="n">XLAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">MIN</span><span class="p">(</span><span class="mi">9</span><span class="mf">0.0</span><span class="p">,</span><span class="n">XLAT</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3742</span><span class="w">      </span><span class="k">do </span><span class="n">lonIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">NLON</span><span class="p">,</span><span class="w"> </span><span class="n">NLON</span><span class="w"></span>
<span class="linenos">3743</span><span class="w">        </span><span class="n">boxPointIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boxPointIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">3744</span><span class="w">        </span><span class="n">XLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lonIndex</span><span class="o">*</span><span class="n">DLON</span><span class="w"></span>
<span class="linenos">3745</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">18</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">3746</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="mi">18</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">3747</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">&lt;</span><span class="w">    </span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XLON</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">3748</span><span class="w">          </span><span class="n">ZLATBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XLAT</span><span class="w"></span>
<span class="linenos">3749</span><span class="w">          </span><span class="n">ZLONBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XLON</span><span class="w"></span>
<span class="linenos">3750</span><span class="w">        </span><span class="k">end do</span>
<span class="linenos">3751</span><span class="k">    end do</span>
<span class="linenos">3752</span><span class="k">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;INTERP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3753</span><span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">(</span><span class="n">gdmt</span><span class="p">,</span><span class="n">mtintbox</span><span class="p">,</span><span class="n">mt</span><span class="p">,</span><span class="n">ZLATBOX</span><span class="p">,</span><span class="n">ZLONBOX</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3754</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3755</span><span class="k">      call </span><span class="n">utl_abort</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bgckMicrowave_mod: ERROR in the interpolation of MT&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3756</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">3757</span><span class="k">    if</span><span class="p">(</span><span class="n">readGlaceMask</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3758</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">(</span><span class="n">gdmg</span><span class="p">,</span><span class="n">mgintbox</span><span class="p">,</span><span class="n">mg</span><span class="p">,</span><span class="n">ZLATBOX</span><span class="p">,</span><span class="n">ZLONBOX</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3759</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3760</span><span class="k">        call </span><span class="n">utl_abort</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bgckMicrowave_mod: ERROR in the interpolation of MG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3761</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3762</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">(</span><span class="n">gdgl</span><span class="p">,</span><span class="n">glintbox</span><span class="p">,</span><span class="n">gl</span><span class="p">,</span><span class="n">ZLATBOX</span><span class="p">,</span><span class="n">ZLONBOX</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3763</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ier</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3764</span><span class="k">        call </span><span class="n">utl_abort</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bgckMicrowave_mod: ERROR in the interpolation of GL&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3765</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3766</span><span class="k">    end if</span>
<span class="linenos">3767</span>
<span class="linenos">3768</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3769</span><span class="k">      print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; ------------------  &#39;</span><span class="w"></span>
<span class="linenos">3770</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; obsLat,obsLon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">3771</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;   &#39;</span><span class="w"></span>
<span class="linenos">3772</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; ZLATBOX = &#39;</span><span class="w"></span>
<span class="linenos">3773</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="n">ZLATBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">),</span><span class="n">boxPointIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3774</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; ZLONBOX = &#39;</span><span class="w"></span>
<span class="linenos">3775</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="n">ZLONBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">),</span><span class="n">boxPointIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3776</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; MGINTBOX = &#39;</span><span class="w"></span>
<span class="linenos">3777</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="n">MGINTBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">),</span><span class="n">boxPointIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3778</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; MTINTBOX = &#39;</span><span class="w"></span>
<span class="linenos">3779</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="n">MTINTBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">),</span><span class="n">boxPointIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3780</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; GLINTBOX = &#39;</span><span class="w"></span>
<span class="linenos">3781</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="n">GLINTBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">),</span><span class="n">boxPointIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">boxPointNum</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3782</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">3783</span><span class="k">    </span><span class="n">modelInterpLandFrac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">3784</span><span class="w">    </span><span class="n">modelInterpTerrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">3785</span><span class="w">    </span><span class="n">modelInterpSeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">3786</span><span class="w">    </span><span class="k">do </span><span class="n">boxPointIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">MXLAT</span><span class="o">*</span><span class="n">MXLON</span><span class="w"></span>
<span class="linenos">3787</span><span class="w">      </span><span class="n">modelInterpTerrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="n">MTINTBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">)</span><span class="o">/</span><span class="n">TOPOFACT</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3788</span><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">readGlaceMask</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3789</span><span class="k">        </span><span class="n">modelInterpLandFrac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="n">MGINTBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3790</span><span class="w">        </span><span class="n">modelInterpSeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="n">GLINTBOX</span><span class="p">(</span><span class="n">boxPointIndex</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3791</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3792</span><span class="k">    end do</span>
<span class="linenos">3793</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">mwbg_debug</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3794</span><span class="k">      print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; modelInterpLandFrac = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w"></span>
<span class="linenos">3795</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; modelInterpTerrain = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w"></span>
<span class="linenos">3796</span><span class="w">      </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; modelInterpSeaIce = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w"></span>
<span class="linenos">3797</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">3798</span><span class="k">  end subroutine </span><span class="n">mwbg_readGeophysicFieldsAndInterpolate</span><span class="w"></span>
<span class="linenos">3799</span>
<span class="linenos">3800</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3801</span><span class="w">  </span><span class="c">! atmsMwhs2landIceMask</span>
<span class="linenos">3802</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">3803</span><span class="w">  </span><span class="k">subroutine </span><span class="n">atmsMwhs2landIceMask</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3804</span><span class="w">                                  </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3805</span><span class="w">    </span><span class="c">! Adapted from: land_ice_mask_ssmis.ftn90 of mwbg_ssmis (D. Anselmo, S. Macpherson)</span>
<span class="linenos">3806</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3807</span><span class="w">    </span><span class="c">! Object:   This routine sets waterobs array by performing a land/ice proximity check using</span>
<span class="linenos">3808</span><span class="w">    </span><span class="c">!           using analysis MG and LG (or GL) fields used by the model which produces the trial field.</span>
<span class="linenos">3809</span><span class="w">    </span><span class="c">!           The purpose of this check is to remove obs that reside close to coasts or ice,</span>
<span class="linenos">3810</span><span class="w">    </span><span class="c">!           and so whose TBs may be contaminated.</span>
<span class="linenos">3811</span><span class="w">    </span><span class="c">!           The GEM Global (glbhyb2) analysis contains MG and LG fields (on different grids).</span>
<span class="linenos">3812</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3813</span><span class="w">    </span><span class="c">!           NOTE: The 0.1 deg binary ice field check from land_ice_mask_ssmis.ftn90</span>
<span class="linenos">3814</span><span class="w">    </span><span class="c">!           was removed. The land/sea qualifier (calcLandQualifierIndice) and terrain type (calcTerrainTypeIndice) </span>
<span class="linenos">3815</span><span class="w">    </span><span class="c">!           are modified to indicate proximity to land and sea-ice but are NOT changed in output BURP file.</span>
<span class="linenos">3816</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3817</span><span class="w">    </span><span class="c">!           In the application of this check, a 5x5 mesh, with spacing defined by rlat_km and</span>
<span class="linenos">3818</span><span class="w">    </span><span class="c">!           rlon_km, is positioned with its center over an obs pt (2 grid pts on either side</span>
<span class="linenos">3819</span><span class="w">    </span><span class="c">!           of the obs pt; size of mesh is equal to 4*rlat_km x 4*rlon_km). The values of MG</span>
<span class="linenos">3820</span><span class="w">    </span><span class="c">!           and LG are evaluated at the grid points of this mesh. For ilsmOpt=1 (or 3), the maximum</span>
<span class="linenos">3821</span><span class="w">    </span><span class="c">!           (or average) determines whether the obs pt is too close to ice or land to be retained.</span>
<span class="linenos">3822</span><span class="w">    </span><span class="c">!           For ilsmOpt=2, the value at the central mesh point is used.</span>
<span class="linenos">3823</span><span class="w">    </span><span class="c">!           **NOTE: the threshold value for MG has a very strong effect on the distance</span>
<span class="linenos">3824</span><span class="w">    </span><span class="c">!                   from land that is permitted for an obs to be retained</span>
<span class="linenos">3825</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3826</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3827</span><span class="w">    </span><span class="c">!      Maximum FOV             x---x---x---x---x     ^</span>
<span class="linenos">3828</span><span class="w">    </span><span class="c">!         = 75km x 75km        |   |   |   |   |     |</span>
<span class="linenos">3829</span><span class="w">    </span><span class="c">!         for Meso-sphere CHs  x---x---x---x---x     |</span>
<span class="linenos">3830</span><span class="w">    </span><span class="c">!         = 74km x 47km        |   |   |   |   |     |</span>
<span class="linenos">3831</span><span class="w">    </span><span class="c">!         for 19 GHz           x---x---o---x---x     | = 4*rlat_km</span>
<span class="linenos">3832</span><span class="w">    </span><span class="c">!                              |   |   |   |   |     | = 4*40 km</span>
<span class="linenos">3833</span><span class="w">    </span><span class="c">!                           ^  x---x---x---x---x     | = 160 km = 80 km north &amp; south</span>
<span class="linenos">3834</span><span class="w">    </span><span class="c">!                   rlat_km |  |   |   |   |   |     |</span>
<span class="linenos">3835</span><span class="w">    </span><span class="c">!                           v  x---x---x---x---x     v</span>
<span class="linenos">3836</span><span class="w">    </span><span class="c">!                                          &lt;---&gt;</span>
<span class="linenos">3837</span><span class="w">    </span><span class="c">!                                         rlon_km</span>
<span class="linenos">3838</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3839</span><span class="w">    </span><span class="c">!                              &lt;---------------&gt;</span>
<span class="linenos">3840</span><span class="w">    </span><span class="c">!                                 = 4*rlon_km</span>
<span class="linenos">3841</span><span class="w">    </span><span class="c">!                                 = 4*40 km</span>
<span class="linenos">3842</span><span class="w">    </span><span class="c">!                                 = 160 km = 80 km east &amp; west</span>
<span class="linenos">3843</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3844</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3845</span><span class="w">    </span><span class="c">!               MG value = 1.0  ==&gt;  LAND       MG value = 0.0  ==&gt;  OCEAN</span>
<span class="linenos">3846</span><span class="w">    </span><span class="c">!               LG value = 1.0  ==&gt;  ICE        LG value = 0.0  ==&gt;  NO ICE</span>
<span class="linenos">3847</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">3848</span><span class="w">    </span><span class="c">!--------------------------------------------------------------------</span>
<span class="linenos">3849</span><span class="w">    </span><span class="c">!  Variable Definitions</span>
<span class="linenos">3850</span><span class="w">    </span><span class="c">!  --------------------</span>
<span class="linenos">3851</span><span class="w">    </span><span class="c">! - obsLat     : input  -  lat</span>
<span class="linenos">3852</span><span class="w">    </span><span class="c">! - obsLon     : input  -  lon</span>
<span class="linenos">3853</span><span class="w">    </span><span class="c">! - calcLandQualifierIndice  : in/out -  array holding land/sea qualifier values for all obs</span>
<span class="linenos">3854</span><span class="w">    </span><span class="c">!                        pts of report (0 = land, 1 = sea)</span>
<span class="linenos">3855</span><span class="w">    </span><span class="c">! - calcTerrainTypeIndice  : in/out -  array holding terrain-type values for all obs pts</span>
<span class="linenos">3856</span><span class="w">    </span><span class="c">!                        of current report (-1 land/open water, 0 = ice)</span>
<span class="linenos">3857</span><span class="w">    </span><span class="c">! - waterobs   : output -  logical array identifying for each obs in current report</span>
<span class="linenos">3858</span><span class="w">    </span><span class="c">!                        whether it is over open water, far from coast/ice</span>
<span class="linenos">3859</span><span class="w">    </span><span class="c">! - ilsmOpt    : input  -  option for &quot;interpolated&quot; value of MG, LG at each location</span>
<span class="linenos">3860</span><span class="w">    </span><span class="c">!                        1 = use MAX value taken from all mesh grid points</span>
<span class="linenos">3861</span><span class="w">    </span><span class="c">!                        2 = use CENTRAL mesh point value (value at obs location)</span>
<span class="linenos">3862</span><span class="w">    </span><span class="c">!                        3 = use AVG value of all mesh grid points    </span>
<span class="linenos">3863</span><span class="w">    </span><span class="c">! - mxlat      : internal-  number of grid pts in lat. direction for mesh</span>
<span class="linenos">3864</span><span class="w">    </span><span class="c">! - mxlon      : internal-  number of grid pts in lon. direction for mesh</span>
<span class="linenos">3865</span><span class="w">    </span><span class="c">! - rlat_km    : internal-  spacing desired between mesh grid points in km</span>
<span class="linenos">3866</span><span class="w">    </span><span class="c">!                           along lat. direction</span>
<span class="linenos">3867</span><span class="w">    </span><span class="c">! - rlon_km    : internal-  spacing desired between mesh grid points in km</span>
<span class="linenos">3868</span><span class="w">    </span><span class="c">!                           along lon. direction</span>
<span class="linenos">3869</span><span class="w">    </span><span class="c">! - dlat       : internal-  spacing between mesh grid points along lon. direction</span>
<span class="linenos">3870</span><span class="w">    </span><span class="c">!                           in degrees computed from rlat_km</span>
<span class="linenos">3871</span><span class="w">    </span><span class="c">! - dlon       : internal-  spacing between mesh grid points along lon. direction</span>
<span class="linenos">3872</span><span class="w">    </span><span class="c">!                           in degrees computed from rlon_km</span>
<span class="linenos">3873</span><span class="w">    </span><span class="c">! - rkm_per_deg : internal- distance in km per degree</span>
<span class="linenos">3874</span><span class="w">    </span><span class="c">!                           = Earth radius * PI/180.0</span>
<span class="linenos">3875</span><span class="w">    </span><span class="c">!                           = 6371.01 km * PI/180.0</span>
<span class="linenos">3876</span><span class="w">    </span><span class="c">!                           = 111.195 km</span>
<span class="linenos">3877</span><span class="w">    </span><span class="c">! - nlat,nlon  : internal-  used to define the lat/lon of the grid pts of mesh</span>
<span class="linenos">3878</span><span class="w">    </span><span class="c">! - zlatbox    : internal-  lat values at all grid pts of mesh for all obs pts</span>
<span class="linenos">3879</span><span class="w">    </span><span class="c">! - zlonbox    : internal-  lon values at all grid pts of mesh for all obs pts</span>
<span class="linenos">3880</span><span class="w">    </span><span class="c">! - latmesh    : internal-  lat values at all grid pts of mesh for 1 obs pt</span>
<span class="linenos">3881</span><span class="w">    </span><span class="c">! - lonmesh    : internal-  lon values at all grid pts of mesh for 1 obs pt</span>
<span class="linenos">3882</span><span class="w">    </span><span class="c">! - mgintob    : internal-  interpolated MG values at all grid pts of mesh for 1 obs pt</span>
<span class="linenos">3883</span><span class="w">    </span><span class="c">! - lgintob    : internal-  interpolated LG values at all grid pts of mesh for 1 obs pt</span>
<span class="linenos">3884</span><span class="w">    </span><span class="c">! - mgintrp    : internal-  max. interpolated MG value on mesh for all obs pts</span>
<span class="linenos">3885</span><span class="w">    </span><span class="c">! - lgintrp    : internal-  max. interpolated LG value on mesh for all obs pts</span>
<span class="linenos">3886</span><span class="w">    </span><span class="c">! - MGthresh   : internal-  maximum allowable land fraction for obs to be kept</span>
<span class="linenos">3887</span><span class="w">    </span><span class="c">! - LGthresh   : internal-  maximum allowable ice  fraction for obs to be kept</span>
<span class="linenos">3888</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">3889</span>
<span class="linenos">3890</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">3891</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="w">    </span>
<span class="linenos">3892</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">3893</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">3894</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">3895</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"></span>
<span class="linenos">3896</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">3897</span>
<span class="linenos">3898</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos">3899</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">firstCall</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3900</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mxlat</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">mxlon</span><span class="o">=</span><span class="mi">5</span><span class="w"></span>
<span class="linenos">3901</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iungeo</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="w"></span>
<span class="linenos">3902</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ni</span><span class="p">,</span><span class="w"> </span><span class="n">nj</span><span class="p">,</span><span class="w"> </span><span class="n">nk</span><span class="p">,</span><span class="w"> </span><span class="n">nilg</span><span class="p">,</span><span class="w"> </span><span class="n">njlg</span><span class="w"></span>
<span class="linenos">3903</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ig1</span><span class="p">,</span><span class="w"> </span><span class="n">ig2</span><span class="p">,</span><span class="w"> </span><span class="n">ig3</span><span class="p">,</span><span class="w"> </span><span class="n">ig4</span><span class="p">,</span><span class="w"> </span><span class="n">ig1lg</span><span class="p">,</span><span class="w"> </span><span class="n">ig2lg</span><span class="p">,</span><span class="w"> </span><span class="n">ig3lg</span><span class="p">,</span><span class="w"> </span><span class="n">ig4lg</span><span class="w"></span>
<span class="linenos">3904</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">idum4</span><span class="p">,</span><span class="w"> </span><span class="n">idum5</span><span class="p">,</span><span class="w"> </span><span class="n">idum6</span><span class="p">,</span><span class="w"> </span><span class="n">idum7</span><span class="p">,</span><span class="w"> </span><span class="n">idum8</span><span class="p">,</span><span class="w"> </span><span class="n">idum9</span><span class="p">,</span><span class="w"> </span><span class="n">idum10</span><span class="p">,</span><span class="w"> </span><span class="n">idum11</span><span class="w"></span>
<span class="linenos">3905</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">idum12</span><span class="p">,</span><span class="w"> </span><span class="n">idum13</span><span class="p">,</span><span class="w"> </span><span class="n">idum14</span><span class="p">,</span><span class="w"> </span><span class="n">idum15</span><span class="p">,</span><span class="w"> </span><span class="n">idum16</span><span class="p">,</span><span class="w"> </span><span class="n">idum17</span><span class="p">,</span><span class="w"> </span><span class="n">idum18</span><span class="w"></span>
<span class="linenos">3906</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">indx</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">nlat</span><span class="p">,</span><span class="w"> </span><span class="n">nlon</span><span class="w"></span>
<span class="linenos">3907</span>
<span class="linenos">3908</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ii_obsloc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">mxlat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mxlon</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">! 1D-index of central mesh-point (obs location)</span>
<span class="linenos">3909</span>
<span class="linenos">3910</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.141592654</span><span class="w"></span>
<span class="linenos">3911</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MGthresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">LGthresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="w"></span>
<span class="linenos">3912</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rlat_km</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">rlon_km</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">3913</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rkm_per_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="mf">1.195</span><span class="w"></span>
<span class="linenos">3914</span>
<span class="linenos">3915</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xlat</span><span class="p">,</span><span class="w"> </span><span class="n">xlatrad</span><span class="p">,</span><span class="w"> </span><span class="n">xlon</span><span class="p">,</span><span class="w"> </span><span class="n">rii</span><span class="p">,</span><span class="w"> </span><span class="n">rjj</span><span class="w"></span>
<span class="linenos">3916</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dlat</span><span class="p">,</span><span class="w"> </span><span class="n">dlon</span><span class="w"></span>
<span class="linenos">3917</span>
<span class="linenos">3918</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">etikxx</span><span class="w"></span>
<span class="linenos">3919</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">nomvxx</span><span class="w"></span>
<span class="linenos">3920</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">typxx</span><span class="w"></span>
<span class="linenos">3921</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grtyp</span><span class="p">,</span><span class="w"> </span><span class="n">grtyplg</span><span class="w"></span>
<span class="linenos">3922</span>
<span class="linenos">3923</span><span class="w">    </span><span class="kt">logical</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">llg</span><span class="w"></span>
<span class="linenos">3924</span>
<span class="linenos">3925</span><span class="w">    </span><span class="c">! F90 allocatable arrays:</span>
<span class="linenos">3926</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mg</span><span class="p">(:),</span><span class="n">lg</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3927</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">latmesh</span><span class="p">(:),</span><span class="w"> </span><span class="n">lonmesh</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3928</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">mgintob</span><span class="p">(:),</span><span class="w"> </span><span class="n">lgintob</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3929</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">zlatbox</span><span class="p">(:),</span><span class="w"> </span><span class="n">zlonbox</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">3930</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mgintrp</span><span class="p">,</span><span class="w"> </span><span class="n">lgintrp</span><span class="w"></span>
<span class="linenos">3931</span>
<span class="linenos">3932</span><span class="w">    </span><span class="c">! RMNLIB interpolating functions:</span>
<span class="linenos">3933</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">,</span><span class="w"> </span><span class="n">ezqkdef</span><span class="w"></span>
<span class="linenos">3934</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">,</span><span class="w"> </span><span class="n">gdid</span><span class="p">,</span><span class="w"> </span><span class="n">gdidlg</span><span class="w"></span>
<span class="linenos">3935</span>
<span class="linenos">3936</span><span class="w">    </span><span class="c">! Define FORTRAN FST functions:</span>
<span class="linenos">3937</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fstinf</span><span class="p">,</span><span class="w"> </span><span class="n">fstprm</span><span class="p">,</span><span class="w"> </span><span class="n">fstlir</span><span class="p">,</span><span class="w"> </span><span class="n">fnom</span><span class="p">,</span><span class="w"> </span><span class="n">fclos</span><span class="w"></span>
<span class="linenos">3938</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fstouv</span><span class="p">,</span><span class="w"> </span><span class="n">fstfrm</span><span class="p">,</span><span class="w"> </span><span class="n">fstinl</span><span class="p">,</span><span class="w"> </span><span class="n">fstvoi</span><span class="w"></span>
<span class="linenos">3939</span>
<span class="linenos">3940</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">idum1</span><span class="p">,</span><span class="w"> </span><span class="n">idum2</span><span class="p">,</span><span class="w"> </span><span class="n">idum3</span><span class="w"></span>
<span class="linenos">3941</span>
<span class="linenos">3942</span><span class="w">    </span><span class="c">! Allocate space for arrays holding values on mesh grid pts.</span>
<span class="linenos">3943</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">latmesh</span><span class="p">,</span><span class="w"> </span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3944</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">lonmesh</span><span class="p">,</span><span class="w"> </span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3945</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">mgintob</span><span class="p">,</span><span class="w"> </span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3946</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">lgintob</span><span class="p">,</span><span class="w"> </span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3947</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">zlatbox</span><span class="p">,</span><span class="w"> </span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3948</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">zlonbox</span><span class="p">,</span><span class="w"> </span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3949</span>
<span class="linenos">3950</span><span class="w">    </span><span class="c">! Open FST file.</span>
<span class="linenos">3951</span><span class="w">    </span><span class="n">iungeo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">3952</span><span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fnom</span><span class="p">(</span><span class="w"> </span><span class="n">iungeo</span><span class="p">,</span><span class="n">fileMgLg</span><span class="p">,</span><span class="s1">&#39;STD+RND+R/O&#39;</span><span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">3953</span><span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstouv</span><span class="p">(</span><span class="w"> </span><span class="n">iungeo</span><span class="p">,</span><span class="s1">&#39;RND&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">3954</span>
<span class="linenos">3955</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstCall</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3956</span><span class="k">      </span><span class="n">firstCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3957</span>
<span class="linenos">3958</span><span class="w">      </span><span class="c">! Read MG field.</span>
<span class="linenos">3959</span><span class="w">      </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstinf</span><span class="p">(</span><span class="n">iungeo</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="p">,</span><span class="s1">&#39;MG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3960</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3961</span><span class="k">        call </span><span class="n">utl_abort</span><span class="p">(</span><span class="s1">&#39;atmsMwhs2landIceMask: The MG field is MISSING&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3962</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3963</span>
<span class="linenos">3964</span><span class="k">      call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span><span class="w"> </span><span class="n">ni</span><span class="o">*</span><span class="n">nj</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3965</span>
<span class="linenos">3966</span><span class="w">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstlir</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span><span class="n">iungeo</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;MG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3967</span>
<span class="linenos">3968</span><span class="w">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstprm</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">idum1</span><span class="p">,</span><span class="n">idum2</span><span class="p">,</span><span class="n">idum3</span><span class="p">,</span><span class="n">idum4</span><span class="p">,</span><span class="n">idum5</span><span class="p">,</span><span class="n">idum6</span><span class="p">,</span><span class="n">idum7</span><span class="p">,</span><span class="n">idum8</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3969</span><span class="w">                   </span><span class="n">idum9</span><span class="p">,</span><span class="n">idum10</span><span class="p">,</span><span class="n">idum11</span><span class="p">,</span><span class="n">typxx</span><span class="p">,</span><span class="n">nomvxx</span><span class="p">,</span><span class="n">etikxx</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3970</span><span class="w">                   </span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="p">,</span><span class="n">idum12</span><span class="p">,</span><span class="n">idum13</span><span class="p">,</span><span class="n">idum14</span><span class="p">,</span><span class="n">idum15</span><span class="p">,</span><span class="n">idum16</span><span class="p">,</span><span class="n">idum17</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3971</span><span class="w">                   </span><span class="n">idum18</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3972</span>
<span class="linenos">3973</span><span class="w">      </span><span class="c">! Read LG field. Use GL field as backup.</span>
<span class="linenos">3974</span><span class="w">      </span><span class="c">! **CAUTION**: Discontinuities in GL field may cause interpolation problems! LG field is preferable.</span>
<span class="linenos">3975</span><span class="w">      </span><span class="n">llg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3976</span><span class="w">      </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstinf</span><span class="p">(</span><span class="n">iungeo</span><span class="p">,</span><span class="n">nilg</span><span class="p">,</span><span class="n">njlg</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="p">,</span><span class="s1">&#39;LG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3977</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3978</span><span class="k">        </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstinf</span><span class="p">(</span><span class="n">iungeo</span><span class="p">,</span><span class="n">nilg</span><span class="p">,</span><span class="n">njlg</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="p">,</span><span class="s1">&#39;GL&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3979</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3980</span><span class="k">          call </span><span class="n">utl_abort</span><span class="p">(</span><span class="s1">&#39;atmsMwhs2landIceMask: The LG or GL field is MISSING&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3981</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">3982</span><span class="k">      else</span>
<span class="linenos">3983</span><span class="k">        </span><span class="n">llg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">3984</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3985</span>
<span class="linenos">3986</span><span class="k">      call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">lg</span><span class="p">,</span><span class="w"> </span><span class="n">nilg</span><span class="o">*</span><span class="n">njlg</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3987</span>
<span class="linenos">3988</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">llg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">3989</span><span class="k">        </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstlir</span><span class="p">(</span><span class="n">lg</span><span class="p">,</span><span class="n">iungeo</span><span class="p">,</span><span class="n">nilg</span><span class="p">,</span><span class="n">njlg</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;LG&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3990</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">3991</span><span class="k">        </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstlir</span><span class="p">(</span><span class="n">lg</span><span class="p">,</span><span class="n">iungeo</span><span class="p">,</span><span class="n">nilg</span><span class="p">,</span><span class="n">njlg</span><span class="p">,</span><span class="n">nk</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;GL&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3992</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">3993</span>
<span class="linenos">3994</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstprm</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">idum1</span><span class="p">,</span><span class="n">idum2</span><span class="p">,</span><span class="n">idum3</span><span class="p">,</span><span class="n">idum4</span><span class="p">,</span><span class="n">idum5</span><span class="p">,</span><span class="n">idum6</span><span class="p">,</span><span class="n">idum7</span><span class="p">,</span><span class="n">idum8</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3995</span><span class="w">                   </span><span class="n">idum9</span><span class="p">,</span><span class="n">idum10</span><span class="p">,</span><span class="n">idum11</span><span class="p">,</span><span class="n">typxx</span><span class="p">,</span><span class="n">nomvxx</span><span class="p">,</span><span class="n">etikxx</span><span class="p">,</span><span class="n">grtyplg</span><span class="p">,</span><span class="n">ig1lg</span><span class="p">,</span><span class="n">ig2lg</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3996</span><span class="w">                   </span><span class="n">ig3lg</span><span class="p">,</span><span class="n">ig4lg</span><span class="p">,</span><span class="n">idum12</span><span class="p">,</span><span class="n">idum13</span><span class="p">,</span><span class="n">idum14</span><span class="p">,</span><span class="n">idum15</span><span class="p">,</span><span class="n">idum16</span><span class="p">,</span><span class="n">idum17</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">3997</span><span class="w">                   </span><span class="n">idum18</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3998</span>
<span class="linenos">3999</span><span class="w">    </span><span class="k">end if</span><span class="w"> </span><span class="c">! firstCall</span>
<span class="linenos">4000</span>
<span class="linenos">4001</span><span class="w">    </span><span class="c">! For each obs pt, define a grid of artificial pts surrounding it.</span>
<span class="linenos">4002</span><span class="w">    </span><span class="n">nlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mxlat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="linenos">4003</span><span class="w">    </span><span class="n">nlon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mxlon</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="linenos">4004</span>
<span class="linenos">4005</span><span class="w">    </span><span class="n">dlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlat_km</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rkm_per_deg</span><span class="w"></span>
<span class="linenos">4006</span><span class="w">    </span><span class="n">indx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4007</span>
<span class="linenos">4008</span><span class="w">    </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">nlat</span><span class="p">,</span><span class="w"> </span><span class="n">nlat</span><span class="w"></span>
<span class="linenos">4009</span><span class="w">      </span><span class="n">rii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">float</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4010</span><span class="w">      </span><span class="n">xlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rii</span><span class="o">*</span><span class="n">dlat</span><span class="w"></span>
<span class="linenos">4011</span><span class="w">      </span><span class="n">xlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="mi">9</span><span class="mf">0.0</span><span class="p">,</span><span class="n">xlat</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">4012</span><span class="w">      </span><span class="n">xlatrad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlat</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4013</span>
<span class="linenos">4014</span><span class="w">      </span><span class="k">do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">nlon</span><span class="p">,</span><span class="w"> </span><span class="n">nlon</span><span class="w"></span>
<span class="linenos">4015</span><span class="w">        </span><span class="n">dlon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlon_km</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rkm_per_deg</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">xlatrad</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">4016</span><span class="w">        </span><span class="n">rjj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">float</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4017</span><span class="w">        </span><span class="n">indx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4018</span><span class="w">        </span><span class="n">xlon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rjj</span><span class="o">*</span><span class="n">dlon</span><span class="w"></span>
<span class="linenos">4019</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">18</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">4020</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="mi">18</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">4021</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">&lt;</span><span class="w">    </span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">4022</span><span class="w">        </span><span class="n">zlatbox</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlat</span><span class="w"></span>
<span class="linenos">4023</span><span class="w">        </span><span class="n">zlonbox</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlon</span><span class="w"></span>
<span class="linenos">4024</span><span class="w">      </span><span class="k">end do</span>
<span class="linenos">4025</span>
<span class="linenos">4026</span><span class="k">    end do</span><span class="w"></span>
<span class="linenos">4027</span>
<span class="linenos">4028</span><span class="w">    </span><span class="c">! Interpolate values from MG and LG field to grid pts of mesh centred over each obs pt.</span>
<span class="linenos">4029</span><span class="w">    </span><span class="c">! Determine for each obs pt, the max interpolated MG and LG value within the box</span>
<span class="linenos">4030</span><span class="w">    </span><span class="c">! surrounding it.</span>
<span class="linenos">4031</span><span class="w">    </span><span class="n">ier</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ezsetopt</span><span class="p">(</span><span class="s1">&#39;INTERP_DEGREE&#39;</span><span class="p">,</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4032</span><span class="w">    </span><span class="n">gdid</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ezqkdef</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">grtyp</span><span class="p">,</span><span class="n">ig1</span><span class="p">,</span><span class="n">ig2</span><span class="p">,</span><span class="n">ig3</span><span class="p">,</span><span class="n">ig4</span><span class="p">,</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4033</span><span class="w">    </span><span class="n">gdidlg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ezqkdef</span><span class="p">(</span><span class="n">nilg</span><span class="p">,</span><span class="n">njlg</span><span class="p">,</span><span class="n">grtyplg</span><span class="p">,</span><span class="n">ig1lg</span><span class="p">,</span><span class="n">ig2lg</span><span class="p">,</span><span class="n">ig3lg</span><span class="p">,</span><span class="n">ig4lg</span><span class="p">,</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4034</span>
<span class="linenos">4035</span><span class="w">    </span><span class="n">mgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4036</span><span class="w">    </span><span class="n">lgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4037</span>
<span class="linenos">4038</span><span class="w">    </span><span class="n">latmesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zlatbox</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4039</span><span class="w">    </span><span class="n">lonmesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zlonbox</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4040</span>
<span class="linenos">4041</span><span class="w">    </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">(</span><span class="n">gdid</span><span class="p">,</span><span class="n">mgintob</span><span class="p">,</span><span class="n">mg</span><span class="p">,</span><span class="n">latmesh</span><span class="p">,</span><span class="n">lonmesh</span><span class="p">,</span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4042</span><span class="w">    </span><span class="n">ier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">gdllsval</span><span class="p">(</span><span class="n">gdidlg</span><span class="p">,</span><span class="n">lgintob</span><span class="p">,</span><span class="n">lg</span><span class="p">,</span><span class="n">latmesh</span><span class="p">,</span><span class="n">lonmesh</span><span class="p">,</span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4043</span>
<span class="linenos">4044</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4045</span><span class="k">      </span><span class="n">mgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">maxval</span><span class="p">(</span><span class="n">mgintob</span><span class="p">(:))</span><span class="w"></span>
<span class="linenos">4046</span><span class="w">      </span><span class="n">lgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">maxval</span><span class="p">(</span><span class="n">lgintob</span><span class="p">(:))</span><span class="w"></span>
<span class="linenos">4047</span><span class="w">    </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4048</span><span class="k">      </span><span class="n">mgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mgintob</span><span class="p">(</span><span class="n">ii_obsloc</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4049</span><span class="w">      </span><span class="n">lgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lgintob</span><span class="p">(</span><span class="n">ii_obsloc</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4050</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">4051</span><span class="k">      </span><span class="n">mgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">mgintob</span><span class="p">(:))</span><span class="o">/</span><span class="kt">real</span><span class="p">((</span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4052</span><span class="w">      </span><span class="n">lgintrp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">lgintob</span><span class="p">(:))</span><span class="o">/</span><span class="kt">real</span><span class="p">((</span><span class="n">mxlat</span><span class="o">*</span><span class="n">mxlon</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4053</span><span class="w">    </span><span class="k">end if</span><span class="w">      </span>
<span class="linenos">4054</span>
<span class="linenos">4055</span><span class="w">    </span><span class="c">!  Initialize all obs as being over land and free of ice or snow.</span>
<span class="linenos">4056</span><span class="w">    </span><span class="c">!  Determine which obs are over open water.</span>
<span class="linenos">4057</span><span class="w">    </span><span class="n">waterobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w">   </span><span class="c">! not over open water</span>
<span class="linenos">4058</span><span class="w">    </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w">             </span><span class="c">! no ice (reset terain type)</span>
<span class="linenos">4059</span><span class="w">    </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c">! land   (reset land/sea qualifier)</span>
<span class="linenos">4060</span>
<span class="linenos">4061</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mgintrp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MGthresh</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">! ocean point away from coast</span>
<span class="linenos">4062</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lgintrp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">LGthresh</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c">! sea-ice affected point</span>
<span class="linenos">4063</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lgintrp</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LGthresh</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4064</span><span class="k">      </span><span class="n">waterobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">  </span><span class="c">! water point not in close proximity to land or sea-ice</span>
<span class="linenos">4065</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4066</span>
<span class="linenos">4067</span><span class="k">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fstfrm</span><span class="p">(</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4068</span><span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fclos</span><span class="p">(</span><span class="n">iungeo</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4069</span>
<span class="linenos">4070</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">atmsMwhs2landIceMask</span><span class="w"></span>
<span class="linenos">4071</span>
<span class="linenos">4072</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4073</span><span class="w">  </span><span class="c">! mwbg_computeMwhs2SurfaceType</span>
<span class="linenos">4074</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4075</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_computeMwhs2SurfaceType</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4076</span><span class="w">    </span><span class="c">!:Purpose: Compute surface type element and update obsSpaceData.</span>
<span class="linenos">4077</span>
<span class="linenos">4078</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">4079</span>
<span class="linenos">4080</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">4081</span><span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">struct_obs</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="w">  </span><span class="c">! ObsSpaceData object</span>
<span class="linenos">4082</span><span class="w">    </span><span class="c">! Locals:</span>
<span class="linenos">4083</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">   </span><span class="c">! OPTION for values of MG (land/sea mask) and LG (ice) </span>
<span class="linenos">4084</span><span class="w">                                        </span><span class="c">! at each observation point using values on 5x5 mesh </span>
<span class="linenos">4085</span><span class="w">                                        </span><span class="c">! centered at each point.</span>
<span class="linenos">4086</span><span class="w">                                        </span><span class="c">! ilsmOpt = 1 --&gt; use MAX value from all 25 mesh points</span>
<span class="linenos">4087</span><span class="w">                                        </span><span class="c">! ilsmOpt = 2 --&gt; use value at central mesh point (obs location)</span>
<span class="linenos">4088</span><span class="w">                                        </span><span class="c">! ilsmOpt = 3 --&gt; use AVG value from all 25 mesh points</span>
<span class="linenos">4089</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">codtyp</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"></span>
<span class="linenos">4090</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">mwhs2DataPresent</span><span class="w"></span>
<span class="linenos">4091</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4092</span>
<span class="linenos">4093</span><span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;ssbg_computeMwhs2SurfaceType: Starting&#39;</span><span class="w"></span>
<span class="linenos">4094</span>
<span class="linenos">4095</span><span class="w">    </span><span class="n">mwhs2DataPresent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4096</span><span class="w">    </span><span class="k">call </span><span class="n">obs_set_current_header_list</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="s1">&#39;TO&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4097</span>
<span class="linenos">4098</span><span class="w">    </span><span class="n">HEADER0</span><span class="p">:</span><span class="w"> </span><span class="k">do</span>
<span class="linenos">4099</span><span class="k">      </span><span class="n">headerIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_getHeaderIndex</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4100</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">headerIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">HEADER0</span><span class="w"></span>
<span class="linenos">4101</span><span class="w">      </span><span class="n">codtyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ITY</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4102</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;mwhs2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4103</span><span class="k">        </span><span class="n">mwhs2DataPresent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4104</span><span class="w">        </span><span class="k">exit </span><span class="n">HEADER0</span><span class="w"></span>
<span class="linenos">4105</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4106</span><span class="k">    end do </span><span class="n">HEADER0</span><span class="w"></span>
<span class="linenos">4107</span>
<span class="linenos">4108</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">mwhs2DataPresent</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4109</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: WILL NOT RUN ssbg_computeMwhs2SurfaceType since no MWHS2 DATA is found&#39;</span><span class="w"></span>
<span class="linenos">4110</span><span class="w">      </span><span class="k">return</span>
<span class="linenos">4111</span><span class="k">    end if</span>
<span class="linenos">4112</span>
<span class="linenos">4113</span><span class="k">    call </span><span class="n">mwbg_init</span><span class="p">()</span><span class="w"></span>
<span class="linenos">4114</span>
<span class="linenos">4115</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">modLSQ</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4116</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: WILL NOT RUN ssbg_computeMwhs2SurfaceType since MODLSQ is not activated&#39;</span><span class="w"></span>
<span class="linenos">4117</span><span class="w">      </span><span class="k">return</span>
<span class="linenos">4118</span><span class="k">    end if</span>
<span class="linenos">4119</span>
<span class="linenos">4120</span><span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;MWHS2 data found and modLSQ option activated!&#39;</span><span class="w"></span>
<span class="linenos">4121</span><span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;--&gt;  Output file will contain recomputed values for land/sea qualifier and terrain type based on LG/MG.&#39;</span><span class="w"></span>
<span class="linenos">4122</span>
<span class="linenos">4123</span><span class="w">    </span><span class="k">call </span><span class="n">obs_set_current_header_list</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="s1">&#39;TO&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4124</span><span class="w">    </span><span class="n">HEADER1</span><span class="p">:</span><span class="w"> </span><span class="k">do</span>
<span class="linenos">4125</span><span class="k">      </span><span class="n">headerIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_getHeaderIndex</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4126</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">headerIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">HEADER1</span><span class="w"></span>
<span class="linenos">4127</span><span class="w">      </span><span class="n">obsLat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_r</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_LAT</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">4128</span><span class="w">      </span><span class="n">obsLat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MPC_DEGREES_PER_RADIAN_R8</span><span class="w"></span>
<span class="linenos">4129</span><span class="w">      </span><span class="n">obsLon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_r</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_LON</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">4130</span><span class="w">      </span><span class="n">obsLon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MPC_DEGREES_PER_RADIAN_R8</span><span class="w"></span>
<span class="linenos">4131</span><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">4132</span><span class="w">      </span><span class="k">call </span><span class="n">atmsMwhs2landIceMask</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4133</span><span class="w">                                </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">ilsmOpt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4134</span><span class="w">      </span><span class="k">call </span><span class="n">obs_headSet_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_STYP</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4135</span><span class="w">      </span><span class="k">call </span><span class="n">obs_headSet_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_TTYP</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4136</span>
<span class="linenos">4137</span><span class="w">    </span><span class="k">end do </span><span class="n">HEADER1</span><span class="w"></span>
<span class="linenos">4138</span>
<span class="linenos">4139</span><span class="w">    </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;ssbg_computeMwhs2SurfaceType: Finished&#39;</span><span class="w"></span>
<span class="linenos">4140</span>
<span class="linenos">4141</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_computeMwhs2SurfaceType</span><span class="w"></span>
<span class="linenos">4142</span>
<span class="linenos">4143</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4144</span><span class="w">  </span><span class="c">! mwbg_grossValueCheck  </span>
<span class="linenos">4145</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4146</span>
<span class="linenos">4147</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_grossValueCheck</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ztbThresholdMin</span><span class="p">,</span><span class="w"> </span><span class="n">ztbThresholdMax</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4148</span>
<span class="linenos">4149</span><span class="w">    </span><span class="c">!:Purpose: Check Tbs for values that are missing or outside physical limits.</span>
<span class="linenos">4150</span><span class="w">    </span><span class="c">!          **NOTE: REJECT ALL CHANNELS OF ONE IS FOUND TO BE BAD.</span>
<span class="linenos">4151</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">4152</span>
<span class="linenos">4153</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">4154</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"> </span><span class="c">! number of ichannels</span>
<span class="linenos">4155</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">         </span><span class="c">! radiances</span>
<span class="linenos">4156</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w"> </span><span class="c">! Bias correction</span>
<span class="linenos">4157</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ztbThresholdMin</span><span class="w">  </span><span class="c">! ztb threshold for rejection</span>
<span class="linenos">4158</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ztbThresholdMax</span><span class="w">  </span><span class="c">! ztb threshold for rejection</span>
<span class="linenos">4159</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grossrej</span><span class="w">         </span><span class="c">! logical array defining which obs are to be rejected</span>
<span class="linenos">4160</span>
<span class="linenos">4161</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">4162</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channel</span><span class="w"></span>
<span class="linenos">4163</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ztb</span><span class="p">(:)</span><span class="w"> </span><span class="c">! biased or unbiased radiances</span>
<span class="linenos">4164</span>
<span class="linenos">4165</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">ztb</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4166</span><span class="w">    </span>
<span class="linenos">4167</span><span class="w">    </span><span class="n">grossrej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4168</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4169</span><span class="k">      do </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4170</span><span class="w">        </span><span class="n">ztb</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4171</span><span class="w">      </span><span class="k">end do</span>
<span class="linenos">4172</span><span class="k">    else</span>
<span class="linenos">4173</span><span class="k">      do </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4174</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4175</span><span class="k">          </span><span class="n">ztb</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4176</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">4177</span><span class="k">          </span><span class="n">ztb</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4178</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">4179</span><span class="k">      end do</span>
<span class="linenos">4180</span><span class="k">    end if</span>
<span class="linenos">4181</span>
<span class="linenos">4182</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="k">all</span><span class="p">(</span><span class="n">ztb</span><span class="p">(:)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">ztbThresholdMin</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="k">all</span><span class="p">(</span><span class="n">ztb</span><span class="p">(:)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ztbThresholdMax</span><span class="p">))</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4183</span>
<span class="linenos">4184</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_grossValueCheck</span><span class="w"></span>
<span class="linenos">4185</span>
<span class="linenos">4186</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4187</span><span class="w">  </span><span class="c">! mwbg_firstQcCheckAtms</span>
<span class="linenos">4188</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4189</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_firstQcCheckAtms</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4190</span><span class="w">                                   </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4191</span><span class="w">                                   </span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4192</span><span class="w">    </span><span class="c">!  :Purpose: This routine performs basic quality control checks on the data. It sets array</span>
<span class="linenos">4193</span><span class="w">    </span><span class="c">!            qcRejectLogic(actualNumChannel) elements to .true. to flag data with failed checks.</span>
<span class="linenos">4194</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4195</span><span class="w">    </span><span class="c">!  The 6 QC checks are:</span>
<span class="linenos">4196</span><span class="w">    </span><span class="c">!                 - 1) Invalid land/sea qualifier or terrain type,</span>
<span class="linenos">4197</span><span class="w">    </span><span class="c">!                 - 2) Invalid field of view number,</span>
<span class="linenos">4198</span><span class="w">    </span><span class="c">!                 - 3) Satellite zenith angle missing or out of range, (&gt; 75 deg),</span>
<span class="linenos">4199</span><span class="w">    </span><span class="c">!                 - 4) lat,lon check (lat,lon = O(-90.), 0(-180.))</span>
<span class="linenos">4200</span><span class="w">    </span><span class="c">!                 - 5) Change in (computed) calcLandQualifierIndice,calcTerrainTypeIndice from (input) </span>
<span class="linenos">4201</span><span class="w">    </span><span class="c">!                      landQualifierIndice,terrainTypeIndice (from MG,LG fields).</span>
<span class="linenos">4202</span><span class="w">    </span><span class="c">!                      landQualifierIndice= 0,1 (from hi-res land/sea mask interpolated to obs point [CMDA])</span>
<span class="linenos">4203</span><span class="w">    </span><span class="c">!                      terrainTypeIndice=-1,0 (from hi-res ice analysis  interpolated to obs point [CMDA])</span>
<span class="linenos">4204</span><span class="w">    </span><span class="c">!                      calcLandQualifierIndice= 0,1 (from max interp MG (0.0 to 1.0) in box surrounding obs point)</span>
<span class="linenos">4205</span><span class="w">    </span><span class="c">!                      calcTerrainTypeIndice=-1,0 (from max interp LG (0.0 to 1.0) in box surrounding obs point)</span>
<span class="linenos">4206</span><span class="w">    </span><span class="c">!                 - 6) ATMS quality flag check (qual. flag elements 33078,33079,33080,33081)</span>
<span class="linenos">4207</span>
<span class="linenos">4208</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4209</span><span class="w">    </span><span class="c">!  In most cases, qcRejectLogic(actualNumChannel) is set to .true. for all channels at point ii</span>
<span class="linenos">4210</span><span class="w">    </span><span class="c">!  if the check detects a problem. In addition, Tb (obsTb) is set to missing_value</span>
<span class="linenos">4211</span><span class="w">    </span><span class="c">!  for checks 3 and 4 fails.</span>
<span class="linenos">4212</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">4213</span>
<span class="linenos">4214</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">4215</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos">4216</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos">4217</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"></span>
<span class="linenos">4218</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4219</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4220</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4221</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4222</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">4223</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"></span>
<span class="linenos">4224</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grossrej</span><span class="w">        </span><span class="c">! true if 1 or more Tb fail gross error check</span>
<span class="linenos">4225</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">4226</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4227</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4228</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos">4229</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="c">! true if Tb(obsTb) are set to missing_value</span>
<span class="linenos">4230</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="c">! dim(actualNumChannel) qcRejectLogic = .false. on input</span>
<span class="linenos">4231</span>
<span class="linenos">4232</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">4233</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">indx1</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="w"></span>
<span class="linenos">4234</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fail</span><span class="p">,</span><span class="w"> </span><span class="n">fail1</span><span class="p">,</span><span class="w"> </span><span class="n">fail2</span><span class="w"></span>
<span class="linenos">4235</span>
<span class="linenos">4236</span><span class="w">    </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4237</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4238</span><span class="w">    </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w">  </span><span class="c">! Flag for preliminary QC checks</span>
<span class="linenos">4239</span><span class="w">    </span><span class="c">! Global rejection checks</span>
<span class="linenos">4240</span>
<span class="linenos">4241</span><span class="w">    </span><span class="c">! Check if number of channels is correct</span>
<span class="linenos">4242</span><span class="w">    </span><span class="c">!if ( actualNumChannel /= mwbg_maxNumChan ) then</span>
<span class="linenos">4243</span><span class="w">    </span><span class="c">!  write(*,*) &#39;WARNING: Number of channels (&#39;,actualNumChannel, &#39;) is not equal to mwbg_maxNumChan (&#39;, mwbg_maxNumChan,&#39;)&#39;</span>
<span class="linenos">4244</span><span class="w">    </span><span class="c">!  write(*,*) &#39;         All data flagged as bad and returning to calling routine!&#39;</span>
<span class="linenos">4245</span><span class="w">    </span><span class="c">!  qcRejectLogic(:) = .true.  ! flag all data in report as bad</span>
<span class="linenos">4246</span><span class="w">    </span><span class="c">!  return</span>
<span class="linenos">4247</span><span class="w">    </span><span class="c">!end if</span>
<span class="linenos">4248</span>
<span class="linenos">4249</span><span class="w">    </span><span class="c">! Check for errors in channel numbers (should be 1-22 for each location ii)</span>
<span class="linenos">4250</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4251</span><span class="w">    </span><span class="k">do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4252</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4253</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">4254</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4255</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Bad channel number(s) detected!&#39;</span><span class="w"></span>
<span class="linenos">4256</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;         All data flagged as bad and returning to calling routine!&#39;</span><span class="w"></span>
<span class="linenos">4257</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  obsChannels(actualNumChannel) array = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4258</span><span class="w">      </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">  </span><span class="c">! flag all data in report as bad</span>
<span class="linenos">4259</span><span class="w">      </span><span class="k">return</span>
<span class="linenos">4260</span><span class="k">    end if</span><span class="w"></span>
<span class="linenos">4261</span>
<span class="linenos">4262</span><span class="w">    </span><span class="c">! 1) invalid land/sea qualifier or terrain type</span>
<span class="linenos">4263</span><span class="w">    </span><span class="c">!  landQualifierIndice = 0 (land),     1 (sea)</span>
<span class="linenos">4264</span><span class="w">    </span><span class="c">!  terrainTypeIndice = 0 (sea-ice), -1 otherwise</span>
<span class="linenos">4265</span><span class="w">    </span><span class="c">!  calcLandQualifierIndice = 1 (sea, away from land/coast [MG]),      0 otherwise</span>
<span class="linenos">4266</span><span class="w">    </span><span class="c">!  calcTerrainTypeIndice = 0 (over or near analyzed sea-ice [LG]), -1 otherwise</span>
<span class="linenos">4267</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4268</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4269</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4270</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4271</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Invalid land/sea qualifier or terrain type!&#39;</span><span class="w"></span>
<span class="linenos">4272</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  landQualifierIndice, terrainTypeIndice, (lat, lon) = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="w"></span>
<span class="linenos">4273</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4274</span>
<span class="linenos">4275</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4276</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4277</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Sea ice point (terrainTypeIndice=0) at land point (landQualifierIndice=0)!&#39;</span><span class="w"></span>
<span class="linenos">4278</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; lat, lon =  &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4279</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4280</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4281</span>
<span class="linenos">4282</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4283</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4284</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4285</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4286</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Invalid model-based (MG/LG) land/sea qualifier or terrain type!&#39;</span><span class="w"></span>
<span class="linenos">4287</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  calcLandQualifierIndice, calcTerrainTypeIndice, (lat, lon) = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4288</span><span class="w">                  </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="w"></span>
<span class="linenos">4289</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4290</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4291</span>
<span class="linenos">4292</span><span class="w">    </span><span class="c">! 2) invalid field of view number</span>
<span class="linenos">4293</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4294</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_maxScanAngle</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4295</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4296</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Invalid field of view! satScanPosition, lat, lon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4297</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4298</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4299</span>
<span class="linenos">4300</span><span class="w">    </span><span class="c">! 3) satellite zenith angle missing or out of range (&gt; 75 deg)</span>
<span class="linenos">4301</span><span class="w">    </span><span class="c">!  If bad zenith, then set Tb (and zenith) = missing value</span>
<span class="linenos">4302</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4303</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4304</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">7</span><span class="mf">5.0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4305</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4306</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Bad or missing zenith angle! zenith, lat, lon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4307</span><span class="w">      </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4308</span><span class="w">      </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4309</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4310</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4311</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4312</span><span class="k">        </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4313</span><span class="w">        </span><span class="n">obsTb</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4314</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4315</span><span class="k">    end do</span><span class="w"></span>
<span class="linenos">4316</span>
<span class="linenos">4317</span><span class="w">    </span><span class="c">! 4) Lat,lon check</span>
<span class="linenos">4318</span><span class="w">    </span><span class="c">! Check for undecoded BURP file integer values of lat,lon = 0,0</span>
<span class="linenos">4319</span><span class="w">    </span><span class="c">! (usually associated with missing zenith angle and erroneous Tb=330K)</span>
<span class="linenos">4320</span>
<span class="linenos">4321</span><span class="w">    </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4322</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4323</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.0</span><span class="w">  </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">18</span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4324</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4325</span><span class="w">      </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4326</span><span class="w">      </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4327</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4328</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4329</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4330</span><span class="k">        </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4331</span><span class="w">        </span><span class="n">obsTb</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4332</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4333</span><span class="k">    end do</span>
<span class="linenos">4334</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Bad lat,lon pair(s) detected. Number of locations = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="w"></span>
<span class="linenos">4335</span>
<span class="linenos">4336</span><span class="w">    </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4337</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4338</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.0</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLon</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4339</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4340</span><span class="w">      </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4341</span><span class="w">      </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4342</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4343</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4344</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4345</span><span class="k">        </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4346</span><span class="w">        </span><span class="n">obsTb</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4347</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4348</span><span class="k">    end do</span>
<span class="linenos">4349</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Lat or lon out of range! Number of locations = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="w"></span>
<span class="linenos">4350</span>
<span class="linenos">4351</span><span class="w">    </span><span class="c">!  5) Change in land/sea qualifier or terrain-type based on MG,LG fields</span>
<span class="linenos">4352</span><span class="w">    </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4353</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4354</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4355</span><span class="w">          </span><span class="p">(</span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4356</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4357</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4358</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4359</span>
<span class="linenos">4360</span><span class="w">    </span><span class="c">! 6) ATMS quality flag check (qual. flag elements 33078,33079,33080,33081)</span>
<span class="linenos">4361</span>
<span class="linenos">4362</span><span class="w">    </span><span class="c">!  33078 Geolocation quality code     obsQcFlag1(1)  code value = 0-15 (0= OK, 15=misg)</span>
<span class="linenos">4363</span><span class="w">    </span><span class="c">!  33079 Granule level quality flags  obsQcFlag1(2)  16 bit flag  (start bit 6(2^5)=32) (misg=2^16-1 = 65535)</span>
<span class="linenos">4364</span><span class="w">    </span><span class="c">!  33080 Scan level quality flags     obsQcFlag1(3)  20 bit flag  (start bit 7(2^6)=64) (misg=2^20-1) </span>
<span class="linenos">4365</span><span class="w">    </span><span class="c">!  33081 Channel data quality flags   obsQcFlag2        12 bit flag  (start bit 3(2^2)=4)  (misg=2^12-1)</span>
<span class="linenos">4366</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4367</span><span class="w">    </span><span class="c">!  See http://www.wmo.int/pages/prog/www/WMOCodes/WMO306_vI2/2010edition/BUFRver16/BUFR_16_0_0_TableD.pdf</span>
<span class="linenos">4368</span>
<span class="linenos">4369</span><span class="w">    </span><span class="n">fail1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4370</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4371</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4372</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: INFO BLOCK QC flag(s) indicate problem with data&#39;</span><span class="w"></span>
<span class="linenos">4373</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ele33078 = &#39;</span><span class="p">,</span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39; ele33079 = &#39;</span><span class="p">,</span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39; ele33080 = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4374</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; lat, lon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4375</span><span class="w">      </span><span class="n">fail1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4376</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; NOTE: grossrej is also true for this point!&#39;</span><span class="w"></span>
<span class="linenos">4377</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4378</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4379</span><span class="w">      </span><span class="n">fail2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4380</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="linenos">4381</span><span class="w">        </span><span class="c">!write(*,*) &#39;WARNING: DATA BLOCK QC flag ele33081 = &#39;, obsQcFlag2(jj)</span>
<span class="linenos">4382</span><span class="w">        </span><span class="c">!write(*,*) &#39;    Lat, lon, channel = &#39;, obsLat, obsLon, obsChannels(jj)</span>
<span class="linenos">4383</span><span class="w">        </span><span class="n">fail2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4384</span><span class="w">        </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4385</span><span class="w">        </span><span class="c">!if ( (.not. fail1) .and. grossrej ) write(*,*) &#39; NOTE: grossrej is also true for this point!&#39;</span>
<span class="linenos">4386</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4387</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">fail1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4388</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">4389</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: DATA BLOCK QC flag ele33081 &gt;= 4 for one or more channels! lat, lon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4390</span>
<span class="linenos">4391</span><span class="w">    </span><span class="c">!write(*,*) &#39;mwbg_firstQcCheckAtms: Number of data processed and flagged = &#39;, &amp;</span>
<span class="linenos">4392</span><span class="w">    </span><span class="c">!           actualNumChannel, count(qcRejectLogic)</span>
<span class="linenos">4393</span>
<span class="linenos">4394</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_firstQcCheckAtms</span><span class="w"></span>
<span class="linenos">4395</span>
<span class="linenos">4396</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4397</span><span class="w">  </span><span class="c">! mwbg_firstQcCheckMwhs2</span>
<span class="linenos">4398</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4399</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_firstQcCheckMwhs2</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4400</span><span class="w">                                    </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4401</span><span class="w">                                    </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="p">,</span><span class="w"> </span><span class="n">modLSQ</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4402</span><span class="w">    </span><span class="c">!  :Purpose: This routine performs basic quality control checks on the data. It sets array</span>
<span class="linenos">4403</span><span class="w">    </span><span class="c">!            qcRejectLogic(actualNumChannel) elements to .true. to flag data with failed checks. Check 1</span>
<span class="linenos">4404</span><span class="w">    </span><span class="c">!            (for landQualifierIndice,terrainTypeIndice) and check 5 are skipped if modlsqtt=.true., </span>
<span class="linenos">4405</span><span class="w">    </span><span class="c">!            as the original values will be replaced in output file by calcLandQualifierIndice,calcTerrainTypeIndice.</span>
<span class="linenos">4406</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4407</span><span class="w">    </span><span class="c">!  The 5 QC checks are:</span>
<span class="linenos">4408</span><span class="w">    </span><span class="c">!                 - 1) Invalid land/sea qualifier or terrain type,</span>
<span class="linenos">4409</span><span class="w">    </span><span class="c">!                 - 2) Invalid field of view number,</span>
<span class="linenos">4410</span><span class="w">    </span><span class="c">!                 - 3) Satellite zenith angle missing or out of range, (&gt; 75 deg),</span>
<span class="linenos">4411</span><span class="w">    </span><span class="c">!                 - 4) lat,lon check (lat,lon = O(-90.), 0(-180.))</span>
<span class="linenos">4412</span><span class="w">    </span><span class="c">!                 - 5) Change in (computed) calcLandQualifierIndice,calcTerrainTypeIndice </span>
<span class="linenos">4413</span><span class="w">    </span><span class="c">!                      from (input) landQualifierIndice,terrainTypeIndice (from MG,LG fields).</span>
<span class="linenos">4414</span><span class="w">    </span><span class="c">!                      landQualifierIndice= 0,1 (from hi-res land/sea mask interpolated to obs point [CMDA])</span>
<span class="linenos">4415</span><span class="w">    </span><span class="c">!                      terrainTypeIndice=-1,0 (from hi-res ice analysis  interpolated to obs point [CMDA])</span>
<span class="linenos">4416</span><span class="w">    </span><span class="c">!                      calcLandQualifierIndice= 0,1 (from max interp MG (0.0 to 1.0) in box surrounding obs point)</span>
<span class="linenos">4417</span><span class="w">    </span><span class="c">!                      calcTerrainTypeIndice=-1,0 (from max interp LG (0.0 to 1.0) in box surrounding obs point)</span>
<span class="linenos">4418</span>
<span class="linenos">4419</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4420</span><span class="w">    </span><span class="c">!  In most cases, qcRejectLogic(ii,actualNumChannel) is set to .true. for all channels at point ii</span>
<span class="linenos">4421</span><span class="w">    </span><span class="c">!  if the check detects a problem. In addition, Tb (obsTb) is set to missing_value</span>
<span class="linenos">4422</span><span class="w">    </span><span class="c">!  for checks 3 and 4 fails.</span>
<span class="linenos">4423</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">4424</span>
<span class="linenos">4425</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">4426</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"></span>
<span class="linenos">4427</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"></span>
<span class="linenos">4428</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"></span>
<span class="linenos">4429</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4430</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4431</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">4432</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"></span>
<span class="linenos">4433</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">4434</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4435</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">            </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4436</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">            </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos">4437</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="c">! true if Tb(obsTb) are set to missing_value</span>
<span class="linenos">4438</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">modLSQ</span><span class="w"></span>
<span class="linenos">4439</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="c">! dim(actualNumChannel)</span>
<span class="linenos">4440</span><span class="w">                                                          </span><span class="c">! qcRejectLogic = .false. on input</span>
<span class="linenos">4441</span>
<span class="linenos">4442</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">4443</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="w"></span>
<span class="linenos">4444</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fail</span><span class="w"></span>
<span class="linenos">4445</span>
<span class="linenos">4446</span><span class="w">    </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4447</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4448</span><span class="w">    </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w">  </span><span class="c">! Flag for preliminary QC checks</span>
<span class="linenos">4449</span><span class="w">    </span><span class="c">! Global rejection checks</span>
<span class="linenos">4450</span>
<span class="linenos">4451</span><span class="w">    </span><span class="c">! Check if number of channels is correct</span>
<span class="linenos">4452</span><span class="w">    </span><span class="c">!if ( actualNumChannel /= mwbg_maxNumChan ) then</span>
<span class="linenos">4453</span><span class="w">    </span><span class="c">!  write(*,*) &#39;WARNING: Number of channels (&#39;,actualNumChannel, &#39;) is not equal to mwbg_maxNumChan (&#39;, mwbg_maxNumChan,&#39;)&#39;</span>
<span class="linenos">4454</span><span class="w">    </span><span class="c">!  write(*,*) &#39;         All data flagged as bad and returning to calling routine!&#39;</span>
<span class="linenos">4455</span><span class="w">    </span><span class="c">!  qcRejectLogic(:) = .true.  ! flag all data in report as bad</span>
<span class="linenos">4456</span><span class="w">    </span><span class="c">!  return</span>
<span class="linenos">4457</span><span class="w">    </span><span class="c">!end if</span>
<span class="linenos">4458</span>
<span class="linenos">4459</span><span class="w">    </span><span class="c">! Check for errors in channel numbers (should be 1-15 for each location ii)</span>
<span class="linenos">4460</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4461</span><span class="w">    </span><span class="k">do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4462</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4463</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">4464</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4465</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Bad channel number(s) detected!&#39;</span><span class="w"></span>
<span class="linenos">4466</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;         All data flagged as bad and returning to calling routine!&#39;</span><span class="w"></span>
<span class="linenos">4467</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  obsChannels(actualNumChannel) array = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4468</span><span class="w">      </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">  </span><span class="c">! flag all data in report as bad</span>
<span class="linenos">4469</span><span class="w">      </span><span class="k">return</span>
<span class="linenos">4470</span><span class="k">    end if</span><span class="w"></span>
<span class="linenos">4471</span>
<span class="linenos">4472</span><span class="w">    </span><span class="c">! 1) invalid land/sea qualifier or terrain type</span>
<span class="linenos">4473</span><span class="w">    </span><span class="c">!  landQualifierIndice = 0 (land),     1 (sea)</span>
<span class="linenos">4474</span><span class="w">    </span><span class="c">!  terrainTypeIndice = 0 (sea-ice), -1 otherwise</span>
<span class="linenos">4475</span><span class="w">    </span><span class="c">!  calcLandQualifierIndice = 1 (sea, away from land/coast [MG]),      0 otherwise</span>
<span class="linenos">4476</span><span class="w">    </span><span class="c">!  calcTerrainTypeIndice = 0 (over or near analyzed sea-ice [LG]), -1 otherwise</span>
<span class="linenos">4477</span>
<span class="linenos">4478</span><span class="w">    </span><span class="c">! Checks on landQualifierIndice,terrainTypeIndice are not done if values are to be replaced in output file.</span>
<span class="linenos">4479</span>
<span class="linenos">4480</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">modLSQ</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4481</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4482</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4483</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4484</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4485</span><span class="k">        write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Invalid land/sea qualifier or terrain type!&#39;</span><span class="w"></span>
<span class="linenos">4486</span><span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  landQualifierIndice, terrainTypeIndice, (lat, lon) = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4487</span><span class="w">                    </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="w"></span>
<span class="linenos">4488</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4489</span>
<span class="linenos">4490</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4491</span><span class="k">        </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4492</span><span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Sea ice point (terrainTypeIndice=0) at land point (landQualifierIndice=0)!&#39;</span><span class="w"></span>
<span class="linenos">4493</span><span class="w">        </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; lat, lon =  &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4494</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4495</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4496</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4497</span>
<span class="linenos">4498</span><span class="k">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4499</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4500</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4501</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4502</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Invalid model-based (MG/LG) land/sea qualifier or terrain type!&#39;</span><span class="w"></span>
<span class="linenos">4503</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  calcLandQualifierIndice, calcTerrainTypeIndice, (lat, lon) = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4504</span><span class="w">                  </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="w"></span>
<span class="linenos">4505</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4506</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4507</span>
<span class="linenos">4508</span><span class="w">    </span><span class="c">! 2) invalid field of view number</span>
<span class="linenos">4509</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4510</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_maxScanAngle</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4511</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4512</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Invalid field of view! satScanPosition, lat, lon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4513</span><span class="w">                  </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4514</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4515</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4516</span>
<span class="linenos">4517</span><span class="w">    </span><span class="c">! 3) satellite zenith angle missing or out of range (&gt; 75 deg)</span>
<span class="linenos">4518</span><span class="w">    </span><span class="c">!  If bad zenith, then set Tb (and zenith) = missing value</span>
<span class="linenos">4519</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4520</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">7</span><span class="mf">5.0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4521</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4522</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Bad or missing zenith angle! zenith, lat, lon = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4523</span><span class="w">                  </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="w"></span>
<span class="linenos">4524</span><span class="w">      </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4525</span><span class="w">      </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4526</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4527</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4528</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4529</span><span class="k">        </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4530</span><span class="w">        </span><span class="n">obsTb</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4531</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4532</span><span class="k">    end do</span><span class="w"></span>
<span class="linenos">4533</span>
<span class="linenos">4534</span><span class="w">    </span><span class="c">! 4) Lat,lon check</span>
<span class="linenos">4535</span><span class="w">    </span><span class="c">! Check for undecoded BURP file integer values of lat,lon = 0,0</span>
<span class="linenos">4536</span><span class="w">    </span><span class="c">! (usually associated with missing zenith angle and erroneous Tb=330K)</span>
<span class="linenos">4537</span>
<span class="linenos">4538</span><span class="w">    </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4539</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4540</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">18</span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4541</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4542</span><span class="w">      </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4543</span><span class="w">      </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4544</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4545</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4546</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4547</span><span class="k">        </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4548</span><span class="w">        </span><span class="n">obsTb</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4549</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4550</span><span class="k">    end do</span>
<span class="linenos">4551</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Bad lat,lon pair(s) detected. Number of locations = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="w"></span>
<span class="linenos">4552</span>
<span class="linenos">4553</span><span class="w">    </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4554</span><span class="w">    </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4555</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLon</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4556</span><span class="k">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4557</span><span class="w">      </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4558</span><span class="w">      </span><span class="n">reportHasMissingTb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4559</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4560</span><span class="k">    do </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">4561</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4562</span><span class="k">        </span><span class="n">qcRejectLogic</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4563</span><span class="w">        </span><span class="n">obsTb</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4564</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4565</span><span class="k">    end do</span>
<span class="linenos">4566</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Lat or lon out of range! Number of locations = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">icount</span><span class="w"></span>
<span class="linenos">4567</span>
<span class="linenos">4568</span><span class="w">    </span><span class="c">!  5) Change in land/sea qualifier or terrain-type based on MG,LG fields</span>
<span class="linenos">4569</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">modLSQ</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4570</span><span class="k">      </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4571</span><span class="w">      </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4572</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4573</span><span class="k">        </span><span class="n">fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4574</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4575</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4576</span><span class="k">        </span><span class="n">icount</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">icount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4577</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4578</span><span class="k">    end if</span>
<span class="linenos">4579</span>
<span class="linenos">4580</span><span class="k">  end subroutine </span><span class="n">mwbg_firstQcCheckMwhs2</span><span class="w"></span>
<span class="linenos">4581</span>
<span class="linenos">4582</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4583</span><span class="w">  </span><span class="c">! mwbg_nrlFilterAtms</span>
<span class="linenos">4584</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4585</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_nrlFilterAtms</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4586</span><span class="w">                                </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4587</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4588</span><span class="w">                                </span><span class="n">si_ecmwf</span><span class="p">,</span><span class="w"> </span><span class="n">si_bg</span><span class="p">,</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">iRej</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4589</span><span class="w">    </span><span class="c">!OBJET          Compute the following parameters using 5 ATMS channels:</span>
<span class="linenos">4590</span><span class="w">    </span><span class="c">!                  - sea ice,</span>
<span class="linenos">4591</span><span class="w">    </span><span class="c">!                  - cloud liquid water from observation (cloudLiquidWaterPathObs),</span>
<span class="linenos">4592</span><span class="w">    </span><span class="c">!                  - cloud liquid water from first guess (cloudLiquidWaterPathFG),</span>
<span class="linenos">4593</span><span class="w">    </span><span class="c">!                  - 2 scattering indices (si) (ECMWF, Bennartz-Grody)</span>
<span class="linenos">4594</span><span class="w">    </span><span class="c">!               The five channels used are: 23Ghz, 31Ghz, 50Ghz, 89Ghz, and 165Ghz.</span>
<span class="linenos">4595</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4596</span><span class="w">    </span><span class="c">!NOTES*</span>
<span class="linenos">4597</span><span class="w">    </span><span class="c">!                - open water points are converted to sea-ice points if sea ice concentration &gt;= 0.55</span>
<span class="linenos">4598</span><span class="w">    </span><span class="c">!                   and calcTerrainTypeIndice (terrainTypeIndice or terrain type) is changed accordingly</span>
<span class="linenos">4599</span><span class="w">    </span><span class="c">!                - cloudLiquidWaterPathObs are missing when out-of-range parameters/Tb detected or grossrej = .true.</span>
<span class="linenos">4600</span><span class="w">    </span><span class="c">!                - cloudLiquidWaterPathObs and si only computed over open water away from coasts and sea-ice</span>
<span class="linenos">4601</span><span class="w">    </span><span class="c">!                - cloudLiquidWaterPathObs and si = -99.0 where value cannot be computed.</span>
<span class="linenos">4602</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4603</span><span class="w">    </span><span class="c">!REFERENCES     Ben Ruston, NRL Monterey</span>
<span class="linenos">4604</span><span class="w">    </span><span class="c">!                  JCSDA Seminar 12/12/12: Impact of NPP Satellite Assimilation in the U.S. Navy Global Modeling System</span>
<span class="linenos">4605</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4606</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4607</span><span class="w">    </span><span class="c">!ARGUMENTS      - ier         - output - error return code for each location:</span>
<span class="linenos">4608</span><span class="w">    </span><span class="c">!                                        0, ok,</span>
<span class="linenos">4609</span><span class="w">    </span><span class="c">!                                        1, input parameter out of range or grossrej=.true.</span>
<span class="linenos">4610</span><span class="w">    </span><span class="c">!               - tb23            - input  -  23Ghz brightness temperature (K) -- ch. 1</span>
<span class="linenos">4611</span><span class="w">    </span><span class="c">!               - tb23FG          - input  -  23Ghz brightness temperature (K) from first guess -- ch. 1</span>
<span class="linenos">4612</span><span class="w">    </span><span class="c">!               - tb31            - input  -  31Ghz brightness temperature (K) -- ch. 2</span>
<span class="linenos">4613</span><span class="w">    </span><span class="c">!               - tb31FG          - input  -  31Ghz brightness temperature (K) from first guess -- ch. 2</span>
<span class="linenos">4614</span><span class="w">    </span><span class="c">!               - tb50            - input  -  50Ghz brightness temperature (K) -- ch. 3</span>
<span class="linenos">4615</span><span class="w">    </span><span class="c">!               - tb89            - input  -  89Ghz brightness temperature (K) -- ch. 16</span>
<span class="linenos">4616</span><span class="w">    </span><span class="c">!               - tb165           - input  -  165Ghz brightness temperature (K) -- ch. 17</span>
<span class="linenos">4617</span><span class="w">    </span><span class="c">!               - satZenithAngle  - input  -  satellite zenith angle (deg.)</span>
<span class="linenos">4618</span><span class="w">    </span><span class="c">!               - obsLat          - input  -  latitude (deg.)</span>
<span class="linenos">4619</span><span class="w">    </span><span class="c">!               - calcLandQualifierIndice - input  -  land/sea indicator (0=land, 1=ocean)</span>
<span class="linenos">4620</span><span class="w">    </span><span class="c">!               - calcTerrainTypeIndice   - in/out -  terrain type (0=ice, -1 otherwise)</span>
<span class="linenos">4621</span><span class="w">    </span><span class="c">!               - waterobs    - in/out -  .true. if open water point (away from coasts and sea-ice)</span>
<span class="linenos">4622</span><span class="w">    </span><span class="c">!               - grossrej    - input  -  .true. if any channel had a gross error from mwbg_grossValueCheck</span>
<span class="linenos">4623</span><span class="w">    </span><span class="c">!               - cloudLiquidWaterPathObs - output -  cloud liquid water from observation (kg/m**2) from tb23 &amp; tb31</span>
<span class="linenos">4624</span><span class="w">    </span><span class="c">!               - cloudLiquidWaterPathFG  - output -  cloud liquid water from first guess (kg/m**2) from tb23FG &amp; tb31FG</span>
<span class="linenos">4625</span><span class="w">    </span><span class="c">!               - si_ecmwf    - output -  ECMWF scattering index from tb89 &amp; tb165</span>
<span class="linenos">4626</span><span class="w">    </span><span class="c">!               - si_bg       - output -  Bennartz-Grody scattering index from tb89 &amp; tb165</span>
<span class="linenos">4627</span><span class="w">    </span><span class="c">!               - iNumSeaIce  - in/out -  running counter for number of open water points</span>
<span class="linenos">4628</span><span class="w">    </span><span class="c">!                                         with sea-ice detected (from algorithm)</span>
<span class="linenos">4629</span><span class="w">    </span><span class="c">!               - iRej        - in/out -  running counter for number of locations with bad</span>
<span class="linenos">4630</span><span class="w">    </span><span class="c">!                                         satZenithAngle, obsLat, calcLandQualifierIndice, or with grossrej=true</span>
<span class="linenos">4631</span><span class="w">    </span><span class="c">!               - SeaIce      - output -  computed sea-ice fraction from tb23 &amp; tb50</span>
<span class="linenos">4632</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4633</span><span class="w">    </span><span class="c">!               - ice         - internal -  sea ice</span>
<span class="linenos">4634</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4635</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4636</span><span class="w">    </span><span class="c">! Notes: In the case where an output parameter cannot be calculated, the</span>
<span class="linenos">4637</span><span class="w">    </span><span class="c">!        value of this parameter is set to the missing value, i.e. -99.</span>
<span class="linenos">4638</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4639</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">4640</span>
<span class="linenos">4641</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">4642</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">iNumSeaIce</span><span class="w"></span>
<span class="linenos">4643</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">4644</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">calcTerrainTypeIndice</span><span class="w"></span>
<span class="linenos">4645</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">iRej</span><span class="w"></span>
<span class="linenos">4646</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">grossrej</span><span class="w"></span>
<span class="linenos">4647</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">4648</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4649</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4650</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4651</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos">4652</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">4653</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">4654</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">4655</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">si_ecmwf</span><span class="w"></span>
<span class="linenos">4656</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">si_bg</span><span class="w"></span>
<span class="linenos">4657</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">SeaIce</span><span class="w"></span>
<span class="linenos">4658</span>
<span class="linenos">4659</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">4660</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">indx1</span><span class="w"></span>
<span class="linenos">4661</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ice</span><span class="p">,</span><span class="w"> </span><span class="n">tb23</span><span class="p">,</span><span class="w"> </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb50</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb165</span><span class="w"></span>
<span class="linenos">4662</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bcor23</span><span class="p">,</span><span class="w"> </span><span class="n">bcor31</span><span class="p">,</span><span class="w"> </span><span class="n">bcor50</span><span class="p">,</span><span class="w"> </span><span class="n">bcor89</span><span class="p">,</span><span class="w"> </span><span class="n">bcor165</span><span class="w"></span>
<span class="linenos">4663</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">deltb</span><span class="p">,</span><span class="w"> </span><span class="n">cosz</span><span class="p">,</span><span class="w"> </span><span class="n">t23</span><span class="p">,</span><span class="w"> </span><span class="n">t23FG</span><span class="p">,</span><span class="w"> </span><span class="n">t31</span><span class="p">,</span><span class="w"> </span><span class="n">t31FG</span><span class="p">,</span><span class="w"> </span><span class="n">t50</span><span class="p">,</span><span class="w"> </span><span class="n">t89</span><span class="p">,</span><span class="w"> </span><span class="n">t165</span><span class="w"></span>
<span class="linenos">4664</span>
<span class="linenos">4665</span><span class="w">    </span><span class="n">iNumSeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4666</span>
<span class="linenos">4667</span><span class="w">    </span><span class="c">! extract required channels:</span>
<span class="linenos">4668</span><span class="w">    </span><span class="c">!  23 Ghz = AMSU-A 1 = ATMS channel 1</span>
<span class="linenos">4669</span><span class="w">    </span><span class="c">!  31 Ghz = AMSU-A 2 = ATMS channel 2</span>
<span class="linenos">4670</span><span class="w">    </span><span class="c">!  50 Ghz = AMSU-A 3 = ATMS channel 3</span>
<span class="linenos">4671</span><span class="w">    </span><span class="c">!  53 Ghz = AMSU-A 5 = ATMS channel 6</span>
<span class="linenos">4672</span><span class="w">    </span><span class="c">!  89 Ghz = AMSU-A15 = ATMS channel 16</span>
<span class="linenos">4673</span><span class="w">    </span><span class="c">! 150 Ghz = AMSU-B 2 = ATMS channel 17</span>
<span class="linenos">4674</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4675</span>
<span class="linenos">4676</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4677</span><span class="w">    </span><span class="n">tb23</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4678</span><span class="w">    </span><span class="n">tb23FG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">indx1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4679</span><span class="w">    </span><span class="n">bcor23</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4680</span><span class="w">    </span><span class="n">tb31</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4681</span><span class="w">    </span><span class="n">tb31FG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4682</span><span class="w">    </span><span class="n">bcor31</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4683</span><span class="w">    </span><span class="n">tb50</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4684</span><span class="w">    </span><span class="n">bcor50</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4685</span><span class="w">    </span><span class="n">tb89</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">15</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4686</span><span class="w">    </span><span class="n">bcor89</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">15</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4687</span><span class="w">    </span><span class="n">tb165</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4688</span><span class="w">    </span><span class="n">bcor165</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4689</span>
<span class="linenos">4690</span><span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4691</span>
<span class="linenos">4692</span><span class="w">    </span><span class="c">! 1) Initialise parameters:</span>
<span class="linenos">4693</span><span class="w">    </span><span class="n">ice</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4694</span><span class="w">    </span><span class="n">cloudLiquidWaterPathObs</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4695</span><span class="w">    </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4696</span><span class="w">    </span><span class="n">si_ecmwf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4697</span><span class="w">    </span><span class="n">si_bg</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4698</span><span class="w">    </span><span class="n">SeaIce</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4699</span>
<span class="linenos">4700</span><span class="w">    </span><span class="c">! 2) Validate input parameters:</span>
<span class="linenos">4701</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">7</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4702</span><span class="w">        </span><span class="n">obsLat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4703</span><span class="w">        </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4704</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4705</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">4706</span>
<span class="linenos">4707</span><span class="w">    </span><span class="c">! Skip computations for points where all data are rejected  (bad Tb ANY channel)</span>
<span class="linenos">4708</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4709</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4710</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">4711</span>
<span class="linenos">4712</span><span class="w">    </span><span class="c">! 3) Compute parameters:</span>
<span class="linenos">4713</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4714</span><span class="k">      </span><span class="n">cosz</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">cosd</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4715</span>
<span class="linenos">4716</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor23</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4717</span><span class="k">        </span><span class="n">t23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23</span><span class="w"></span>
<span class="linenos">4718</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4719</span><span class="k">        </span><span class="n">t23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor23</span><span class="w"></span>
<span class="linenos">4720</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4721</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor31</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4722</span><span class="k">        </span><span class="n">t31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31</span><span class="w"></span>
<span class="linenos">4723</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4724</span><span class="k">        </span><span class="n">t31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor31</span><span class="w"></span>
<span class="linenos">4725</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4726</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor50</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4727</span><span class="k">        </span><span class="n">t50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb50</span><span class="w"></span>
<span class="linenos">4728</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4729</span><span class="k">        </span><span class="n">t50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb50</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor50</span><span class="w"></span>
<span class="linenos">4730</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4731</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor89</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4732</span><span class="k">        </span><span class="n">t89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb89</span><span class="w"></span>
<span class="linenos">4733</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4734</span><span class="k">        </span><span class="n">t89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor89</span><span class="w"></span>
<span class="linenos">4735</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4736</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor165</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4737</span><span class="k">        </span><span class="n">t165</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb165</span><span class="w"></span>
<span class="linenos">4738</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4739</span><span class="k">        </span><span class="n">t165</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb165</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor165</span><span class="w"></span>
<span class="linenos">4740</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4741</span>
<span class="linenos">4742</span><span class="k">      </span><span class="n">deltb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t165</span><span class="w"></span>
<span class="linenos">4743</span><span class="w">      </span><span class="n">t23FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23FG</span><span class="w"></span>
<span class="linenos">4744</span><span class="w">      </span><span class="n">t31FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31FG</span><span class="w"></span>
<span class="linenos">4745</span>
<span class="linenos">4746</span><span class="w">      </span><span class="c">! Check for sea-ice over water points. Set terrain type to 0 if ice&gt;=0.55 detected.</span>
<span class="linenos">4747</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c">! water point</span>
<span class="linenos">4748</span>
<span class="linenos">4749</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4750</span><span class="k">          </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4751</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">4752</span><span class="k">          </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.85</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.020</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.028</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t50</span><span class="w"></span>
<span class="linenos">4753</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">4754</span>
<span class="linenos">4755</span><span class="k">        </span><span class="n">SeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ice</span><span class="w"></span>
<span class="linenos">4756</span>
<span class="linenos">4757</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ice</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.55</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4758</span><span class="k">          </span><span class="n">iNumSeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4759</span><span class="w">          </span><span class="n">waterobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4760</span><span class="w">          </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4761</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">4762</span>
<span class="linenos">4763</span><span class="k">      end if</span><span class="w"></span>
<span class="linenos">4764</span>
<span class="linenos">4765</span><span class="w">      </span><span class="c">! Compute cloudLiquidWaterPathObs, cloudLiquidWaterPathFG, and Scattering Indices (over open water only)</span>
<span class="linenos">4766</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4767</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="mf">4.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">t31</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="mf">4.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4768</span><span class="k">          </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.24</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">2.622</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.846</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">4769</span><span class="w">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.754</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t23</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.265</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t31</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4770</span><span class="w">          </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">4771</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4772</span>
<span class="linenos">4773</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.754</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t23FG</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.265</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t31FG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4774</span><span class="w">          </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">4775</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4776</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">4777</span><span class="k">        </span><span class="n">si_ecmwf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deltb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="mf">6.94</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.248</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4778</span><span class="w">        </span><span class="n">si_bg</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">deltb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="mf">9.201</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.1104</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4779</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4780</span>
<span class="linenos">4781</span><span class="k">    else</span><span class="w">  </span><span class="c">! ier == 1 case</span>
<span class="linenos">4782</span><span class="w">        </span><span class="n">iRej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iRej</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4783</span>
<span class="linenos">4784</span><span class="w">    </span><span class="k">end if</span><span class="w"> </span><span class="c">! if ( ier == 0 )</span>
<span class="linenos">4785</span>
<span class="linenos">4786</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4787</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">4788</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; tb23,tb23FG,tb31,tb31FG,tb50,tb89,tb165,satZenithAngle,obsLat, calcLandQualifierIndice = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4789</span><span class="w">                  </span><span class="n">tb23</span><span class="p">,</span><span class="n">tb23FG</span><span class="p">,</span><span class="n">tb31</span><span class="p">,</span><span class="n">tb31FG</span><span class="p">,</span><span class="n">tb50</span><span class="p">,</span><span class="n">tb89</span><span class="p">,</span><span class="n">tb165</span><span class="p">,</span><span class="n">satZenithAngle</span><span class="p">,</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">4790</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ier,ice,cloudLiquidWaterPathObs,cloudLiquidWaterPathFG,si_ecmwf,si_bg,calcTerrainTypeIndice,waterobs =&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4791</span><span class="w">                  </span><span class="n">ier</span><span class="p">,</span><span class="n">ice</span><span class="p">,</span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="n">si_ecmwf</span><span class="p">,</span><span class="n">si_bg</span><span class="p">,</span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">4792</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">4793</span>
<span class="linenos">4794</span><span class="k">  end subroutine </span><span class="n">mwbg_nrlFilterAtms</span><span class="w"></span>
<span class="linenos">4795</span>
<span class="linenos">4796</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4797</span><span class="w">  </span><span class="c">! mwbg_nrlFilterMwhs2</span>
<span class="linenos">4798</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">4799</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_nrlFilterMwhs2</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4800</span><span class="w">                                 </span><span class="n">calcLandQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4801</span><span class="w">                                 </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4802</span><span class="w">                                 </span><span class="n">si_ecmwf</span><span class="p">,</span><span class="w"> </span><span class="n">si_bg</span><span class="p">,</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">iRej</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4803</span><span class="w">    </span><span class="c">!OBJET          Compute the following parameters using 2 MWHS2 channels:</span>
<span class="linenos">4804</span><span class="w">    </span><span class="c">!                  - sea ice,</span>
<span class="linenos">4805</span><span class="w">    </span><span class="c">!                  - cloud liquid water from observation (cloudLiquidWaterPathObs),</span>
<span class="linenos">4806</span><span class="w">    </span><span class="c">!                  - cloud liquid water from first guess (cloudLiquidWaterPathFG),</span>
<span class="linenos">4807</span><span class="w">    </span><span class="c">!                  - 2 scattering indices (si) (ECMWF, Bennartz-Grody)</span>
<span class="linenos">4808</span><span class="w">    </span><span class="c">!               The two channels used are: 89Ghz, and 165Ghz.</span>
<span class="linenos">4809</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4810</span><span class="w">    </span><span class="c">!NOTES*</span>
<span class="linenos">4811</span><span class="w">    </span><span class="c">!                - open water points are converted to sea-ice points if sea ice concentration &gt;= 0.55</span>
<span class="linenos">4812</span><span class="w">    </span><span class="c">!                   and calcTerrainTypeIndice (terrainTypeIndice or terrain type) is changed accordingly</span>
<span class="linenos">4813</span><span class="w">    </span><span class="c">!                - cloudLiquidWaterPathObs are missing when out-of-range parameters/Tb detected or grossrej = .true.</span>
<span class="linenos">4814</span><span class="w">    </span><span class="c">!                - cloudLiquidWaterPathObs and si_ecmwf only computed over open water away from coasts and sea-ice</span>
<span class="linenos">4815</span><span class="w">    </span><span class="c">!                - si_bg is computed for all points</span>
<span class="linenos">4816</span><span class="w">    </span><span class="c">!                - cloudLiquidWaterPathObs and si = -99.0 where value cannot be computed.</span>
<span class="linenos">4817</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4818</span><span class="w">    </span><span class="c">!REFERENCES     Ben Ruston, NRL Monterey</span>
<span class="linenos">4819</span><span class="w">    </span><span class="c">!                  JCSDA Seminar 12/12/12: Impact of NPP Satellite Assimilation in the U.S. Navy Global Modeling System</span>
<span class="linenos">4820</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4821</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4822</span><span class="w">    </span><span class="c">!ARGUMENTS      - ier         - output - error return code for each location:</span>
<span class="linenos">4823</span><span class="w">    </span><span class="c">!                                        0, ok,</span>
<span class="linenos">4824</span><span class="w">    </span><span class="c">!                                        1, input parameter out of range or grossrej=.true.</span>
<span class="linenos">4825</span><span class="w">    </span><span class="c">!               - tb23            - input  -  23Ghz brightness temperature (K) -- ch. 1 [missing for MWHS-2]</span>
<span class="linenos">4826</span><span class="w">    </span><span class="c">!               - tb23FG          - input  -  23Ghz brightness temperature (K) from first guess -- ch. 1</span>
<span class="linenos">4827</span><span class="w">    </span><span class="c">!               - tb31            - input  -  31Ghz brightness temperature (K) -- ch. 2 [missing for MWHS-2]</span>
<span class="linenos">4828</span><span class="w">    </span><span class="c">!               - tb31FG          - input  -  31Ghz brightness temperature (K) from first guess -- ch. 2</span>
<span class="linenos">4829</span><span class="w">    </span><span class="c">!               - tb50            - input  -  50Ghz brightness temperature (K) -- ch. 3 [missing for MWHS-2]</span>
<span class="linenos">4830</span><span class="w">    </span><span class="c">!               - tb89            - input  -  89Ghz brightness temperature (K) -- ch. 16</span>
<span class="linenos">4831</span><span class="w">    </span><span class="c">!               - tb165           - input  -  165Ghz brightness temperature (K) -- ch. 17</span>
<span class="linenos">4832</span><span class="w">    </span><span class="c">!               - satZenithAngle  - input  -  satellite zenith angle (deg.)</span>
<span class="linenos">4833</span><span class="w">    </span><span class="c">!               - obsLat          - input  -  latitude (deg.)</span>
<span class="linenos">4834</span><span class="w">    </span><span class="c">!               - calcLandQualifierIndice   - input  -  land/sea indicator (0=land, 1=ocean)</span>
<span class="linenos">4835</span><span class="w">    </span><span class="c">!               - calcTerrainTypeIndice     - in/out -  terrain type (0=ice, -1 otherwise)</span>
<span class="linenos">4836</span><span class="w">    </span><span class="c">!               - waterobs    - in/out -  .true. if open water point (away from coasts and sea-ice)</span>
<span class="linenos">4837</span><span class="w">    </span><span class="c">!               - grossrej    - input  -  .true. if any channel had a gross error from mwbg_grossValueCheck</span>
<span class="linenos">4838</span><span class="w">    </span><span class="c">!               - cloudLiquidWaterPathObs - output -  cloud liquid water from observation (kg/m**2) from tb23 &amp; tb31</span>
<span class="linenos">4839</span><span class="w">    </span><span class="c">!               - cloudLiquidWaterPathFG  - output -  cloud liquid water from first guess (kg/m**2) from tb23FG &amp; tb31FG</span>
<span class="linenos">4840</span><span class="w">    </span><span class="c">!               - si_ecmwf    - output -  ECMWF scattering index from tb89 &amp; tb165</span>
<span class="linenos">4841</span><span class="w">    </span><span class="c">!               - si_bg       - output -  Bennartz-Grody scattering index from tb89 &amp; tb165</span>
<span class="linenos">4842</span><span class="w">    </span><span class="c">!               - iNumSeaIce  - in/out -  running counter for number of open water points</span>
<span class="linenos">4843</span><span class="w">    </span><span class="c">!                                         with sea-ice detected (from algorithm)</span>
<span class="linenos">4844</span><span class="w">    </span><span class="c">!               - iRej        - in/out -  running counter for number of locations with bad</span>
<span class="linenos">4845</span><span class="w">    </span><span class="c">!                                         satZenithAngle, obsLat, calcLandQualifierIndice, or with grossrej=true</span>
<span class="linenos">4846</span><span class="w">    </span><span class="c">!               - SeaIce      - output -  computed sea-ice fraction from tb23 &amp; tb50</span>
<span class="linenos">4847</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4848</span><span class="w">    </span><span class="c">!               - ice         - internal -  sea ice</span>
<span class="linenos">4849</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4850</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4851</span><span class="w">    </span><span class="c">! Notes: In the case where an output parameter cannot be calculated, the</span>
<span class="linenos">4852</span><span class="w">    </span><span class="c">!        value of this parameter is set to the missing value, i.e. -99.</span>
<span class="linenos">4853</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4854</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">4855</span>
<span class="linenos">4856</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">4857</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">iNumSeaIce</span><span class="w"></span>
<span class="linenos">4858</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">4859</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">calcTerrainTypeIndice</span><span class="w"></span>
<span class="linenos">4860</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">iRej</span><span class="w"></span>
<span class="linenos">4861</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">grossrej</span><span class="w"></span>
<span class="linenos">4862</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">4863</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4864</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">4865</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">satZenithAngle</span><span class="w"></span>
<span class="linenos">4866</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">obsLat</span><span class="w"></span>
<span class="linenos">4867</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">4868</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">4869</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">si_ecmwf</span><span class="w"></span>
<span class="linenos">4870</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">si_bg</span><span class="w"></span>
<span class="linenos">4871</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w">  </span><span class="n">SeaIce</span><span class="w"></span>
<span class="linenos">4872</span>
<span class="linenos">4873</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">4874</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="n">indx1</span><span class="w"></span>
<span class="linenos">4875</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ice</span><span class="p">,</span><span class="w"> </span><span class="n">tb23</span><span class="p">,</span><span class="w"> </span><span class="n">tb23FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb31</span><span class="p">,</span><span class="w"> </span><span class="n">tb31FG</span><span class="p">,</span><span class="w"> </span><span class="n">tb50</span><span class="p">,</span><span class="w"> </span><span class="n">tb89</span><span class="p">,</span><span class="w"> </span><span class="n">tb165</span><span class="w"></span>
<span class="linenos">4876</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bcor23</span><span class="p">,</span><span class="w"> </span><span class="n">bcor31</span><span class="p">,</span><span class="w"> </span><span class="n">bcor50</span><span class="p">,</span><span class="w"> </span><span class="n">bcor89</span><span class="p">,</span><span class="w"> </span><span class="n">bcor165</span><span class="w"></span>
<span class="linenos">4877</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">deltb</span><span class="p">,</span><span class="w"> </span><span class="n">cosz</span><span class="p">,</span><span class="w"> </span><span class="n">t23</span><span class="p">,</span><span class="w"> </span><span class="n">t23FG</span><span class="p">,</span><span class="w"> </span><span class="n">t31</span><span class="p">,</span><span class="w"> </span><span class="n">t31FG</span><span class="p">,</span><span class="w"> </span><span class="n">t50</span><span class="p">,</span><span class="w"> </span><span class="n">t89</span><span class="p">,</span><span class="w"> </span><span class="n">t165</span><span class="w"></span>
<span class="linenos">4878</span>
<span class="linenos">4879</span><span class="w">    </span><span class="n">iNumSeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4880</span>
<span class="linenos">4881</span><span class="w">    </span><span class="c">!! extract required channels:  ATMS ch.   MWHS-2 ch.</span>
<span class="linenos">4882</span><span class="w">    </span><span class="c">!!   23 Ghz = AMSU-A 1 =        1          n/a</span>
<span class="linenos">4883</span><span class="w">    </span><span class="c">!!   31 Ghz = AMSU-A 2 =        2          n/a</span>
<span class="linenos">4884</span><span class="w">    </span><span class="c">!!   50 Ghz = AMSU-A 3 =        3          n/a</span>
<span class="linenos">4885</span><span class="w">    </span><span class="c">!!   53 Ghz = AMSU-A 5 =        6          n/a</span>
<span class="linenos">4886</span><span class="w">    </span><span class="c">!!   89 Ghz = AMSU-A 15/ B 1 = 16           1</span>
<span class="linenos">4887</span><span class="w">    </span><span class="c">!!  150 Ghz = AMSU-B 2 =       17          10</span>
<span class="linenos">4888</span><span class="w">    </span><span class="c">!!  183 Ghz = AMSU-B 3 =       22          11</span>
<span class="linenos">4889</span><span class="w">    </span><span class="c">!!  183 Ghz = AMSU-B 5 =       18          15</span>
<span class="linenos">4890</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">4891</span><span class="w">    </span><span class="c">!   Extract Tb for channels 1 (AMSU-B 1) and 10 (AMSU-B 2) for Bennartz SI</span>
<span class="linenos">4892</span><span class="w">    </span><span class="c">!   Extract Tb for channels 22 (AMSU-B 3) and 18 (AMSU-B 5) for Dryness Index (DI)</span>
<span class="linenos">4893</span>
<span class="linenos">4894</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4895</span><span class="w">    </span><span class="n">tb23</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4896</span><span class="w">    </span><span class="n">tb23FG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4897</span><span class="w">    </span><span class="n">bcor23</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4898</span><span class="w">    </span><span class="n">tb31</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4899</span><span class="w">    </span><span class="n">tb31FG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4900</span><span class="w">    </span><span class="n">bcor31</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4901</span><span class="w">    </span><span class="n">tb50</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4902</span><span class="w">    </span><span class="n">bcor50</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4903</span><span class="w">    </span><span class="n">tb89</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4904</span><span class="w">    </span><span class="n">bcor89</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4905</span><span class="w">    </span><span class="n">tb165</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4906</span><span class="w">    </span><span class="n">bcor165</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4907</span>
<span class="linenos">4908</span><span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4909</span>
<span class="linenos">4910</span><span class="w">    </span><span class="c">! 1) Initialise parameters:</span>
<span class="linenos">4911</span><span class="w">    </span><span class="n">ice</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4912</span><span class="w">    </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4913</span><span class="w">    </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4914</span><span class="w">    </span><span class="n">si_ecmwf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4915</span><span class="w">    </span><span class="n">si_bg</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">4916</span><span class="w">    </span><span class="n">SeaIce</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4917</span>
<span class="linenos">4918</span><span class="w">    </span><span class="c">! 2) Validate input parameters:</span>
<span class="linenos">4919</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">7</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4920</span><span class="w">        </span><span class="n">obsLat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">4921</span><span class="w">        </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4922</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4923</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">4924</span>
<span class="linenos">4925</span><span class="w">    </span><span class="c">! Skip computations for points where all data are rejected  (bad Tb ANY channel)</span>
<span class="linenos">4926</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4927</span><span class="k">      </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4928</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">4929</span>
<span class="linenos">4930</span><span class="w">    </span><span class="c">! 3) Compute parameters:</span>
<span class="linenos">4931</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4932</span><span class="k">      </span><span class="n">cosz</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">cosd</span><span class="p">(</span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4933</span>
<span class="linenos">4934</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor23</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4935</span><span class="k">        </span><span class="n">t23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23</span><span class="w"></span>
<span class="linenos">4936</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4937</span><span class="k">        </span><span class="n">t23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor23</span><span class="w"></span>
<span class="linenos">4938</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4939</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor31</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4940</span><span class="k">        </span><span class="n">t31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31</span><span class="w"></span>
<span class="linenos">4941</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4942</span><span class="k">        </span><span class="n">t31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor31</span><span class="w"></span>
<span class="linenos">4943</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4944</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor50</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4945</span><span class="k">        </span><span class="n">t50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb50</span><span class="w"></span>
<span class="linenos">4946</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4947</span><span class="k">        </span><span class="n">t50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb50</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor50</span><span class="w"></span>
<span class="linenos">4948</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4949</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor89</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4950</span><span class="k">        </span><span class="n">t89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb89</span><span class="w"></span>
<span class="linenos">4951</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4952</span><span class="k">        </span><span class="n">t89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor89</span><span class="w"></span>
<span class="linenos">4953</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4954</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">bcor165</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">mwbg_useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4955</span><span class="k">        </span><span class="n">t165</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb165</span><span class="w"></span>
<span class="linenos">4956</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4957</span><span class="k">        </span><span class="n">t165</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb165</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor165</span><span class="w"></span>
<span class="linenos">4958</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">4959</span>
<span class="linenos">4960</span><span class="k">      </span><span class="n">deltb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t89</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t165</span><span class="w"></span>
<span class="linenos">4961</span><span class="w">      </span><span class="n">t23FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb23FG</span><span class="w"></span>
<span class="linenos">4962</span><span class="w">      </span><span class="n">t31FG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb31FG</span><span class="w"></span>
<span class="linenos">4963</span>
<span class="linenos">4964</span><span class="w">      </span><span class="c">! Check for sea-ice over water points. Set terrain type to 0 if ice&gt;=0.55 detected.</span>
<span class="linenos">4965</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c">! water point</span>
<span class="linenos">4966</span>
<span class="linenos">4967</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">obsLat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4968</span><span class="k">          </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4969</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">4970</span><span class="k">          </span><span class="n">ice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.85</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.020</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.028</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t50</span><span class="w"></span>
<span class="linenos">4971</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">4972</span>
<span class="linenos">4973</span><span class="k">        </span><span class="n">SeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ice</span><span class="w"></span>
<span class="linenos">4974</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ice</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.55</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4975</span><span class="k">          </span><span class="n">iNumSeaIce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iNumSeaIce</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">4976</span><span class="w">          </span><span class="n">waterobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">4977</span><span class="w">          </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4978</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">4979</span>
<span class="linenos">4980</span><span class="k">      end if</span><span class="w"></span>
<span class="linenos">4981</span>
<span class="linenos">4982</span><span class="w">      </span><span class="c">! Compute cloudLiquidWaterPathObs, cloudLiquidWaterPathFG, and Scattering Indices (over open water only)</span>
<span class="linenos">4983</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4984</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4985</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">t23</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="mf">4.</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">t31</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">28</span><span class="mf">4.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">4986</span><span class="k">            </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.24</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">2.622</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.846</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">4987</span><span class="w">            </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.754</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t23</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.265</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t31</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4988</span><span class="w">            </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">4989</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4990</span>
<span class="linenos">4991</span><span class="w">            </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.754</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t23FG</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.265</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">alog</span><span class="p">(</span><span class="mi">28</span><span class="mf">5.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t31FG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4992</span><span class="w">            </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosz</span><span class="w"></span>
<span class="linenos">4993</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="linenos">4994</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">4995</span><span class="k">        end if</span>
<span class="linenos">4996</span><span class="k">        </span><span class="n">si_ecmwf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deltb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="mf">6.94</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.248</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4997</span><span class="w">        </span><span class="n">si_bg</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">deltb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="mf">9.201</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.1104</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4998</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">4999</span><span class="k">        </span><span class="n">si_bg</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">deltb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">0.158</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.0163</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5000</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5001</span>
<span class="linenos">5002</span><span class="k">    else</span><span class="w">  </span><span class="c">! ier == 1 case</span>
<span class="linenos">5003</span><span class="w">        </span><span class="n">iRej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iRej</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5004</span>
<span class="linenos">5005</span><span class="w">    </span><span class="k">end if</span><span class="w"> </span><span class="c">! if ( ier == 0 )</span>
<span class="linenos">5006</span>
<span class="linenos">5007</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mwbg_debug</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5008</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<span class="linenos">5009</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; tb23,tb23FG,tb31,tb31FG,tb50,tb89,tb165,satZenithAngle,obsLat, calcLandQualifierIndice = &#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5010</span><span class="w">                  </span><span class="n">tb23</span><span class="p">,</span><span class="n">tb23FG</span><span class="p">,</span><span class="n">tb31</span><span class="p">,</span><span class="n">tb31FG</span><span class="p">,</span><span class="n">tb50</span><span class="p">,</span><span class="n">tb89</span><span class="p">,</span><span class="n">tb165</span><span class="p">,</span><span class="n">satZenithAngle</span><span class="p">,</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">calcLandQualifierIndice</span><span class="w"></span>
<span class="linenos">5011</span><span class="w">      </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; ier,ice,cloudLiquidWaterPathObs,cloudLiquidWaterPathFG,si_ecmwf,si_bg,calcTerrainTypeIndice,waterobs =&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5012</span><span class="w">                  </span><span class="n">ier</span><span class="p">,</span><span class="n">ice</span><span class="p">,</span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="n">si_ecmwf</span><span class="p">,</span><span class="n">si_bg</span><span class="p">,</span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">5013</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5014</span>
<span class="linenos">5015</span><span class="k">  end subroutine </span><span class="n">mwbg_nrlFilterMwhs2</span><span class="w"></span>
<span class="linenos">5016</span>
<span class="linenos">5017</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5018</span><span class="w">  </span><span class="c">! mwbg_flagDataUsingNrlCritAtms</span>
<span class="linenos">5019</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5020</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_flagDataUsingNrlCritAtms</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5021</span><span class="w">                                           </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5022</span><span class="w">                                           </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">cloudobs</span><span class="p">,</span><span class="w"> </span><span class="n">precipobs</span><span class="p">,</span><span class="w">  </span><span class="n">cldcnt</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5023</span>
<span class="linenos">5024</span><span class="w">    </span><span class="c">!:Purpose:                       Set the  Information flag (newInformationFlag) values (new BURP element 025174 in header)</span>
<span class="linenos">5025</span><span class="w">    </span><span class="c">!                                BIT    Meaning</span>
<span class="linenos">5026</span><span class="w">    </span><span class="c">!                                - 0     off=land or sea-ice, on=open water away from coast</span>
<span class="linenos">5027</span><span class="w">    </span><span class="c">!                                - 1     Mean 183 Ghz [ch. 18-22] is missing</span>
<span class="linenos">5028</span><span class="w">    </span><span class="c">!                                - 2     CLW is missing (over water)</span>
<span class="linenos">5029</span><span class="w">    </span><span class="c">!                                - 3     CLW &gt; clw_atms_nrl_LTrej (0.175 kg/m2) (cloudobs)</span>
<span class="linenos">5030</span><span class="w">    </span><span class="c">!                                - 4     scatec/scatbg &gt; Lower Troposphere limit 9/10 (precipobs)</span>
<span class="linenos">5031</span><span class="w">    </span><span class="c">!                                - 5     Mean 183 Ghz [ch. 18-22] Tb &lt; 240K</span>
<span class="linenos">5032</span><span class="w">    </span><span class="c">!                                - 6     CLW &gt; clw_atms_nrl_UTrej (0.200 kg/m2)</span>
<span class="linenos">5033</span><span class="w">    </span><span class="c">!                                - 7     Dryness Index rejection (for ch. 22)</span>
<span class="linenos">5034</span><span class="w">    </span><span class="c">!                                - 8     scatec/scatbg &gt; Upper Troposphere limit 18/15</span>
<span class="linenos">5035</span><span class="w">    </span><span class="c">!                                - 9     Dryness Index rejection (for ch. 21)</span>
<span class="linenos">5036</span><span class="w">    </span><span class="c">!                               - 10     Sea ice &gt; 0.55 detected</span>
<span class="linenos">5037</span><span class="w">    </span><span class="c">!                               - 11     Gross error in Tb (any chan.)  (all channels rejected)</span>
<span class="linenos">5038</span>
<span class="linenos">5039</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">5040</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5041</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5042</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">5043</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec</span><span class="w"></span>
<span class="linenos">5044</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg</span><span class="w"></span>
<span class="linenos">5045</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SeaIce</span><span class="w"></span>
<span class="linenos">5046</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="w"></span>
<span class="linenos">5047</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grossrej</span><span class="w"></span>
<span class="linenos">5048</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">5049</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldcnt</span><span class="w"></span>
<span class="linenos">5050</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudobs</span><span class="w"></span>
<span class="linenos">5051</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"></span>
<span class="linenos">5052</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">precipobs</span><span class="w"></span>
<span class="linenos">5053</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"></span>
<span class="linenos">5054</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdi</span><span class="w"></span>
<span class="linenos">5055</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">riwv</span><span class="w"></span>
<span class="linenos">5056</span>
<span class="linenos">5057</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5058</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">indx</span><span class="p">,</span><span class="w"> </span><span class="n">indx1</span><span class="p">,</span><span class="w"> </span><span class="n">n_cld</span><span class="w"></span>
<span class="linenos">5059</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ztb_amsub3</span><span class="p">,</span><span class="w"> </span><span class="n">bcor_amsub3</span><span class="p">,</span><span class="w"> </span><span class="n">ztb_amsub5</span><span class="p">,</span><span class="w"> </span><span class="n">bcor_amsub5</span><span class="p">,</span><span class="w"> </span><span class="n">ztb183</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5060</span>
<span class="linenos">5061</span><span class="w">    </span><span class="c">! To begin, assume that all obs are good.</span>
<span class="linenos">5062</span><span class="w">    </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">5063</span><span class="w">    </span><span class="n">n_cld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">5064</span><span class="w">    </span><span class="n">cloudobs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5065</span><span class="w">    </span><span class="n">iwvreject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5066</span><span class="w">    </span><span class="n">precipobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5067</span>
<span class="linenos">5068</span><span class="w">    </span><span class="c">! Extract Tb for channels 16 (AMSU-B 1) and 17 (AMSU-B 2) for Bennartz SI</span>
<span class="linenos">5069</span><span class="w">    </span><span class="c">! Extract Tb for channels 22 (AMSU-B 3) and 18 (AMSU-B 5) for Dryness Index (DI)</span>
<span class="linenos">5070</span>
<span class="linenos">5071</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5072</span><span class="w">    </span><span class="n">ztb_amsub3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">21</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5073</span><span class="w">    </span><span class="n">bcor_amsub3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">21</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5074</span><span class="w">    </span><span class="n">ztb_amsub5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">17</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5075</span><span class="w">    </span><span class="n">bcor_amsub5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">17</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5076</span>
<span class="linenos">5077</span><span class="w">    </span><span class="c">! Flag data using NRL criteria</span>
<span class="linenos">5078</span>
<span class="linenos">5079</span><span class="w">    </span><span class="c">! Compute Mean 183 Ghz [ch. 18-22] Tb (riwv)</span>
<span class="linenos">5080</span><span class="w">    </span><span class="n">riwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.0</span><span class="w"></span>
<span class="linenos">5081</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5082</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5083</span><span class="k">      do </span><span class="n">indx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="linenos">5084</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5085</span><span class="k">          </span><span class="n">ztb183</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5086</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">5087</span><span class="k">          </span><span class="n">ztb183</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5088</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5089</span><span class="k">      end do</span>
<span class="linenos">5090</span><span class="k">      </span><span class="n">riwv</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">ztb183</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">5.0</span><span class="w"></span>
<span class="linenos">5091</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">riwv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mean_Tb_183Ghz_min</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5092</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">5093</span><span class="k">      </span><span class="n">iwvreject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5094</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">5095</span>
<span class="linenos">5096</span><span class="w">    </span><span class="c">!  Set bits in newInformationFlag flag to identify where various data selection criteria are met</span>
<span class="linenos">5097</span><span class="w">    </span><span class="c">!     precipobs = .true  where ECMWF or BG scattering index &gt; min_threshold (LT)</span>
<span class="linenos">5098</span><span class="w">    </span><span class="c">!     cloudobs  = .true. where CLW &gt; min_threshold (LT) or if precipobs = .true</span>
<span class="linenos">5099</span>
<span class="linenos">5100</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5101</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatec</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatec_atms_nrl_LTrej</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">scatbg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatbg_atms_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5102</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_atms_nrl_LTrej</span><span class="p">)</span><span class="w"> </span><span class="n">n_cld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5103</span><span class="w">    </span><span class="n">cldcnt</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">cldcnt</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">n_cld</span><span class="w"></span>
<span class="linenos">5104</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_atms_nrl_LTrej</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5105</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5106</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5107</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5108</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_atms_nrl_LTrej</span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5109</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_atms_nrl_UTrej</span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5110</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatec</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatec_atms_nrl_UTrej</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">scatbg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatbg_atms_nrl_UTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5111</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">SeaIce</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.55</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5112</span>
<span class="linenos">5113</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5114</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">riwv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="p">)</span><span class="w">                                      </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5115</span>
<span class="linenos">5116</span><span class="w">    </span><span class="c">! Compute the simple AMSU-B Dryness Index zdi for all points = Tb(ch.3)-Tb(ch.5)</span>
<span class="linenos">5117</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5118</span><span class="k">      if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5119</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ztb_amsub3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ztb_amsub5</span><span class="w"></span>
<span class="linenos">5120</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">5121</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5122</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5123</span><span class="k">    else</span>
<span class="linenos">5124</span><span class="k">      if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5125</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ztb_amsub3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor_amsub3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">ztb_amsub5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor_amsub5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5126</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">5127</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5128</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5129</span><span class="k">    end if</span>
<span class="linenos">5130</span>
<span class="linenos">5131</span><span class="k">  end subroutine </span><span class="n">mwbg_flagDataUsingNrlCritAtms</span><span class="w"></span>
<span class="linenos">5132</span>
<span class="linenos">5133</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5134</span><span class="w">  </span><span class="c">! mwbg_flagDataUsingNrlCritMwhs2</span>
<span class="linenos">5135</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5136</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_flagDataUsingNrlCritMwhs2</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5137</span><span class="w">                                            </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">SeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5138</span><span class="w">                                            </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">cloudobs</span><span class="p">,</span><span class="w"> </span><span class="n">precipobs</span><span class="p">,</span><span class="w">  </span><span class="n">cldcnt</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5139</span>
<span class="linenos">5140</span><span class="w">    </span><span class="c">!:Purpose:                       Set the  Information flag (newInformationFlag) values (new BURP element 025174 in header)</span>
<span class="linenos">5141</span><span class="w">    </span><span class="c">!                                BIT    Meaning</span>
<span class="linenos">5142</span><span class="w">    </span><span class="c">!                                - 0     off=land or sea-ice, on=open water away from coast</span>
<span class="linenos">5143</span><span class="w">    </span><span class="c">!                                - 1     Mean 183 Ghz [ch. 18-22] is missing</span>
<span class="linenos">5144</span><span class="w">    </span><span class="c">!                                - 2     CLW is missing (over water)</span>
<span class="linenos">5145</span><span class="w">    </span><span class="c">!                                - 3     CLW &gt; clw_mwhs2_nrl_LTrej (0.175 kg/m2) (cloudobs)</span>
<span class="linenos">5146</span><span class="w">    </span><span class="c">!                                - 4     scatec &gt; Lower Troposphere limit 9/10 (precipobs)</span>
<span class="linenos">5147</span><span class="w">    </span><span class="c">!                                - 5     Mean 183 Ghz [ch. 18-22] Tb &lt; 240K</span>
<span class="linenos">5148</span><span class="w">    </span><span class="c">!                                - 6     CLW &gt; clw_mwhs2_nrl_UTrej (0.200 kg/m2)</span>
<span class="linenos">5149</span><span class="w">    </span><span class="c">!                               - 10     Sea ice &gt; 0.55 detected</span>
<span class="linenos">5150</span><span class="w">    </span><span class="c">!                               - 11     Gross error in Tb (any chan.)  (all channels rejected)</span>
<span class="linenos">5151</span>
<span class="linenos">5152</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">5153</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5154</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5155</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">5156</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec</span><span class="w"></span>
<span class="linenos">5157</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SeaIce</span><span class="w"></span>
<span class="linenos">5158</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="w"></span>
<span class="linenos">5159</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grossrej</span><span class="w"></span>
<span class="linenos">5160</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">5161</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldcnt</span><span class="w"></span>
<span class="linenos">5162</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudobs</span><span class="w"></span>
<span class="linenos">5163</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"></span>
<span class="linenos">5164</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">precipobs</span><span class="w"></span>
<span class="linenos">5165</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"></span>
<span class="linenos">5166</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdi</span><span class="w"></span>
<span class="linenos">5167</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">riwv</span><span class="w"></span>
<span class="linenos">5168</span>
<span class="linenos">5169</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5170</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">indx</span><span class="p">,</span><span class="w"> </span><span class="n">indx1</span><span class="p">,</span><span class="w"> </span><span class="n">n_cld</span><span class="w"></span>
<span class="linenos">5171</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ztb_amsub3</span><span class="p">,</span><span class="w"> </span><span class="n">bcor_amsub3</span><span class="p">,</span><span class="w"> </span><span class="n">ztb_amsub5</span><span class="p">,</span><span class="w"> </span><span class="n">bcor_amsub5</span><span class="p">,</span><span class="w">  </span><span class="n">ztb183</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5172</span>
<span class="linenos">5173</span><span class="w">    </span><span class="c">! To begin, assume that all obs are good.</span>
<span class="linenos">5174</span><span class="w">    </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">5175</span><span class="w">    </span><span class="n">n_cld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">5176</span><span class="w">    </span><span class="n">cloudobs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5177</span><span class="w">    </span><span class="n">iwvreject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5178</span><span class="w">    </span><span class="n">precipobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5179</span>
<span class="linenos">5180</span><span class="w">    </span><span class="c">! Extract Tb for channels 1 (AMSU-B 1) and 10 (AMSU-B 2) for Bennartz SI</span>
<span class="linenos">5181</span><span class="w">    </span><span class="c">! Extract Tb for channels 11 (AMSU-B 3) and 15 (AMSU-B 5) for Dryness Index (DI)</span>
<span class="linenos">5182</span>
<span class="linenos">5183</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5184</span><span class="w">    </span><span class="n">ztb_amsub3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5185</span><span class="w">    </span><span class="n">bcor_amsub3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5186</span><span class="w">    </span><span class="n">ztb_amsub5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">14</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5187</span><span class="w">    </span><span class="n">bcor_amsub5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="mi">14</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5188</span>
<span class="linenos">5189</span><span class="w">    </span><span class="c">! Flag data using NRL criteria</span>
<span class="linenos">5190</span>
<span class="linenos">5191</span><span class="w">    </span><span class="c">! Compute Mean 183 Ghz [ch. 11-15] Tb (riwv)</span>
<span class="linenos">5192</span><span class="w">    </span><span class="n">riwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.0</span><span class="w"></span>
<span class="linenos">5193</span><span class="w">    </span><span class="n">indx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5194</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">grossrej</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5195</span><span class="k">      do </span><span class="n">indx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="linenos">5196</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5197</span><span class="k">          </span><span class="n">ztb183</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5198</span><span class="w">        </span><span class="k">else</span>
<span class="linenos">5199</span><span class="k">          </span><span class="n">ztb183</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">indx1</span><span class="o">+</span><span class="n">indx</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5200</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5201</span><span class="k">      end do</span>
<span class="linenos">5202</span><span class="k">      </span><span class="n">riwv</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">ztb183</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">5.0</span><span class="w"></span>
<span class="linenos">5203</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">riwv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mean_Tb_183Ghz_min</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5204</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">5205</span><span class="k">      </span><span class="n">iwvreject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5206</span><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">5207</span>
<span class="linenos">5208</span><span class="w">    </span><span class="c">!  Set bits in newInformationFlag flag to identify where various data selection criteria are met</span>
<span class="linenos">5209</span><span class="w">    </span><span class="c">!     precipobs = .true  where ECMWF or BG scattering index &gt; min_threshold (LT)</span>
<span class="linenos">5210</span><span class="w">    </span><span class="c">!     cloudobs  = .true. where CLW &gt; min_threshold (LT) or if precipobs = .true</span>
<span class="linenos">5211</span>
<span class="linenos">5212</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5213</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatec</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatec_mwhs2_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5214</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_LTrej</span><span class="p">)</span><span class="w"> </span><span class="n">n_cld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5215</span><span class="w">    </span><span class="n">cldcnt</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">cldcnt</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">n_cld</span><span class="w"></span>
<span class="linenos">5216</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_LTrej</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5217</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5218</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5219</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5220</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_LTrej</span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5221</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_UTrej</span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5222</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">SeaIce</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.55</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5223</span>
<span class="linenos">5224</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5225</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">riwv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="p">)</span><span class="w">                                      </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5226</span>
<span class="linenos">5227</span><span class="w">    </span><span class="c">! Compute the simple AMSU-B Dryness Index zdi for all points = Tb(ch.3)-Tb(ch.5)</span>
<span class="linenos">5228</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">useUnbiasedObsForClw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5229</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5230</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ztb_amsub3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ztb_amsub5</span><span class="w"></span>
<span class="linenos">5231</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">5232</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5233</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5234</span><span class="k">    else</span>
<span class="linenos">5235</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5236</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ztb_amsub3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor_amsub3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">ztb_amsub5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bcor_amsub5</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5237</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">5238</span><span class="k">        </span><span class="n">zdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5239</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5240</span><span class="k">    end if</span>
<span class="linenos">5241</span>
<span class="linenos">5242</span><span class="k">  end subroutine </span><span class="n">mwbg_flagDataUsingNrlCritMwhs2</span><span class="w"></span>
<span class="linenos">5243</span>
<span class="linenos">5244</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5245</span><span class="w">  </span><span class="c">! mwbg_reviewAllCritforFinalFlagsAtms</span>
<span class="linenos">5246</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5247</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_reviewAllCritforFinalFlagsAtms</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5248</span><span class="w">                                                 </span><span class="n">precipobs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5249</span><span class="w">                                                 </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5250</span><span class="w">                                                 </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">drycnt</span><span class="p">,</span><span class="w"> </span><span class="n">landcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5251</span><span class="w">                                                 </span><span class="n">rejcnt</span><span class="p">,</span><span class="w"> </span><span class="n">iwvcnt</span><span class="p">,</span><span class="w"> </span><span class="n">pcpcnt</span><span class="p">,</span><span class="w"> </span><span class="n">flgcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5252</span><span class="w">                                                 </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5253</span>
<span class="linenos">5254</span><span class="w">    </span><span class="c">!:Purpose:                   Review all the checks previously made to determine which obs are to be accepted</span>
<span class="linenos">5255</span><span class="w">    </span><span class="c">!                            for assimilation and which are to be flagged for exclusion (lflagchn).</span>
<span class="linenos">5256</span><span class="w">    </span><span class="c">!                            - grossrej()  = .true. if any channel had a gross error at the point</span>
<span class="linenos">5257</span><span class="w">    </span><span class="c">!                            - cloudobs()  = .true. if CLW &gt; clw_atms_nrl_LTrej (0.175) or precipobs</span>
<span class="linenos">5258</span><span class="w">    </span><span class="c">!                            - precipobs() = .true. if precip. detected through NRL scattering indices</span>
<span class="linenos">5259</span><span class="w">    </span><span class="c">!                            - waterobs()  = .true. if open water point</span>
<span class="linenos">5260</span><span class="w">    </span><span class="c">!                            - iwvreject() = .true. if Mean 183 Ghz [ch. 18-22] Tb &lt; 240K (too dry for ch.20-22 over land)</span>
<span class="linenos">5261</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">5262</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">5263</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5264</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">5265</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">5266</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg</span><span class="w"></span>
<span class="linenos">5267</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec</span><span class="w"></span>
<span class="linenos">5268</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"></span>
<span class="linenos">5269</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">    </span>
<span class="linenos">5270</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grossrej</span><span class="w"></span>
<span class="linenos">5271</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">5272</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"></span>
<span class="linenos">5273</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">precipobs</span><span class="w"></span>
<span class="linenos">5274</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"></span>
<span class="linenos">5275</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdi</span><span class="w"></span>
<span class="linenos">5276</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">riwv</span><span class="w"></span>
<span class="linenos">5277</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5278</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"></span>
<span class="linenos">5279</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">drycnt</span><span class="w"></span>
<span class="linenos">5280</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landcnt</span><span class="w"></span>
<span class="linenos">5281</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rejcnt</span><span class="w"></span>
<span class="linenos">5282</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w"></span>
<span class="linenos">5283</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w"></span>
<span class="linenos">5284</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"></span>
<span class="linenos">5285</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5286</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5287</span>
<span class="linenos">5288</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5289</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">ipos</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"></span>
<span class="linenos">5290</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"></span>
<span class="linenos">5291</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5292</span>
<span class="linenos">5293</span><span class="w">    </span><span class="c">! Allocation</span>
<span class="linenos">5294</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">lflagchn</span><span class="p">,</span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5295</span>
<span class="linenos">5296</span><span class="w">    </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w">  </span><span class="c">! initialize with flags set in mwbg_firstQcCheckAtms</span>
<span class="linenos">5297</span><span class="w">    </span><span class="c">! Reject all channels if gross Tb error detected in any channel or other problems</span>
<span class="linenos">5298</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5299</span><span class="k">      </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5300</span><span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="linenos">5301</span>
<span class="linenos">5302</span><span class="w">      </span><span class="c">! OVER LAND OR SEA-ICE,</span>
<span class="linenos">5303</span><span class="w">      </span><span class="c">!    -- CLW/SI not determined over land</span>
<span class="linenos">5304</span><span class="w">      </span><span class="c">!    -- surface emissivity effects lower tropospheric and window channels</span>
<span class="linenos">5305</span><span class="w">      </span><span class="c">!    -- reject window &amp; lower tropospheric channels 1-6, 16-19</span>
<span class="linenos">5306</span><span class="w">      </span><span class="c">!    -- reject ch. 20-22 if iwvreject = .true.  [ Mean 183 Ghz [ch. 18-22] Tb &lt; 240K ]</span>
<span class="linenos">5307</span><span class="w">      </span><span class="c">!    -- check DI for AMSU-B like channels</span>
<span class="linenos">5308</span>
<span class="linenos">5309</span><span class="w">      </span><span class="k">if</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5310</span><span class="k">        </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mwbg_atmsNumSfcSensitiveChannel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">      </span><span class="c">! AMSU-A 1-6</span>
<span class="linenos">5311</span><span class="w">        </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">                                  </span><span class="c">! AMSU-B (like 1,2,5)</span>
<span class="linenos">5312</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">20</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">                 </span><span class="c">! AMSU-B (like 4,3)</span>
<span class="linenos">5313</span>
<span class="linenos">5314</span><span class="w">        </span><span class="c">! Dryness index (for AMSU-B channels 19-22 assimilated over land/sea-ice)</span>
<span class="linenos">5315</span><span class="w">        </span><span class="c">! Channel AMSUB-3 (ATMS channel 22) is rejected for a dryness index &gt;    0.</span>
<span class="linenos">5316</span><span class="w">        </span><span class="c">!                (ATMS channel 21) is rejected for a dryness index &gt;   -5.</span>
<span class="linenos">5317</span><span class="w">        </span><span class="c">! Channel AMSUB-4 (ATMS channel 20) is rejected for a dryness index &gt;   -8.</span>
<span class="linenos">5318</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">zdi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5319</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5320</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5321</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5322</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">zdi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">5.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5323</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5324</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5325</span><span class="w">          </span><span class="n">drycnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drycnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5326</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5327</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">zdi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">8.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5328</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5329</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5330</span>
<span class="linenos">5331</span><span class="k">      else</span><span class="w">  </span><span class="c">! if waterobs</span>
<span class="linenos">5332</span>
<span class="linenos">5333</span><span class="w">      </span><span class="c">! OVER WATER,</span>
<span class="linenos">5334</span><span class="w">      </span><span class="c">!    in clear-sky mode:</span>
<span class="linenos">5335</span><span class="w">      </span><span class="c">!    -- reject ch. 5-6, if CLW &gt; clw_atms_nrl_LTrej or CLW = -99.0</span>
<span class="linenos">5336</span><span class="w">      </span><span class="c">!    in all-sky mode:</span>
<span class="linenos">5337</span><span class="w">      </span><span class="c">!    -- reject ch. 5-6, if CLW &gt; mwbg_clwQcThreshold or CLW = -99.0</span>
<span class="linenos">5338</span><span class="w">      </span><span class="c">!</span>
<span class="linenos">5339</span><span class="w">      </span><span class="c">!    -- reject ch. 1-4, if CLW &gt; clw_atms_nrl_LTrej or CLW = -99.0</span>
<span class="linenos">5340</span><span class="w">      </span><span class="c">!    -- reject ch. 16-20 if CLW &gt; clw_atms_nrl_LTrej or CLW = -99.0</span>
<span class="linenos">5341</span><span class="w">      </span><span class="c">!    -- reject ch. 7-9, 21-22 if CLW &gt; clw_atms_nrl_UTrej or CLW = -99.0</span>
<span class="linenos">5342</span><span class="w">      </span><span class="c">!    -- reject ch. 1-6, 16-22 if scatec &gt; 9  or scatec = -99.0</span>
<span class="linenos">5343</span><span class="w">      </span><span class="c">!    -- reject ch. 7-9        if scatec &gt; 18 or scatec = -99.0</span>
<span class="linenos">5344</span><span class="w">      </span><span class="c">!    -- reject ch. 1-6        if scatbg &gt; 10 or scatbg = -99.0</span>
<span class="linenos">5345</span><span class="w">      </span><span class="c">!    -- reject ch. 7-9        if scatbg &gt; 15 or scatbg = -99.0</span>
<span class="linenos">5346</span><span class="w">      </span><span class="c">!    -- reject ch. 16-22      if iwvreject = .true.   [ Mean 183 Ghz [ch. 18-22] Tb &lt; 240K ]</span>
<span class="linenos">5347</span>
<span class="linenos">5348</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_atms_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">5349</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5350</span><span class="k">            </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5351</span><span class="w">            </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5352</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_clwQcThreshold</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5353</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">5354</span><span class="k">            </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mwbg_atmsNumSfcSensitiveChannel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5355</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">5356</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5357</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5358</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_atms_nrl_UTrej</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">5359</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5360</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">21</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5361</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5362</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatec</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">scatec_atms_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5363</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mwbg_atmsNumSfcSensitiveChannel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5364</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5365</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5366</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatec</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatec_atms_nrl_UTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5367</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatbg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatbg_atms_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">mwbg_atmsNumSfcSensitiveChannel</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5368</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatbg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatbg_atms_nrl_UTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5369</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5370</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5371</span><span class="k">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5372</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">9</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5373</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5374</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5375</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">riwv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">     </span><span class="c">! riwv = mean_Tb_183Ghz</span>
<span class="linenos">5376</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5377</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5378</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5379</span><span class="k">      end if</span><span class="w">  </span><span class="c">! if waterobs</span>
<span class="linenos">5380</span>
<span class="linenos">5381</span><span class="w">    </span><span class="k">end if</span><span class="w">  </span><span class="c">! if .not. grossrej</span>
<span class="linenos">5382</span>
<span class="linenos">5383</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">landcnt</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">landcnt</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5384</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="n">rejcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5385</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">)</span><span class="w">  </span><span class="n">iwvcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5386</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5387</span><span class="k">      </span><span class="n">pcpcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5388</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5389</span>
<span class="linenos">5390</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ANY</span><span class="p">(</span><span class="n">lflagchn</span><span class="p">(:))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5391</span>
<span class="linenos">5392</span><span class="w">    </span><span class="c">! RESET scatIndexOverWaterObs array to ECMWF scattering index for output to BURP file</span>
<span class="linenos">5393</span><span class="w">    </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatec</span><span class="w"></span>
<span class="linenos">5394</span><span class="w">    </span><span class="c">! Set missing cloudLiquidWaterPathObs and scatIndexOverWaterObs to BURP missing value (mwbg_realMissing)</span>
<span class="linenos">5395</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5396</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5397</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5398</span><span class="w">    </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5399</span>
<span class="linenos">5400</span><span class="w">    </span><span class="c">! Modify data flag values (set bit 7) for rejected data</span>
<span class="linenos">5401</span><span class="w">    </span><span class="c">! In all-sky mode, turn on bit=23 for channels in chanIgnoreInAllskyGenCoeff(:)</span>
<span class="linenos">5402</span><span class="w">    </span><span class="c">! as cloud-affected radiances over sea when there is mismatch between </span>
<span class="linenos">5403</span><span class="w">    </span><span class="c">! cloudLiquidWaterPathObs and cloudLiquidWaterPathFG (to be used in gen_bias_corr)</span>
<span class="linenos">5404</span><span class="w">    </span><span class="n">ipos</span><span class="o">=</span><span class="mi">0</span><span class="w"></span>
<span class="linenos">5405</span><span class="w">    </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5406</span><span class="w">    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">5407</span><span class="w">      </span><span class="n">ipos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5408</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lflagchn</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5409</span><span class="k">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5410</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5411</span>
<span class="linenos">5412</span><span class="k">      </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">ipos</span><span class="p">))</span><span class="w"></span>
<span class="linenos">5413</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5414</span><span class="w">          </span><span class="p">(</span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_cloudyClwThresholdBcorr</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5415</span><span class="w">           </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5416</span><span class="w">           </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5417</span><span class="k">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">),</span><span class="mi">23</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5418</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5419</span><span class="k">    end do</span><span class="w"></span>
<span class="linenos">5420</span>
<span class="linenos">5421</span><span class="w">    </span><span class="c">! Set bit 6 in 24-bit global flags if any data rejected</span>
<span class="linenos">5422</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ANY</span><span class="p">(</span><span class="n">lflagchn</span><span class="p">(:))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5423</span>
<span class="linenos">5424</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_reviewAllCritforFinalFlagsAtms</span><span class="w"></span>
<span class="linenos">5425</span>
<span class="linenos">5426</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5427</span><span class="w">  </span><span class="c">! mwbg_reviewAllCritforFinalFlagsMwhs2</span>
<span class="linenos">5428</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5429</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_reviewAllCritforFinalFlagsMwhs2</span><span class="p">(</span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">,</span><span class="w"> </span><span class="n">grossrej</span><span class="p">,</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">waterobs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5430</span><span class="w">                                                  </span><span class="n">precipobs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="n">scatec</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5431</span><span class="w">                                                  </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">,</span><span class="w"> </span><span class="n">riwv</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5432</span><span class="w">                                                  </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">zdi</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">allcnt</span><span class="p">,</span><span class="w"> </span><span class="n">drycnt</span><span class="p">,</span><span class="w"> </span><span class="n">landcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5433</span><span class="w">                                                  </span><span class="n">rejcnt</span><span class="p">,</span><span class="w"> </span><span class="n">iwvcnt</span><span class="p">,</span><span class="w"> </span><span class="n">pcpcnt</span><span class="p">,</span><span class="w"> </span><span class="n">flgcnt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5434</span><span class="w">                                                  </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5435</span>
<span class="linenos">5436</span><span class="w">    </span><span class="c">!:Purpose:                   Review all the checks previously made to determine which obs are to be accepted</span>
<span class="linenos">5437</span><span class="w">    </span><span class="c">!                            for assimilation and which are to be flagged for exclusion (lflagchn).</span>
<span class="linenos">5438</span><span class="w">    </span><span class="c">!                            - grossrej()  = .true. if any channel had a gross error at the point</span>
<span class="linenos">5439</span><span class="w">    </span><span class="c">!                            - cloudobs()  = .true. if CLW &gt; clw_mwhs2_nrl_LTrej (0.175) or precipobs</span>
<span class="linenos">5440</span><span class="w">    </span><span class="c">!                            - precipobs() = .true. if precip. detected through NRL scattering indices</span>
<span class="linenos">5441</span><span class="w">    </span><span class="c">!                            - waterobs()  = .true. if open water point</span>
<span class="linenos">5442</span><span class="w">    </span><span class="c">!                            - iwvreject() = .true. if Mean 183 Ghz [ch. 18-22] Tb &lt; 240K (too dry for ch.20-22 over land)</span>
<span class="linenos">5443</span><span class="w">    </span><span class="c">! Arguments</span>
<span class="linenos">5444</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">5445</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5446</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"></span>
<span class="linenos">5447</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"></span>
<span class="linenos">5448</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatec</span><span class="w"></span>
<span class="linenos">5449</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatbg</span><span class="w"></span>
<span class="linenos">5450</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"></span>
<span class="linenos">5451</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w"></span>
<span class="linenos">5452</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grossrej</span><span class="w"></span>
<span class="linenos">5453</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">waterobs</span><span class="w"></span>
<span class="linenos">5454</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"></span>
<span class="linenos">5455</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">precipobs</span><span class="w"></span>
<span class="linenos">5456</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w"></span>
<span class="linenos">5457</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdi</span><span class="w"></span>
<span class="linenos">5458</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">riwv</span><span class="w"></span>
<span class="linenos">5459</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5460</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"></span>
<span class="linenos">5461</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">allcnt</span><span class="w"></span>
<span class="linenos">5462</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">drycnt</span><span class="w"></span>
<span class="linenos">5463</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landcnt</span><span class="w"></span>
<span class="linenos">5464</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rejcnt</span><span class="w"></span>
<span class="linenos">5465</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w"></span>
<span class="linenos">5466</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w"></span>
<span class="linenos">5467</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"></span>
<span class="linenos">5468</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"></span>
<span class="linenos">5469</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5470</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5471</span>
<span class="linenos">5472</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5473</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">ipos</span><span class="p">,</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"></span>
<span class="linenos">5474</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="p">,</span><span class="w"> </span><span class="n">scatbg_rej</span><span class="w"></span>
<span class="linenos">5475</span><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"></span>
<span class="linenos">5476</span>
<span class="linenos">5477</span><span class="w">    </span><span class="c">! Allocation</span>
<span class="linenos">5478</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">lflagchn</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5479</span>
<span class="linenos">5480</span><span class="w">    </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qcRejectLogic</span><span class="p">(:)</span><span class="w">  </span><span class="c">! initialize with flags set in mwbg_firstQcCheckMwhs2</span>
<span class="linenos">5481</span><span class="w">    </span><span class="n">allcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">! Counting total number of observations</span>
<span class="linenos">5482</span><span class="w">    </span><span class="c">! Reject all channels if gross Tb error detected in any channel or other problems</span>
<span class="linenos">5483</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5484</span><span class="k">      </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5485</span><span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="linenos">5486</span>
<span class="linenos">5487</span><span class="w">      </span><span class="c">! OVER LAND OR SEA-ICE,</span>
<span class="linenos">5488</span><span class="w">      </span><span class="c">!    -- CLW/SI not determined over land</span>
<span class="linenos">5489</span><span class="w">      </span><span class="c">!    -- surface emissivity effects lower tropospheric and window channels</span>
<span class="linenos">5490</span><span class="w">      </span><span class="c">!    -- reject window &amp; lower tropospheric channels 1,10,14,15</span>
<span class="linenos">5491</span><span class="w">      </span><span class="c">!    -- reject ch. 11-13 if iwvreject = .true.  [ Mean 183 Ghz [ch. 18-22] Tb &lt; 240K ]</span>
<span class="linenos">5492</span><span class="w">      </span><span class="c">!    -- check DI for AMSU-B like channels</span>
<span class="linenos">5493</span><span class="w">      </span><span class="c">!    -- reject all channels if scatbg exceeds CMC thresholds for AMSU-B</span>
<span class="linenos">5494</span>
<span class="linenos">5495</span><span class="w">      </span><span class="k">if</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5496</span><span class="k">        </span><span class="n">lflagchn</span><span class="p">((</span><span class="o">/</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="w"> </span><span class="o">/</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">       </span><span class="c">! AMSU-B (like 1,2,5)</span>
<span class="linenos">5497</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"> </span><span class="c">! AMSU-B (like 4,3)</span>
<span class="linenos">5498</span>
<span class="linenos">5499</span><span class="w">        </span><span class="c">! Dryness index (for AMSU-B channels 11-14 assimilated over land/sea-ice)</span>
<span class="linenos">5500</span><span class="w">        </span><span class="c">! Channel AMSUB-3 (MWHS-2 channel 11) is rejected for a dryness index &gt;    0.</span>
<span class="linenos">5501</span><span class="w">        </span><span class="c">!                 (MWHS-2 channel 12) is rejected for a dryness index &gt;   -5.</span>
<span class="linenos">5502</span><span class="w">        </span><span class="c">! Channel AMSUB-4 (MWHS-2 channel 13) is rejected for a dryness index &gt;   -8.</span>
<span class="linenos">5503</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">zdi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5504</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5505</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5506</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5507</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">zdi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">5.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5508</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5509</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5510</span><span class="w">          </span><span class="n">drycnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drycnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5511</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5512</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">zdi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">8.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5513</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5514</span><span class="w">        </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">5515</span>
<span class="linenos">5516</span><span class="w">        </span><span class="c">! Bennartz -Grody SI check thresholds (same as for QC of AMSU-B/MHS)</span>
<span class="linenos">5517</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">calcTerrainTypeIndice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! sea-ice</span>
<span class="linenos">5518</span><span class="w">          </span><span class="n">scatbg_rej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatbg_mwhs2_cmc_ICErej</span><span class="w"></span>
<span class="linenos">5519</span><span class="w">        </span><span class="k">else</span><span class="w">                     </span><span class="c">! land</span>
<span class="linenos">5520</span><span class="w">          </span><span class="n">scatbg_rej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatbg_mwhs2_cmc_LANDrej</span><span class="w"></span>
<span class="linenos">5521</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5522</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatbg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatbg_rej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5523</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5524</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5525</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5526</span>
<span class="linenos">5527</span><span class="k">      else</span><span class="w">  </span><span class="c">! if waterobs</span>
<span class="linenos">5528</span>
<span class="linenos">5529</span><span class="w">      </span><span class="c">! OVER WATER,</span>
<span class="linenos">5530</span><span class="w">      </span><span class="c">!-----------------------------------------------------------------</span>
<span class="linenos">5531</span><span class="w">      </span><span class="c">! PLACEHOLDER VALUES FOR ALLSKY ASSIM, SINCE NOT IMPLEMENTED YET</span>
<span class="linenos">5532</span><span class="w">      </span><span class="c">!    in clear-sky mode:</span>
<span class="linenos">5533</span><span class="w">      </span><span class="c">!    -- reject ch. 1, if CLW &gt; clw_mwhs2_nrl_LTrej or CLW = -99.0</span>
<span class="linenos">5534</span><span class="w">      </span><span class="c">!    in all-sky mode:</span>
<span class="linenos">5535</span><span class="w">      </span><span class="c">!    -- reject ch. 1, if CLW &gt; mwbg_clwQcThreshold or CLW = -99.0</span>
<span class="linenos">5536</span><span class="w">      </span><span class="c">!-----------------------------------------------------------------</span>
<span class="linenos">5537</span><span class="w">      </span><span class="c">!    -- reject ch. 1, 10, 13-15 if CLW &gt; clw_mwhs2_nrl_LTrej</span>
<span class="linenos">5538</span><span class="w">      </span><span class="c">!    -- reject ch. 11-12 if CLW &gt; clw_mwhs2_nrl_UTrej</span>
<span class="linenos">5539</span><span class="w">      </span><span class="c">!    -- reject ch. 1, 10-15 if scatec &gt; 9  or scatec = -99.0</span>
<span class="linenos">5540</span><span class="w">      </span><span class="c">!    -- reject ch. 1, 10-15 if iwvreject = .true.   [ Mean 183 Ghz [ch. 11-15] Tb &lt; 240K ]</span>
<span class="linenos">5541</span><span class="w">      </span><span class="c">!    -- reject all channels if scatbg exceeds CMC SEA threshold for AMSU-B</span>
<span class="linenos">5542</span>
<span class="linenos">5543</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">5544</span><span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! NEVER TRUE SINCE NOT IMPLEMENTED YET</span>
<span class="linenos">5545</span><span class="w">            </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5546</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_clwQcThreshold</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5547</span><span class="w">          </span><span class="k">else</span>
<span class="linenos">5548</span><span class="k">            </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5549</span><span class="w">          </span><span class="k">end if</span>
<span class="linenos">5550</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">((</span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="w"> </span><span class="o">/</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5551</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5552</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clw_mwhs2_nrl_UTrej</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="k">then</span>
<span class="linenos">5553</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5554</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5555</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatec</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">scatec_mwhs2_nrl_LTrej</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5556</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5557</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5558</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5559</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5560</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5561</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5562</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5563</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">riwv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">     </span><span class="c">! riwv = mean_Tb_183Ghz</span>
<span class="linenos">5564</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5565</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5566</span><span class="w">          </span><span class="n">lflagchn</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5567</span><span class="w">        </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">5568</span><span class="w">        </span><span class="c">! Bennartz-Grody SI check thresholds (same as for QC of AMSU-B/MHS)</span>
<span class="linenos">5569</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scatbg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">scatbg_mwhs2_cmc_SEA</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5570</span><span class="k">          </span><span class="n">lflagchn</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5571</span><span class="w">          </span><span class="n">newInformationFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">newInformationFlag</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5572</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5573</span><span class="k">      end if</span><span class="w">  </span><span class="c">! if waterobs</span>
<span class="linenos">5574</span>
<span class="linenos">5575</span><span class="w">    </span><span class="k">end if</span><span class="w">  </span><span class="c">! if .not. grossrej</span>
<span class="linenos">5576</span>
<span class="linenos">5577</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">landcnt</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">landcnt</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5578</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">grossrej</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="n">rejcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5579</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iwvreject</span><span class="p">)</span><span class="w">  </span><span class="n">iwvcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iwvcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5580</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">precipobs</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5581</span><span class="k">      </span><span class="n">pcpcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcpcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5582</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5583</span>
<span class="linenos">5584</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ANY</span><span class="p">(</span><span class="n">lflagchn</span><span class="p">(:))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flgcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5585</span>
<span class="linenos">5586</span><span class="w">    </span><span class="c">! RESET scatIndexOverWaterObs array to Bennartz-Grody scattering index for output to BURP file</span>
<span class="linenos">5587</span><span class="w">    </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatbg</span><span class="w"></span>
<span class="linenos">5588</span><span class="w">    </span><span class="c">! Set missing cloudLiquidWaterPathObs and scatIndexOverWaterObs to BURP missing value (mwbg_realMissing)</span>
<span class="linenos">5589</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5590</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5591</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="mf">9.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5592</span><span class="w">    </span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5593</span>
<span class="linenos">5594</span><span class="w">    </span><span class="c">! Modify data flag values (set bit 7) for rejected data</span>
<span class="linenos">5595</span><span class="w">    </span><span class="c">! In all-sky mode, turn on bit=23 for channels in chanIgnoreInAllskyGenCoeff(:)</span>
<span class="linenos">5596</span><span class="w">    </span><span class="c">! as cloud-affected radiances over sea when there is mismatch between </span>
<span class="linenos">5597</span><span class="w">    </span><span class="c">! cloudLiquidWaterPathObs and cloudLiquidWaterPathFG (to be used in gen_bias_corr)</span>
<span class="linenos">5598</span><span class="w">    </span><span class="n">ipos</span><span class="o">=</span><span class="mi">0</span><span class="w"></span>
<span class="linenos">5599</span><span class="w">    </span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5600</span>
<span class="linenos">5601</span><span class="w">    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">5602</span><span class="w">      </span><span class="n">ipos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5603</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lflagchn</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5604</span><span class="k">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5605</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5606</span>
<span class="linenos">5607</span><span class="k">      </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISRCHEQI</span><span class="p">(</span><span class="n">chanIgnoreInAllskyGenCoeff</span><span class="p">,</span><span class="n">obsChannels</span><span class="p">(</span><span class="n">ipos</span><span class="p">))</span><span class="w"></span>
<span class="linenos">5608</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_mwAllskyAssim</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">waterobs</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">INDXCAN</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5609</span><span class="w">          </span><span class="p">(</span><span class="n">clwObsFGaveraged</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mwbg_cloudyClwThresholdBcorr</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5610</span><span class="w">           </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5611</span><span class="w">           </span><span class="n">cloudLiquidWaterPathFG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5612</span><span class="k">        </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">(</span><span class="n">ipos</span><span class="p">),</span><span class="mi">23</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5613</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5614</span><span class="k">    end do</span><span class="w"></span>
<span class="linenos">5615</span>
<span class="linenos">5616</span><span class="w">    </span><span class="c">! Set bit 6 in 24-bit global flags if any data rejected</span>
<span class="linenos">5617</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ANY</span><span class="p">(</span><span class="n">lflagchn</span><span class="p">(:))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">IBSET</span><span class="p">(</span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5618</span>
<span class="linenos">5619</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_reviewAllCritforFinalFlagsMwhs2</span><span class="w"></span>
<span class="linenos">5620</span>
<span class="linenos">5621</span><span class="w">  </span><span class="k">function </span><span class="n">calcStateDepObsErr_r4</span><span class="p">(</span><span class="n">cldPredThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">cldPredThresh2</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5622</span><span class="w">                                 </span><span class="n">errThresh1</span><span class="p">,</span><span class="w"> </span><span class="n">errThresh2</span><span class="p">,</span><span class="w"> </span><span class="n">cldPredUsed</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">sigmaObsErrUsed</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5623</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">5624</span><span class="w">    </span><span class="c">!:Purpose: Calculate single-precision state-dependent observation error.</span>
<span class="linenos">5625</span><span class="w">    </span><span class="c">!                                 </span>
<span class="linenos">5626</span><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="linenos">5627</span>
<span class="linenos">5628</span><span class="w">    </span><span class="c">! Arguments:</span>
<span class="linenos">5629</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldPredThresh1</span><span class="w">  </span><span class="c">! first cloud predictor threshold</span>
<span class="linenos">5630</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldPredThresh2</span><span class="w">  </span><span class="c">! second cloud predictor threshold</span>
<span class="linenos">5631</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">errThresh1</span><span class="w">      </span><span class="c">! sigmaO corresponding to first cloud predictor threshold</span>
<span class="linenos">5632</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">errThresh2</span><span class="w">      </span><span class="c">! sigmaO corresponding to second cloud predictor threshold</span>
<span class="linenos">5633</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cldPredUsed</span><span class="w">     </span><span class="c">! cloud predictor for the obs</span>
<span class="linenos">5634</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">             </span><span class="kd">::</span><span class="w"> </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="c">! estimated sigmaO for the obs</span>
<span class="linenos">5635</span>
<span class="linenos">5636</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cldPredUsed</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cldPredThresh1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5637</span><span class="k">      </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errThresh1</span><span class="w"></span>
<span class="linenos">5638</span><span class="w">    </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">cldPredUsed</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">cldPredThresh1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">5639</span><span class="w">             </span><span class="n">cldPredUsed</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cldPredThresh2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5640</span><span class="k">      </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errThresh1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5641</span><span class="w">                        </span><span class="p">(</span><span class="n">errThresh2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errThresh1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5642</span><span class="w">                        </span><span class="p">(</span><span class="n">cldPredThresh2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cldPredThresh1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5643</span><span class="w">                        </span><span class="p">(</span><span class="n">cldPredUsed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cldPredThresh1</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5644</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">5645</span><span class="k">      </span><span class="n">sigmaObsErrUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errThresh2</span><span class="w"></span>
<span class="linenos">5646</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5647</span>
<span class="linenos">5648</span><span class="k">  end function </span><span class="n">calcStateDepObsErr_r4</span><span class="w"></span>
<span class="linenos">5649</span>
<span class="linenos">5650</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5651</span><span class="w">  </span><span class="c">! mwbg_updateObsSpaceAfterQc</span>
<span class="linenos">5652</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5653</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_updateObsSpaceAfterQc</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5654</span><span class="w">                                        </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5655</span><span class="w">                                        </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5656</span><span class="w">                                        </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5657</span>
<span class="linenos">5658</span><span class="w">    </span><span class="c">!:Purpose:      Update obspacedata variables (obstTB and obs flags) after QC</span>
<span class="linenos">5659</span><span class="w">    </span><span class="k">implicit None</span><span class="w"></span>
<span class="linenos">5660</span>
<span class="linenos">5661</span><span class="w">    </span><span class="c">!Arguments</span>
<span class="linenos">5662</span><span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">struct_obs</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="w">            </span><span class="c">! obspaceData Object</span>
<span class="linenos">5663</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">             </span><span class="c">! tvs_sensorIndex</span>
<span class="linenos">5664</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">headerIndex</span><span class="w">             </span><span class="c">! current header index</span>
<span class="linenos">5665</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">             </span><span class="c">! data flags</span>
<span class="linenos">5666</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">                </span><span class="c">! obs Tb</span>
<span class="linenos">5667</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w"> </span><span class="c">! obs CLW</span>
<span class="linenos">5668</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">  </span><span class="c">! trial CLW</span>
<span class="linenos">5669</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">   </span><span class="c">! atmospheric scatering index from observation</span>
<span class="linenos">5670</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">    </span><span class="c">! atmospheric scatering index from background</span>
<span class="linenos">5671</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">      </span><span class="c">! information flag used with satplot</span>
<span class="linenos">5672</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">             </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w">         </span><span class="c">! information flag used with satplot</span>
<span class="linenos">5673</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5674</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsNumCurrentLoc</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndexbeg</span><span class="p">,</span><span class="w"> </span><span class="n">currentChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="n">codtyp</span><span class="w"></span>
<span class="linenos">5675</span>
<span class="linenos">5676</span><span class="w">    </span><span class="n">codtyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ITY</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5677</span><span class="w">    </span><span class="k">call </span><span class="n">obs_headSet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_CLWO</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5678</span>
<span class="linenos">5679</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_isInstrumAllskyTtAssim</span><span class="p">(</span><span class="n">tvs_getInstrumentId</span><span class="p">(</span><span class="n">codtyp_get_name</span><span class="p">(</span><span class="n">codtyp</span><span class="p">))))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5680</span><span class="k">      call </span><span class="n">obs_headSet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_CLWB</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5681</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5682</span>
<span class="linenos">5683</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterObs</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5684</span><span class="k">      call </span><span class="n">obs_headSet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SIO</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5685</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">5686</span><span class="k">      call </span><span class="n">obs_headSet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SIO</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5687</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5688</span>
<span class="linenos">5689</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_isInstrumAllskyHuAssim</span><span class="p">(</span><span class="n">tvs_getInstrumentId</span><span class="p">(</span><span class="n">codtyp_get_name</span><span class="p">(</span><span class="n">codtyp</span><span class="p">))))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5690</span><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">scatIndexOverWaterFG</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5691</span><span class="k">        call </span><span class="n">obs_headSet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SIB</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5692</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">5693</span><span class="k">        call </span><span class="n">obs_headSet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SIB</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">MPC_missingValue_R4</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5694</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5695</span><span class="k">    end if</span>
<span class="linenos">5696</span><span class="k">    </span>
<span class="linenos">5697</span><span class="k">    call </span><span class="n">obs_headSet_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_INFG</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5698</span><span class="w">    </span><span class="k">call </span><span class="n">obs_headSet_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ST1</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5699</span><span class="w">    </span><span class="n">bodyIndexbeg</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_RLN</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5700</span><span class="w">    </span><span class="n">obsNumCurrentLoc</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_NLV</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5701</span><span class="w">    </span><span class="n">BODY</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">bodyIndex</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">bodyIndexbeg</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndexbeg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">obsNumCurrentLoc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5702</span><span class="w">      </span><span class="n">currentChannelNumber</span><span class="o">=</span><span class="nb">nint</span><span class="p">(</span><span class="n">obs_bodyElem_r</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w">  </span><span class="n">OBS_PPP</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="w"> </span><span class="p">))</span><span class="o">-</span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5703</span><span class="w">      </span><span class="k">call </span><span class="n">obs_bodySet_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_VAR</span><span class="p">,</span><span class="w">   </span><span class="n">bodyIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">))</span><span class="w"></span>
<span class="linenos">5704</span><span class="w">      </span><span class="k">call </span><span class="n">obs_bodySet_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_FLG</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">))</span><span class="w"></span>
<span class="linenos">5705</span><span class="w">    </span><span class="k">end do </span><span class="n">BODY</span><span class="w"></span>
<span class="linenos">5706</span>
<span class="linenos">5707</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_updateObsSpaceAfterQc</span><span class="w">  </span>
<span class="linenos">5708</span><span class="w">   </span>
<span class="linenos">5709</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5710</span><span class="w">  </span><span class="c">!  mwbg_readObsFromObsSpace</span>
<span class="linenos">5711</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5712</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_readObsFromObsSpace</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5713</span><span class="w">                                      </span><span class="n">satIdentifier</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5714</span><span class="w">                                      </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5715</span><span class="w">                                      </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="n">satOrbit</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">5716</span><span class="w">                                      </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5717</span><span class="w">                                      </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5718</span><span class="w">                                      </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5719</span><span class="w">    </span>
<span class="linenos">5720</span><span class="w">    </span><span class="c">!:Purpose: copy headers and bodies from obsSpaceData object to arrays</span>
<span class="linenos">5721</span>
<span class="linenos">5722</span><span class="w">    </span><span class="k">implicit None</span><span class="w"></span>
<span class="linenos">5723</span>
<span class="linenos">5724</span><span class="w">    </span><span class="c">!Arguments</span>
<span class="linenos">5725</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">InstName</span><span class="w">            </span><span class="c">! Instrument Name</span>
<span class="linenos">5726</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">               </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">headerIndex</span><span class="w">         </span><span class="c">! current header Index </span>
<span class="linenos">5727</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satIdentifier</span><span class="w">       </span><span class="c">! satellite identifier</span>
<span class="linenos">5728</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">      </span><span class="c">! satellite zenith angle (btyp=3072,ele=7024) </span>
<span class="linenos">5729</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="c">! land/sea qualifier     (btyp=3072,ele=8012)</span>
<span class="linenos">5730</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">   </span><span class="c">! terrain-type (ice)     (btyp=3072,ele=13039)</span>
<span class="linenos">5731</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w">              </span><span class="c">! latitude values (btyp=5120,ele=5002)</span>
<span class="linenos">5732</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w">              </span><span class="c">! longitude values (btyp=5120,ele=6002)</span>
<span class="linenos">5733</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">     </span><span class="c">! scan position (fov)    (btyp=3072,ele=5043)</span>
<span class="linenos">5734</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">(:)</span><span class="w">       </span><span class="c">! flag values for btyp=3072 block ele 033078, 033079, 033080</span>
<span class="linenos">5735</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">satOrbit</span><span class="w">            </span><span class="c">! orbit number</span>
<span class="linenos">5736</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w">     </span><span class="c">! global Marqueur Data</span>
<span class="linenos">5737</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="w">     </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">               </span><span class="c">! Platform Name</span>
<span class="linenos">5738</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">            </span><span class="c">! brightness temperature (btyp=9248/9264,ele=12163) </span>
<span class="linenos">5739</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">btClear</span><span class="p">(:)</span><span class="w">          </span><span class="c">! clear brightness temperature (btyp=9248/9264,ele=btClearElementId)</span>
<span class="linenos">5740</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w">    </span><span class="c">! bias correction </span>
<span class="linenos">5741</span><span class="w">    </span><span class="kt">real</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w">            </span><span class="c">! OMP values</span>
<span class="linenos">5742</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">(:)</span><span class="w">       </span><span class="c">! flag values for btyp=9248 block ele 033081      </span>
<span class="linenos">5743</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w">      </span><span class="c">! channel numbers btyp=9248 block ele 5042 (= 1-22)</span>
<span class="linenos">5744</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">         </span><span class="c">! data flags</span>
<span class="linenos">5745</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">         </span><span class="c">! find tvs_sensor index corresponding to current obs</span>
<span class="linenos">5746</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w">              </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">    </span><span class="c">! actual Num channel</span>
<span class="linenos">5747</span><span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">struct_obs</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="w">        </span><span class="c">! obspaceData Object</span>
<span class="linenos">5748</span>
<span class="linenos">5749</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5750</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsNumCurrentLoc</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndexbeg</span><span class="p">,</span><span class="w"> </span><span class="n">currentChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="n">channelIndex</span><span class="w"></span>
<span class="linenos">5751</span><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iplatform</span><span class="p">,</span><span class="w"> </span><span class="n">instrum</span><span class="p">,</span><span class="w"> </span><span class="n">isat</span><span class="p">,</span><span class="w"> </span><span class="n">iplatf</span><span class="p">,</span><span class="w"> </span><span class="n">instr</span><span class="p">,</span><span class="w"> </span><span class="n">codtyp</span><span class="w"></span>
<span class="linenos">5752</span><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndexFound</span><span class="w"></span>
<span class="linenos">5753</span>
<span class="linenos">5754</span><span class="w">   </span><span class="c">! find tvs_sensor index corresponding to current obs</span>
<span class="linenos">5755</span><span class="w">    </span><span class="n">iplatf</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SAT</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5756</span><span class="w">    </span><span class="n">instr</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_INS</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5757</span>
<span class="linenos">5758</span><span class="w">    </span><span class="k">call </span><span class="n">tvs_mapSat</span><span class="p">(</span><span class="w"> </span><span class="n">iplatf</span><span class="p">,</span><span class="w"> </span><span class="n">iplatform</span><span class="p">,</span><span class="w"> </span><span class="n">isat</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5759</span><span class="w">    </span><span class="k">call </span><span class="n">tvs_mapInstrum</span><span class="p">(</span><span class="w"> </span><span class="n">instr</span><span class="p">,</span><span class="w"> </span><span class="n">instrum</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5760</span><span class="w">    </span>
<span class="linenos">5761</span><span class="w">    </span><span class="n">sensorIndexFound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5762</span><span class="w">    </span><span class="k">do </span><span class="n">sensorIndex</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tvs_nsensors</span><span class="w"></span>
<span class="linenos">5763</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iplatform</span><span class="w"> </span><span class="o">==</span><span class="w">  </span><span class="n">tvs_platforms</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5764</span><span class="w">           </span><span class="n">isat</span><span class="w">      </span><span class="o">==</span><span class="w">  </span><span class="n">tvs_satellites</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5765</span><span class="w">           </span><span class="n">instrum</span><span class="w">   </span><span class="o">==</span><span class="w"> </span><span class="n">tvs_instruments</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w">       </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5766</span><span class="k">          </span><span class="n">sensorIndexFound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"> </span>
<span class="linenos">5767</span><span class="w">         </span><span class="k">exit</span>
<span class="linenos">5768</span><span class="k">      end if</span>
<span class="linenos">5769</span><span class="k">    end do</span>
<span class="linenos">5770</span><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">sensorIndexFound</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">utl_abort</span><span class="p">(</span><span class="s1">&#39;mwbg_readObsFromObsSpace: sensor Index not found&#39;</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5771</span>
<span class="linenos">5772</span><span class="w">    </span><span class="c">! find actual Number of channels</span>
<span class="linenos">5773</span><span class="w">    </span><span class="n">actualNumChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tvs_coefs</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)%</span><span class="n">coef</span><span class="p">%</span><span class="n">fmv_ori_nchn</span><span class="w"></span>
<span class="linenos">5774</span>
<span class="linenos">5775</span><span class="w">    </span><span class="c">! Allocate Header elements</span>
<span class="linenos">5776</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5777</span><span class="w">    </span><span class="c">! Allocate Body elements</span>
<span class="linenos">5778</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5779</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5780</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5781</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5782</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5783</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5784</span><span class="w">    </span><span class="k">call </span><span class="n">utl_reAllocate</span><span class="p">(</span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5785</span>
<span class="linenos">5786</span><span class="w">    </span><span class="c">!Initialization</span>
<span class="linenos">5787</span><span class="w">    </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5788</span><span class="w">    </span><span class="n">btClear</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5789</span><span class="w">    </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5790</span><span class="w">    </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mwbg_realMissing</span><span class="w"></span>
<span class="linenos">5791</span><span class="w">        </span>
<span class="linenos">5792</span><span class="w">    </span><span class="n">stnId</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="n">obs_elem_c</span><span class="w">    </span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;STID&#39;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5793</span><span class="w">    </span><span class="n">satIdentifier</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SAT</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5794</span><span class="w">    </span><span class="n">satZenithAngle</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_SZA</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5795</span><span class="w">    </span><span class="n">landQualifierIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_STYP</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5796</span><span class="w">    </span><span class="n">terrainTypeIndice</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_TTYP</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5797</span>
<span class="linenos">5798</span><span class="w">    </span><span class="c">! If terrain type is missing, set it to -1 for the QC programs</span>
<span class="linenos">5799</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">==</span><span class="w">  </span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5800</span><span class="w">    </span>
<span class="linenos">5801</span><span class="w">    </span><span class="n">obsLat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_LAT</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5802</span><span class="w">    </span><span class="n">obsLon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_LON</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5803</span>
<span class="linenos">5804</span><span class="w">    </span><span class="c">! Convert lat/lon to degrees</span>
<span class="linenos">5805</span><span class="w">    </span><span class="n">obsLon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MPC_DEGREES_PER_RADIAN_R8</span><span class="w"></span>
<span class="linenos">5806</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obsLon</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="mf">0.</span><span class="p">)</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLon</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">36</span><span class="mf">0.</span><span class="w"></span>
<span class="linenos">5807</span><span class="w">    </span><span class="n">obsLat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obsLat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MPC_DEGREES_PER_RADIAN_R8</span><span class="w"></span>
<span class="linenos">5808</span><span class="w">    </span>
<span class="linenos">5809</span><span class="w">    </span><span class="n">satScanPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_FOV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5810</span><span class="w">    </span><span class="n">obsGlobalMarker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ST1</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5811</span><span class="w">    </span><span class="n">satOrbit</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ORBI</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5812</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;ATMS&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then  </span>
<span class="linenos">5813</span><span class="k">      </span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_AQF1</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5814</span><span class="w">      </span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_AQF2</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5815</span><span class="w">      </span><span class="n">obsQcFlag1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_AQF3</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">5816</span><span class="w">    </span><span class="k">end if</span>
<span class="linenos">5817</span>
<span class="linenos">5818</span><span class="k">    </span><span class="n">bodyIndexbeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_RLN</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5819</span><span class="w">    </span><span class="n">obsNumCurrentLoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_NLV</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5820</span><span class="w">    </span><span class="n">codtyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ITY</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5821</span>
<span class="linenos">5822</span><span class="w">    </span><span class="n">BODY</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">bodyIndex</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">bodyIndexbeg</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndexbeg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">obsNumCurrentLoc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5823</span><span class="w">      </span><span class="n">currentChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">obs_bodyElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_PPP</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5824</span><span class="w">                             </span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5825</span><span class="w">      </span><span class="n">obsTb</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_bodyElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_VAR</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5826</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_isInstrumAllskyTtAssim</span><span class="p">(</span><span class="n">tvs_getInstrumentId</span><span class="p">(</span><span class="n">codtyp_get_name</span><span class="p">(</span><span class="n">codtyp</span><span class="p">)))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5827</span><span class="w">          </span><span class="n">tvs_isInstrumAllskyHuAssim</span><span class="p">(</span><span class="n">tvs_getInstrumentId</span><span class="p">(</span><span class="n">codtyp_get_name</span><span class="p">(</span><span class="n">codtyp</span><span class="p">))))</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5828</span><span class="k">        </span><span class="n">btClear</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_bodyElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w">  </span><span class="n">OBS_BTCL</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5829</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5830</span><span class="k">      </span><span class="n">ompTb</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">)</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">obs_bodyElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_OMP</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5831</span><span class="w">      </span><span class="n">obsTbBiasCorr</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_bodyElem_r</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_BCOR</span><span class="p">,</span><span class="n">bodyIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5832</span><span class="w">      </span><span class="n">obsFlags</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">)</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">obs_bodyElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_FLG</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5833</span><span class="w">      </span><span class="n">obsQcFlag2</span><span class="p">(</span><span class="n">currentChannelNumber</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">obs_bodyElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_QCF2</span><span class="p">,</span><span class="w"> </span><span class="n">bodyIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5834</span><span class="w">    </span><span class="k">end do </span><span class="n">BODY</span><span class="w"></span>
<span class="linenos">5835</span>
<span class="linenos">5836</span><span class="w">    </span><span class="k">do </span><span class="n">channelIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w"></span>
<span class="linenos">5837</span><span class="w">      </span><span class="n">obsChannels</span><span class="p">(</span><span class="n">channelIndex</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channelIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tvs_channelOffset</span><span class="p">(</span><span class="n">sensorIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5838</span><span class="w">    </span><span class="k">end do</span>
<span class="linenos">5839</span><span class="k">      </span>
<span class="linenos">5840</span>
<span class="linenos">5841</span><span class="k">  end subroutine </span><span class="n">mwbg_readObsFromObsSpace</span><span class="w"> </span>
<span class="linenos">5842</span>
<span class="linenos">5843</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5844</span><span class="w">  </span><span class="c">! mwbg_mwbg_bgCheckMW</span>
<span class="linenos">5845</span><span class="w">  </span><span class="c">!--------------------------------------------------------------------------</span>
<span class="linenos">5846</span><span class="w">  </span><span class="k">subroutine </span><span class="n">mwbg_bgCheckMW</span><span class="p">(</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos">5847</span>
<span class="linenos">5848</span><span class="w">    </span><span class="c">!:Purpose:        Do the quality control for ATMS, AMSUA, AMSUB and MWHS2</span>
<span class="linenos">5849</span>
<span class="linenos">5850</span><span class="w">    </span><span class="k">implicit None</span><span class="w"></span>
<span class="linenos">5851</span>
<span class="linenos">5852</span><span class="w">    </span><span class="c">!Arguments</span>
<span class="linenos">5853</span><span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">struct_obs</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="w">   </span><span class="c">! obspaceData Object</span>
<span class="linenos">5854</span>
<span class="linenos">5855</span><span class="w">    </span><span class="c">! Locals</span>
<span class="linenos">5856</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">headerIndex</span><span class="w">              </span><span class="c">! header Index</span>
<span class="linenos">5857</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">sensorIndex</span><span class="w">              </span><span class="c">! satellite index in obserror file</span>
<span class="linenos">5858</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="w">         </span><span class="c">! iactual Number of channel for instrument</span>
<span class="linenos">5859</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">codtyp</span><span class="w">                   </span><span class="c">! codetype</span>
<span class="linenos">5860</span><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">stnId</span><span class="w">                    </span><span class="c">! station id in burp file</span>
<span class="linenos">5861</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="w">       </span><span class="c">! topo in standard file interpolated to obs point</span>
<span class="linenos">5862</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="w">        </span><span class="c">! Glace de mer &quot; &quot;</span>
<span class="linenos">5863</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="w">      </span><span class="c">! model interpolated land fraction</span>
<span class="linenos">5864</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLat</span><span class="w">                   </span><span class="c">! obs. point latitudes</span>
<span class="linenos">5865</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">obsLon</span><span class="w">                   </span><span class="c">! obs. point longitude</span>
<span class="linenos">5866</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">satIdentifier</span><span class="w">            </span><span class="c">! Satellite identifier</span>
<span class="linenos">5867</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="w">           </span><span class="c">! sat. satZenithAngle angle</span>
<span class="linenos">5868</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="w">      </span><span class="c">! land qualifyer</span>
<span class="linenos">5869</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="w">        </span><span class="c">! terrain type</span>
<span class="linenos">5870</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTb</span><span class="p">(:)</span><span class="w">                 </span><span class="c">! temperature de brillance</span>
<span class="linenos">5871</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">btClear</span><span class="p">(:)</span><span class="w">               </span><span class="c">! clear-sky BT</span>
<span class="linenos">5872</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">ompTb</span><span class="p">(:)</span><span class="w">                 </span><span class="c">! o-p temperature de &quot;</span>
<span class="linenos">5873</span><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">(:)</span><span class="w">         </span><span class="c">! bias correction fo obsTb</span>
<span class="linenos">5874</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">satScanPosition</span><span class="w">          </span><span class="c">! scan position</span>
<span class="linenos">5875</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">(:)</span><span class="w">            </span><span class="c">! Obs Quality flag 1</span>
<span class="linenos">5876</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">(:)</span><span class="w">            </span><span class="c">! Obs Quality flag 2 </span>
<span class="linenos">5877</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">(:)</span><span class="w">           </span><span class="c">! obsTb channels</span>
<span class="linenos">5878</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">(:)</span><span class="w">              </span><span class="c">! obs. flag</span>
<span class="linenos">5879</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">satOrbit</span><span class="w">                 </span><span class="c">! orbit</span>
<span class="linenos">5880</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="w">          </span><span class="c">! global marker</span>
<span class="linenos">5881</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">(:)</span><span class="w">           </span><span class="c">! indicateur controle de qualite tovs par canal </span>
<span class="linenos">5882</span><span class="w">                                                      </span><span class="c">!  =0 ok, &gt;0 rejet,</span>
<span class="linenos">5883</span><span class="w">    </span><span class="kt">integer</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="w">       </span><span class="c">! ATMS Information flag (newInformationFlag) values </span>
<span class="linenos">5884</span><span class="w">                                                      </span><span class="c">!   (new BURP element  025174 in header). FOR AMSUA </span>
<span class="linenos">5885</span><span class="w">    </span><span class="kt">real</span><span class="w">                  </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathObs</span><span class="w">  </span><span class="c">! cloud liquid water path from observation.</span>
<span class="linenos">5886</span><span class="w">    </span><span class="kt">real</span><span class="w">                  </span><span class="kd">::</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="w">   </span><span class="c">! cloud liquid water path from background.</span>
<span class="linenos">5887</span><span class="w">    </span><span class="kt">real</span><span class="w">                  </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterObs</span><span class="w">    </span><span class="c">! scattering index from observation.</span>
<span class="linenos">5888</span><span class="w">    </span><span class="kt">real</span><span class="w">                  </span><span class="kd">::</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="w">     </span><span class="c">! scattering index from background.</span>
<span class="linenos">5889</span><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">external</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">exdb</span><span class="p">,</span><span class="w"> </span><span class="n">exfin</span><span class="p">,</span><span class="w"> </span><span class="n">fnom</span><span class="p">,</span><span class="w"> </span><span class="n">fclos</span><span class="w"></span>
<span class="linenos">5890</span><span class="w">    </span><span class="kt">logical</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">mwDataPresent</span><span class="w"></span>
<span class="linenos">5891</span><span class="w">    </span><span class="kt">logical</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">lastHeader</span><span class="w">               </span><span class="c">! active while reading last report</span>
<span class="linenos">5892</span>
<span class="linenos">5893</span><span class="w">    </span><span class="k">call </span><span class="n">utl_tmg_start</span><span class="p">(</span><span class="mi">118</span><span class="p">,</span><span class="s1">&#39;--BgckMicrowave&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5894</span><span class="w">    </span><span class="n">mwDataPresent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5895</span><span class="w">    </span><span class="k">call </span><span class="n">obs_set_current_header_list</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="s1">&#39;TO&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5896</span><span class="w">    </span><span class="n">HEADER0</span><span class="p">:</span><span class="w"> </span><span class="k">do</span>
<span class="linenos">5897</span><span class="k">      </span><span class="n">headerIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_getHeaderIndex</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5898</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">headerIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">HEADER0</span><span class="w"></span>
<span class="linenos">5899</span><span class="w">      </span><span class="n">codtyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ITY</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5900</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;atms&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5901</span><span class="w">           </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;amsua&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5902</span><span class="w">           </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;amsub&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">5903</span><span class="w">           </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;mwhs2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5904</span><span class="w">           </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;mhs&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5905</span><span class="k">        </span><span class="n">mwDataPresent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5906</span><span class="w">      </span><span class="k">end if</span>
<span class="linenos">5907</span><span class="k">    end do </span><span class="n">HEADER0</span><span class="w"></span>
<span class="linenos">5908</span>
<span class="linenos">5909</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">mwDataPresent</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then </span>
<span class="linenos">5910</span><span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: WILL NOT RUN mwbg_bgCheckMW since no ATMS or AMSUA or MWHS2&#39;</span><span class="w"></span>
<span class="linenos">5911</span><span class="w">      </span><span class="k">return</span>
<span class="linenos">5912</span><span class="k">    end if </span>
<span class="linenos">5913</span>
<span class="linenos">5914</span><span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; MWBG QC PROGRAM STARTS ....&#39;</span><span class="w"></span>
<span class="linenos">5915</span><span class="w">    </span><span class="c">! read nambgck</span>
<span class="linenos">5916</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_init</span><span class="p">()</span><span class="w"></span>
<span class="linenos">5917</span>
<span class="linenos">5918</span><span class="w">    </span><span class="c">!Quality Control loop over all observations</span>
<span class="linenos">5919</span><span class="w">    </span><span class="c">!</span>
<span class="linenos">5920</span><span class="w">    </span><span class="c">! loop over all header indices of the specified family with surface obs</span>
<span class="linenos">5921</span><span class="w">    </span><span class="n">lastHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5922</span>
<span class="linenos">5923</span><span class="w">    </span><span class="k">call </span><span class="n">obs_set_current_header_list</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="s1">&#39;TO&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5924</span><span class="w">    </span><span class="n">HEADER</span><span class="p">:</span><span class="w"> </span><span class="k">do</span>
<span class="linenos">5925</span><span class="k">      </span><span class="n">headerIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_getHeaderIndex</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5926</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">headerIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">HEADER</span><span class="w"></span>
<span class="linenos">5927</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">headerIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">obs_numHeader</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">))</span><span class="w"> </span><span class="n">lastHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="linenos">5928</span><span class="w">      </span><span class="n">codtyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_headElem_i</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">OBS_ITY</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5929</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;AMSUB&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5930</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;amsub&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5931</span><span class="w">             </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;mhs&#39;</span><span class="w">  </span><span class="p">)</span><span class="w">  </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5932</span><span class="w">             </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="s1">&#39;mwhs2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5933</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Observation with codtyp = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">codtyp</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; is not &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">instName</span><span class="w"></span>
<span class="linenos">5934</span><span class="w">          </span><span class="k">cycle </span><span class="n">HEADER</span><span class="w"></span>
<span class="linenos">5935</span><span class="w">        </span><span class="k">end if </span>
<span class="linenos">5936</span><span class="k">      else</span>
<span class="linenos">5937</span><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">tvs_isIdBurpInst</span><span class="p">(</span><span class="n">codtyp</span><span class="p">,</span><span class="n">instName</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5938</span><span class="k">          write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;WARNING: Observation with codtyp = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">codtyp</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; is not &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">instName</span><span class="w"></span>
<span class="linenos">5939</span><span class="w">          </span><span class="k">cycle </span><span class="n">HEADER</span><span class="w"></span>
<span class="linenos">5940</span><span class="w">        </span><span class="k">end if</span>
<span class="linenos">5941</span><span class="k">      end if</span><span class="w"></span>
<span class="linenos">5942</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">5943</span><span class="w">      </span><span class="c">! STEP 1) read obs from obsSpacedata to start QC                               !</span>
<span class="linenos">5944</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">5945</span>
<span class="linenos">5946</span><span class="w">      </span><span class="k">call </span><span class="n">mwbg_readObsFromObsSpace</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5947</span><span class="w">                                   </span><span class="n">satIdentifier</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5948</span><span class="w">                                   </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5949</span><span class="w">                                   </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="n">satOrbit</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5950</span><span class="w">                                   </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5951</span><span class="w">                                   </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5952</span><span class="w">                                   </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">obsSpaceData</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5953</span>
<span class="linenos">5954</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">5955</span><span class="w">      </span><span class="c">! STEP 3) Interpolation de le champ MX(topogrpahy), MG et GL aux pts TOVS.</span>
<span class="linenos">5956</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">5957</span><span class="w">      </span><span class="k">call </span><span class="n">mwbg_readGeophysicFieldsAndInterpolate</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5958</span><span class="w">                                                  </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpSeaIce</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5959</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">5960</span><span class="w">      </span><span class="c">! STEP 4) Controle de qualite des TOVS. Data QC flags (obsFlags) are modified here!</span>
<span class="linenos">5961</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">5962</span>
<span class="linenos">5963</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;AMSUA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5964</span><span class="k">        call </span><span class="n">mwbg_tovCheckAmsua</span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5965</span><span class="w">                                </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5966</span><span class="w">                                </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,&amp;</span><span class="w"></span>
<span class="linenos">5967</span><span class="w">                                </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5968</span><span class="w">                                </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5969</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5970</span><span class="w">                                </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5971</span><span class="w">                                </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">obsLat</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5972</span><span class="w">      </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;AMSUB&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5973</span><span class="k">        call </span><span class="n">mwbg_tovCheckAmsub</span><span class="p">(</span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">btClear</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5974</span><span class="w">                                </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5975</span><span class="w">                                </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpLandFrac</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,&amp;</span><span class="w"></span>
<span class="linenos">5976</span><span class="w">                                </span><span class="n">modelInterpSeaIce</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5977</span><span class="w">                                </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">5978</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5979</span><span class="w">                                </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5980</span><span class="w">      </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;ATMS&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5981</span><span class="k">        call </span><span class="n">mwbg_tovCheckAtms</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5982</span><span class="w">                               </span><span class="n">obsQcFlag2</span><span class="p">,</span><span class="w"> </span><span class="n">obsQcFlag1</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5983</span><span class="w">                               </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5984</span><span class="w">                               </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w"> </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5985</span><span class="w">                               </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5986</span><span class="w">                               </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5987</span><span class="w">                               </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5988</span><span class="w">      </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">instName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;MWHS2&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">5989</span><span class="k">        call </span><span class="n">mwbg_tovCheckMwhs2</span><span class="p">(</span><span class="n">obsLat</span><span class="p">,</span><span class="w"> </span><span class="n">obsLon</span><span class="p">,</span><span class="w"> </span><span class="n">landQualifierIndice</span><span class="p">,</span><span class="w"> </span><span class="n">terrainTypeIndice</span><span class="p">,</span><span class="w"> </span><span class="n">satZenithAngle</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5990</span><span class="w">                                </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsTbBiasCorr</span><span class="p">,</span><span class="w"> </span><span class="n">ompTb</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5991</span><span class="w">                                </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5992</span><span class="w">                                </span><span class="n">newInformationFlag</span><span class="p">,</span><span class="w"> </span><span class="n">satScanPosition</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5993</span><span class="w">                                </span><span class="n">modelInterpTerrain</span><span class="p">,</span><span class="w"> </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5994</span><span class="w">                                </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5995</span><span class="w">                                </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">5996</span><span class="w">                                </span><span class="n">stnId</span><span class="p">,</span><span class="w"> </span><span class="n">RESETQC</span><span class="p">,</span><span class="w"> </span><span class="n">modLSQ</span><span class="p">,</span><span class="w"> </span><span class="n">lastHeader</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5997</span><span class="w">      </span><span class="k">else</span>
<span class="linenos">5998</span><span class="k">        write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;midas-bgckMW: instName = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">instName</span><span class="w"></span>
<span class="linenos">5999</span><span class="w">        </span><span class="k">call </span><span class="n">utl_abort</span><span class="p">(</span><span class="s1">&#39;midas-bgckMW: unknown instName&#39;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">6000</span><span class="w">      </span><span class="k">end if</span><span class="w"></span>
<span class="linenos">6001</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">6002</span><span class="w">      </span><span class="c">! STEP 5) Accumuler Les statistiques sur les rejets</span>
<span class="linenos">6003</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">6004</span><span class="w">      </span><span class="k">call </span><span class="n">mwbg_qcStats</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">6005</span><span class="w">                        </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">tvs_satelliteName</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">tvs_nsensors</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">6006</span><span class="w">                        </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.)</span><span class="w"></span>
<span class="linenos">6007</span>
<span class="linenos">6008</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">6009</span><span class="w">      </span><span class="c">! STEP 6) Update Flags and obs in obsspace data</span>
<span class="linenos">6010</span><span class="w">      </span><span class="c">!###############################################################################</span>
<span class="linenos">6011</span><span class="w">      </span><span class="k">call </span><span class="n">mwbg_updateObsSpaceAfterQc</span><span class="p">(</span><span class="n">obsSpaceData</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w"> </span><span class="n">headerIndex</span><span class="p">,</span><span class="w"> </span><span class="n">obsTb</span><span class="p">,</span><span class="w"> </span><span class="n">obsFlags</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">6012</span><span class="w">                                      </span><span class="n">cloudLiquidWaterPathObs</span><span class="p">,</span><span class="w"> </span><span class="n">cloudLiquidWaterPathFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">6013</span><span class="w">                                      </span><span class="n">scatIndexOverWaterObs</span><span class="p">,</span><span class="w"> </span><span class="n">scatIndexOverWaterFG</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">6014</span><span class="w">                                      </span><span class="n">obsGlobalMarker</span><span class="p">,</span><span class="w"> </span><span class="n">newInformationFlag</span><span class="p">)</span><span class="w"></span>
<span class="linenos">6015</span>
<span class="linenos">6016</span><span class="w">    </span><span class="k">end do </span><span class="n">HEADER</span><span class="w"></span>
<span class="linenos">6017</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">6018</span><span class="w">    </span><span class="c">! STEP 7) Print the statistics in listing file </span>
<span class="linenos">6019</span><span class="w">    </span><span class="c">!###############################################################################</span>
<span class="linenos">6020</span><span class="w">    </span><span class="k">call </span><span class="n">mwbg_qcStats</span><span class="p">(</span><span class="n">instName</span><span class="p">,</span><span class="w"> </span><span class="n">qcIndicator</span><span class="p">,</span><span class="w"> </span><span class="n">obsChannels</span><span class="p">,</span><span class="w"> </span><span class="n">sensorIndex</span><span class="p">,</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="linenos">6021</span><span class="w">                      </span><span class="n">actualNumChannel</span><span class="p">,</span><span class="w"> </span><span class="n">tvs_satelliteName</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">tvs_nsensors</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>
<span class="linenos">6022</span><span class="w">                      </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.)</span><span class="w"></span>
<span class="linenos">6023</span>
<span class="linenos">6024</span><span class="w">    </span><span class="k">call </span><span class="n">utl_tmg_stop</span><span class="p">(</span><span class="mi">118</span><span class="p">)</span><span class="w"></span>
<span class="linenos">6025</span>
<span class="linenos">6026</span><span class="w">  </span><span class="k">end subroutine </span><span class="n">mwbg_bgCheckMW</span><span class="w"> </span>
<span class="linenos">6027</span>
<span class="linenos">6028</span><span class="k">end module </span><span class="n">bgckmicrowave_mod</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
</section>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../f-modindex.html" title="Fortran Module Index"
             >fortran modules</a> |</li>
        <li><a href="../index.html">MIDAS  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2018, ECCC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>